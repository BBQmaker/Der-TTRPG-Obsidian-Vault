/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var N1=Object.create;var wi=Object.defineProperty;var B1=Object.getOwnPropertyDescriptor;var V1=Object.getOwnPropertyNames;var H1=Object.getPrototypeOf,q1=Object.prototype.hasOwnProperty;var z1=(o,e,t)=>e in o?wi(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var ou=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),nu=(o,e)=>{for(var t in e)wi(o,t,{get:e[t],enumerable:!0})},dh=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of V1(e))!q1.call(o,n)&&n!==t&&wi(o,n,{get:()=>e[n],enumerable:!(r=B1(e,n))||r.enumerable});return o};var ln=(o,e,t)=>(t=o!=null?N1(H1(o)):{},dh(e||!o||!o.__esModule?wi(t,"default",{value:o,enumerable:!0}):t,o)),j1=o=>dh(wi({},"__esModule",{value:!0}),o);var vt=(o,e,t)=>(z1(o,typeof e!="symbol"?e+"":e,t),t);var $n=ou((sD,mh)=>{"use strict";function ao(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function ph(o,e){for(var t="",r=0,n=-1,s=0,i,a=0;a<=o.length;++a){if(a<o.length)i=o.charCodeAt(a);else{if(i===47)break;i=47}if(i===47){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=a,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=a,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,a):t=o.slice(n+1,a),r=a-n-1;n=a,s=0}else i===46&&s!==-1?++s:s=-1}return t}function W1(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var hs={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),ao(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=ph(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(ao(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=ph(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return ao(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];ao(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":hs.normalize(e)},relative:function(e,t){if(ao(e),ao(t),e===t||(e=hs.resolve(e),t=hs.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,i=1;i<t.length&&t.charCodeAt(i)===47;++i);for(var a=t.length,l=a-i,c=s<l?s:l,u=-1,f=0;f<=c;++f){if(f===c){if(l>c){if(t.charCodeAt(i+f)===47)return t.slice(i+f+1);if(f===0)return t.slice(i+f)}else s>c&&(e.charCodeAt(r+f)===47?u=f:f===0&&(u=0));break}var d=e.charCodeAt(r+f),p=t.charCodeAt(i+f);if(d!==p)break;d===47&&(u=f)}var m="";for(f=r+u+1;f<=n;++f)(f===n||e.charCodeAt(f)===47)&&(m.length===0?m+="..":m+="/..");return m.length>0?m+t.slice(i+u):(i+=u,t.charCodeAt(i)===47&&++i,t.slice(i))},_makeLong:function(e){return e},dirname:function(e){if(ao(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,i=e.length-1;i>=1;--i)if(t=e.charCodeAt(i),t===47){if(!s){n=i;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');ao(e);var r=0,n=-1,s=!0,i;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,l=-1;for(i=e.length-1;i>=0;--i){var c=e.charCodeAt(i);if(c===47){if(!s){r=i+1;break}}else l===-1&&(s=!1,l=i+1),a>=0&&(c===t.charCodeAt(a)?--a===-1&&(n=i):(a=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(i=e.length-1;i>=0;--i)if(e.charCodeAt(i)===47){if(!s){r=i+1;break}}else n===-1&&(s=!1,n=i+1);return n===-1?"":e.slice(r,n)}},extname:function(e){ao(e);for(var t=-1,r=0,n=-1,s=!0,i=0,a=e.length-1;a>=0;--a){var l=e.charCodeAt(a);if(l===47){if(!s){r=a+1;break}continue}n===-1&&(s=!1,n=a+1),l===46?t===-1?t=a:i!==1&&(i=1):t!==-1&&(i=-1)}return t===-1||n===-1||i===0||i===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return W1("/",e)},parse:function(e){ao(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var i=-1,a=0,l=-1,c=!0,u=e.length-1,f=0;u>=s;--u){if(r=e.charCodeAt(u),r===47){if(!c){a=u+1;break}continue}l===-1&&(c=!1,l=u+1),r===46?i===-1?i=u:f!==1&&(f=1):i!==-1&&(f=-1)}return i===-1||l===-1||f===0||f===1&&i===l-1&&i===a+1?l!==-1&&(a===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(a,l)):(a===0&&n?(t.name=e.slice(1,i),t.base=e.slice(1,l)):(t.name=e.slice(a,i),t.base=e.slice(a,l)),t.ext=e.slice(i,l)),a>0?t.dir=e.slice(0,a-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};hs.posix=hs;mh.exports=hs});var kf=ou((J3,Ks)=>{var de=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},it=-1,lt=1,Ke=0;de.Diff=function(o,e){return[o,e]};de.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new de.Diff(Ke,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,i=this.diff_commonPrefix(o,e),a=o.substring(0,i);o=o.substring(i),e=e.substring(i),i=this.diff_commonSuffix(o,e);var l=o.substring(o.length-i);o=o.substring(0,o.length-i),e=e.substring(0,e.length-i);var c=this.diff_compute_(o,e,s,n);return a&&c.unshift(new de.Diff(Ke,a)),l&&c.push(new de.Diff(Ke,l)),this.diff_cleanupMerge(c),c};de.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new de.Diff(lt,e)];if(!e)return[new de.Diff(it,o)];var s=o.length>e.length?o:e,i=o.length>e.length?e:o,a=s.indexOf(i);if(a!=-1)return n=[new de.Diff(lt,s.substring(0,a)),new de.Diff(Ke,i),new de.Diff(lt,s.substring(a+i.length))],o.length>e.length&&(n[0][0]=n[2][0]=it),n;if(i.length==1)return[new de.Diff(it,o),new de.Diff(lt,e)];var l=this.diff_halfMatch_(o,e);if(l){var c=l[0],u=l[1],f=l[2],d=l[3],p=l[4],m=this.diff_main(c,f,t,r),y=this.diff_main(u,d,t,r);return m.concat([new de.Diff(Ke,p)],y)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};de.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new de.Diff(Ke,""));for(var i=0,a=0,l=0,c="",u="";i<s.length;){switch(s[i][0]){case lt:l++,u+=s[i][1];break;case it:a++,c+=s[i][1];break;case Ke:if(a>=1&&l>=1){s.splice(i-a-l,a+l),i=i-a-l;for(var f=this.diff_main(c,u,!1,t),d=f.length-1;d>=0;d--)s.splice(i,0,f[d]);i=i+f.length}l=0,a=0,c="",u="";break}i++}return s.pop(),s};de.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),i=s,a=2*s,l=new Array(a),c=new Array(a),u=0;u<a;u++)l[u]=-1,c[u]=-1;l[i+1]=0,c[i+1]=0;for(var f=r-n,d=f%2!=0,p=0,m=0,y=0,g=0,k=0;k<s&&!(new Date().getTime()>t);k++){for(var L=-k+p;L<=k-m;L+=2){var I=i+L,C;L==-k||L!=k&&l[I-1]<l[I+1]?C=l[I+1]:C=l[I-1]+1;for(var A=C-L;C<r&&A<n&&o.charAt(C)==e.charAt(A);)C++,A++;if(l[I]=C,C>r)m+=2;else if(A>n)p+=2;else if(d){var M=i+f-L;if(M>=0&&M<a&&c[M]!=-1){var P=r-c[M];if(C>=P)return this.diff_bisectSplit_(o,e,C,A,t)}}}for(var O=-k+y;O<=k-g;O+=2){var M=i+O,P;O==-k||O!=k&&c[M-1]<c[M+1]?P=c[M+1]:P=c[M-1]+1;for(var T=P-O;P<r&&T<n&&o.charAt(r-P-1)==e.charAt(n-T-1);)P++,T++;if(c[M]=P,P>r)g+=2;else if(T>n)y+=2;else if(!d){var I=i+f-O;if(I>=0&&I<a&&l[I]!=-1){var C=l[I],A=i+C-I;if(P=r-P,C>=P)return this.diff_bisectSplit_(o,e,C,A,t)}}}}return[new de.Diff(it,o),new de.Diff(lt,e)]};de.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),i=e.substring(0,r),a=o.substring(t),l=e.substring(r),c=this.diff_main(s,i,!1,n),u=this.diff_main(a,l,!1,n);return c.concat(u)};de.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var c="",u=0,f=-1,d=t.length;f<l.length-1;){f=l.indexOf(`
`,u),f==-1&&(f=l.length-1);var p=l.substring(u,f+1);(r.hasOwnProperty?r.hasOwnProperty(p):r[p]!==void 0)?c+=String.fromCharCode(r[p]):(d==s&&(p=l.substring(u),f=l.length),c+=String.fromCharCode(d),r[p]=d,t[d++]=p),u=f+1}return c}var s=4e4,i=n(o);s=65535;var a=n(e);return{chars1:i,chars2:a,lineArray:t}};de.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};de.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};de.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};de.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,i=1;;){var a=o.substring(n-i),l=e.indexOf(a);if(l==-1)return s;i+=l,(l==0||o.substring(n-i)==e.substring(0,i))&&(s=i,i++)}};de.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(m,y,g){for(var k=m.substring(g,g+Math.floor(m.length/4)),L=-1,I="",C,A,M,P;(L=y.indexOf(k,L+1))!=-1;){var O=n.diff_commonPrefix(m.substring(g),y.substring(L)),T=n.diff_commonSuffix(m.substring(0,g),y.substring(0,L));I.length<T+O&&(I=y.substring(L-T,L)+y.substring(L,L+O),C=m.substring(0,g-T),A=m.substring(g+O),M=y.substring(0,L-T),P=y.substring(L+O))}return I.length*2>=m.length?[C,A,M,P,I]:null}var i=s(t,r,Math.ceil(t.length/4)),a=s(t,r,Math.ceil(t.length/2)),l;if(!i&&!a)return null;a?i?l=i[4].length>a[4].length?i:a:l=a:l=i;var c,u,f,d;o.length>e.length?(c=l[0],u=l[1],f=l[2],d=l[3]):(f=l[0],d=l[1],c=l[2],u=l[3]);var p=l[4];return[c,u,f,d,p]};de.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=0,a=0,l=0,c=0;s<o.length;)o[s][0]==Ke?(t[r++]=s,i=l,a=c,l=0,c=0,n=o[s][1]):(o[s][0]==lt?l+=o[s][1].length:c+=o[s][1].length,n&&n.length<=Math.max(i,a)&&n.length<=Math.max(l,c)&&(o.splice(t[r-1],0,new de.Diff(it,n)),o[t[r-1]+1][0]=lt,r--,r--,s=r>0?t[r-1]:-1,i=0,a=0,l=0,c=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==it&&o[s][0]==lt){var u=o[s-1][1],f=o[s][1],d=this.diff_commonOverlap_(u,f),p=this.diff_commonOverlap_(f,u);d>=p?(d>=u.length/2||d>=f.length/2)&&(o.splice(s,0,new de.Diff(Ke,f.substring(0,d))),o[s-1][1]=u.substring(0,u.length-d),o[s+1][1]=f.substring(d),s++):(p>=u.length/2||p>=f.length/2)&&(o.splice(s,0,new de.Diff(Ke,u.substring(0,p))),o[s-1][0]=lt,o[s-1][1]=f.substring(0,f.length-p),o[s+1][0]=it,o[s+1][1]=u.substring(p),s++),s++}s++}};de.prototype.diff_cleanupSemanticLossless=function(o){function e(p,m){if(!p||!m)return 6;var y=p.charAt(p.length-1),g=m.charAt(0),k=y.match(de.nonAlphaNumericRegex_),L=g.match(de.nonAlphaNumericRegex_),I=k&&y.match(de.whitespaceRegex_),C=L&&g.match(de.whitespaceRegex_),A=I&&y.match(de.linebreakRegex_),M=C&&g.match(de.linebreakRegex_),P=A&&p.match(de.blanklineEndRegex_),O=M&&m.match(de.blanklineStartRegex_);return P||O?5:A||M?4:k&&!I&&C?3:I||C?2:k||L?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==Ke&&o[t+1][0]==Ke){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],i=this.diff_commonSuffix(r,n);if(i){var a=n.substring(n.length-i);r=r.substring(0,r.length-i),n=a+n.substring(0,n.length-i),s=a+s}for(var l=r,c=n,u=s,f=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var d=e(r,n)+e(n,s);d>=f&&(f=d,l=r,c=n,u=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=c,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};de.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;de.whitespaceRegex_=/\s/;de.linebreakRegex_=/[\r\n]/;de.blanklineEndRegex_=/\n\r?\n$/;de.blanklineStartRegex_=/^\r?\n\r?\n/;de.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,i=!1,a=!1,l=!1,c=!1;s<o.length;)o[s][0]==Ke?(o[s][1].length<this.Diff_EditCost&&(l||c)?(t[r++]=s,i=l,a=c,n=o[s][1]):(r=0,n=null),l=c=!1):(o[s][0]==it?c=!0:l=!0,n&&(i&&a&&l&&c||n.length<this.Diff_EditCost/2&&i+a+l+c==3)&&(o.splice(t[r-1],0,new de.Diff(it,n)),o[t[r-1]+1][0]=lt,r--,n=null,i&&a?(l=c=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};de.prototype.diff_cleanupMerge=function(o){o.push(new de.Diff(Ke,""));for(var e=0,t=0,r=0,n="",s="",i;e<o.length;)switch(o[e][0]){case lt:r++,s+=o[e][1],e++;break;case it:t++,n+=o[e][1],e++;break;case Ke:t+r>1?(t!==0&&r!==0&&(i=this.diff_commonPrefix(s,n),i!==0&&(e-t-r>0&&o[e-t-r-1][0]==Ke?o[e-t-r-1][1]+=s.substring(0,i):(o.splice(0,0,new de.Diff(Ke,s.substring(0,i))),e++),s=s.substring(i),n=n.substring(i)),i=this.diff_commonSuffix(s,n),i!==0&&(o[e][1]=s.substring(s.length-i)+o[e][1],s=s.substring(0,s.length-i),n=n.substring(0,n.length-i))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new de.Diff(it,n)),e++),s.length&&(o.splice(e,0,new de.Diff(lt,s)),e++),e++):e!==0&&o[e-1][0]==Ke?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var a=!1;for(e=1;e<o.length-1;)o[e-1][0]==Ke&&o[e+1][0]==Ke&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),a=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),a=!0)),e++;a&&this.diff_cleanupMerge(o)};de.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,i;for(i=0;i<o.length&&(o[i][0]!==lt&&(t+=o[i][1].length),o[i][0]!==it&&(r+=o[i][1].length),!(t>e));i++)n=t,s=r;return o.length!=i&&o[i][0]===it?s:s+(e-n)};de.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,i=0;i<o.length;i++){var a=o[i][0],l=o[i][1],c=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(a){case lt:e[i]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case it:e[i]='<del style="background:#ffe6e6;">'+c+"</del>";break;case Ke:e[i]="<span>"+c+"</span>";break}}return e.join("")};de.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==lt&&(e[t]=o[t][1]);return e.join("")};de.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==it&&(e[t]=o[t][1]);return e.join("")};de.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],i=o[n][1];switch(s){case lt:t+=i.length;break;case it:r+=i.length;break;case Ke:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};de.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case lt:e[t]="+"+encodeURI(o[t][1]);break;case it:e[t]="-"+o[t][1].length;break;case Ke:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};de.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),i=0;i<s.length;i++){var a=s[i].substring(1);switch(s[i].charAt(0)){case"+":try{t[r++]=new de.Diff(lt,decodeURI(a))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+a)}break;case"-":case"=":var l=parseInt(a,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+a);var c=o.substring(n,n+=l);s[i].charAt(0)=="="?t[r++]=new de.Diff(Ke,c):t[r++]=new de.Diff(it,c);break;default:if(s[i])throw new Error("Invalid diff operation in diff_fromDelta: "+s[i])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};de.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};de.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(C,A){var M=C/e.length,P=Math.abs(t-A);return n.Match_Distance?M+P/n.Match_Distance:P?1:M}var i=this.Match_Threshold,a=o.indexOf(e,t);a!=-1&&(i=Math.min(s(0,a),i),a=o.lastIndexOf(e,t+e.length),a!=-1&&(i=Math.min(s(0,a),i)));var l=1<<e.length-1;a=-1;for(var c,u,f=e.length+o.length,d,p=0;p<e.length;p++){for(c=0,u=f;c<u;)s(p,t+u)<=i?c=u:f=u,u=Math.floor((f-c)/2+c);f=u;var m=Math.max(1,t-u+1),y=Math.min(t+u,o.length)+e.length,g=Array(y+2);g[y+1]=(1<<p)-1;for(var k=y;k>=m;k--){var L=r[o.charAt(k-1)];if(p===0?g[k]=(g[k+1]<<1|1)&L:g[k]=(g[k+1]<<1|1)&L|((d[k+1]|d[k])<<1|1)|d[k+1],g[k]&l){var I=s(p,k-1);if(I<=i)if(i=I,a=k-1,a>t)m=Math.max(1,2*t-a);else break}}if(s(p+1,t)>i)break;d=g}return a};de.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};de.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new de.Diff(Ke,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new de.Diff(Ke,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};de.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],i=new de.patch_obj,a=0,l=0,c=0,u=r,f=r,d=0;d<n.length;d++){var p=n[d][0],m=n[d][1];switch(!a&&p!==Ke&&(i.start1=l,i.start2=c),p){case lt:i.diffs[a++]=n[d],i.length2+=m.length,f=f.substring(0,c)+m+f.substring(c);break;case it:i.length1+=m.length,i.diffs[a++]=n[d],f=f.substring(0,c)+f.substring(c+m.length);break;case Ke:m.length<=2*this.Patch_Margin&&a&&n.length!=d+1?(i.diffs[a++]=n[d],i.length1+=m.length,i.length2+=m.length):m.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(i,u),s.push(i),i=new de.patch_obj,a=0,u=f,l=c);break}p!==lt&&(l+=m.length),p!==it&&(c+=m.length)}return a&&(this.patch_addContext_(i,u),s.push(i)),s};de.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new de.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new de.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};de.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var i=o[s].start2+r,a=this.diff_text1(o[s].diffs),l,c=-1;if(a.length>this.Match_MaxBits?(l=this.match_main(e,a.substring(0,this.Match_MaxBits),i),l!=-1&&(c=this.match_main(e,a.substring(a.length-this.Match_MaxBits),i+a.length-this.Match_MaxBits),(c==-1||l>=c)&&(l=-1))):l=this.match_main(e,a,i),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-i;var u;if(c==-1?u=e.substring(l,l+a.length):u=e.substring(l,c+this.Match_MaxBits),a==u)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+a.length);else{var f=this.diff_main(a,u,!1);if(a.length>this.Match_MaxBits&&this.diff_levenshtein(f)/a.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(f);for(var d=0,p,m=0;m<o[s].diffs.length;m++){var y=o[s].diffs[m];y[0]!==Ke&&(p=this.diff_xIndex(f,d)),y[0]===lt?e=e.substring(0,l+p)+y[1]+e.substring(l+p):y[0]===it&&(e=e.substring(0,l+p)+e.substring(l+this.diff_xIndex(f,d+y[1].length))),y[0]!==it&&(d+=y[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};de.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=Ke)s.unshift(new de.Diff(Ke,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var i=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=Ke)s.push(new de.Diff(Ke,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var i=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,i),n.length1+=i,n.length2+=i}return t};de.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,i="";r.diffs.length!==0;){var a=new de.patch_obj,l=!0;for(a.start1=n-i.length,a.start2=s-i.length,i!==""&&(a.length1=a.length2=i.length,a.diffs.push(new de.Diff(Ke,i)));r.diffs.length!==0&&a.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],u=r.diffs[0][1];c===lt?(a.length2+=u.length,s+=u.length,a.diffs.push(r.diffs.shift()),l=!1):c===it&&a.diffs.length==1&&a.diffs[0][0]==Ke&&u.length>2*e?(a.length1+=u.length,n+=u.length,l=!1,a.diffs.push(new de.Diff(c,u)),r.diffs.shift()):(u=u.substring(0,e-a.length1-this.Patch_Margin),a.length1+=u.length,n+=u.length,c===Ke?(a.length2+=u.length,s+=u.length):l=!1,a.diffs.push(new de.Diff(c,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}i=this.diff_text2(a.diffs),i=i.substring(i.length-this.Patch_Margin);var f=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);f!==""&&(a.length1+=f.length,a.length2+=f.length,a.diffs.length!==0&&a.diffs[a.diffs.length-1][0]===Ke?a.diffs[a.diffs.length-1][1]+=f:a.diffs.push(new de.Diff(Ke,f))),l||o.splice(++t,0,a)}}};de.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};de.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var i=new de.patch_obj;for(e.push(i),i.start1=parseInt(s[1],10),s[2]===""?(i.start1--,i.length1=1):s[2]=="0"?i.length1=0:(i.start1--,i.length1=parseInt(s[2],10)),i.start2=parseInt(s[3],10),s[4]===""?(i.start2--,i.length2=1):s[4]=="0"?i.length2=0:(i.start2--,i.length2=parseInt(s[4],10)),r++;r<t.length;){var a=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(c){throw new Error("Illegal escape in patch_fromText: "+l)}if(a=="-")i.diffs.push(new de.Diff(it,l));else if(a=="+")i.diffs.push(new de.Diff(lt,l));else if(a==" ")i.diffs.push(new de.Diff(Ke,l));else{if(a=="@")break;if(a!=="")throw new Error('Invalid patch mode "'+a+'" in: '+l)}r++}}return e};de.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};de.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case lt:r="+";break;case it:r="-";break;case Ke:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};Ks.exports=de;Ks.exports.diff_match_patch=de;Ks.exports.DIFF_DELETE=it;Ks.exports.DIFF_INSERT=lt;Ks.exports.DIFF_EQUAL=Ke});var Ky=ou((U4,Wy)=>{var Hy=require("url").parse,CI=require("events"),LI=require("https"),TI=require("http"),AI=require("util"),MI=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],jy=[239,187,191],FI=58,PI=32,qy=10,EI=13,zy=1024*256,RI=/^(cookie|authorization)$/i;function DI(o){return jy.every(function(e,t){return o[t]===e})}function wt(o,e){var t=wt.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function i(g){t!==wt.CLOSED&&(t=wt.CONNECTING,m("error",new Yi("error",{message:g})),d&&(o=d,d=null,n=!1),setTimeout(function(){t!==wt.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,p())},s.reconnectInterval))}var a,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var c=!1,u="",f="",d=null;function p(){var g=Hy(o),k=g.protocol==="https:";if(g.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(g.headers["Last-Event-ID"]=l),r){var L=n?OI(r):r;for(var I in L){var C=L[I];C&&(g.headers[I]=C)}}g.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(g.createConnection=e.createConnection);var A=e&&e.proxy;if(A){var M=Hy(e.proxy);k=M.protocol==="https:",g.protocol=k?"https:":"http:",g.path=o,g.headers.Host=g.host,g.hostname=M.hostname,g.host=M.host,g.port=M.port}if(e&&e.https){for(var P in e.https)if(MI.indexOf(P)!==-1){var O=e.https[P];O!==void 0&&(g[P]=O)}}e&&e.withCredentials!==void 0&&(g.withCredentials=e.withCredentials),a=(k?LI:TI).request(g,function(T){if(s.connectionInProgress=!1,T.statusCode===500||T.statusCode===502||T.statusCode===503||T.statusCode===504){m("error",new Yi("error",{status:T.statusCode,message:T.statusMessage})),i();return}if(T.statusCode===301||T.statusCode===302||T.statusCode===307){var U=T.headers.location;if(!U){m("error",new Yi("error",{status:T.statusCode,message:T.statusMessage}));return}var j=new URL(o).origin,Q=new URL(U).origin;n=j!==Q,T.statusCode===307&&(d=o),o=U,process.nextTick(p);return}if(T.statusCode!==200)return m("error",new Yi("error",{status:T.statusCode,message:T.statusMessage})),s.close();t=wt.OPEN,T.on("close",function(){T.removeAllListeners("close"),T.removeAllListeners("end"),i()}),T.on("end",function(){T.removeAllListeners("close"),T.removeAllListeners("end"),i()}),m("open",new Yi("open"));var N,X,$=0,B=-1,pe=0,Z=0;T.on("data",function(ae){N?(ae.length>N.length-Z&&(pe=N.length*2+ae.length,pe>zy&&(pe=N.length+ae.length+zy),X=Buffer.alloc(pe),N.copy(X,0,0,Z),N=X),ae.copy(N,Z),Z+=ae.length):(N=ae,DI(N)&&(N=N.slice(jy.length)),Z=N.length);for(var ue=0,ee=Z;ue<ee;){c&&(N[ue]===qy&&++ue,c=!1);for(var q=-1,Y=B,Te,fe=$;q<0&&fe<ee;++fe)Te=N[fe],Te===FI?Y<0&&(Y=fe-ue):Te===EI?(c=!0,q=fe-ue):Te===qy&&(q=fe-ue);if(q<0){$=ee-ue,B=Y;break}else $=0,B=-1;y(N,ue,Y,q),ue+=q+1}ue===ee?(N=void 0,Z=0):ue>0&&(N=N.slice(ue,Z),Z=N.length)})}),a.on("error",function(T){s.connectionInProgress=!1,i(T.message)}),a.setNoDelay&&a.setNoDelay(!0),a.end()}p();function m(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==wt.CLOSED&&(t=wt.CLOSED,a.abort&&a.abort(),a.xhr&&a.xhr.abort&&a.xhr.abort())};function y(g,k,L,I){if(I===0){if(u.length>0){var C=f||"message";m(C,new UI(C,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}f=void 0}else if(L>0){var A=L<0,M=0,P=g.slice(k,k+(A?I:L)).toString();A?M=I:g[k+L+1]!==PI?M=L+1:M=L+2,k+=M;var O=I-M,T=g.slice(k,k+O).toString();if(P==="data")u+=T+`
`;else if(P==="event")f=T;else if(P==="id")l=T;else if(P==="retry"){var U=parseInt(T,10);Number.isNaN(U)||(s.reconnectInterval=U)}}}}Wy.exports=wt;AI.inherits(wt,CI.EventEmitter);wt.prototype.constructor=wt;["open","error","message"].forEach(function(o){Object.defineProperty(wt.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(wt,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(wt,"OPEN",{enumerable:!0,value:1});Object.defineProperty(wt,"CLOSED",{enumerable:!0,value:2});wt.prototype.CONNECTING=0;wt.prototype.OPEN=1;wt.prototype.CLOSED=2;wt.prototype.close=function(){this._close()};wt.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};wt.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};wt.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Yi(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function UI(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function OI(o){var e={};for(var t in o)RI.test(t)||(e[t]=o[t]);return e}});var oD={};nu(oD,{default:()=>tu});module.exports=j1(oD);var ot=require("obsidian"),C1=require("obsidian"),L1=ln($n());var tt=require("obsidian");var Ut=()=>new Map,Aa=o=>{let e=Ut();return o.forEach((t,r)=>{e.set(r,t)}),e},jr=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},hh=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},gh=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var lo=()=>new Set;var Ma=o=>o[o.length-1];var yh=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},Wr=Array.from;var iu=Array.isArray;var Fa=class{constructor(){this._observers=Ut()}on(e,t){return jr(this._observers,e,lo).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Wr((this._observers.get(e)||Ut()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ut()}},gs=class{constructor(){this._observers=Ut()}on(e,t){jr(this._observers,e,lo).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Wr((this._observers.get(e)||Ut()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ut()}};var ur=Math.floor;var ys=Math.abs;var bs=(o,e)=>o<e?o:e,Kr=(o,e)=>o>e?o:e,aD=Number.isNaN;var Pa=o=>o!==0?o<0:1/o<0;var lu=Number.MAX_SAFE_INTEGER,lD=Number.MIN_SAFE_INTEGER,cD=1<<31;var bh=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&ur(o)===o),uD=Number.isNaN,fD=Number.parseInt;var K1=String.fromCharCode,dD=String.fromCodePoint,pD=K1(65535),G1=o=>o.toLowerCase(),J1=/^\s*/g,Q1=o=>o.replace(J1,""),Y1=/([A-Z])/g,cu=(o,e)=>Q1(o.replace(Y1,t=>`${e}${G1(t)}`));var Z1=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},xs=typeof TextEncoder!="undefined"?new TextEncoder:null,X1=o=>xs.encode(o),_h=xs?X1:Z1;var _s=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});_s&&_s.decode(new Uint8Array).length===1&&(_s=null);var Nn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Vn=()=>new Nn;var e0=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var xr=o=>{let e=new Uint8Array(e0(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},t0=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Kr(t,e)*2),o.cpos=0)},Ot=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Ra=Ot;var He=(o,e)=>{for(;e>127;)Ot(o,128|127&e),e=ur(e/128);Ot(o,127&e)},Da=(o,e)=>{let t=Pa(e);for(t&&(e=-e),Ot(o,(e>63?128:0)|(t?64:0)|63&e),e=ur(e/64);e>0;)Ot(o,(e>127?128:0)|127&e),e=ur(e/128)},fu=new Uint8Array(3e4),r0=fu.length/3,o0=(o,e)=>{if(e.length<r0){let t=xs.encodeInto(e,fu).written||0;He(o,t);for(let r=0;r<t;r++)Ot(o,fu[r])}else $t(o,_h(e))},n0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;He(o,r);for(let n=0;n<r;n++)Ot(o,t.codePointAt(n))},Fo=xs&&xs.encodeInto?o0:n0;var Ii=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=bs(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Kr(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},$t=(o,e)=>{He(o,e.byteLength),Ii(o,e)},du=(o,e)=>{t0(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},s0=(o,e)=>du(o,4).setFloat32(0,e,!1),i0=(o,e)=>du(o,8).setFloat64(0,e,!1),a0=(o,e)=>du(o,8).setBigInt64(0,e,!1);var wh=new DataView(new ArrayBuffer(4)),l0=o=>(wh.setFloat32(0,o),wh.getFloat32(0)===o),Ss=(o,e)=>{switch(typeof e){case"string":Ot(o,119),Fo(o,e);break;case"number":bh(e)&&ys(e)<=2147483647?(Ot(o,125),Da(o,e)):l0(e)?(Ot(o,124),s0(o,e)):(Ot(o,123),i0(o,e));break;case"bigint":Ot(o,122),a0(o,e);break;case"object":if(e===null)Ot(o,126);else if(iu(e)){Ot(o,117),He(o,e.length);for(let t=0;t<e.length;t++)Ss(o,e[t])}else if(e instanceof Uint8Array)Ot(o,116),$t(o,e);else{Ot(o,118);let t=Object.keys(e);He(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];Fo(o,n),Ss(o,e[n])}}break;case"boolean":Ot(o,e?120:121);break;default:Ot(o,127)}},ki=class extends Nn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&He(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var Sh=o=>{o.count>0&&(Da(o.encoder,o.count===1?o.s:-o.s),o.count>1&&He(o.encoder,o.count-2))},Bn=class{constructor(){this.encoder=new Nn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(Sh(this),this.count=1,this.s=e)}toUint8Array(){return Sh(this),xr(this.encoder)}};var kh=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Da(o.encoder,e),o.count>1&&He(o.encoder,o.count-2)}},ks=class{constructor(){this.encoder=new Nn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(kh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return kh(this),xr(this.encoder)}},Ea=class{constructor(){this.sarr=[],this.s="",this.lensE=new Bn}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Nn;return this.sarr.push(this.s),this.s="",Fo(e,this.sarr.join("")),Ii(e,this.lensE.toUint8Array()),xr(e)}};var Pr=o=>new Error(o),Gr=()=>{throw Pr("Method unimplemented")},Er=()=>{throw Pr("Unexpected case")};var Ih=Pr("Unexpected end of array"),Ch=Pr("Integer out of Range"),Is=class{constructor(e){this.arr=e,this.pos=0}},Qr=o=>new Is(o),Lh=o=>o.pos!==o.arr.length;var c0=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},qt=o=>c0(o,Be(o));var Hn=o=>o.arr[o.pos++];var Be=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>lu)throw Ch}throw Ih},Oa=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if(!(e&128))return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>lu)throw Ch}throw Ih};var u0=o=>{let e=Be(o);if(e===0)return"";{let t=String.fromCodePoint(Hn(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Hn(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},f0=o=>_s.decode(qt(o)),Jr=_s?f0:u0;var hu=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},d0=o=>hu(o,4).getFloat32(0,!1),p0=o=>hu(o,8).getFloat64(0,!1),m0=o=>hu(o,8).getBigInt64(0,!1);var h0=[o=>{},o=>null,Oa,d0,p0,m0,o=>!1,o=>!0,Jr,o=>{let e=Be(o),t={};for(let r=0;r<e;r++){let n=Jr(o);t[n]=Cs(o)}return t},o=>{let e=Be(o),t=[];for(let r=0;r<e;r++)t.push(Cs(o));return t},qt],Cs=o=>h0[127-Hn(o)](o),Ci=class extends Is{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Lh(this)?this.count=Be(this)+1:this.count=-1),this.count--,this.s}};var qn=class extends Is{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Oa(this);let e=Pa(this.s);this.count=1,e&&(this.s=-this.s,this.count=Be(this)+2)}return this.count--,this.s}};var Ls=class extends Is{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Oa(this),t=e&1;this.diff=ur(e/2),this.count=1,t&&(this.count=Be(this)+2)}return this.s+=this.diff,this.count--,this.s}},Ua=class{constructor(e){this.decoder=new qn(e),this.str=Jr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var gD=crypto.subtle,Th=crypto.getRandomValues.bind(crypto);var Li=()=>Th(new Uint32Array(1))[0];var g0=[1e7]+-1e3+-4e3+-8e3+-1e11,Ts=()=>g0.replace(/[018]/g,o=>(o^Li()&15>>o/4).toString(16));var zn=Date.now;var Po=o=>new Promise(o);var y0=Promise.all.bind(Promise);var yu=o=>o===void 0?null:o;var bu=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},Fh=new bu,v0=!0;try{typeof localStorage!="undefined"&&localStorage&&(Fh=localStorage,v0=!1)}catch(o){}var Ph=Fh;var Eh=Object.assign,x0=Object.keys,Rh=(o,e)=>{for(let t in o)e(o[t],t)};var Ti=o=>x0(o).length;var Dh=o=>{for(let e in o)return!1;return!0},w0=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},vu=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),_u=(o,e)=>o===e||Ti(o)===Ti(e)&&w0(o,(t,r)=>(t!==void 0||vu(e,r))&&e[r]===t);var Ai=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Ai(o,e,t+1)}};var Oh=o=>o,S0=(o,e)=>o===e;var As=(o,e)=>{if(o==null||e==null)return S0(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!As(o.get(t),e.get(t)))return!1;break}case Object:if(Ti(o)!==Ti(e))return!1;for(let t in o)if(!vu(o,t)||!As(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!As(o[t],e[t]))return!1;break;default:return!1}return!0},$h=(o,e)=>e.includes(o);var Mi=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var vD=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,co,k0=[],I0=()=>{if(co===void 0)if(Mi){co=Ut();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&co.set(e,""),e=r):e!==null?(co.set(e,r),e=null):k0.push(r)}e!==null&&co.set(e,"")}else typeof location=="object"?(co=Ut(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");co.set(`--${cu(e,"-")}`,t),co.set(`-${cu(e,"-")}`,t)}})):co=Ut();return co},wu=o=>I0().has(o);var Su=o=>Mi?yu(process.env[o.toUpperCase().replaceAll("-","_")]):yu(Ph.getItem(o));var C0=o=>wu("--"+o)||Su(o)!==null,_D=C0("production"),Nh=Mi&&$h(process.env.FORCE_COLOR,["true","1","2"]),Bh=!wu("no-colors")&&(!Mi||process.stdout.isTTY||Nh)&&(!Mi||wu("color")||Nh||Su("COLORTERM")!==null||(Su("TERM")||"").includes("color"));var T0=o=>new Uint8Array(o);var Vh=o=>{let e=T0(o.byteLength);return e.set(o),e};var ku=class{constructor(e,t){this.left=e,this.right=t}},Xt=(o,e)=>new ku(o,e);var Hh=(o,e)=>o.forEach(t=>e(t.left,t.right));var uo=typeof document!="undefined"?document:{},M0=o=>uo.createElement(o),F0=()=>uo.createDocumentFragment(),P0=o=>uo.createTextNode(o),xD=typeof DOMParser!="undefined"?new DOMParser:null;var E0=(o,e)=>(Hh(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var R0=o=>{let e=F0();for(let t=0;t<o.length;t++)jh(e,o[t]);return e},qh=(o,e)=>(jh(o,R0(e)),o);var Fi=(o,e=[],t=[])=>qh(E0(M0(o),e),t);var Ms=P0;var zh=o=>hh(o,(e,t)=>`${t}:${e};`).join("");var jh=(o,e)=>o.appendChild(e),wD=uo.ELEMENT_NODE,SD=uo.TEXT_NODE,kD=uo.CDATA_SECTION_NODE,ID=uo.COMMENT_NODE,CD=uo.DOCUMENT_NODE,LD=uo.DOCUMENT_TYPE_NODE,TD=uo.DOCUMENT_FRAGMENT_NODE;var fo=Symbol;var Pi=fo(),Ei=fo(),Cu=fo(),Lu=fo(),Tu=fo(),Ri=fo(),Au=fo(),Di=fo(),Mu=fo(),Kh=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var AD=zn();var O0={[Pi]:Xt("font-weight","bold"),[Ei]:Xt("font-weight","normal"),[Cu]:Xt("color","blue"),[Tu]:Xt("color","green"),[Lu]:Xt("color","grey"),[Ri]:Xt("color","red"),[Au]:Xt("color","purple"),[Di]:Xt("color","orange"),[Mu]:Xt("color","black")},$0=o=>{var i;o.length===1&&((i=o[0])==null?void 0:i.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Ut(),n=[],s=0;for(;s<o.length;s++){let a=o[s],l=O0[a];if(l!==void 0)r.set(l.left,l.right);else{if(a===void 0)break;if(a.constructor===String||a.constructor===Number){let c=zh(r);s>0||c.length>0?(e.push("%c"+a),t.push(c)):e.push(a)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let a=o[s];a instanceof Symbol||n.push(a)}return n},N0=Bh?$0:Kh,Gh=(...o)=>{console.log(...N0(o)),B0.forEach(e=>e.print(o))};var B0=lo();var Jh=o=>({[Symbol.iterator](){return this},next:o}),Qh=(o,e)=>Jh(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),Na=(o,e)=>Jh(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Oi=class{constructor(e,t){this.clock=e,this.len=t}},jn=class{constructor(){this.clients=new Map}},fg=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let i=0;i<r.length;i++){let a=r[i];_g(o,s,a.clock,a.len,t)}}),j0=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=ur((t+r)/2),s=o[n],i=s.clock;if(i<=e){if(e<i+s.len)return n;t=n+1}else r=n-1}return null},Wu=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&j0(t,e.clock)!==null},Ku=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=Kr(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},Pu=o=>{let e=new jn;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let i=t+1;i<o.length;i++)yh(s,o[i].clients.get(n)||[]);e.clients.set(n,s)}});return Ku(e),e},Wa=(o,e,t,r)=>{jr(o.clients,e,()=>[]).push(new Oi(t,r))},Gu=()=>new jn,W0=o=>{let e=Gu();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let i=t[s];if(i.deleted){let a=i.id.clock,l=i.length;if(s+1<t.length)for(let c=t[s+1];s+1<t.length&&c.deleted;c=t[++s+1])l+=c.length;n.push(new Oi(a,l))}}n.length>0&&e.clients.set(r,n)}),e},pn=(o,e)=>{He(o.restEncoder,e.clients.size),Wr(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),He(o.restEncoder,t);let n=r.length;He(o.restEncoder,n);for(let s=0;s<n;s++){let i=r[s];o.writeDsClock(i.clock),o.writeDsLen(i.len)}})},$i=o=>{let e=new jn,t=Be(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=Be(o.restDecoder),s=Be(o.restDecoder);if(s>0){let i=jr(e.clients,n,()=>[]);for(let a=0;a<s;a++)i.push(new Oi(o.readDsClock(),o.readDsLen()))}}return e},Xh=(o,e,t)=>{let r=new jn,n=Be(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let i=Be(o.restDecoder),a=Be(o.restDecoder),l=t.clients.get(i)||[],c=Ct(t,i);for(let u=0;u<a;u++){let f=o.readDsClock(),d=f+o.readDsLen();if(f<c){c<d&&Wa(r,i,c,d-c);let p=mo(l,f),m=l[p];for(!m.deleted&&m.id.clock<f&&(l.splice(p+1,0,tl(e,m,f-m.id.clock)),p++);p<l.length&&(m=l[p++],m.id.clock<d);)m.deleted||(d<m.id.clock+m.length&&l.splice(p,0,tl(e,m,d-m.id.clock)),m.delete(e))}else Wa(r,i,f,d-f)}}if(r.clients.size>0){let s=new Eo;return He(s.restEncoder,0),pn(s,r),s.toUint8Array()}return null};var dg=Li,wr=class extends Fa{constructor({guid:e=Ts(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:i=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=dg(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new Ya,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Po(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});let l=()=>Po(c=>{let u=f=>{(f===void 0||f===!0)&&(this.off("sync",u),c())};this.on("sync",u)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&nt(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Wr(this.subdocs).map(e=>e.guid))}transact(e,t=null){return nt(this,e,t)}get(e,t=Et){let r=jr(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==Et&&n!==t)if(n===Et){let s=new t;s._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=s}),s._start=r._start;for(let i=s._start;i!==null;i=i.right)i.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,po)}getText(e=""){return this.get(e,gn)}getMap(e=""){return this.get(e,Ro)}getXmlElement(e=""){return this.get(e,yn)}getXmlFragment(e=""){return this.get(e,Do)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){Wr(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new wr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,nt(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Es=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Be(this.restDecoder)}readDsLen(){return Be(this.restDecoder)}},Ka=class extends Es{readLeftID(){return Ge(Be(this.restDecoder),Be(this.restDecoder))}readRightID(){return Ge(Be(this.restDecoder),Be(this.restDecoder))}readClient(){return Be(this.restDecoder)}readInfo(){return Hn(this.restDecoder)}readString(){return Jr(this.restDecoder)}readParentInfo(){return Be(this.restDecoder)===1}readTypeRef(){return Be(this.restDecoder)}readLen(){return Be(this.restDecoder)}readAny(){return Cs(this.restDecoder)}readBuf(){return Vh(qt(this.restDecoder))}readJSON(){return JSON.parse(Jr(this.restDecoder))}readKey(){return Jr(this.restDecoder)}},Eu=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Be(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Be(this.restDecoder)+1;return this.dsCurrVal+=e,e}},mn=class extends Eu{constructor(e){super(e),this.keys=[],Be(e),this.keyClockDecoder=new Ls(qt(e)),this.clientDecoder=new qn(qt(e)),this.leftClockDecoder=new Ls(qt(e)),this.rightClockDecoder=new Ls(qt(e)),this.infoDecoder=new Ci(qt(e),Hn),this.stringDecoder=new Ua(qt(e)),this.parentInfoDecoder=new Ci(qt(e),Hn),this.typeRefDecoder=new qn(qt(e)),this.lenDecoder=new qn(qt(e))}readLeftID(){return new dn(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new dn(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Cs(this.restDecoder)}readBuf(){return qt(this.restDecoder)}readJSON(){return Cs(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},Rs=class{constructor(){this.restEncoder=Vn()}toUint8Array(){return xr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){He(this.restEncoder,e)}writeDsLen(e){He(this.restEncoder,e)}},Wn=class extends Rs{writeLeftID(e){He(this.restEncoder,e.client),He(this.restEncoder,e.clock)}writeRightID(e){He(this.restEncoder,e.client),He(this.restEncoder,e.clock)}writeClient(e){He(this.restEncoder,e)}writeInfo(e){Ra(this.restEncoder,e)}writeString(e){Fo(this.restEncoder,e)}writeParentInfo(e){He(this.restEncoder,e?1:0)}writeTypeRef(e){He(this.restEncoder,e)}writeLen(e){He(this.restEncoder,e)}writeAny(e){Ss(this.restEncoder,e)}writeBuf(e){$t(this.restEncoder,e)}writeJSON(e){Fo(this.restEncoder,JSON.stringify(e))}writeKey(e){Fo(this.restEncoder,e)}},Ga=class{constructor(){this.restEncoder=Vn(),this.dsCurrVal=0}toUint8Array(){return xr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,He(this.restEncoder,t)}writeDsLen(e){e===0&&Er(),He(this.restEncoder,e-1),this.dsCurrVal+=e}},Eo=class extends Ga{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ks,this.clientEncoder=new Bn,this.leftClockEncoder=new ks,this.rightClockEncoder=new ks,this.infoEncoder=new ki(Ra),this.stringEncoder=new Ea,this.parentInfoEncoder=new ki(Ra),this.typeRefEncoder=new Bn,this.lenEncoder=new Bn}toUint8Array(){let e=Vn();return He(e,0),$t(e,this.keyClockEncoder.toUint8Array()),$t(e,this.clientEncoder.toUint8Array()),$t(e,this.leftClockEncoder.toUint8Array()),$t(e,this.rightClockEncoder.toUint8Array()),$t(e,xr(this.infoEncoder)),$t(e,this.stringEncoder.toUint8Array()),$t(e,xr(this.parentInfoEncoder)),$t(e,this.typeRefEncoder.toUint8Array()),$t(e,this.lenEncoder.toUint8Array()),Ii(e,xr(this.restEncoder)),xr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Ss(this.restEncoder,e)}writeBuf(e){$t(this.restEncoder,e)}writeJSON(e){Ss(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},K0=(o,e,t,r)=>{r=Kr(r,e[0].id.clock);let n=mo(e,r);He(o.restEncoder,e.length-n),o.writeClient(t),He(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let i=n+1;i<e.length;i++)e[i].write(o,0)},Ju=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{Ct(e,s)>n&&r.set(s,n)}),rl(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),He(o.restEncoder,r.size),Wr(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{K0(o,e.clients.get(n),n,s)})},G0=(o,e)=>{let t=Ut(),r=Be(o.restDecoder);for(let n=0;n<r;n++){let s=Be(o.restDecoder),i=new Array(s),a=o.readClient(),l=Be(o.restDecoder);t.set(a,{i:0,refs:i});for(let c=0;c<s;c++){let u=o.readInfo();switch(31&u){case 0:{let f=o.readLen();i[c]=new fr(Ge(a,l),f),l+=f;break}case 10:{let f=Be(o.restDecoder);i[c]=new dr(Ge(a,l),f),l+=f;break}default:{let f=(u&192)===0,d=new ht(Ge(a,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,f?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,f&&(u&32)===32?o.readString():null,Ng(o,u));i[c]=d,l+=d.length}}}}return t},J0=(o,e,t)=>{let r=[],n=Wr(t.keys()).sort((p,m)=>p-m);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let p=t.get(n[n.length-1]);for(;p.refs.length===p.i;)if(n.pop(),n.length>0)p=t.get(n[n.length-1]);else return null;return p},i=s();if(i===null)return null;let a=new Ya,l=new Map,c=(p,m)=>{let y=l.get(p);(y==null||y>m)&&l.set(p,m)},u=i.refs[i.i++],f=new Map,d=()=>{for(let p of r){let m=p.id.client,y=t.get(m);y?(y.i--,a.clients.set(m,y.refs.slice(y.i)),t.delete(m),y.i=0,y.refs=[]):a.clients.set(m,[p]),n=n.filter(g=>g!==m)}r.length=0};for(;;){if(u.constructor!==dr){let m=jr(f,u.id.client,()=>Ct(e,u.id.client))-u.id.clock;if(m<0)r.push(u),c(u.id.client,u.id.clock-1),d();else{let y=u.getMissing(o,e);if(y!==null){r.push(u);let g=t.get(y)||{refs:[],i:0};if(g.refs.length===g.i)c(y,Ct(e,y)),d();else{u=g.refs[g.i++];continue}}else(m===0||m<u.length)&&(u.integrate(o,m),f.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(i!==null&&i.i<i.refs.length)u=i.refs[i.i++];else{if(i=s(),i===null)break;u=i.refs[i.i++]}}if(a.clients.size>0){let p=new Eo;return Ju(p,a,new Map),He(p.restEncoder,0),{missing:l,update:p.toUint8Array()}}return null},Q0=(o,e)=>Ju(o,e.doc.store,e.beforeState),Y0=(o,e,t,r=new mn(o))=>nt(e,n=>{n.local=!1;let s=!1,i=n.doc,a=i.store,l=G0(r,i),c=J0(n,a,l),u=a.pendingStructs;if(u){for(let[d,p]of u.missing)if(p<Ct(a,d)){s=!0;break}if(c){for(let[d,p]of c.missing){let m=u.missing.get(d);(m==null||m>p)&&u.missing.set(d,p)}u.update=Za([u.update,c.update])}}else a.pendingStructs=c;let f=Xh(r,n,a);if(a.pendingDs){let d=new mn(Qr(a.pendingDs));Be(d.restDecoder);let p=Xh(d,n,a);f&&p?a.pendingDs=Za([f,p]):a.pendingDs=f||p}else a.pendingDs=f;if(s){let d=a.pendingStructs.update;a.pendingStructs=null,pg(n.doc,d)}},t,!1);var pg=(o,e,t,r=mn)=>{let n=Qr(e);Y0(n,o,t,new r(n))},Ur=(o,e,t)=>pg(o,e,t,Ka),Z0=(o,e,t=new Map)=>{Ju(o,e.store,t),pn(o,W0(e.store))},X0=(o,e=new Uint8Array([0]),t=new Eo)=>{let r=mg(e);Z0(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(dS(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===Wn)return uS(n.map((s,i)=>i===0?s:mS(s)));if(t.constructor===Eo)return Za(n)}return n[0]},Qn=(o,e)=>X0(o,e,new Wn),eS=o=>{let e=new Map,t=Be(o.restDecoder);for(let r=0;r<t;r++){let n=Be(o.restDecoder),s=Be(o.restDecoder);e.set(n,s)}return e},mg=o=>eS(new Es(Qr(o))),hg=(o,e)=>(He(o.restEncoder,e.size),Wr(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{He(o.restEncoder,t),He(o.restEncoder,r)}),o),tS=(o,e)=>hg(o,rl(e.store)),rS=(o,e=new Ga)=>(o instanceof Map?hg(e,o):tS(e,o),e.toUint8Array()),gg=o=>rS(o,new Rs),Ru=class{constructor(){this.l=[]}},eg=()=>new Ru,tg=(o,e)=>o.l.push(e),rg=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},yg=(o,e,t)=>Ai(o.l,[e,t]),dn=class{constructor(e,t){this.client=e,this.clock=t}},Ps=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Ge=(o,e)=>new dn(o,e);var bg=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Er()};var Ja=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,i)=>{let a=s.get("ds"),l=s.get("ids"),c=u=>this.clients.set(u,i);a.observe(u=>{u.changes.added.forEach(f=>{f.content.getContent().forEach(d=>{d instanceof Uint8Array&&this.dss.set(i,Pu([this.dss.get(i)||Gu(),$i(new Es(Qr(d)))]))})})}),this.dss.set(i,Pu(a.map(u=>$i(new Es(Qr(u)))))),l.observe(u=>u.changes.added.forEach(f=>f.content.getContent().forEach(c))),l.forEach(c)};t.observe(s=>{s.keysChanged.forEach(i=>n(t.get(i),i))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,i=s.get(r);i||(i=new Ro,i.set("ids",new po),i.set("ds",new po),s.set(r,i)),i.get("ids").push([t]),s.observe(a=>{setTimeout(()=>{let l=s.get(r);if(l!==i){i=l,this.clients.forEach((f,d)=>{r===f&&i.get("ids").push([d])});let c=new Rs,u=this.dss.get(r);u&&(pn(c,u),i.get("ds").push([c.toUint8Array()]))}},0)}),e.on("afterTransaction",a=>{setTimeout(()=>{let l=i.get("ds"),c=a.deleteSet;if(a.local&&c.clients.size>0&&n(a,c)){let u=new Rs;pn(u,c),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Wu(r,e))return t;return null}},Qa=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var Qu=o=>new Qa(o.type==null?null:Ge(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Ge(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),Du=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},oS=(o,e,t=0)=>new Du(o,e,t),Ba=(o,e,t)=>{let r=null,n=null;return o._item===null?n=bg(o):r=Ge(o._item.id.client,o._item.id.clock),new Qa(r,n,e,t)},Yu=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return Ba(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Ba(o,Ge(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Ba(o,r.lastId,t);r=r.right}return Ba(o,null,t)};var Zu=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,i=o.assoc,a=null,l=0;if(r!==null){if(Ct(t,r.client)<=r.clock)return null;let c=ug(t,r),u=c.item;if(!(u instanceof ht))return null;if(a=u.parent,a._item===null||!a._item.deleted){l=u.deleted||!u.countable?0:c.diff+(i>=0?0:1);let f=u.left;for(;f!==null;)!f.deleted&&f.countable&&(l+=f.length),f=f.left}}else{if(s!==null)a=e.get(s);else if(n!==null){if(Ct(t,n.client)<=n.clock)return null;let{item:c}=ug(t,n);if(c instanceof ht&&c.content instanceof Dr)a=c.content.type;else return null}else throw Er();i>=0?l=a._length:l=0}return oS(a,l,o.assoc)},Xu=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&Ps(o.item,e.item)&&Ps(o.type,e.type)&&o.assoc===e.assoc,Uu=class{constructor(e,t){this.ds=e,this.sv=t}};var nS=(o,e)=>new Uu(o,e),ND=nS(Gu(),new Map);var Fs=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Wu(e.ds,o.id),Ou=(o,e)=>{let t=jr(o.meta,Ou,lo),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<Ct(r,s)&&hn(o,Ge(s,n))}),fg(o,e.ds,n=>{}),t.add(e))};var Ya=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},rl=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},Ct=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},vg=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Er()}t.push(e)},mo=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let i=ur(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[i],s=n.id.clock,s<=e){if(e<s+n.length)return i;t=i+1}else r=i-1;i=ur((t+r)/2)}throw Er()},sS=(o,e)=>{let t=o.clients.get(e.client);return t[mo(t,e.clock)]},qa=sS,$u=(o,e,t)=>{let r=mo(e,t),n=e[r];return n.id.clock<t&&n instanceof ht?(e.splice(r+1,0,tl(o,n,t-n.id.clock)),r+1):r},hn=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[$u(o,t,e.clock)]},og=(o,e,t)=>{let r=e.clients.get(t.client),n=mo(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==fr&&r.splice(n+1,0,tl(o,s,t.clock-s.id.clock+1)),s},iS=(o,e,t)=>{let r=o.clients.get(e.id.client);r[mo(r,e.id.clock)]=t},_g=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,i=$u(o,e,t),a;do a=e[i++],s<a.id.clock+a.length&&$u(o,e,s),n(a);while(i<e.length&&e[i].id.clock<s)},Nu=class{constructor(e,t,r){this.doc=e,this.deleteSet=new jn,this.beforeState=rl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},ng=(o,e)=>e.deleteSet.clients.size===0&&!gh(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Ku(e.deleteSet),Q0(o,e),pn(o,e.deleteSet),!0),sg=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&jr(o.changed,e,lo).add(t)},za=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ht&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},aS=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let i=n.length-1;i>=0;i--){let a=n[i],l=a.clock+a.len;for(let c=mo(s,a.clock),u=s[c];c<s.length&&u.id.clock<l;u=s[++c]){let f=s[c];if(a.clock+a.len<=f.id.clock)break;f instanceof ht&&f.deleted&&!f.keep&&t(f)&&f.gc(e,!1)}}}},lS=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let i=t[s],a=bs(n.length-1,1+mo(n,i.clock+i.len-1));for(let l=a,c=n[l];l>0&&c.id.clock>=i.clock;c=n[l])l-=1+za(n,l)}})};var xg=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,i=t._mergeStructs;try{Ku(s),t.afterState=rl(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let a=[];t.changed.forEach((l,c)=>a.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(t,l)})),a.push(()=>{t.changedParentTypes.forEach((l,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=c,u._path=null}),l.sort((u,f)=>u.path.length-f.path.length),yg(c._dEH,l,t))})}),a.push(()=>r.emit("afterTransaction",[t,r])),Ai(a,[]),t._needFormattingCleanup&&IS(t)}finally{r.gc&&aS(s,n,r.gcFilter),lS(s,n),t.afterState.forEach((u,f)=>{let d=t.beforeState.get(f)||0;if(d!==u){let p=n.clients.get(f),m=Kr(mo(p,d),1);for(let y=p.length-1;y>=m;)y-=1+za(p,y)}});for(let u=i.length-1;u>=0;u--){let{client:f,clock:d}=i[u].id,p=n.clients.get(f),m=mo(p,d);m+1<p.length&&za(p,m+1)>1||m>0&&za(p,m)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Gh(Di,Pi,"[yjs] ",Ei,Ri,"Changed the client-id because another client seems to be using it."),r.clientID=dg()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new Wn;ng(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new Eo;ng(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:a,subdocsLoaded:l,subdocsRemoved:c}=t;(a.size>0||c.size>0||l.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),c.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:a,removed:c},r,t]),c.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):xg(o,e+1)}}},nt=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,i=null;o._transaction===null&&(s=!0,o._transaction=new Nu(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{i=e(o._transaction)}finally{if(s){let a=o._transaction===n[0];o._transaction=null,a&&xg(n,0)}}return i};function*cS(o){let e=Be(o.restDecoder);for(let t=0;t<e;t++){let r=Be(o.restDecoder),n=o.readClient(),s=Be(o.restDecoder);for(let i=0;i<r;i++){let a=o.readInfo();if(a===10){let l=Be(o.restDecoder);yield new dr(Ge(n,s),l),s+=l}else if(31&a){let l=(a&192)===0,c=new ht(Ge(n,s),null,(a&128)===128?o.readLeftID():null,null,(a&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(a&32)===32?o.readString():null,Ng(o,a));yield c,s+=c.length}else{let l=o.readLen();yield new fr(Ge(n,s),l),s+=l}}}}var Ni=class{constructor(e,t){this.gen=cS(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===dr);return this.curr}};var Bi=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},uS=o=>Za(o,Ka,Wn);var fS=(o,e)=>{if(o.constructor===fr){let{client:t,clock:r}=o.id;return new fr(Ge(t,r+e),o.length-e)}else if(o.constructor===dr){let{client:t,clock:r}=o.id;return new dr(Ge(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new ht(Ge(r,n+e),null,Ge(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},Za=(o,e=mn,t=Eo)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Qr(u))),n=r.map(u=>new Ni(u,!0)),s=null,i=new t,a=new Bi(i);for(;n=n.filter(d=>d.curr!==null),n.sort((d,p)=>{if(d.curr.id.client===p.curr.id.client){let m=d.curr.id.clock-p.curr.id.clock;return m===0?d.curr.constructor===p.curr.constructor?0:d.curr.constructor===dr?1:-1:m}else return p.curr.id.client-d.curr.id.client}),n.length!==0;){let u=n[0],f=u.curr.id.client;if(s!==null){let d=u.curr,p=!1;for(;d!==null&&d.id.clock+d.length<=s.struct.id.clock+s.struct.length&&d.id.client>=s.struct.id.client;)d=u.next(),p=!0;if(d===null||d.id.client!==f||p&&d.id.clock>s.struct.id.clock+s.struct.length)continue;if(f!==s.struct.id.client)un(a,s.struct,s.offset),s={struct:d,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<d.id.clock)if(s.struct.constructor===dr)s.struct.length=d.id.clock+d.length-s.struct.id.clock;else{un(a,s.struct,s.offset);let m=d.id.clock-s.struct.id.clock-s.struct.length;s={struct:new dr(Ge(f,s.struct.id.clock+s.struct.length),m),offset:0}}else{let m=s.struct.id.clock+s.struct.length-d.id.clock;m>0&&(s.struct.constructor===dr?s.struct.length-=m:d=fS(d,m)),s.struct.mergeWith(d)||(un(a,s.struct,s.offset),s={struct:d,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===f&&d.id.clock===s.struct.id.clock+s.struct.length&&d.constructor!==dr;d=u.next())un(a,s.struct,s.offset),s={struct:d,offset:0}}s!==null&&(un(a,s.struct,s.offset),s=null),ef(a);let l=r.map(u=>$i(u)),c=Pu(l);return pn(i,c),i.toUint8Array()},dS=(o,e,t=mn,r=Eo)=>{let n=mg(e),s=new r,i=new Bi(s),a=new t(Qr(o)),l=new Ni(a,!1);for(;l.curr;){let u=l.curr,f=u.id.client,d=n.get(f)||0;if(l.curr.constructor===dr){l.next();continue}if(u.id.clock+u.length>d)for(un(i,u,Kr(d-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===f;)un(i,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===f&&l.curr.id.clock+l.curr.length<=d;)l.next()}ef(i);let c=$i(a);return pn(s,c),s.toUint8Array()};var wg=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:xr(o.encoder.restEncoder)}),o.encoder.restEncoder=Vn(),o.written=0)},un=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&wg(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),He(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},ef=o=>{wg(o);let e=o.encoder.restEncoder;He(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];He(e,r.written),Ii(e,r.restEncoder)}},pS=(o,e,t,r)=>{let n=new t(Qr(o)),s=new Ni(n,!1),i=new r,a=new Bi(i);for(let c=s.curr;c!==null;c=s.next())un(a,e(c),0);ef(a);let l=$i(n);return pn(i,l),i.toUint8Array()};var mS=o=>pS(o,Oh,mn,Wn),ig="You must not compute changes after the event-handler fired.",Ds=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=hS(this.currentTarget,this.target))}deletes(e){return Wu(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Pr(ig);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),i,a;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))i="delete",a=Ma(l.content.getContent());else return;else l!==null&&this.deletes(l)?(i="update",a=Ma(l.content.getContent())):(i="add",a=void 0)}else if(this.deletes(s))i="delete",a=Ma(s.content.getContent());else return;e.set(n,{action:i,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Pr(ig);let t=this.target,r=lo(),n=lo(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null,l=()=>{a&&s.push(a)};for(let c=t._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((a===null||a.delete===void 0)&&(l(),a={delete:0}),a.delete+=c.length,n.add(c)):this.adds(c)?((a===null||a.insert===void 0)&&(l(),a={insert:[]}),a.insert=a.insert.concat(c.content.getContent()),r.add(c)):((a===null||a.retain===void 0)&&(l(),a={retain:0}),a.retain+=c.length);a!==null&&a.retain===void 0&&l()}this._changes=e}return e}},hS=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},Sg=80,tf=0,Bu=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=tf++}},gS=o=>{o.timestamp=tf++},kg=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=tf++},yS=(o,e,t)=>{if(o.length>=Sg){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return kg(r,e,t),r}else{let r=new Bu(e,t);return o.push(r),r}},ol=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,i)=>ys(e-s.index)<ys(e-i.index)?s:i),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,gS(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&ys(t.index-n)<r.parent.length/Sg?(kg(t,r,n),t):yS(o._searchMarker,r,n)},Vi=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=Kr(e,n.index+t))}};var nl=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;jr(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;yg(r._eH,t,e)},Et=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=eg(),this._dEH=eg(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Gr()}clone(){throw Gr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){tg(this._eH,e)}observeDeep(e){tg(this._dEH,e)}unobserve(e){rg(this._eH,e)}unobserveDeep(e){rg(this._dEH,e)}toJSON(){}},Ig=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let i=s.content.getContent();if(i.length<=e)e-=i.length;else{for(let a=e;a<i.length&&r>0;a++)n.push(i[a]),r--;e=0}}s=s.right}return n},Cg=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var Hi=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},Lg=(o,e)=>{let t=[];return Hi(o,(r,n)=>{t.push(e(r,n,o))}),t},bS=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},Tg=(o,e)=>{let t=ol(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Xa=(o,e,t,r)=>{let n=t,s=o.doc,i=s.clientID,a=s.store,l=t===null?e._start:t.right,c=[],u=()=>{c.length>0&&(n=new ht(Ge(i,Ct(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Oo(c)),n.integrate(o,0),c=[])};r.forEach(f=>{if(f===null)c.push(f);else switch(f.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(f);break;default:switch(u(),f.constructor){case Uint8Array:case ArrayBuffer:n=new ht(Ge(i,Ct(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Kn(new Uint8Array(f))),n.integrate(o,0);break;case wr:n=new ht(Ge(i,Ct(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Jn(f)),n.integrate(o,0);break;default:if(f instanceof Et)n=new ht(Ge(i,Ct(a,i)),n,n&&n.lastId,l,l&&l.id,e,null,new Dr(f)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},Ag=()=>Pr("Length exceeded!"),Mg=(o,e,t,r)=>{if(t>e._length)throw Ag();if(t===0)return e._searchMarker&&Vi(e._searchMarker,t,r.length),Xa(o,e,null,r);let n=t,s=ol(e,t),i=e._start;for(s!==null&&(i=s.p,t-=s.index,t===0&&(i=i.prev,t+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(t<=i.length){t<i.length&&hn(o,Ge(i.id.client,i.id.clock+t));break}t-=i.length}return e._searchMarker&&Vi(e._searchMarker,n,r.length),Xa(o,e,i,r)},vS=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,i)=>i.index>s.index?i:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return Xa(o,e,n,t)},Fg=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,i=ol(e,t),a=e._start;for(i!==null&&(a=i.p,t-=i.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&hn(o,Ge(a.id.client,a.id.clock+t)),t-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&hn(o,Ge(a.id.client,a.id.clock+r)),a.delete(o),r-=a.length),a=a.right;if(r>0)throw Ag();e._searchMarker&&Vi(e._searchMarker,n,-s+r)},el=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},rf=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,i=s.clientID,a;if(r==null)a=new Oo([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Oo([r]);break;case Uint8Array:a=new Kn(r);break;case wr:a=new Jn(r);break;default:if(r instanceof Et)a=new Dr(r);else throw new Error("Unexpected content type")}new ht(Ge(i,Ct(s.store,i)),n,n&&n.lastId,null,null,e,t,a).integrate(o,0)},of=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Pg=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Eg=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var _S=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&Fs(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},Va=o=>Qh(o.entries(),e=>!e[1].deleted),Vu=class extends Ds{constructor(e,t){super(e,t),this._transaction=t}},po=class extends Et{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new po;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new po}clone(){let e=new po;return e.insert(0,this.toArray().map(t=>t instanceof Et?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),nl(this,e,new Vu(this,e))}insert(e,t){this.doc!==null?nt(this.doc,r=>{Mg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?nt(this.doc,t=>{vS(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?nt(this.doc,r=>{Fg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return Tg(this,e)}toArray(){return Cg(this)}slice(e=0,t=this.length){return Ig(this,e,t)}toJSON(){return this.map(e=>e instanceof Et?e.toJSON():e)}map(e){return Lg(this,e)}forEach(e){Hi(this,e)}[Symbol.iterator](){return bS(this)}_write(e){e.writeTypeRef(VS)}},xS=o=>new po,Hu=class extends Ds{constructor(e,t,r){super(e,t),this.keysChanged=r}},Ro=class extends Et{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new Ro}clone(){let e=new Ro;return this.forEach((t,r)=>{e.set(r,t instanceof Et?t.clone():t)}),e}_callObserver(e,t){nl(this,e,new Hu(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof Et?n.toJSON():n}}),e}get size(){return[...Va(this._map)].length}keys(){return Na(Va(this._map),e=>e[0])}values(){return Na(Va(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Na(Va(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?nt(this.doc,t=>{el(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?nt(this.doc,r=>{rf(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return of(this,e)}has(e){return Eg(this,e)}clear(){this.doc!==null?nt(this.doc,e=>{this.forEach(function(t,r,n){el(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(HS)}},wS=o=>new Ro,fn=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&_u(o,e),qi=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Er(),this.right.content.constructor){case St:this.right.deleted||Ns(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},ag=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case St:e.right.deleted||Ns(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&hn(o,Ge(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Ha=(o,e,t,r)=>{let n=new Map,s=r?ol(e,t):null;if(s){let i=new qi(s.p.left,s.p,s.index,n);return ag(o,i,t-s.index)}else{let i=new qi(null,e._start,0,n);return ag(o,i,t)}},Rg=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===St&&fn(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((i,a)=>{let l=t.left,c=t.right,u=new ht(Ge(s,Ct(n.store,s)),l,l&&l.lastId,c,c&&c.id,e,null,new St(a,i));u.integrate(o,0),t.right=u,t.forward()})},Ns=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},Dg=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===St&&fn((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Ug=(o,e,t,r)=>{var a;let n=o.doc,s=n.clientID,i=new Map;for(let l in r){let c=r[l],u=(a=t.currentAttributes.get(l))!=null?a:null;if(!fn(u,c)){i.set(l,u);let{left:f,right:d}=t;t.right=new ht(Ge(s,Ct(n.store,s)),f,f&&f.lastId,d,d&&d.id,e,null,new St(l,c)),t.right.integrate(o,0),t.forward()}}return i},Fu=(o,e,t,r,n)=>{t.currentAttributes.forEach((d,p)=>{n[p]===void 0&&(n[p]=null)});let s=o.doc,i=s.clientID;Dg(t,n);let a=Ug(o,e,t,n),l=r.constructor===String?new Rr(r):r instanceof Et?new Dr(r):new Uo(r),{left:c,right:u,index:f}=t;e._searchMarker&&Vi(e._searchMarker,t.index,l.getLength()),u=new ht(Ge(i,Ct(s.store,i)),c,c&&c.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=f,t.forward(),Rg(o,e,t,a)},lg=(o,e,t,r,n)=>{let s=o.doc,i=s.clientID;Dg(t,n);let a=Ug(o,e,t,n);e:for(;t.right!==null&&(r>0||a.size>0&&(t.right.deleted||t.right.content.constructor===St));){if(!t.right.deleted)switch(t.right.content.constructor){case St:{let{key:l,value:c}=t.right.content,u=n[l];if(u!==void 0){if(fn(u,c))a.delete(l);else{if(r===0)break e;a.set(l,c)}t.right.delete(o)}else t.currentAttributes.set(l,c);break}default:r<t.right.length&&hn(o,Ge(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ht(Ge(i,Ct(s.store,i)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Rr(l)),t.right.integrate(o,0),t.forward()}Rg(o,e,t,a)},Og=(o,e,t,r,n)=>{var c,u;let s=e,i=Ut();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===St){let f=s.content;i.set(f.key,f)}s=s.right}let a=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let f=e.content;switch(f.constructor){case St:{let{key:d,value:p}=f,m=(c=r.get(d))!=null?c:null;(i.get(d)!==f||m===p)&&(e.delete(o),a++,!l&&((u=n.get(d))!=null?u:null)===p&&m!==p&&(m===null?n.delete(d):n.set(d,m))),!l&&!e.deleted&&Ns(n,f);break}}}e=e.right}return a},SS=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===St){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},kS=o=>{let e=0;return nt(o.doc,t=>{let r=o._start,n=o._start,s=Ut(),i=Aa(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case St:Ns(i,n.content);break;default:e+=Og(t,r,n,s,i),s=Aa(i),r=n;break}n=n.right}}),e},IS=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&_g(o,t.store.clients.get(r),s,n,i=>{!i.deleted&&i.content.constructor===St&&i.constructor!==fr&&e.add(i.parent)})}nt(t,r=>{fg(o,o.deleteSet,n=>{if(n instanceof fr||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===St?e.add(s):SS(r,n)});for(let n of e)kS(n)})},cg=(o,e,t)=>{let r=t,n=Aa(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Dr:case Uo:case Rr:t<e.right.length&&hn(o,Ge(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&Og(o,s,e.right,n,e.currentAttributes);let i=(e.left||e.right).parent;return i._searchMarker&&Vi(i._searchMarker,e.index,-r+t),e},qu=class extends Ds{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];nt(e,r=>{var p,m,y;let n=new Map,s=new Map,i=this.target._start,a=null,l={},c="",u=0,f=0,d=()=>{if(a!==null){let g=null;switch(a){case"delete":f>0&&(g={delete:f}),f=0;break;case"insert":(typeof c=="object"||c.length>0)&&(g={insert:c},n.size>0&&(g.attributes={},n.forEach((k,L)=>{k!==null&&(g.attributes[L]=k)}))),c="";break;case"retain":u>0&&(g={retain:u},Dh(l)||(g.attributes=Eh({},l))),u=0;break}g&&t.push(g),a=null}};for(;i!==null;){switch(i.content.constructor){case Dr:case Uo:this.adds(i)?this.deletes(i)||(d(),a="insert",c=i.content.getContent()[0],d()):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),f+=1):i.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case Rr:this.adds(i)?this.deletes(i)||(a!=="insert"&&(d(),a="insert"),c+=i.content.str):this.deletes(i)?(a!=="delete"&&(d(),a="delete"),f+=i.length):i.deleted||(a!=="retain"&&(d(),a="retain"),u+=i.length);break;case St:{let{key:g,value:k}=i.content;if(this.adds(i)){if(!this.deletes(i)){let L=(p=n.get(g))!=null?p:null;fn(L,k)?k!==null&&i.delete(r):(a==="retain"&&d(),fn(k,(m=s.get(g))!=null?m:null)?delete l[g]:l[g]=k)}}else if(this.deletes(i)){s.set(g,k);let L=(y=n.get(g))!=null?y:null;fn(L,k)||(a==="retain"&&d(),l[g]=L)}else if(!i.deleted){s.set(g,k);let L=l[g];L!==void 0&&(fn(L,k)?L!==null&&i.delete(r):(a==="retain"&&d(),k===null?delete l[g]:l[g]=k))}i.deleted||(a==="insert"&&d(),Ns(n,i.content));break}}i=i.right}for(d();t.length>0;){let g=t[t.length-1];if(g.retain!==void 0&&g.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},gn=class extends Et{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new gn}clone(){let e=new gn;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new qu(this,e,t);nl(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Rr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?nt(this.doc,r=>{let n=new qi(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let i=e[s];if(i.insert!==void 0){let a=!t&&typeof i.insert=="string"&&s===e.length-1&&n.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof a!="string"||a.length>0)&&Fu(r,this,n,a,i.attributes||{})}else i.retain!==void 0?lg(r,this,n,i.retain,i.attributes||{}):i.delete!==void 0&&cg(r,n,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,i=this.doc,a="",l=this._start;function c(){if(a.length>0){let f={},d=!1;s.forEach((m,y)=>{d=!0,f[y]=m});let p={insert:a};d&&(p.attributes=f),n.push(p),a=""}}let u=()=>{for(;l!==null;){if(Fs(l,e)||t!==void 0&&Fs(l,t))switch(l.content.constructor){case Rr:{let f=s.get("ychange");e!==void 0&&!Fs(l,e)?(f===void 0||f.user!==l.id.client||f.type!=="removed")&&(c(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!Fs(l,t)?(f===void 0||f.user!==l.id.client||f.type!=="added")&&(c(),s.set("ychange",r?r("added",l.id):{type:"added"})):f!==void 0&&(c(),s.delete("ychange")),a+=l.content.str;break}case Dr:case Uo:{c();let f={insert:l.content.getContent()[0]};if(s.size>0){let d={};f.attributes=d,s.forEach((p,m)=>{d[m]=p})}n.push(f);break}case St:Fs(l,e)&&(c(),Ns(s,l.content));break}l=l.right}c()};return e||t?nt(i,f=>{e&&Ou(f,e),t&&Ou(f,t),u()},"cleanup"):u(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?nt(n,s=>{let i=Ha(s,this,e,!r);r||(r={},i.currentAttributes.forEach((a,l)=>{r[l]=a})),Fu(s,this,i,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?nt(n,s=>{let i=Ha(s,this,e,!r);Fu(s,this,i,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?nt(r,n=>{cg(n,Ha(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?nt(n,s=>{let i=Ha(s,this,e,!1);i.right!==null&&lg(s,this,i,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?nt(this.doc,t=>{el(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?nt(this.doc,r=>{rf(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return of(this,e)}getAttributes(){return Pg(this)}_write(e){e.writeTypeRef(qS)}},CS=o=>new gn,Ui=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===yn||t.constructor===Do)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Do=class extends Et{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Do}clone(){let e=new Do;return e.insert(0,this.toArray().map(t=>t instanceof Et?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ui(this,e)}querySelector(e){e=e.toUpperCase();let r=new Ui(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Wr(new Ui(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){nl(this,e,new zu(this,t,e))}toString(){return Lg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),Hi(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?nt(this.doc,r=>{Mg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)nt(this.doc,r=>{let n=e&&e instanceof Et?e._item:e;Xa(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw Pr("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?nt(this.doc,r=>{Fg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return Cg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return Tg(this,e)}slice(e=0,t=this.length){return Ig(this,e,t)}forEach(e){Hi(this,e)}_write(e){e.writeTypeRef(jS)}},LS=o=>new Do,yn=class extends Do{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new yn(this.nodeName)}clone(){let e=new yn(this.nodeName),t=this.getAttributes();return Rh(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof Et?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let a in e)r.push(a);r.sort();let n=r.length;for(let a=0;a<n;a++){let l=r[a];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?nt(this.doc,t=>{el(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?nt(this.doc,r=>{rf(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return of(this,e)}hasAttribute(e){return Eg(this,e)}getAttributes(e){return e?_S(this,e):Pg(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let i in s){let a=s[i];typeof a=="string"&&n.setAttribute(i,a)}return Hi(this,i=>{n.appendChild(i.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(zS),e.writeKey(this.nodeName)}},TS=o=>new yn(o.readKey()),zu=class extends Ds{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},Us=class extends Ro{constructor(e){super(),this.hookName=e}_copy(){return new Us(this.hookName)}clone(){let e=new Us(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(WS),e.writeKey(this.hookName)}},AS=o=>new Us(o.readKey()),Os=class extends gn{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Os}clone(){let e=new Os;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let i in e.attributes[n])s.push({key:i,value:e.attributes[n][i]});s.sort((i,a)=>i.key<a.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let i=0;i<s.attrs.length;i++){let a=s.attrs[i];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(KS)}},MS=o=>new Os,zi=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Gr()}mergeWith(e){return!1}write(e,t,r){throw Gr()}integrate(e,t){throw Gr()}},FS=0,fr=class extends zi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),vg(e.doc.store,this)}write(e,t){e.writeInfo(FS),e.writeLen(this.length-t)}getMissing(e,t){return null}},Kn=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Kn(this.content)}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},PS=o=>new Kn(o.readBuf()),Gn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Gn(this.len)}splice(e){let t=new Gn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){Wa(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},ES=o=>new Gn(o.readLen()),$g=(o,e)=>new wr({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Jn=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Jn($g(this.doc.guid,this.opts))}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},RS=o=>new Jn($g(o.readString(),o.readAny())),Uo=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Uo(this.embed)}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},DS=o=>new Uo(o.readJSON()),St=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new St(this.key,this.value)}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},US=o=>new St(o.readKey(),o.readJSON()),$s=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new $s(this.arr)}splice(e){let t=new $s(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},OS=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new $s(t)},Oo=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Oo(this.arr)}splice(e){let t=new Oo(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},$S=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Oo(t)},Rr=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Rr(this.str)}splice(e){let t=new Rr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},NS=o=>new Rr(o.readString()),BS=[xS,wS,CS,TS,LS,AS,MS],VS=0,HS=1,qS=2,zS=3,jS=4,WS=5,KS=6,Dr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Dr(this.type._copy())}splice(e){throw Gr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},GS=o=>new Dr(BS[o.readTypeRef()](o)),ug=(o,e)=>{let t=e,r=0,n;do r>0&&(t=Ge(t.client,t.clock+r)),n=qa(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof ht);return{item:n,diff:r}};var tl=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new ht(Ge(r,n+t),e,Ge(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ge(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var ht=class extends zi{constructor(e,t,r,n,s,i,a,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=i,this.parentSub=a,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Ct(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Ct(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===dn&&this.id.client!==this.parent.client&&this.parent.clock>=Ct(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=og(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=hn(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===fr||this.right&&this.right.constructor===fr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ht&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ht&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===dn){let r=qa(t,this.parent);r.constructor===fr?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=og(e,e.doc.store,Ge(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,i=new Set;for(;n!==null&&n!==this.right;){if(i.add(n),s.add(n),Ps(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(Ps(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&i.has(qa(e.doc.store,n.origin)))s.has(qa(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),vg(e.doc.store,this),this.content.integrate(e,this),sg(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new fr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ge(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Ps(e.origin,this.lastId)&&this.right===e&&Ps(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),Wa(e.deleteSet,this.id.client,this.id.clock,this.length),sg(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Er();this.content.gc(e),t?iS(e,this,new fr(this.id,this.length)):this.content=new Gn(this.length)}write(e,t){let r=t>0?Ge(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let a=this.parent;if(a._item!==void 0){let l=a._item;if(l===null){let c=bg(a);e.writeParentInfo(!0),e.writeString(c)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===dn?(e.writeParentInfo(!1),e.writeLeftID(a)):Er();s!==null&&e.writeString(s)}this.content.write(e,t)}},Ng=(o,e)=>JS[e&31](o),JS=[()=>{Er()},ES,OS,PS,NS,DS,US,GS,$S,RS,()=>{Er()}],QS=10,dr=class extends zi{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Er()}write(e,t){e.writeInfo(QS),He(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Bg=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Vg="__ $YJS$ __";Bg[Vg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Bg[Vg]=!0;var Zn=o=>Po((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),Hg=(o,e)=>Po((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(Pr(s.target.error)),n.onsuccess=s=>{let i=s.target.result;i.onversionchange=()=>{i.close()},t(i)}}),qg=o=>Zn(indexedDB.deleteDatabase(o)),zg=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),Or=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>ek(r,n))},$o=(o,e)=>Zn(o.count(e)),jg=(o,e)=>Zn(o.get(e)),nf=(o,e)=>Zn(o.delete(e)),Wg=(o,e,t)=>Zn(o.put(e,t));var sl=(o,e)=>Zn(o.add(e)),Kg=(o,e,t)=>Zn(o.getAll(e,t));var YS=(o,e,t)=>{let r=null;return XS(o,e,n=>(r=n,!1),t).then(()=>r)},Gg=(o,e=null)=>YS(o,e,"prev");var ZS=(o,e)=>Po((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var XS=(o,e,t,r="next")=>ZS(o.openKeyCursor(e,r),n=>t(n.key)),ek=(o,e)=>o.objectStore(e);var Jg=(o,e)=>IDBKeyRange.upperBound(o,e),Qg=(o,e)=>IDBKeyRange.lowerBound(o,e);var sf="custom",Yg="updates",Zg=500,Xg=(o,e=()=>{},t=()=>{})=>{let[r]=Or(o.db,[Yg]);return Kg(r,Qg(o._dbref,!1)).then(n=>{o._destroyed||(e(r),nt(o.doc,()=>{n.forEach(s=>Ur(o.doc,s))},o,!1),t(r))}).then(()=>Gg(r).then(n=>{o._dbref=n+1})).then(()=>$o(r).then(n=>{o._dbsize=n})).then(()=>r)},tk=(o,e=!0)=>Xg(o).then(t=>{(e||o._dbsize>=Zg)&&sl(t,Qn(o.doc)).then(()=>nf(t,Jg(o._dbref,!0))).then(()=>$o(t).then(r=>{o._dbsize=r}))});var bn=class extends gs{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Hg(e,r=>zg(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Po(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Xg(this,i=>sl(i,Qn(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=Or(this.db,[Yg]);sl(s,r),++this._dbsize>=Zg&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{tk(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{qg(this.name)})}get(e){return this._db.then(t=>{let[r]=Or(t,[sf],"readonly");return jg(r,e)})}set(e,t){return this._db.then(r=>{let[n]=Or(r,[sf]);return Wg(n,t,e)})}del(e){return this._db.then(t=>{let[r]=Or(t,[sf]);return nf(r,e)})}};var Cr=ln($n());var ey=0,al=1,ty=2,ll=(o,e)=>{He(o,ey);let t=gg(e);$t(o,t)},af=(o,e,t)=>{He(o,al),$t(o,Qn(e,t))},rk=(o,e,t)=>af(e,t,qt(o)),ry=(o,e,t)=>{try{Ur(e,qt(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},oy=(o,e)=>{He(o,ty),$t(o,e)},ok=ry,ny=(o,e,t,r)=>{let n=Be(o);switch(n){case ey:rk(o,e,t);break;case al:ry(o,t,r);break;case ty:ok(o,t,r);break;default:throw new Error("Unknown message type")}return n};var sk=0;var sy=(o,e,t)=>{switch(Be(o)){case sk:t(e,Jr(o))}};var lf=3e4,cl=class extends gs{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=zn();this.getLocalState()!==null&&lf/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&lf<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&ul(this,r,"timeout")},ur(lf/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:zn()});let i=[],a=[],l=[],c=[];e===null?c.push(t):s==null?e!=null&&i.push(t):(a.push(t),As(s,e)||l.push(t)),(i.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:i,updated:l,removed:c},"local"]),this.emit("update",[{added:i,updated:a,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},ul=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let i=o.meta.get(s);o.meta.set(s,{clock:i.clock+1,lastUpdated:zn()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Bs=(o,e,t=o.states)=>{let r=e.length,n=Vn();He(n,r);for(let s=0;s<r;s++){let i=e[s],a=t.get(i)||null,l=o.meta.get(i).clock;He(n,i),He(n,l),Fo(n,JSON.stringify(a))}return xr(n)};var iy=(o,e,t)=>{let r=Qr(e),n=zn(),s=[],i=[],a=[],l=[],c=Be(r);for(let u=0;u<c;u++){let f=Be(r),d=Be(r),p=JSON.parse(Jr(r)),m=o.meta.get(f),y=o.states.get(f),g=m===void 0?0:m.clock;(g<d||g===d&&p===null&&o.states.has(f))&&(p===null?f===o.clientID&&o.getLocalState()!=null?d++:o.states.delete(f):o.states.set(f,p),o.meta.set(f,{clock:d,lastUpdated:n}),m===void 0&&p!==null?s.push(f):m!==void 0&&p===null?l.push(f):p!==null&&(As(p,y)||a.push(f),i.push(f)))}(s.length>0||a.length>0||l.length>0)&&o.emit("change",[{added:s,updated:a,removed:l},t]),(s.length>0||i.length>0||l.length>0)&&o.emit("update",[{added:s,updated:i,removed:l},t])};var Hs=()=>new Map,fy=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},dy=()=>new Set,lk=Array.from,qD=Array.isArray,py=String.fromCharCode,zD=String.fromCodePoint,jD=py(65535),ck=o=>o.toLowerCase(),uk=/^\s*/g,fk=o=>o.replace(uk,""),dk=/([A-Z])/g,ay=(o,e)=>fk(o.replace(dk,t=>`${e}${ck(t)}`)),pk=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},ji=typeof TextEncoder!="undefined"?new TextEncoder:null,mk=o=>ji.encode(o),hk=ji?mk:pk,cf=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});cf&&cf.decode(new Uint8Array).length===1&&(cf=null);var ly=o=>o===void 0?null:o,gk=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},my=new gk,hf=!0;try{typeof localStorage!="undefined"&&(my=localStorage,hf=!1)}catch(o){}var hy=my,yk=o=>hf||addEventListener("storage",o),bk=o=>hf||removeEventListener("storage",o),vk=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},_k=(o,e)=>e.includes(o),js=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),gy=typeof window!="undefined"&&typeof document!="undefined"&&!js,WD=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,ho,xk=[],wk=()=>{if(ho===void 0)if(js){ho=Hs();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&ho.set(e,""),e=r):e!==null?(ho.set(e,r),e=null):xk.push(r)}e!==null&&ho.set(e,"")}else typeof location=="object"?(ho=Hs(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");ho.set(`--${ay(e,"-")}`,t),ho.set(`-${ay(e,"-")}`,t)}})):ho=Hs();return ho},ff=o=>wk().has(o),df=o=>ly(js?process.env[o.toUpperCase()]:hy.getItem(o)),Sk=o=>ff("--"+o)||df(o)!==null,KD=Sk("production"),cy=js&&_k(process.env.FORCE_COLOR,["true","1","2"]),GD=!ff("no-colors")&&(!js||process.stdout.isTTY||cy)&&(!js||ff("color")||cy||df("COLORTERM")!==null||(df("TERM")||"").includes("color")),yy=Math.floor,by=(o,e)=>o<e?o:e,kk=(o,e)=>o>e?o:e,JD=Number.isNaN,Ik=Math.pow,vy=128,Ck=1<<17,Lk=1<<18,Tk=1<<19,Ak=1<<20,Mk=1<<21,Fk=1<<22,Pk=1<<23,Ek=1<<24,Rk=1<<25,Dk=1<<26,Uk=1<<27,Ok=1<<28,$k=1<<29,Nk=1<<30,QD=1<<31,fl=127,YD=Ck-1,ZD=Lk-1,XD=Tk-1,e3=Ak-1,t3=Mk-1,r3=Fk-1,o3=Pk-1,n3=Ek-1,s3=Rk-1,i3=Dk-1,a3=Uk-1,l3=Ok-1,c3=$k-1,u3=Nk-1,Bk=Number.MAX_SAFE_INTEGER,f3=Number.MIN_SAFE_INTEGER,d3=1<<31,p3=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&yy(o)===o),m3=Number.isNaN,h3=Number.parseInt,Vk=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Yr=()=>new Vk,gf=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},$r=o=>{let e=new Uint8Array(gf(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(wy(o.cbuf.buffer,0,o.cpos),t),e},dl=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},er=(o,e)=>{for(;e>fl;)dl(o,vy|fl&e),e=yy(e/128);dl(o,fl&e)},pf=new Uint8Array(3e4),Hk=pf.length/3,qk=(o,e)=>{if(e.length<Hk){let t=ji.encodeInto(e,pf).written||0;er(o,t);for(let r=0;r<t;r++)dl(o,pf[r])}else qs(o,hk(e))},zk=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;er(o,r);for(let n=0;n<r;n++)dl(o,t.codePointAt(n))},g3=ji&&ji.encodeInto?qk:zk,jk=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=by(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(kk(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},qs=(o,e)=>{er(o,e.byteLength),jk(o,e)},y3=new DataView(new ArrayBuffer(4)),_y=o=>new Error(o),Wk=_y("Unexpected end of array"),Kk=_y("Integer out of Range"),Gk=class{constructor(o){this.arr=o,this.pos=0}},Jk=o=>new Gk(o),Qk=(o,e)=>{let t=wy(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},Yk=o=>Qk(o,xy(o)),xy=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&fl)*t,t*=128,n<vy)return e;if(e>Bk)throw Kk}throw Wk},Zk=o=>new Uint8Array(o),wy=(o,e,t)=>new Uint8Array(o,e,t),Xk=o=>new Uint8Array(o),eI=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=py(o[t]);return btoa(e)},tI=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),rI=o=>{let e=atob(o),t=Zk(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},oI=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},nI=gy?eI:tI,sI=gy?rI:oI,Sy=new Map,iI=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:sI(e.newValue||"")}),yk(this._onChange)}postMessage(o){hy.setItem(this.room,nI(Xk(o)))}close(){bk(this._onChange)}},aI=typeof BroadcastChannel=="undefined"?iI:BroadcastChannel,yf=o=>fy(Sy,o,()=>{let e=dy(),t=new aI(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),lI=(o,e)=>(yf(o).subs.add(e),e),cI=(o,e)=>{let t=yf(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),Sy.delete(o)),r},Vs=(o,e,t=null)=>{let r=yf(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},mf=Date.now,uI=class{constructor(){this._observers=Hs()}on(o,e){fy(this._observers,o,dy).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return lk((this._observers.get(o)||Hs()).values()).forEach(t=>t(...e))}destroy(){this._observers=Hs()}},fI=o=>vk(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Xn=0,ky=3,zs=1,dI=2,Wi=[];Wi[Xn]=(o,e,t,r,n)=>{er(o,Xn);let s=ny(e,o,t.doc,t);r&&s===al&&!t.synced&&(t.synced=!0)};Wi[ky]=(o,e,t,r,n)=>{er(o,zs),qs(o,Bs(t.awareness,Array.from(t.awareness.getStates().keys())))};Wi[zs]=(o,e,t,r,n)=>{iy(t.awareness,Yk(e),t)};Wi[dI]=(o,e,t,r,n)=>{sy(e,t.doc,(s,i)=>pI(t,i))};var uy=3e4,pI=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),Iy=(o,e,t)=>{let r=Jk(e),n=Yr(),s=xy(r),i=o.messageHandlers[s];return i?i(n,r,o,t,s):console.error("Unable to compute message"),n},Cy=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=mf();let r=Iy(o,new Uint8Array(t.data),!0);gf(r)>1&&e.send($r(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,ul(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(Cy,by(Ik(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=mf(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Yr();if(er(t,Xn),ll(t,o.doc),e.send($r(t)),o.awareness.getLocalState()!==null){let r=Yr();er(r,zs),qs(r,Bs(o.awareness,[o.doc.clientID])),e.send($r(r))}},o.emit("status",[{status:"connecting"}])}},uf=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Vs(o.bcChannel,e,o)},Ly=class extends uI{constructor(o,e,t,{connect:r=!0,awareness:n=new cl(t),params:s={},WebSocketPolyfill:i=WebSocket,resyncInterval:a=-1,maxBackoffTime:l=2500,disableBc:c=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=fI(s);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=i,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=c,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Wi.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,a>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let f=Yr();er(f,Xn),ll(f,t),this.ws.send($r(f))}},a)),this._bcSubscriber=(f,d)=>{if(d!==this){let p=Iy(this,new Uint8Array(f),!1);gf(p)>1&&Vs(this.bcChannel,$r(p),this)}},this._updateHandler=(f,d)=>{if(d!==this){let p=Yr();er(p,Xn),oy(p,f),uf(this,$r(p))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:f,updated:d,removed:p},m)=>{let y=f.concat(d).concat(p),g=Yr();er(g,zs),qs(g,Bs(n,y)),uf(this,$r(g))},this._unloadHandler=()=>{ul(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var f;this.wsconnected&&uy<mf()-this.wsLastMessageReceived&&((f=this.ws)==null||f.close())},uy/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(lI(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Yr();er(o,Xn),ll(o,this.doc),Vs(this.bcChannel,$r(o),this);let e=Yr();er(e,Xn),af(e,this.doc),Vs(this.bcChannel,$r(e),this);let t=Yr();er(t,ky),Vs(this.bcChannel,$r(t),this);let r=Yr();er(r,zs),qs(r,Bs(this.awareness,[this.doc.clientID])),Vs(this.bcChannel,$r(r),this)}disconnectBc(){let o=Yr();er(o,zs),qs(o,Bs(this.awareness,[this.doc.clientID],new Map)),uf(this,$r(o)),this.bcconnected&&(cI(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(Cy(this),this.connectBc())}};var Nt=new WeakMap,Ty=!1;function ml(o){Ty=o}var Nr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3,allowStackTraces:!1},tr,rr,pl=[];function Ay(o,e,t,r){rr=o,tr=t,r&&(Nr={...Nr,...r}),e.setInterval(vf,Nr.batchInterval)}async function vf(){if(pl.length===0)return;let o=[...pl];pl.length=0;for(let e=0;e<Nr.maxRetries;e++)try{await mI();let t=o.map(bf).join(`
`)+`
`;await rr.append(tr,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===Nr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function mI(){let o=await rr.stat(tr);if(o&&o.size>Nr.maxFileSize){for(let e=Nr.maxBackups;e>0;e--){let t=`${tr}.${e}`,r=`${tr}.${e+1}`;await rr.exists(t)&&(e===Nr.maxBackups?await rr.remove(t):await rr.rename(t,r))}await rr.exists(tr)&&await rr.rename(tr,`${tr}.1`),await rr.write(tr,"")}}function bf(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}var hI=["token","authorization","email","key"];function gI(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&hI.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Fe(o,e="log"){return(...t)=>{if(Ty){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",i=t.map(gI).join(" "),a={timestamp:r,level:e,message:`${o}: ${i}`,callerInfo:s};if(!Nr.disableConsole)if(Nr.allowStackTraces||e==="debug"||e==="log")console[e](bf(a));else{let l={warn:"color: #ff8c00; background: rgba(255, 140, 0, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;",error:"color: #ff5555; background: rgba(255, 85, 85, 0.1); font-weight: normal; padding: 1px 4px; border-radius: 2px;"};console.log(`%c${bf(a)}`,l[e])}pl.push(a)}}}async function hl(){let o=[];await rr.exists(tr)&&o.push(tr);for(let e=1;e<=Nr.maxBackups;e++){let t=`${tr}.${e}`;await rr.exists(t)&&o.push(t)}return o}async function My(){let o=[];if(await rr.exists(tr)){let e=await rr.read(tr);o.push(e)}for(let e=1;e<=Nr.maxBackups;e++){let t=`${tr}.${e}`;if(await rr.exists(t)){let r=await rr.read(t);o.push(r)}}return o.reverse().join(`
`)}var Lt=class{constructor(e){let t=e||this.constructor.name;this.debug=Fe(`[${t}]`,"debug"),this.log=Fe(`[${t}]`,"log"),this.warn=Fe(`[${t}]`,"warn"),this.error=Fe(`[${t}]`,"error")}setLoggers(e){this.debug=Fe(`[${e}]`,"debug"),this.log=Fe(`[${e}]`,"log"),this.warn=Fe(`[${e}]`,"warn"),this.error=Fe(`[${e}]`,"error")}};var _f=class{constructor(){this.platform="s3rn";this.product="relay"}},xf=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},No=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},Zr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},pr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.canvasId=r;this.platform="s3rn";this.product="relay"}},Bo=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},wf=class{constructor(e,t,r,n,s,i){this.relayId=e;this.folderId=t;this.fileId=r;this.hash=n;this.contentType=s;this.contentLength=i;this.platform="s3rn";this.product="relay"}},Br=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Vo=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},es=class{constructor(e,t){this.folderId=e;this.canvasId=t;this.platform="s3rn";this.product="relay"}},Ki=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},gt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("canvasId"in e){if(!this.validateUUID(e.canvasId))throw new Error("Invalid document UUID");t+=`:canvas:${e.canvasId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");if(t+=`:file:${e.fileId}`,"hash"in e&&e.hash&&"contentType"in e&&"contentLength"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:sha256:${e.hash}`,t+=`:contentType:${e.contentType}`,t+=`:contentLength:${e.contentLength}`}}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,i,a,l,c,u,f,d,p,m,y]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(a&&!this.validateUUID(a))throw new Error("Invalid UUID");if(c&&!this.validateUUID(c))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&i==="folder"&&l==="doc")return new Zr(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="canvas")return new pr(s,a,c);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file"&&u==="hash"&&d==="contentType"&&m==="contentLength")return new wf(s,a,c,f,p,y);if(r==="relay"&&n==="relay"&&i==="folder"&&l==="file")return new Bo(s,a,c);if(r==="relay"&&n==="relay"&&i=="folder")return new No(s,a);if(r==="relay"&&n==="folder"&&i==="document")return new Vo(s,a);if(r==="relay"&&n==="folder"&&i==="canvas")return new es(s,a);if(r==="relay"&&n==="folder")return new Br(s);if(r==="relay"&&n==="relay")return new xf(s);if(n===void 0)return new _f;throw new Error("Invalid s3rn format for the given product type")}};function yI(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Fy(o){let e=JSON.stringify(o),t=yI(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var Gi={enableDocumentStatus:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableAttachmentSync:!0,enableNetworkLogging:!1,enableCanvasSync:!1,enableVerifyUploads:!1,enableAutomaticDiffResolution:!1,enableDiscordLogin:!1,enableOIDCLogin:!1,enableGitHubLogin:!1,enableSelfManageHosts:!1,enableToasts:!1};function gl(o){return o in Gi}function bI(){return new Proxy({},{get:(o,e)=>e})}var Ho=bI();var Ws=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var zt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return zt.instance||(zt.instance=new zt(new Ws),Nt.set(this.instance,"postie")),zt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Fe("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Fe("[postie]","warn")(`All Mail Log:
`+this.prettyPrintMailLog(this.allMailLog))}prettyPrintDeliveredMailLog(){Fe("[postie]","warn")(`Delivered Mail Log:
`+this.prettyPrintMailLog(this.deliveredMailLog))}prettyPrintMailLog(e){let t="",r=n=>{t+=`${n}
`};return e.forEach((n,s)=>{r(`Mail #${s+1}:`),r(`  Timestamp: ${new Date(n.timestamp).toISOString()}`),r(`  Transaction ID: ${n.transactionId}`),r(`  Sender: ${n.sender.observableName||n.sender.constructor.name}`),r(`  Recipient: ${n.recipient.name||"Anonymous function"}`),r(`  Recipient Origin: ${n.recipientOrigin||"Unknown"}`),r("---")}),t}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){zt.instance&&(zt.instance.mailboxes=null,zt.instance.allMailLog=[],zt.instance.deliveredMailLog=[],zt.instance.timeProvider.destroy(),zt.instance.timeProvider=null,zt.instance.isDelivering=!1,zt.instance.isInTransaction=!1,zt.instance.currentTransactionId=0,zt._destroyed=!0,zt.instance=void 0)}},Vr=zt;Vr._destroyed=!1;var Sf=new Map;function Py(){for(let[,o]of Sf)o();Sf.clear()}var st=class extends Lt{constructor(t){super();this.observableName=t;this.destroyed=!1;Sf.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)Vr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Vr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function je(){return{...xt.getInstance().flags}}function vn(o,e,t=()=>{}){xt.getInstance().flags[o]?e():t()}function Ey(o,e,t=()=>{}){o.forEach(r=>{if(xt.getInstance().flags[r]){e();return}}),t()}var xt=class extends st{constructor(){super("FeatureFlagManager");this.flags=Gi}async applyServerFlags(t){if(!this.settings)return;let n=t.filter(s=>s.override).reduce((s,i)=>(s[i.name]=i.value,s),{});this.log("applying server flags",n),await this.settings.update(s=>({...s,...n}),!0)}static getInstance(){return xt.instance||(xt.instance=new xt),xt.instance}setSettings(t){this.settings=t,this.unsubscribes.push(this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()}))}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(n=>({...n,[t]:r}))}static destroy(){xt.instance&&xt.instance.destroy(),xt.instance=null}};var vI={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Ry(o,e,t){let r={token:o.token},n=new Ly(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,id:t.id,color:t.color.color,colorLight:t.color.light}),n}var qo=class extends Lt{constructor(t,r,n,s){var c;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=s;let i=(c=this.loginManager)==null?void 0:c.user;this.ydoc=new wr,je().enableDocumentHistory&&(this.ydoc.gc=!1),i&&new Ja(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,i.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(gt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=Ry(this.clientToken,this.ydoc,i);let a=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let f=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),f&&this.connect()});a.on(),this._offConnectionError=a.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Fy(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(gt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var i;this.clientToken=t;let r=new wr,n=Ry(t,r),s=n.url;if(this._provider){if(this._provider.url!==s){this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0;let a=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${a}`),(i=this._provider.ws)==null||i.close()}}else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:vI[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.ws&&(this._provider.ws.onopen=null,this._provider.ws.onmessage=null,this._provider.ws.onerror=null,this._provider.ws.onclose=null,(this._provider.ws.readyState===WebSocket.OPEN||this._provider.ws.readyState===WebSocket.CONNECTING)&&this._provider.ws.close(1e3,"Destroyed"),this._provider.ws=null),this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var zo=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},yl=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(i){s(i)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r(a.result?a.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let a=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onerror=()=>n(a.error),a.onsuccess=()=>r()}catch(s){n(s)}})}};var Xr=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{Fe("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[i,a]=this.checkFunction();i&&r(a)},3e3),this.promiseFunction().then(i=>{this.timeoutId&&clearTimeout(this.timeoutId),n(i)},i=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(i)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},bl=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Fe("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function Dy(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{Fe("[Promise]","debug")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var _I={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/canvas+json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function _n(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return _I[e]||"application/octet-stream"}var Uy=ln(kf());function Gs(o,e,t){let r=o.getText("contents"),n=r.toString(),s=new Uy.diff_match_patch,i=s.diff_main(n,e);s.diff_cleanupSemantic(i);let a=0,l=je().enableDeltaLogging?Fe("[diffMatchPatch]","debug"):(...c)=>{};l("Updating YDoc:"),l("Current content length:",n.length),l("Disk buffer length:",e.length),i.length!=0&&(o.transact(()=>{for(let[c,u]of i){switch(c){case 1:l(`Inserting "${u}" at position ${a}`),r.insert(a,u),a+=u.length;break;case 0:l(`Keeping "${u}" (length: ${u.length})`),a+=u.length;break;case-1:l(`Deleting "${u}" at position ${a}`),r.delete(a,u.length);break}l("intermediate",r.toString())}},t),l("result",r.toString()),l("Update complete. New content length:",r.toString().length))}function Sr(o){return o instanceof Tt}var Tt=class extends qo{constructor(t,r,n,s){let i=s.relayId?new Zr(s.relayId,s.guid,r):new Vo(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this.pendingOps=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new bn(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{let a=l=>{let c=l.transaction.origin;l.changes.keys.size!==0&&c!=this&&this.updateStats()};this.ytext.observe(a),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(a)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",gt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),vn(Ho.enableDeltaLogging,()=>{let a=l=>{var u,f;let c="";c+=`Transaction origin: ${l.transaction.origin} ${(f=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:f.name}
`;for(let d of l.changes.delta)c+=`insert: ${d.insert}

retain: ${d.retain}

delete: ${d.delete}
`;this.debug(c)};this.ytext.observe(a),this.unsubscribes.push(()=>{this.ytext.unobserve(a)})}),this._tfile=null}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}async process(t){this.tfile&&je().enableAutomaticDiffResolution&&this.pendingOps.push(t)}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this.getTFile()),this._tfile}getTFile(){var t;return(t=this._parent)==null?void 0:t.getTFile(this)}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new zo(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=await this.sharedFolder.backgroundSync.downloadItem(this),s=new Uint8Array(n.arrayBuffer);Ur(this.ydoc,s);let i=this.text!==r,a=this.text,l=a,c=[];for(let u of this.pendingOps)if(l=u(l),c.push(u),l==r){if(this.clearDiskBuffer(),a==this.text)Gs(this.ydoc,l,this);else return je().enableDeltaLogging?this.warn("diffMatchPatch solution is stale an cannot be applied",l,this.text):this.log("diffMatchPatch solution is stale an cannot be applied"),!0;return this.pendingOps=[],!0}return this.pendingOps=[],i||this.clearDiskBuffer(),i}async connect(){return this.sharedFolder.s3rn instanceof Br?!1:(this.s3rn instanceof Vo&&(this.sharedFolder.relayId?this.s3rn=new Zr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Vo(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Xr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Xr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return _n(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Or(this._persistence.db,["updates"],"readonly"),r=await $o(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,this._parent=null}async read(){return this.text}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var xn=class extends st{constructor(){super();this._set=new Set}add(t){let r=this._set.size;return this._set.add(t),this._set.size>r&&this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let n of this._set)t(n)&&r.push(n);return r}};var jo=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var If=require("obsidian");function Cf(o){return o instanceof wn}var wn=class extends Lt{constructor(t,r,n){super();this.path=t;this.guid=r;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let s=()=>{let i=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));return i instanceof If.TFolder?(this._tfolder=i,this.ready=!0,!0):!1};s()||(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0}).catch(()=>{s()})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r){return console.log("virtualpath for new syncfolder",t.getVirtualPath(r.path)),new wn(t.getVirtualPath(r.path),Ts(),t)}disconnect(){this.connected=!1}move(t,r){t!==this.path&&(this._parent=r,this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof If.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this._tfolder=null}};var go=ln($n());var vl,xI=new Uint8Array(16);function Lf(){if(!vl&&(vl=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!vl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return vl(xI)}var jt=[];for(let o=0;o<256;++o)jt.push((o+256).toString(16).slice(1));function Oy(o,e=0){return jt[o[e+0]]+jt[o[e+1]]+jt[o[e+2]]+jt[o[e+3]]+"-"+jt[o[e+4]]+jt[o[e+5]]+"-"+jt[o[e+6]]+jt[o[e+7]]+"-"+jt[o[e+8]]+jt[o[e+9]]+"-"+jt[o[e+10]]+jt[o[e+11]]+jt[o[e+12]]+jt[o[e+13]]+jt[o[e+14]]+jt[o[e+15]]}var wI=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Tf={randomUUID:wI};function SI(o,e,t){if(Tf.randomUUID&&!e&&!o)return Tf.randomUUID();o=o||{};let r=o.random||(o.rng||Lf)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return Oy(r)}var Js=SI;var kI={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function _l(o){return(o==null?void 0:o.type)==="markdown"}function $y(o){return(o==null?void 0:o.type)==="folder"}function Qi(o){return{version:0,id:o,type:"markdown"}}function Ny(o){return{version:0,id:o,type:"canvas"}}function xl(o){return{version:0,id:o,type:"folder"}}function By(o,e,t,r,n){return n||(n=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:n,hash:r}}var Af=class extends st{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||Af.defaults,r.forEach(([n,s])=>this.protocols.set(n,s)),this.unsubscribes.push(t.subscribe(n=>{this.updateFromSettings(n)}))}setEnabled(t,r){let n=this.protocols.get(t);n&&this.protocols.set(t,{...n,enabled:r})}canSync(t,r){var i,a;if(t.endsWith(".md")||je().enableCanvasSync&&t.endsWith(".canvas")||!((i=t.split("/").pop())==null?void 0:i.includes(".")))return!0;if(!je().enableAttachmentSync)return!1;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let s=this.getTypeForPath(t);return!!((a=this.protocols.get(s))!=null&&a.enabled)}updateFromSettings(t){Object.entries(kI).forEach(([r,n])=>{this.setEnabled(n,t[r])})}getEnabledFileSyncTypes(){if(!je().enableAttachmentSync)return["markdown","canvas"];let t=[];return this.protocols.forEach((r,n)=>{r!=null&&r.enabled&&n!=="folder"&&t.push(n)}),t}getTypeForPath(t){let r=_n(t);for(let[n,s]of this.protocols)if(s.mimetypes.includes(r))return!je().enableCanvasSync&&n==="canvas"?"file":n;return"file"}},Ji=Af;Ji.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["canvas",{maxVersion:0,mimetypes:["application/canvas+json"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var wl=class extends st{constructor(t,r,n,s){super();this.ydoc=t;this.namespace=r;this.pendingUpload=n;this.syncSettingsManager=s;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new Ji(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+go.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let n=this.pendingUpload.get(t);n&&(this.pendingUpload.set(r,n),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let s=this.overlay.get(t);s&&(this.overlay.set(r,s),this.overlay.delete(t));let i=this.meta.get(t);$y(i)?this.moveFolder(t,r):i&&(this.set(r,i),this.delete(t))}new(t){this.assertVPath(t);let r=Js();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)}),this.overlay.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}willSet(t,r){if(this.assertVPath(t),_l(r)&&this.legacyIds.get(t)!==r.id)return this.log("legacy vpath set to a different ID",this.legacyIds.get(t),r.id),!0;let n=this.meta.get(t);return n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash?!1:(this.log("new meta diff",n,r),!0)}set(t,r){this.assertVPath(t),_l(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let n=this.meta.get(t);n&&n.id===r.id&&n.mimetype==r.mimetype&&n.type===r.type&&n.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,n,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,n=new Map;t.changes.keys.forEach((s,i)=>{if(s.action==="delete"){let a=s.oldValue;(a==null?void 0:a.type)==="folder"&&r.set(a.id,i)}else if(s.action==="add"||s.action==="update"){let a=this.meta.get(i);(a==null?void 0:a.type)==="folder"&&n.set(a.id,i)}}),r.forEach((s,i)=>{let a=n.get(i);if(a&&s!==a){this.log(`Detected folder move from ${s} to ${a}`);let l=new Map;this.meta.forEach((c,u)=>{u.startsWith(a+go.sep)&&l.set(u,c)}),this.renames.set(s,a),this.log("setting alias",s,a),this.log("paths to move",l),l.forEach((c,u)=>{let f=u.slice(a.length),d=s+f;this.renames.set(d,u),this.log("setting alias",d,u)})}})}start(){vn(Ho.enableDeltaLogging,()=>{let n=s=>{var a,l;let i="";i+=`Transaction origin: ${s.transaction.origin}${(l=(a=s.transaction.origin)==null?void 0:a.constructor)==null?void 0:l.name}
`,s.changes.keys.forEach((c,u)=>{c.action==="add"&&(i+=`Added ${u}: ${this.get(u)}
`),c.action==="update"&&(i+=`Updated ${u}: ${this.get(u)}
`),c.action==="delete"&&(i+=`Deleted ${u}
`)}),this.debug(i)};this.legacyIds.observe(n),this.meta.observe(n),this.unsubscribes.push(()=>{this.legacyIds.unobserve(n)}),this.unsubscribes.push(()=>{this.meta.unobserve(n)})});let t=async n=>{if(n.changes.keys.size===0){this.log("no changes detected");return}n.transaction.origin!=this&&(this.processFolderOperation(n),this.notifyListeners())},r=async n=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let n=this.getMeta(t);if(n)return n.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),n=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let s=this.legacyIds.get(t),i=Qi(s);return this.overlay.set(t,i),i}if(r){if(_l(r)&&!n){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((s,i)=>{let a;if(this.meta.forEach((l,c)=>{l.type==="markdown"&&l.id===s&&c!==i&&(a=c)}),a){let l=(0,go.dirname)(a),c=(0,go.dirname)(i);l!==c&&t.set(l,c)}}),Array.from(t.entries()).sort(([s],[i])=>i.length-s.length).forEach(([s,i])=>{r.has(s)||(this.moveFolder(s,i),r.add(s))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let n=new Map;this.meta.forEach((i,a)=>{(a===t||a.startsWith(t+go.sep))&&n.set(a,i)}),this.overlay.forEach((i,a)=>{(a===t||a.startsWith(t+go.sep))&&n.set(a,i)});let s=this.meta.get(t);s&&(this.meta.set(r,s),this.meta.delete(t)),n.forEach((i,a)=>{if(a===t)return;let l=a.slice(t.length),c=r+l;this.move(a,c)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var a;if(this.assertVPath(r),((a=this.meta.get(r))==null?void 0:a.id)===t)return;let n=new Set,s=r.split(go.sep),i="";for(let l=0;l<s.length-1;l++)i=s.slice(0,l+1).join(go.sep),n.add(i);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,Qi(t))),n.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let c=Js();console.log("creating folder path",l,c),this.overlay.set(l,xl(c))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function Vy(o,e,t=(r,n)=>r.substring(n.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,n){let s=r[n];return typeof s=="function"?function(...i){return i.length>0&&typeof i[0]=="string"&&(i[0]=t(i[0],e)),s.apply(r,i)}:s}})}var Gy=require("obsidian"),Jy=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkfetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(Jy.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=Ky()));var ft=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.6.0"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},i;if(i=await(0,Gy.requestUrl)(s),!i.arrayBuffer.byteLength)return new Response(null,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});let a=new Response(i.arrayBuffer,{status:i.status,statusText:i.status.toString(),headers:new Headers(i.headers)});if(Object.defineProperty(a,"json",{value:async()=>JSON.parse(i.text)}),je().enableNetworkLogging){let c=i.status>=500?"error":i.status>=400?"warn":"debug",u=i.text,f;if((i.headers["content-type"]||"").includes("application/json"))try{f=JSON.parse(u)}catch(p){}Fe("[CustomFetch]",c)(i.status.toString(),r,t,f||u)}if(i.status>=500)throw new Error(i.text);return a};var or=class extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,or.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof or||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},Sl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function $I(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||NI,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let i=o.indexOf(";",n);if(i===-1)i=o.length;else if(i<s){n=o.lastIndexOf(";",s-1)+1;continue}let a=o.slice(n,s).trim();if(t[a]===void 0){let l=o.slice(s+1,i).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[a]=r(l)}catch(c){t[a]=l}}n=i+1}return t}function Qy(o,e,t){let r=Object.assign({},t||{}),n=r.encode||BI;if(!Sl.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!Sl.test(s))throw new TypeError("argument val is invalid");let i=o+"="+s;if(r.maxAge!=null){let a=r.maxAge-0;if(isNaN(a)||!isFinite(a))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(a)}if(r.domain){if(!Sl.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!Sl.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return i}function NI(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function BI(o){return encodeURIComponent(o)}var Xy;function kl(o){if(o)try{let e=decodeURIComponent(Xy(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function eb(o,e=0){let t=kl(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}Xy=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,i="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?i+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return i};var Yy="pb_auth",Zi=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!eb(this.token)}get isAdmin(){return kl(this.token).type==="admin"}get isAuthRecord(){return kl(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=Yy){let r=$I(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=Yy){var l,c;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=kl(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},i=Qy(t,JSON.stringify(s),e),a=typeof Blob!="undefined"?new Blob([i]).size:i.length;if(s.model&&a>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(c=s==null?void 0:s.model)==null?void 0:c.email};let u=["collectionId","username","verified"];for(let f in this.model)u.includes(f)&&(s.model[f]=this.model[f]);i=Qy(t,JSON.stringify(s),e)}return i}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Ff=class extends Zi{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},Wo=class{constructor(e){this.client=e}},Pf=class extends Wo{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,n,s,i){return i=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},i),this.client.send("/api/settings/apple/generate-client-secret",i)}},Xi=class extends Wo{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(n=>{var s;return n.items=((s=n.items)==null?void 0:s.map(i=>this.decode(i)))||[],n})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new or({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new or({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(n=>this.decode(n))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then(i=>{let a=i.items;return r=r.concat(a),a.length==i.perPage?n(s+1):r});return n(1)}};function kr(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Mf(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Ef=class extends Xi{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,i;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((i=this.client.authStore.model)==null?void 0:i.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=kr("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let i=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||Mf(this.client);let a=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return a=this.authResponse(a),i&&function(c,u,f,d){Mf(c);let p=c.beforeSend,m=c.authStore.model,y=c.authStore.onChange((g,k)=>{(!g||(k==null?void 0:k.id)!=(m==null?void 0:m.id)||(k!=null&&k.collectionId||m!=null&&m.collectionId)&&(k==null?void 0:k.collectionId)!=(m==null?void 0:m.collectionId))&&Mf(c)});c._resetAutoRefresh=function(){y(),c.beforeSend=p,delete c._resetAutoRefresh},c.beforeSend=async(g,k)=>{var A;let L=c.authStore.token;if((A=k.query)!=null&&A.autoRefresh)return p?p(g,k):{url:g,sendOptions:k};let I=c.authStore.isValid;if(I&&eb(c.authStore.token,u))try{await f()}catch(M){I=!1}I||await d();let C=k.headers||{};for(let M in C)if(M.toLowerCase()=="authorization"&&L==C[M]&&c.authStore.token){C[M]=c.authStore.token;break}return k.headers=C,p?p(g,k):{url:g,sendOptions:k}}}(this.client,i,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s))),a}async authRefresh(e,t){let r={method:"POST"};return r=kr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=kr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=kr("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",i).then(()=>!0)}},VI=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function tb(o){if(o){o.query=o.query||{};for(let e in o)VI.includes(e)||(o.query[e]=o[e],delete o[e])}}var Il=class extends Wo{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var i;if(!e)throw new Error("topic must be set.");let n=e;if(r){tb(r);let a="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+a}let s=function(a){let l=a,c;try{c=JSON.parse(l==null?void 0:l.data)}catch(u){}t(c||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(i=this.eventSource)==null||i.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let i of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,i);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let i in n){if(!Array.isArray(this.subscriptions[i])||!this.subscriptions[i].length)continue;let a=!1;for(let l=this.subscriptions[i].length-1;l>=0;l--)this.subscriptions[i][l]===t&&(a=!0,delete this.subscriptions[i][l],this.subscriptions[i].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(i,t));a&&(this.subscriptions[i].length||delete this.subscriptions[i],r||this.hasSubscriptionListeners(i)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new or(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Rf=class extends Xi{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,i,a;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((i=this.client.authStore.model)==null?void 0:i.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s,i;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=kr("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then(i=>this.authResponse(i))}async authWithOAuth2Code(e,t,r,n,s,i,a){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=kr("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,i,a),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(c=>this.authResponse(c))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new or(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new Il(this.client),i=null;function a(){i==null||i.close(),s.unsubscribe()}return t.urlCallback||(i=Zy(void 0)),new Promise(async(l,c)=>{var u;try{await s.subscribe("@oauth2",async m=>{let y=s.clientId;try{if(!m.state||y!==m.state)throw new Error("State parameters don't match.");let g=Object.assign({},t);delete g.provider,delete g.scopes,delete g.createData,delete g.urlCallback;let k=await this.authWithOAuth2Code(r.name,m.code,r.codeVerifier,n,t.createData,g);l(k)}catch(g){c(new or(g))}a()});let f={state:s.clientId};(u=t.scopes)!=null&&u.length&&(f.scope=t.scopes.join(" "));let d=this._replaceQueryParams(r.authUrl+n,f);await(t.urlCallback||function(m){i?i.location.href=m:i=Zy(m)})(d)}catch(f){a(),c(new or(f))}})}async authRefresh(e,t){let r={method:"POST"};return r=kr("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(n=>this.authResponse(n))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=kr("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let i={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return i=kr("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",i,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",i).then(()=>!0)}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=kr("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=kr("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>!0)}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=kr("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=kr("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},i=n.split("&");for(let a of i){if(a=="")continue;let l=a.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let a in t)t.hasOwnProperty(a)&&(t[a]==null?delete s[a]:s[a]=t[a]);n="";for(let a in s)s.hasOwnProperty(a)&&(n!=""&&(n+="&"),n+=encodeURIComponent(a.replace(/%20/g,"+"))+"="+encodeURIComponent(s[a].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function Zy(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new or(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,i=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+i+",left="+s+",resizable,menubar=no")}var Df=class extends Xi{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},Uf=class extends Wo{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new or({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Of=class extends Wo{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},$f=class extends Wo{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let i=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+i}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},Nf=class extends Wo{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},ts=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Ff,this.admins=new Ef(this),this.collections=new Df(this),this.files=new $f(this),this.logs=new Uf(this),this.settings=new Pf(this),this.realtime=new Il(this),this.health=new Of(this),this.backups=new Nf(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Rf(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async n=>{let s={};try{s=await n.json()}catch(i){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new or({url:n.url,status:n.status,data:s});return s}).catch(n=>{throw new or(n)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),tb(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let i of s)t.append(r,i);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let i of n)t.push(s+"="+encodeURIComponent(i));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var Cl=class extends Lt{constructor(t){super();this.sharedFolder=t;let r=t.loginManager.getEndpointManager().getAuthUrl();this.pb=new ts(r,t.loginManager.authStore),this.tokenStore=t.tokenStore}async verify(t){if(!t.meta)throw new Error("cannot head file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(gt.encode(t.s3rn),r,t.mimetype,0);return(await ft(n.baseUrl,{method:"HEAD",headers:{Authorization:`Bearer ${n.token}`}})).status===200}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,n=await this.tokenStore.getFileToken(gt.encode(t.s3rn),r,t.mimetype,0),s=await ft(n.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(s.status===404)throw new Error(`[${this.sharedFolder.path}] File is missing: ${t.guid} ${t.meta.hash} ${t.meta.type}`);let a=(await s.json()).downloadUrl;return(await ft(a)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),n=await t.caf.hash();if(this.log("writeFile",n),!(r&&n))throw new Error("invalid caf");let s=await this.tokenStore.getFileToken(gt.encode(t.s3rn),n,t.mimetype,r.byteLength),i=await ft(s.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${s.token}`}}),a=await i.json();if(i.status!==200)throw new Error(a.error);let l=a.uploadUrl;await ft(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null,this.sharedFolder=null}};var mr=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var Ll=class extends st{constructor(t,r){super("Settings");this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},nr=class extends st{constructor(t,r){super(`NamespacedSettings[${r}]`);this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new mr("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new mr(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([a])=>s.test(a)).reduce((a,[l,c])=>(a[l]=c,a),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new mr("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),c={...r};return Object.entries(t).forEach(([u,f])=>{l.test(u)&&(c[u]=f)}),c}let s={...r},i=s;this.path.forEach(l=>{i[l]=i[l]||{},i=i[l]});let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,c])=>{a.test(l)&&(i[l]=c)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new mr(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(a=>a),n=[],s=[],i=[];return r.forEach((a,l)=>{let c=a.match(/^\[(\w+)=(.+)\]$/),u=a.match(/^\((.+?)\)$/);if(c){let[,f,d]=c,p=l>0?s[l-1]:a.split("[")[0];i.push({type:"arrayMatch",key:f,value:d,level:l}),n.push(a),s.push(p)}else if(u){let[,f]=u;i.push({type:"wildcard",wildcardPattern:this.createPatternRegex(f),level:l}),n.push(a),s.push(a)}else n.push(a),s.push(a)}),[n,s,i]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>i.test(l)).reduce((l,[c,u])=>(l[c]=u,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let i=this.basePath[0];if(!Array.isArray(r[i]))return;let a=r[i].find(c=>c[s.key]===s.value);if(!a)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let c=a;for(let u of l){if(!c||typeof c!="object")return;c=c[u]}return c}return a}for(let i=0;i<this.basePath.length;i++){if(!r)return;r=r[this.basePath[i]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let c=n[l].findIndex(f=>f[s.key]===s.value),u=this.basePath.slice(s.level+1);if(c>=0)if(u.length>0){let f=n[l][c];for(let p=0;p<u.length-1;p++){let m=u[p];f[m]=f[m]||{},f=f[m]}let d=u[u.length-1];f[d]=r}else n[l][c]={...n[l][c],...r,[s.key]:s.value};else if(u.length>0){let f={[s.key]:s.value},d=f;for(let m=0;m<u.length-1;m++){let y=u[m];d[y]={},d=d[y]}let p=u[u.length-1];d[p]=r,n[l].push(f)}else n[l].push({...r,[s.key]:s.value});return n}let i=n;for(let l=0;l<this.basePath.length-1;l++){let c=this.basePath[l];i[c]=i[c]||{},i=i[c]}let a=this.basePath[this.basePath.length-1];return i[a]=r,n}getParent(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new nr(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new nr(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(c=>c[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,i=this.basePath.slice(0,-1);for(let l of i){if(!s[l])return r;s=s[l]}let a=this.basePath[this.basePath.length-1];return delete s[a],r})}subscribe(t){if(this.destroyed)throw new mr("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var Sn=class extends nr{constructor(t,r,n=!0){super(t,r);this.enabled=n}isExtensionEnabled(t){var s,i;let n=(t.split(".").pop()||"").toLowerCase();if(n==="md"||je().enableCanvasSync&&n==="canvas")return!0;if(!this.enabled||!je().enableAttachmentSync)return!1;for(let[a,l]of Object.entries(Sn.schema)){let c=a;if(((s=this.get()[c])!=null?s:l.defaultEnabled)&&l.extensions.includes(n))return!0}return(i=this.get().otherTypes)!=null?i:Sn.schema.otherTypes.defaultEnabled}getCategory(t){var s;let r=Sn.schema[t];return{enabled:(s=this.get()[t])!=null?s:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(Sn.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(n=>({...n,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...Sn.defaultFlags}))}},kn=Sn;kn.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},kn.defaultFlags=Object.fromEntries(Object.entries(Sn.schema).map(([t,r])=>[t,r.defaultEnabled]));var ea=require("obsidian");async function Bf(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function Hr(o){return!!o&&o instanceof In}var Tl=class extends Lt{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let n=indexedDB.open(this.dbName,1);n.onupgradeneeded=s=>{let i=n.result;i.objectStoreNames.contains("files")||i.createObjectStore("files",{keyPath:"path"})},n.onsuccess=s=>{this.db=n.result,t()},n.onerror=s=>{this.error("Error opening ContentAddressedFile database:",n.error),r(n.error)}})}async saveHash(t,r,n){if(await this.ready,!!this.db)return new Promise((s,i)=>{if(!this.db)return;let c=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:n});c.onsuccess=()=>s(),c.onerror=()=>{this.error("Error saving hash:",c.error),i(c.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readonly").objectStore("files").get(t);a.onsuccess=()=>{r(a.result||null)},a.onerror=()=>{this.error("Error retrieving hash:",a.error),n(a.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,n)=>{if(!this.db)return null;let a=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);a.onsuccess=()=>r(),a.onerror=()=>{this.error("Error removing hash:",a.error),n(a.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},Vf=class extends Lt{constructor(t,r,n){super();this.vault=t;this.path=r;this.store=n;this.content=null;this._tfile=null;let s=this.vault.getAbstractFileByPath(r);s&&s instanceof ea.TFile&&(this._tfile=s)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof ea.TFile)this._tfile=t;else throw new Error(`missing tfile: ${this.path}`)}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await Bf(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return r}async _hash(){let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),n=await Bf(r);try{await this.store.saveHash(this.path,n,t)}catch(s){this.warn("Failed to save hash to store:",s)}return n}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof ea.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();return t||(t=await this._hash(),t)}destroy(){this.vault=null,this._tfile=null}},In=class extends st{constructor(t,r,n,s){super();this.path=t;this.guid=r;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.uploadError=void 0;this.s3rn=s.relayId?new Bo(s.relayId,s.guid,r):new Ki(s.guid,r),this._parent=s,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new Vf(this.vault,this.sharedFolder.getPath(t),this.hashStore),this.log("created")}get mimetype(){return _n(this.path)}disconnect(){}get inMeta(){return!!this.sharedFolder.syncStore.getMeta(this.path)}get pending(){return!!this.sharedFolder.syncStore.pendingUpload.has(this.path)}get tag(){return this.inMeta?"":this.uploadError?this.uploadError:this.pending?"pending":"unknown"}move(t,r){t!==this.path&&(this._parent=r,this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}_refreshMeta(){let t=this.sharedFolder.syncStore.getMeta(this.path);return this.meta=t,t}async push(t=!1){if(this.log("push"),!this.sharedFolder.connected){this.log("skipping push -- folder is disconnected");return}if(!this.sharedFolder.syncStore.canSync(this.path)){this.log("skipping push -- filetype is disabled");return}let r=await this.caf.hash();if(this._refreshMeta(),!this.meta||r&&this.meta.hash!==r||t)try{await this.sharedFolder.cas.writeFile(this),await this.sharedFolder.markUploaded(this),this.uploadError=void 0,this.notifyListeners()}catch(n){let s="Failed to push file";try{s=n.toString()}catch(i){}this.uploadError=s.replace(/^Error:/,"").trim(),this.notifyListeners()}}async sync(){var t;if(this.log("sync"),this._refreshMeta(),this.caf.exists()){if(!this.meta){await this.push();return}}else{if(!this.meta)throw new Error("unexpected case");await this.pull();return}try{let r=await this.caf.hash();if(je().enableVerifyUploads)try{this.verifyUpload()||(this.warn("file in metadata, but not on the server!"),await this.push())}catch(n){}if(r!==this.meta.hash){if(this.stat.mtime>this.meta.synctime){await this.push();return}this.warn("synctime",this.meta.synctime,(t=this.meta)==null?void 0:t.synctime,this.stat.mtime),await this.pull();return}}catch(r){this.warn("unable to compute hash",r)}}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async verifyUpload(){if(this.log("verify upload"),this._refreshMeta(),!this.meta)throw new Error("cannot verify upload without meta");return this.sharedFolder.cas.verify(this)}async pull(){if(this.log("pull"),this._refreshMeta(),!this.meta)throw new Error("cannot pull without meta");if(!(this.caf.exists()&&await this.caf.hash()===this.meta.hash))try{let t=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),t),await this.caf.hash()}catch(t){this.log(t);return}}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof ea.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof Br?!1:(this.s3rn instanceof Vo&&(this.sharedFolder.relayId?this.s3rn=new Bo(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ki(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.caf.destroy()}};function yo(o,e){if(!o||!e)return!1;for(let t in o)if(typeof o[t]=="object"&&o[t]!==null){if(!yo(o[t],e[t]))return!1}else if(o[t]!==e[t])return!1;for(let t in e)if(!(t in o))return!1;return!0}function Ir(o){return o instanceof yt}var yt=class extends qo{constructor(t,r,n,s){let i=s.relayId?new pr(s.relayId,s.guid,r):new es(s.guid,r);super(r,i,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this.unsubscribes.push(this._parent.subscribe(this.path,a=>{a.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[Canvas](${this.path})`);try{let a=`${this.sharedFolder.appId}-relay-canvas-${this.guid}`;this._persistence=new bn(a,this.ydoc)}catch(a){throw this.warn("Unable to open persistence.",this.guid),console.error(a),a}this.whenSynced().then(()=>{this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",gt.encode(this.s3rn))}catch(a){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),this._tfile=null}get yedges(){return this.ydoc.getMap("edges")}get ynodes(){return this.ydoc.getMap("nodes")}textNode(t){let r=this.ydoc.getText(t.id);return r.toString()===""&&r.insert(0,t.text),r}static exportCanvasData(t){let r=t.getMap("edges"),n=t.getMap("nodes"),s=[],i=[];for(let[,a]of r.entries())s.push({...a});for(let[,a]of n.entries()){let l=t.getText(a.id);i.push({...a,text:l.toString()||a.text})}return{edges:s,nodes:i}}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async connect(){return this.sharedFolder.s3rn instanceof Br?!1:(this.s3rn instanceof es&&(this.sharedFolder.relayId?this.s3rn=new pr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new es(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Or(this._persistence.db,["updates"],"readonly"),r=await $o(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new Xr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new Xr(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}static checkExtension(t){return t.endsWith(".canvas")&&je().enableCanvasSync}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async applyJSON(t){if(t==="")return;let r=JSON.parse(t);return await this.applyData(r)}async importFromView(t){if(t.file&&t.file===this.tfile)return await this.applyData(t.canvas.getData())}async applyData(t){let r=this.yedges,n=this.ynodes,s=new Set,i=new Map,a=new Set,l=new Map,c=new Set;t.nodes.forEach(u=>{s.add(u.id);let f=n.get(u.id);f?yo(f,u)||i.set(u.id,u):(i.set(u.id,u),u.type==="text"&&this.textNode(u))});for(let u of n.keys())s.has(u)||a.add(u);t.edges.forEach(u=>{s.add(u.id);let f=r.get(u.id);f&&yo(f,u)||l.set(u.id,u)});for(let u of r.keys())s.has(u)||c.add(u);(i.size>0||a.size>0||l.size>0||c.size>0)&&nt(this.ydoc,()=>{for(let u of i.values())this.ynodes.set(u.id,u);for(let u of a)this.ynodes.delete(u);for(let u of l.values())this.yedges.set(u.id,u);for(let u of c)this.yedges.delete(u)},this)}move(t,r){this.path=t,this._parent=r,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get mimetype(){return _n(this.path)}get json(){let t=yt.exportCanvasData(this.ydoc);return JSON.stringify(t)}async cleanup(){}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.json.length}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}};var Hf=class extends xn{constructor(){super(...arguments);this.notifyListeners=(0,tt.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let n=this.find(s=>s.guid===t.guid);return n&&n!==t&&(this.error("duplicate guid",n,t),this._set.delete(n)),this._set.add(t),r&&this.notifyListeners(),this}},Al=class extends qo{constructor(t,r,n,s,i,a,l,c,u,f,d,p,m=!0){var g;let y=p?new No(p,r):new Br(r);super(r,y,l,s);this.appId=t;this.hashStore=u;this.backgroundSync=f;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],n=this.placeHold(t);t.forEach(s=>{let i=this.getVirtualPath(s.path),a=n.contains(i);if(s instanceof tt.TFolder){let l=this.getSyncFolder(i,!1);r.push(l)}else if(Tt.checkExtension(i))if(a){let l=this.uploadDoc(i,!1);r.push(l)}else{let l=this.getDoc(i,!1);r.push(l)}else if(yt.checkExtension(i))if(a){let l=this.uploadCanvas(i,!1);r.push(l)}else{let l=this.getCanvas(i,!1);r.push(l)}else if(this.syncStore.canSync(i))if(a){let l=this.uploadSyncFile(i,!1);r.push(l)}else{let l=this.syncFile(i,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=a,this.vault=i,this.files=new Map,this.fset=new Hf,this.pendingUpload=new jo(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.pendingUpload.forEach((k,L)=>{this.existsSync(L)||(this.warn("deleting pending upload record because file is missing",L,k),this.pendingUpload.delete(L))}),this.relayManager=c,this.relayId=p,this.diskBufferStore=new yl,this._shouldConnect=(g=this.settings.connect)!=null?g:!0,this.authoritative=!m,this.syncSettingsManager=this._settings.getChild("sync",(k,L)=>new kn(k,L)),this.syncStore=new wl(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(k=>{this.remote=k.find(L=>L.guid==this.guid)})),this.unsubscribes.push(this.relayManager.storageQuotas.subscribe(async k=>{let L=k.find(I=>{var C;return I.id===((C=this._remote)==null?void 0:C.relay.storageQuotaId)});L!==void 0&&this.storageQuota!==L.quota&&(this.storageQuota!==void 0&&L.quota!==void 0&&L.quota>this.storageQuota&&(this.debug("storage quota increase",this.storageQuota,L.quota),await this.netSync()),this.debug("storage quota update",this.storageQuota,L.quota),this.storageQuota=L.quota)})),this.proxy=Vy(this,this.path,k=>this.getVirtualPath(k));try{this._persistence=new bn(this.guid,this.ydoc)}catch(k){throw this.warn("Unable to open persistence.",this.guid),console.error(k),k}s.loggedIn&&this.connect(),this.cas=new Cl(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",gt.encode(this.s3rn))}catch(k){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Nt.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let n=[];this.fset.forEach(s=>{s instanceof qo&&(s.connected&&n.push(s),s.reset())}),this.tokenStore.clear(s=>{var i;return!!(this.relayId&&((i=s.token)!=null&&i.docId.startsWith(this.relayId)))}),r&&(this.connect(),n.forEach(s=>{s.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof tt.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path),n=this.getVirtualPath(t.path),s=this.syncStore.canSync(n);if(t instanceof tt.TFolder)return r&&s;let i=this.syncSettingsManager.isExtensionEnabled(n);return r&&s&&i}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof tt.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return tt.Vault.recurseChildren(t,n=>{n!==t&&r.push(n)}),r.filter(n=>this.isSyncableTFile(n))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof No&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new No(this.relayId,this.guid):new Br(this.guid),this._settings.update(n=>({...n,relay:this.relayId})),t&&(this._server=t.relay.providerId,this.unsubscribes.push(t.relay.subscribe(n=>{n.guid===this.relayId&&(this.server=n.providerId)}))),this.server=t==null?void 0:t.relay.providerId,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=Or(this._persistence.db,["updates"],"readonly"),r=await $o(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new Xr(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new Xr(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){if(s==null||s.push(`${n.path} was renamed to ${this.getPath(r)}`),n instanceof tt.TFile){let i=(0,Cr.dirname)(r);this.existsSync(i)||(await this.mkdir(i),s==null||s.push(`creating directory ${i}`))}await this.fileManager.renameFile(n,(0,tt.normalizePath)(this.getPath(r))).then(()=>{t.move(r,this)})}async _handleServerCreate(t,r,n){let s=(0,Cr.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),n==null||n.push(`creating directory ${s}`)),r.type==="markdown")return n==null||n.push(`created local .md file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(r.type==="canvas")return n==null||n.push(`created local .canvas file for remotely added canvas ${t}`),await this.downloadCanvas(t,!1);if(r.type==="folder")return n==null||n.push(`created local folder for remotely added folder ${t}`),this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return n==null||n.push(`created local file for remotely added file ${t}`),this.downloadSyncFile(t,!1);throw new Error(`${t}: Unexpected file type ${r.type} ${r.mimetype}`)}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,n,s){let i=this.files.get(t),a=this.syncStore.getMeta(r);if(!a)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return i&&Hr(i)&&i.shouldPull(a)?{op:"update",path:r,promise:i.pull()}:{op:"noop",path:r,promise:Promise.resolve()};if(n.has(t)&&i){let c=this.getPath(i.path),u=this.vault.getAbstractFileByPath(c);if(u){let f=this._handleServerRename(i,r,u,s);return{op:"rename",path:r,from:c,to:r,promise:f}}}let l=this._handleServerCreate(r,a,s);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let n=this.getSyncFiles(),s=[],i=n.filter(c=>c instanceof tt.TFolder),a=n.filter(c=>c instanceof tt.TFile),l=c=>{var g,k;let u=this.isSyncableTFile(c),f=this.checkPath(c.path),d=t.contains(c.path.slice(this.path.length)),p=this.pendingUpload.has(this.getVirtualPath(c.path)),m=this.getVirtualPath(c.path),y=((g=this._provider)==null?void 0:g.synced)&&((k=this._persistence)==null?void 0:k.synced);if(f&&u&&!d&&!p&&y){r.push(`deleted local file ${m} for remotely deleted doc`);let L=this.vault.adapter.trashLocal(c.path);s.push({op:"delete",path:m,promise:L})}};return a.forEach(l),i.forEach(l),s}syncByType(t,r,n,s){t.forEach((i,a)=>{this._assertNamespacing(a),s.contains(i.type)&&(this._assertNamespacing(a),n.push(this.applyRemoteState(i.id,a,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,s,n,["folder"])},this),await Promise.all(n.map(u=>u.promise)),this.ydoc.transact(async()=>{this.syncByType(t,s,n,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let i=n.filter(u=>u.op==="create"),a=n.filter(u=>u.op==="rename"),l=n.map(u=>u.path);await Promise.all([...i,...a].map(u=>Dy(u.promise,u)));let c=this.cleanupExtraLocalFiles(l,s);[...n,...c].every(u=>u.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...n,...c])),(a.length>0||i.length>0||c.length>0)&&this.fset.update(),s.length>0&&this.log(`syncFileTree diff:
`+s.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new bl(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,Cr.join)(this.path,t.path);return this.vault.adapter.read((0,tt.normalizePath)(r))}existsSync(t){let r=(0,tt.normalizePath)((0,Cr.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,Cr.join)(this.path,t.path);return this.vault.adapter.exists((0,tt.normalizePath)(r))}flush(t,r){let n=(0,Cr.join)(this.path,t.path);return this.log("writing to ",(0,tt.normalizePath)(n)),this.vault.adapter.write((0,tt.normalizePath)(n),r)}getPath(t){return(0,Cr.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,Cr.join)(this.path,t);return this.vault.adapter.mkdir((0,tt.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+Cr.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof tt.TFile?r:null}getDoc(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!Sr(s))throw new Error("getDoc(): unexpected ifile type");return s}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof tt.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}getCanvas(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t,this),!Ir(s))throw new Error("getCanvas(): unexpected ifile type");return s}else return this.log("[getCanvas]: creating canvas for shared ID"),this.createCanvas(t,r)}else{this.warn("[getCanvas]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof tt.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadCanvas(t):this.createCanvas(t,r)}}async markUploaded(t){let r=(n,s)=>{this.syncStore&&this.syncStore.willSet(n.path,s)&&(this.log("new meta",n.path,s),this.ydoc.transact(()=>{this.syncStore.markUploaded(n.path,s)},this))};if(Sr(t)){let n=Qi(t.guid);r(t,n);return}if(Ir(t)){let n=Ny(t.guid);r(t,n);return}if(Cf(t)){let n=xl(t.guid);r(t,n);return}if(Hr(t)){let n=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!n)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let i=By(n,t.guid,t.mimetype,s,t.stat.mtime);r(t,i);return}}getFile(t,r=!0){let n=this.getVirtualPath(t.path),s=this.syncStore.get(n);if(s){let i=this.files.get(s);if(i)return i}if(t instanceof tt.TFolder)return this.getSyncFolder(n,r);if(t instanceof tt.TFile){if(Tt.checkExtension(n))return this.getDoc(n);if(yt.checkExtension(n))return this.getCanvas(n);if(this.syncStore.canSync(n))return this.getSyncFile(n,r)}return null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{let s=this.getVirtualPath(n.path);this.syncStore.has(s)||(this.log("place hold new",s),this.syncStore.new(s),r.push(s))})},this),r}getOrCreateCanvas(t,r){let n=this.files.get(t)||new yt(r,t,this.loginManager,this);if(!Ir(n))throw new Error("getOrCreateCanvas(): unexpected ifile type");return n.move(r,this),n}async downloadCanvas(t,r=!0){if(!yt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateCanvas(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueCanvasDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadCanvas(t,r=!0){if(!yt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,f]=await Promise.all([this.read(s),i,a]);!f&&u===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{try{s.applyJSON(c)}catch(d){throw console.warn(c),d}},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createCanvas(t,r){if(!yt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateCanvas(n,t);return(async()=>this.whenReady().then(async()=>{let i=await s.getServerSynced();s.stat.size===0&&!i?this.backgroundSync.enqueueCanvasDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!Sr(n))throw new Error("viewDoc(): unexpected ifile type");return n}viewSyncFile(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!Hr(n))throw new Error(`viewSyncFile(): unexpected ifile type, guid=${r}, vpath=${t}`);return n}getOrCreateDoc(t,r){let n=this.files.get(t)||new Tt(r,t,this.loginManager,this);if(!Sr(n))throw new Error("unexpected ifile type");return n.move(r,this),n}async downloadDoc(t,r=!0){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateDoc(n,t);return s.markOrigin("remote"),this.backgroundSync.enqueueDownload(s),this.files.set(n,s),this.fset.add(s,r),s}uploadDoc(t,r=!0){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.getOrCreateDoc(n,t),i=s.getOrigin(),a=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[c,u,f]=await Promise.all([this.read(s),i,a]),d=s.ydoc.getText("contents");!f&&u===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{d.insert(0,c)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createDoc(t,r=!0){if(!Tt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateDoc(n,t);return(async()=>this.whenReady().then(async()=>{var a;let i=await s.getServerSynced();((a=s.tfile)==null?void 0:a.stat.size)===0&&!i?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFolder(t,r){let n=this.files.get(t)||new wn(r,t,this);if(!Cf(n))throw new Error("unexpected ifile type");return n.move(r,this),n}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateSyncFolder(n,t);return this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFile(t,r,n){let s=this.files.get(t)||new In(r,t,this.hashStore,this);if(!Hr(s))throw new Error(`getOrCreateSyncFile(): unexpected ifile type, guid=${t}`);return s.move(r,this),this.files.set(t,s),s}syncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called sync on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueSync(i),this.files.set(n,i),this.fset.add(i,r),i}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.syncStore.getMeta(t);if(!s||!s.hash)return this.uploadSyncFile(t,r);let i=this.getOrCreateSyncFile(n,t,s.hash);return this.backgroundSync.enqueueDownload(i),this.files.set(n,i),this.fset.add(i,r),i}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof tt.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.backgroundSync.enqueueSync(i),this.fset.add(i,r),i}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!s)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(s instanceof tt.TFile))throw new Error(`Upload failed, expected file at ${t}`);let i=this.getOrCreateSyncFile(n,t,s);return this.syncStore.getMeta(t)?i.pull():(this.log("get syncfile missing meta"),i.push()),this.files.set(n,i),this.fset.add(i,r),i}uploadFile(t,r=!0){let n=this.getVirtualPath(t.path);if(t instanceof tt.TFolder)return this.getSyncFolder(n,r);if(t instanceof tt.TFile){if(Tt.checkExtension(n))return this.uploadDoc(n,r);if(yt.checkExtension(n))return this.uploadCanvas(n,r);if(this.syncStore.canSync(n))return this.uploadSyncFile(n,r)}throw new Error("unexpectedly unable to upload")}deleteFile(t){var n;let r=(n=this.syncStore)==null?void 0:n.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let s=this.files.get(r);s&&(s.cleanup(),this.fset.delete(s)),this.files.delete(r)},this)}renameFile(t,r){let n=t.path,s="",i="";try{s=this.getVirtualPath(n)}catch(a){this.log("Moving out of shared folder")}try{i=this.getVirtualPath(r)}catch(a){this.log("Moving in from outside of shared folder")}if(!(!s&&!i))if(i){let a=this.syncStore.get(i);if(!a)return;let l=this.files.get(a);if(!s)this.ydoc.transact(()=>{this.syncStore.delete(i)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(a);else{if(!this.syncStore.get(i))return;let u=[];l instanceof wn&&this.syncStore.forEach((f,d)=>{if(d.startsWith(i+Cr.sep)){let p=d.replace(i,s);u.push([f.id,d,p])}}),this.ydoc.transact(()=>{this.syncStore.move(i,s),l&&l.move(s,this),u.forEach(f=>{let[d,p,m]=f;this.syncStore.move(p,m);let y=this.files.get(d);y&&y.move(m,this)})},this),this.syncStore.resolveMove(i)}}else{if(this.assertPath(n),!this.syncStore.canSync(s))return;this.placeHold([t]),this.uploadFile(t)}}destroy(){var t,r,n;this.destroyed=!0,this.unsubscribes.forEach(s=>{s()}),this.files.forEach(s=>{s.destroy(),this.files.delete(s.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},Ml=class extends xn{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.update=(0,tt.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(i=>{let a=!1;this.items().forEach(l=>{let c=i.find(u=>u.guid==l.guid);l.remote!=c&&(a=!0),l.remote=c}),a&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let i=this.find(u=>u.path==t&&u.guid==r);if(i)return i;let a=this.find(u=>u.guid==r);if(a)throw new Error(`This folder is already mounted at ${a.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let c=this.folderBuilder(t,r,n,s);return this._set.add(c),c}new(t,r,n,s){let i=this._new(t,r,n,s);return this.notifyListeners(),i}};var rc=require("@codemirror/state"),ii=require("obsidian");function z(){}var ta=o=>o;function re(o,e){for(let t in e)o[t]=e[t];return o}function rb(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function qf(o){return o()}function Pl(){return Object.create(null)}function Ie(o){o.forEach(qf)}function Qe(o){return typeof o=="function"}function W(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Fl;function hr(o,e){return o===e?!0:(Fl||(Fl=document.createElement("a")),Fl.href=e,o===Fl.href)}function ob(o){return Object.keys(o).length===0}function Rt(o,...e){if(o==null){for(let r of e)r(void 0);return z}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function bo(o){let e;return Rt(o,t=>e=t)(),e}function ce(o,e,t){o.$$.on_destroy.push(Rt(e,t))}function ye(o,e,t,r){if(o){let n=nb(o,e,t,r);return o[0](n)}}function nb(o,e,t,r){return o[1]&&r?re(t.ctx.slice(),o[1](r(e))):t.ctx}function be(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],i=Math.max(e.dirty.length,n.length);for(let a=0;a<i;a+=1)s[a]=e.dirty[a]|n[a];return s}return e.dirty|n}return e.dirty}function ve(o,e,t,r,n,s){if(n){let i=nb(e,t,r,s);o.p(i,n)}}function _e(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Se(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function zf(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function kt(o){return o==null?"":o}function Qs(o,e,t){return o.set(t),e}function rs(o){return o&&Qe(o.destroy)?o.destroy:z}var sb=typeof window!="undefined",jf=sb?()=>window.performance.now():()=>Date.now(),ra=sb?o=>requestAnimationFrame(o):z;var Ys=new Set;function ib(o){Ys.forEach(e=>{e.c(o)||(Ys.delete(e),e.f())}),Ys.size!==0&&ra(ib)}function Wf(o){let e;return Ys.size===0&&ra(ib),{promise:new Promise(t=>{Ys.add(e={c:o,f:t})}),abort(){Ys.delete(e)}}}var os=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Zs=class{constructor(e){vt(this,"_listeners","WeakMap"in os?new WeakMap:void 0);vt(this,"_observer");vt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)Zs.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};Zs.entries="WeakMap"in os?new WeakMap:void 0;var ab=!1;function lb(){ab=!0}function cb(){ab=!1}function v(o,e){o.appendChild(e)}function Le(o,e,t){let r=El(o);if(!r.getElementById(e)){let n=S("style");n.id=e,n.textContent=t,fb(r,n)}}function El(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function ub(o){let e=S("style");return e.textContent="/* empty */",fb(El(o),e),e.sheet}function fb(o,e){return v(o.head||o,e),e.sheet}function x(o,e,t){o.insertBefore(e,t||null)}function _(o){o.parentNode&&o.parentNode.removeChild(o)}function ze(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function S(o){return document.createElement(o)}function eo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function V(o){return document.createTextNode(o)}function F(){return V(" ")}function me(){return V("")}function H(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function Rl(o){return function(e){return e.preventDefault(),o.call(this,e)}}function Dl(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function h(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}var qI=["width","height"];function zI(o,e){let t=Object.getOwnPropertyDescriptors(o.__proto__);for(let r in e)e[r]==null?o.removeAttribute(r):r==="style"?o.style.cssText=e[r]:r==="__value"?o.value=o[r]=e[r]:t[r]&&t[r].set&&qI.indexOf(r)===-1?o[r]=e[r]:h(o,r,e[r])}function oa(o,e){for(let t in e)h(o,t,e[t])}function jI(o,e){Object.keys(e).forEach(t=>{WI(o,t,e[t])})}function WI(o,e,t){let r=e.toLowerCase();r in o?o[r]=typeof o[r]=="boolean"&&t===""?!0:t:e in o?o[e]=typeof o[e]=="boolean"&&t===""?!0:t:h(o,e,t)}function db(o){return/-/.test(o)?jI:zI}function pb(o){return Array.from(o.childNodes)}function J(o,e){e=""+e,o.data!==e&&(o.data=e)}function rt(o,e){o.value=e==null?"":e}function he(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Xs(o,e,t){for(let r=0;r<o.options.length;r+=1){let n=o.options[r];if(n.__value===e){n.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Me(o,e,t){o.classList.toggle(e,!!t)}function na(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var Cn=class{constructor(e=!1){vt(this,"is_svg",!1);vt(this,"e");vt(this,"n");vt(this,"t");vt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=eo(t.nodeName):this.e=S(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)x(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(_)}};function mb(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function Ko(o,e){return new o(e)}var Ul=new Map,Ol=0;function KI(o){let e=5381,t=o.length;for(;t--;)e=(e<<5)-e^o.charCodeAt(t);return e>>>0}function GI(o,e){let t={stylesheet:ub(e),rules:{}};return Ul.set(o,t),t}function $l(o,e,t,r,n,s,i,a=0){let l=16.666/r,c=`{
`;for(let g=0;g<=1;g+=l){let k=e+(t-e)*s(g);c+=g*100+`%{${i(k,1-k)}}
`}let u=c+`100% {${i(t,1-t)}}
}`,f=`__svelte_${KI(u)}_${a}`,d=El(o),{stylesheet:p,rules:m}=Ul.get(d)||GI(d,o);m[f]||(m[f]=!0,p.insertRule(`@keyframes ${f} ${u}`,p.cssRules.length));let y=o.style.animation||"";return o.style.animation=`${y?`${y}, `:""}${f} ${r}ms linear ${n}ms 1 both`,Ol+=1,f}function Kf(o,e){let t=(o.style.animation||"").split(", "),r=t.filter(e?s=>s.indexOf(e)<0:s=>s.indexOf("__svelte")===-1),n=t.length-r.length;n&&(o.style.animation=r.join(", "),Ol-=n,Ol||JI())}function JI(){ra(()=>{Ol||(Ul.forEach(o=>{let{ownerNode:e}=o.stylesheet;e&&_(e)}),Ul.clear())})}var Ln;function Lr(o){Ln=o}function sa(){if(!Ln)throw new Error("Function called outside component initialization");return Ln}function dt(o){sa().$$.on_mount.push(o)}function ns(o){sa().$$.on_destroy.push(o)}function Ye(){let o=sa();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=na(e,t,{cancelable:r});return n.slice().forEach(i=>{i.call(o,s)}),!s.defaultPrevented}return!0}}function gr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var ss=[];var _t=[],ti=[],Jf=[],hb=Promise.resolve(),Qf=!1;function Yf(){Qf||(Qf=!0,hb.then(ia))}function Zf(){return Yf(),hb}function vo(o){ti.push(o)}function Nl(o){Jf.push(o)}var Gf=new Set,ei=0;function ia(){if(ei!==0)return;let o=Ln;do{try{for(;ei<ss.length;){let e=ss[ei];ei++,Lr(e),QI(e.$$)}}catch(e){throw ss.length=0,ei=0,e}for(Lr(null),ss.length=0,ei=0;_t.length;)_t.pop()();for(let e=0;e<ti.length;e+=1){let t=ti[e];Gf.has(t)||(Gf.add(t),t())}ti.length=0}while(ss.length);for(;Jf.length;)Jf.pop()();Qf=!1,Gf.clear(),Lr(o)}function QI(o){if(o.fragment!==null){o.update(),Ie(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(vo)}}function gb(o){let e=[],t=[];ti.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),ti=e}var aa;function YI(){return aa||(aa=Promise.resolve(),aa.then(()=>{aa=null})),aa}function Xf(o,e,t){o.dispatchEvent(na(`${e?"intro":"outro"}${t}`))}var Bl=new Set,Go;function oe(){Go={r:0,c:[],p:Go}}function ne(){Go.r||Ie(Go.c),Go=Go.p}function b(o,e){o&&o.i&&(Bl.delete(o),o.i(e))}function w(o,e,t,r){if(o&&o.o){if(Bl.has(o))return;Bl.add(o),Go.c.push(()=>{Bl.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}var ZI={duration:0};function is(o,e,t,r){let s=e(o,t,{direction:"both"}),i=r?0:1,a=null,l=null,c=null,u;function f(){c&&Kf(o,c)}function d(m,y){let g=m.b-i;return y*=Math.abs(g),{a:i,b:m.b,d:g,duration:y,start:m.start,end:m.start+y,group:m.group}}function p(m){let{delay:y=0,duration:g=300,easing:k=ta,tick:L=z,css:I}=s||ZI,C={start:jf()+y,b:m};m||(C.group=Go,Go.r+=1),"inert"in o&&(m?u!==void 0&&(o.inert=u):(u=o.inert,o.inert=!0)),a||l?l=C:(I&&(f(),c=$l(o,i,m,g,y,k,I)),m&&L(0,1),a=d(C,g),vo(()=>Xf(o,m,"start")),Wf(A=>{if(l&&A>l.start&&(a=d(l,g),l=null,Xf(o,a.b,"start"),I&&(f(),c=$l(o,i,a.b,a.duration,0,k,s.css))),a){if(A>=a.end)L(i=a.b,1-i),Xf(o,a.b,"end"),l||(a.b?f():--a.group.r||Ie(a.group.c)),a=null;else if(A>=a.start){let M=A-a.start;i=a.a+a.d*k(M/a.duration),L(i,1-i)}}return!!(a||l)}))}return{run(m){Qe(s)?YI().then(()=>{s=s({direction:m?"in":"out"}),p(m)}):p(m)},end(){f(),a=l=null}}}function Jo(o,e){let t=e.token={};function r(n,s,i,a){if(e.token!==t)return;e.resolved=a;let l=e.ctx;i!==void 0&&(l=l.slice(),l[i]=a);let c=n&&(e.current=n)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((f,d)=>{d!==s&&f&&(oe(),w(f,1,1,()=>{e.blocks[d]===f&&(e.blocks[d]=null)}),ne())}):e.block.d(1),c.c(),b(c,1),c.m(e.mount(),e.anchor),u=!0),e.block=c,e.blocks&&(e.blocks[s]=c),u&&ia()}if(rb(o)){let n=sa();if(o.then(s=>{Lr(n),r(e.then,1,e.value,s),Lr(null)},s=>{if(Lr(n),r(e.catch,2,e.error,s),Lr(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function ri(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function ke(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Vl(o,e){o.d(1),e.delete(o.key)}function oi(o,e){w(o,1,1,()=>{e.delete(o.key)})}function Qo(o,e,t,r,n,s,i,a,l,c,u,f){let d=o.length,p=s.length,m=d,y={};for(;m--;)y[o[m].key]=m;let g=[],k=new Map,L=new Map,I=[];for(m=p;m--;){let P=f(n,s,m),O=t(P),T=i.get(O);T?r&&I.push(()=>T.p(P,e)):(T=c(O,P),T.c()),k.set(O,g[m]=T),O in y&&L.set(O,Math.abs(m-y[O]))}let C=new Set,A=new Set;function M(P){b(P,1),P.m(a,u),i.set(P.key,P),u=P.first,p--}for(;d&&p;){let P=g[p-1],O=o[d-1],T=P.key,U=O.key;P===O?(u=P.first,d--,p--):k.has(U)?!i.has(T)||C.has(T)?M(P):A.has(U)?d--:L.get(T)>L.get(U)?(A.add(T),M(P)):(C.add(U),d--):(l(O,i),d--)}for(;d--;){let P=o[d];k.has(P.key)||l(P,i)}for(;p;)M(g[p-1]);return Ie(I),g}function Re(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let i=o[s],a=e[s];if(a){for(let l in i)l in a||(r[l]=1);for(let l in a)n[l]||(t[l]=a[l],n[l]=1);o[s]=a}else for(let l in i)n[l]=1}for(let i in r)i in t||(t[i]=void 0);return t}function De(o){return typeof o=="object"&&o!==null?o:{}}var XI=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],eC=new Set([...XI]);function Hl(o,e,t){let r=o.$$.props[e];r!==void 0&&(o.$$.bound[r]=t,t(o.$$.ctx[r]))}function D(o){o&&o.c()}function E(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),vo(()=>{let s=o.$$.on_mount.map(qf).filter(Qe);o.$$.on_destroy?o.$$.on_destroy.push(...s):Ie(s),o.$$.on_mount=[]}),n.forEach(vo)}function R(o,e){let t=o.$$;t.fragment!==null&&(gb(t.after_update),Ie(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function rC(o,e){o.$$.dirty[0]===-1&&(ss.push(o),Yf(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function G(o,e,t,r,n,s,i=null,a=[-1]){let l=Ln;Lr(o);let c=o.$$={fragment:null,ctx:[],props:s,update:z,not_equal:n,bound:Pl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Pl(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};i&&i(c.root);let u=!1;if(c.ctx=t?t(o,e.props||{},(f,d,...p)=>{let m=p.length?p[0]:d;return c.ctx&&n(c.ctx[f],c.ctx[f]=m)&&(!c.skip_bound&&c.bound[f]&&c.bound[f](m),u&&rC(o,f)),d}):[],c.update(),u=!0,Ie(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){lb();let f=pb(e.target);c.fragment&&c.fragment.l(f),f.forEach(_)}else c.fragment&&c.fragment.c();e.intro&&b(o.$$.fragment),E(o,e.target,e.anchor),cb(),ia()}Lr(l)}var oC;typeof HTMLElement=="function"&&(oC=class extends HTMLElement{constructor(e,t,r){super();vt(this,"$$ctor");vt(this,"$$s");vt(this,"$$c");vt(this,"$$cn",!1);vt(this,"$$d",{});vt(this,"$$r",!1);vt(this,"$$p_d",{});vt(this,"$$l",{});vt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let i;return{c:function(){i=S("slot"),s!=="default"&&h(i,"name",s)},m:function(c,u){x(c,i,u)},d:function(c){c&&_(i)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=mb(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let i=this.$$g_p(s.name);i in this.$$d||(this.$$d[i]=ed(i,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let i=ed(s,this.$$d[s],this.$$p_d,"toAttribute");i==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,i)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let i of this.$$l[s]){let a=this.$$c.$on(s,i);this.$$l_u.set(i,a)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=ed(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function ed(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var K=class{constructor(){vt(this,"$$");vt(this,"$$set")}$destroy(){R(this,1),this.$destroy=z}$on(e,t){if(!Qe(t))return z;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!ob(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var yb="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(yb);var nC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},td=nC;function bb(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function rd(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=re(r,t[n]);return{c(){e=eo(o[11]),oa(e,r)},m(n,s){x(n,e,s)},p(n,s){oa(e,r=Re(t,[s&32&&n[12]]))},d(n){n&&_(e)}}}function vb(o){let e=o[11],t,r=o[11]&&rd(o);return{c(){r&&r.c(),t=me()},m(n,s){r&&r.m(n,s),x(n,t,s)},p(n,s){n[11]?e?W(e,n[11])?(r.d(1),r=rd(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=rd(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&_(t),r&&r.d(n)}}}function sC(o){let e,t,r,n,s,i=ke(o[5]),a=[];for(let d=0;d<i.length;d+=1)a[d]=vb(bb(o,i,d));let l=o[10].default,c=ye(l,o,o[9],null),u=[td,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],f={};for(let d=0;d<u.length;d+=1)f=re(f,u[d]);return{c(){e=eo("svg");for(let d=0;d<a.length;d+=1)a[d].c();t=me(),c&&c.c(),oa(e,f)},m(d,p){x(d,e,p);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(e,null);v(e,t),c&&c.m(e,null),s=!0},p(d,[p]){if(p&32){i=ke(d[5]);let m;for(m=0;m<i.length;m+=1){let y=bb(d,i,m);a[m]?a[m].p(y,p):(a[m]=vb(y),a[m].c(),a[m].m(e,t))}for(;m<a.length;m+=1)a[m].d(1);a.length=i.length}c&&c.p&&(!s||p&512)&&ve(c,l,d,d[9],s?be(l,d[9],p,null):_e(d[9]),null),oa(e,f=Re(u,[td,p&128&&d[7],(!s||p&4)&&{width:d[2]},(!s||p&4)&&{height:d[2]},(!s||p&2)&&{stroke:d[1]},(!s||p&28&&r!==(r=d[4]?Number(d[3])*24/Number(d[2]):d[3]))&&{"stroke-width":r},(!s||p&257&&n!==(n=d[6]("lucide-icon","lucide",d[0]?`lucide-${d[0]}`:"",d[8].class)))&&{class:n}]))},i(d){s||(b(c,d),s=!0)},o(d){w(c,d),s=!1},d(d){d&&_(e),ze(a,d),c&&c.d(d)}}}function iC(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=zf(e,r),{$$slots:s={},$$scope:i}=e,{name:a=void 0}=e,{color:l="currentColor"}=e,{size:c=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:f=!1}=e,{iconNode:d}=e,p=(...m)=>m.filter((y,g,k)=>Boolean(y)&&k.indexOf(y)===g).join(" ");return o.$$set=m=>{t(8,e=re(re({},e),Se(m))),t(7,n=zf(e,r)),"name"in m&&t(0,a=m.name),"color"in m&&t(1,l=m.color),"size"in m&&t(2,c=m.size),"strokeWidth"in m&&t(3,u=m.strokeWidth),"absoluteStrokeWidth"in m&&t(4,f=m.absoluteStrokeWidth),"iconNode"in m&&t(5,d=m.iconNode),"$$scope"in m&&t(9,i=m.$$scope)},e=Se(e),[a,l,c,u,f,d,p,n,e,i,s]}var od=class extends K{constructor(e){super(),G(this,e,iC,sC,W,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},Ue=od;function aC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function lC(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[aC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function cC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var nd=class extends K{constructor(e){super(),G(this,e,cC,lC,W,{})}},sd=nd;function uC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function fC(o){let e,t,r=[{name:"arrow-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[uC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function dC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M5 12h14"}],["path",{d:"m12 5 7 7-7 7"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var id=class extends K{constructor(e){super(),G(this,e,dC,fC,W,{})}},ad=id;function pC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function mC(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],n={$$slots:{default:[pC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function hC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var ld=class extends K{constructor(e){super(),G(this,e,hC,mC,W,{})}},cd=ld;function gC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function yC(o){let e,t,r=[{name:"check"},o[1],{iconNode:o[0]}],n={$$slots:{default:[gC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function bC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 6 9 17l-5-5"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var ud=class extends K{constructor(e){super(),G(this,e,bC,yC,W,{})}},la=ud;function vC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function _C(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[vC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function xC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var fd=class extends K{constructor(e){super(),G(this,e,xC,_C,W,{})}},dd=fd;function wC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function SC(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[wC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function kC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var pd=class extends K{constructor(e){super(),G(this,e,kC,SC,W,{})}},md=pd;function IC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function CC(o){let e,t,r=[{name:"circle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[IC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function LC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var hd=class extends K{constructor(e){super(),G(this,e,LC,CC,W,{})}},gd=hd;function TC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function AC(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[TC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function MC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var yd=class extends K{constructor(e){super(),G(this,e,MC,AC,W,{})}},ca=yd;function FC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function PC(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[FC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function EC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var bd=class extends K{constructor(e){super(),G(this,e,EC,PC,W,{})}},ua=bd;function RC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function DC(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[RC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function UC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var vd=class extends K{constructor(e){super(),G(this,e,UC,DC,W,{})}},fa=vd;function OC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function $C(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[OC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function NC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var _d=class extends K{constructor(e){super(),G(this,e,NC,$C,W,{})}},da=_d;function BC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function VC(o){let e,t,r=[{name:"folder-lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[BC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function HC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"8",height:"5",x:"14",y:"17",rx:"1"}],["path",{d:"M10 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v2.5"}],["path",{d:"M20 17v-2a2 2 0 1 0-4 0v2"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var xd=class extends K{constructor(e){super(),G(this,e,HC,VC,W,{})}},as=xd;function qC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function zC(o){let e,t,r=[{name:"folder-open"},o[1],{iconNode:o[0]}],n={$$slots:{default:[qC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function jC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var wd=class extends K{constructor(e){super(),G(this,e,jC,zC,W,{})}},Sd=wd;function WC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function KC(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[WC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function GC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var kd=class extends K{constructor(e){super(),G(this,e,GC,KC,W,{})}},_o=kd;function JC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function QC(o){let e,t,r=[{name:"home"},o[1],{iconNode:o[0]}],n={$$slots:{default:[JC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function YC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}],["polyline",{points:"9 22 9 12 15 12 15 22"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Id=class extends K{constructor(e){super(),G(this,e,YC,QC,W,{})}},Cd=Id;function ZC(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function XC(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[ZC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function e2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Ld=class extends K{constructor(e){super(),G(this,e,e2,XC,W,{})}},pa=Ld;function t2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function r2(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[t2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function o2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Td=class extends K{constructor(e){super(),G(this,e,o2,r2,W,{})}},to=Td;function n2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function s2(o){let e,t,r=[{name:"lock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[n2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function i2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Ad=class extends K{constructor(e){super(),G(this,e,i2,s2,W,{})}},Md=Ad;function a2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function l2(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[a2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function c2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Fd=class extends K{constructor(e){super(),G(this,e,c2,l2,W,{})}},Pd=Fd;function u2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function f2(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],n={$$slots:{default:[u2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function d2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Ed=class extends K{constructor(e){super(),G(this,e,d2,f2,W,{})}},Rd=Ed;function p2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function m2(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],n={$$slots:{default:[p2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function h2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Dd=class extends K{constructor(e){super(),G(this,e,h2,m2,W,{})}},Ud=Dd;function g2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function y2(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],n={$$slots:{default:[g2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function b2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Od=class extends K{constructor(e){super(),G(this,e,b2,y2,W,{})}},$d=Od;function v2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function _2(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[v2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function x2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Nd=class extends K{constructor(e){super(),G(this,e,x2,_2,W,{})}},Yo=Nd;function w2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function S2(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[w2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function k2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Bd=class extends K{constructor(e){super(),G(this,e,k2,S2,W,{})}},Vd=Bd;function I2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function C2(o){let e,t,r=[{name:"square-pen"},o[1],{iconNode:o[0]}],n={$$slots:{default:[I2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function L2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Hd=class extends K{constructor(e){super(),G(this,e,L2,C2,W,{})}},ma=Hd;function T2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function A2(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[T2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function M2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var qd=class extends K{constructor(e){super(),G(this,e,M2,A2,W,{})}},ls=qd;function F2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function P2(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],n={$$slots:{default:[F2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function E2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var zd=class extends K{constructor(e){super(),G(this,e,E2,P2,W,{})}},jd=zd;function R2(o){let e,t=o[2].default,r=ye(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&ve(r,t,n,n[3],e?be(t,n[3],s,null):_e(n[3]),null)},i(n){e||(b(r,n),e=!0)},o(n){w(r,n),e=!1},d(n){r&&r.d(n)}}}function D2(o){let e,t,r=[{name:"x"},o[1],{iconNode:o[0]}],n={$$slots:{default:[R2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=re(n,r[s]);return e=new Ue({props:n}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,[i]){let a=i&3?Re(r,[r[0],i&2&&De(s[1]),i&1&&{iconNode:s[0]}]):{};i&8&&(a.$$scope={dirty:i,ctx:s}),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function U2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];return o.$$set=i=>{t(1,e=re(re({},e),Se(i))),"$$scope"in i&&t(3,n=i.$$scope)},e=Se(e),[s,e,r,n]}var Wd=class extends K{constructor(e){super(),G(this,e,U2,D2,W,{})}},Kd=Wd;function O2(o){Le(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function $2(o){let e,t,r,n,s,i;return t=new to({props:{class:"svg-icon inline-icon"}}),{c(){var a;e=S("button"),D(t.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(a=o[0].view.file)==null?void 0:a.name)},m(a,l){x(a,e,l),E(t,e,null),i=!0},p(a,l){var c;(!i||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(a[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!i||l&1&&n!==(n=a[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!i||l&1&&s!==(s=(c=a[0].view.file)==null?void 0:c.name))&&h(e,"data-filename",s)},i(a){i||(b(t.$$.fragment,a),i=!0)},o(a){w(t.$$.fragment,a),i=!1},d(a){a&&_(e),R(t)}}}function N2(o){let e,t,r,n,s,i,a,l,c,u,f,d,p;return t=new to({props:{class:"svg-icon inline-icon"}}),l=new Yo({props:{class:"svg-icon inline-icon"}}),{c(){var m;e=S("button"),D(t.$$.fragment),i=F(),a=S("button"),D(l.$$.fragment),h(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),h(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),h(e,"tabindex","0"),h(e,"data-filename",s=(m=o[0].view.file)==null?void 0:m.name),h(a,"class",c="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),h(a,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),h(a,"tabindex","0")},m(m,y){x(m,e,y),E(t,e,null),x(m,i,y),x(m,a,y),E(l,a,null),f=!0,d||(p=[H(a,"click",o[3]),H(a,"keypress",o[4])],d=!0)},p(m,y){var g;(!f||y&1&&r!==(r="clickable-icon view-action system3-view-action "+(m[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&h(e,"class",r),(!f||y&1&&n!==(n=m[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&h(e,"aria-label",n),(!f||y&1&&s!==(s=(g=m[0].view.file)==null?void 0:g.name))&&h(e,"data-filename",s),(!f||y&2&&c!==(c="system3-"+m[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&h(a,"class",c),(!f||y&6&&u!==(u=`${m[2].relay.name} (${m[1].status})`))&&h(a,"aria-label",u)},i(m){f||(b(t.$$.fragment,m),b(l.$$.fragment,m),f=!0)},o(m){w(t.$$.fragment,m),w(l.$$.fragment,m),f=!1},d(m){m&&(_(e),_(i),_(a)),R(t),R(l),d=!1,Ie(p)}}}function B2(o){let e,t,r,n,s=[N2,$2],i=[];function a(l,c){return l[2]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,[c]){let u=e;e=a(l,c),e===u?i[e].p(l,c):(oe(),w(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){w(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function V2(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,i={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},a=()=>{r.toggleConnection()},l=c=>{c.key==="Enter"&&a()};return o.$$set=c=>{"view"in c&&t(0,r=c.view),"state"in c&&t(1,n=c.state),"remote"in c&&t(2,s=c.remote)},[r,n,s,a,l]}var Gd=class extends K{constructor(e){super(),G(this,e,V2,B2,W,{view:0,state:1,remote:2},O2)}},Jd=Gd;var cs=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){if(!this.view)return!0;let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let i=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",i)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),this.onClick=async()=>!0,!0}};var ql=require("@codemirror/state"),_b=require("@codemirror/view");function Zo(o,e){let t=Object.keys(e).map(r=>H2(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function H2(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},i=t(s);return r&&Object.setPrototypeOf(i,r),Object.setPrototypeOf(a,i),o[e]=a,l;function a(...c){return i===s&&o[e]===a&&l(),i.apply(this,c)}function l(){o[e]===a&&(n?o[e]=s:delete o[e]),i!==s&&(i=s,Object.setPrototypeOf(a,r||Function))}}var xb=ln(kf());var q2=25,x5=ql.Facet.define({combine(o){return o[o.length-1]}}),Qd=ql.Annotation.define(),Yd=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var n,s,i,a;if(this.unsubscribes=[],this.editor=e,this.connectionManager=this.editor.state.field(xo),this.view=(n=this.connectionManager)==null?void 0:n.findView(e),!this.view||(this.log=Fe(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"log"),this.warn=Fe(`[LiveCMPluginValue][${(i=this.view.view.file)==null?void 0:i.path}]`,"warn"),this.debug=Fe(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=!1,r=this;this.unsubscribes.push(Zo(this.view.view,{setViewData(l){return function(c,u){if(u)ro(r.view)&&r.view.document.text===c&&(r.view.tracking=!0),r.resync();else if(t){let f=r.incrementalBufferChange(c);e.dispatch({changes:f})}return l.call(this,c,u)}},saveFrontmatter(l){return function(c){t=!0;let u=l.call(this,c);return t=!1,u}}})),this.unsubscribes.push(Zo(this.view.view.previewMode,{edit(l){return function(c){if(ro(r.view)&&r.view.view.getMode()==="preview"){let u=r.incrementalBufferChange(c);e.dispatch({changes:u})}return l.call(this,c)}}})),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(l,c)=>{if(!ro(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(c.origin!==this){let u=l.delta,f=[],d=0;for(let p=0;p<u.length;p++){let m=u[p];m.insert!=null?f.push({from:d,to:d,insert:m.insert}):m.delete!=null?(f.push({from:d,to:d+m.delete,insert:""}),d+=m.delete):m.retain!=null&&(d+=m.retain)}!this.view.tracking||je().enableEditorTweens&&this.keyFrameCounter>q2?(this.keyFrameCounter=0,f=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),ro(this.view)&&(e.dispatch({changes:f,annotations:[Qd.of(this.editor)]}),this.view.tracking=!0)}this.render()},this.observer=(l,c)=>{var u;try{(u=this._observer)==null||u.call(this,l,c)}catch(f){f instanceof RangeError&&ro(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}render(){var e;((e=this.view)==null?void 0:e.view.getMode())==="preview"&&(this.view.view.previewMode.renderer.set(this.editor.state.doc.toString()),this.view.view.onInternalDataChange())}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new xb.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],i=0;for(let[a,l]of n)switch(a){case 0:i+=l.length;break;case 1:s.push({from:i,to:i,insert:l}),i+=l.length;break;case-1:s.push({from:i,to:i+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(ro(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();ro(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Qd.of(this.editor)]})}}async getKeyFrame(e=!1){return!ro(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),ro(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var n,s,i,a;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Qd)===this.editor)return;let t=e.view;this.view=(n=this.connectionManager)==null?void 0:n.findView(t);let r=(i=(s=this.view)==null?void 0:s.document)==null?void 0:i.ytext;r&&((a=r.doc)==null||a.transact(()=>{let l=0;e.changes.iterChanges((c,u,f,d,p)=>{let m=p.sliceString(0,p.length,`
`);c!==u&&r.delete(c+l,u-c),m.length>0&&r.insert(c+l,m),l+=m.length-(u-c)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.unsubscribes.forEach(t=>{t()}),this.unsubscribes.length=0,this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},wb=_b.ViewPlugin.fromClass(Yd);var zl=require("@codemirror/state"),yr=require("@codemirror/view");var Sb=yr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),z2=zl.Annotation.define(),Zd=class extends yr.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Fi("span",[Xt("class","cm-ySelectionCaret"),Xt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[Ms("\u2060"),Fi("div",[Xt("class","cm-ySelectionCaretDot")]),Ms("\u2060"),Fi("div",[Xt("class","cm-ySelectionInfo")],[Ms(this.name)]),Ms("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},Xd=class{constructor(e){var r,n;this.editor=e,this.decorations=zl.RangeSet.of([]),this.connectionManager=this.editor.state.field(xo);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof Tn){this.view=t;let s=(n=this.view.document)==null?void 0:n._provider;this._listener=({added:i,updated:a,removed:l},c,u)=>{i.concat(a).concat(l).findIndex(d=>{var p;return d!==((p=this._awareness)==null?void 0:p.doc.clientID)})>=0&&e.dispatch({annotations:[z2.of([])]})},s&&(this._awareness=s.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var c,u,f,d;let t=e.view;this.view=(c=this.connectionManager)==null?void 0:c.findView(t);let r=(f=(u=this.view)==null?void 0:u.document)==null?void 0:f.ytext;if(!(this.view&&r&&r.doc))return;let n=(d=this.view.document)==null?void 0:d._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,i=r.doc,a=[],l=this._awareness.getLocalState();if(l!=null){let p=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),m=p?e.state.selection.main:null,y=l.cursor==null?null:Qu(l.cursor.anchor),g=l.cursor==null?null:Qu(l.cursor.head);if(m!=null){let k=Yu(r,m.anchor),L=Yu(r,m.head);(l.cursor==null||!Xu(y,k)||!Xu(g,L))&&s.setLocalStateField("cursor",{anchor:k,head:L})}else l.cursor!=null&&p&&s.setLocalStateField("cursor",null)}s.getStates().forEach((p,m)=>{if(m===s.doc.clientID)return;let y=p.cursor;if(y==null||y.anchor==null||y.head==null)return;let g=Zu(y.anchor,i),k=Zu(y.head,i);if(g==null||k==null||g.type!==r||k.type!==r)return;if(g.index>e.state.doc.length||k.index>e.state.doc.length){Fe("[RemoteSelections]","warn")(`cursor positions (${g.index}, ${k.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=yr.Decoration.none;return}let{color:L="#30bced",name:I="Anonymous"}=p.user||{},C=p.user&&p.user.colorLight||L+"33",A=bs(g.index,k.index),M=Kr(g.index,k.index),P=e.view.state.doc.lineAt(A),O=e.view.state.doc.lineAt(M);if(P.number===O.number)a.push({from:A,to:M,value:yr.Decoration.mark({attributes:{style:`background-color: ${C}`},class:"cm-ySelection"})});else{a.push({from:A,to:P.from+P.length,value:yr.Decoration.mark({attributes:{style:`background-color: ${C}`},class:"cm-ySelection"})}),a.push({from:O.from,to:M,value:yr.Decoration.mark({attributes:{style:`background-color: ${C}`},class:"cm-ySelection"})});for(let T=P.number+1;T<O.number;T++){let U=e.view.state.doc.line(T).from;a.push({from:U,to:U,value:yr.Decoration.line({attributes:{style:`background-color: ${C}`,class:"cm-yLineSelection"}})})}}a.push({from:k.index,to:k.index,value:yr.Decoration.widget({side:k.index-g.index>0?-1:1,block:!1,widget:new Zd(L,I)})})}),this.decorations=yr.Decoration.set(a,!0)}},kb=yr.ViewPlugin.fromClass(Xd,{decorations:o=>o.decorations});var jl=require("@codemirror/state"),Xo=require("@codemirror/view"),Ib=require("@codemirror/view");var D5=jl.Annotation.define(),tp=class extends Ib.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},ep=jl.StateEffect.define(),rp=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(xo),this.decorations=Xo.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:ep.of(null)})},!this.connectionManager){Fe("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Fe(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var n,s;let r=(s=(n=this.view)==null?void 0:n.document)==null?void 0:s.getTFile();if(this.connectionManager&&this.app&&r){this.connectionManager.onMeta(r,this.cb);let i=this.app.metadataCache.getFileCache(r);i&&(this.updateFromMetadata(i),this.editor.dispatch({effects:ep.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(Xo.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(i,a,l)=>{var f;(((f=l.spec)==null?void 0:f.class)||"").contains("cm-formatting-link-end")&&t.push({from:i,to:a})})}),t}updateFromMetadata(e){var r,n,s,i;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.tfile))return;let t=new Map;for(let a of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}for(let a of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(a.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(a.position.start.offset,{from:a.position.start.offset,to:a.position.end.offset,link:a.link,original:a.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,i,a,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((i=(s=this.view)==null?void 0:s.document)!=null&&i.sharedFolder)||!((l=(a=this.view)==null?void 0:a.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let c of n){let u=null;for(let[p,m]of r)if(c.from<=m.to&&c.to>=m.from){u=m,r.delete(p);break}if(!u)continue;let f=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);f&&!this.view.document.sharedFolder.checkPath(f.path)&&t.push(c.from)}t.filter(c=>c<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>Xo.Decoration.widget({widget:new tp,side:1}).range(t));e.length>0?this.decorations=Xo.Decoration.set(e,!0):this.decorations=Xo.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(ep))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},Cb=Xo.ViewPlugin.fromClass(rp,{decorations:o=>o.decorations});function en(){}en.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var i=this;function a(C){return s?(setTimeout(function(){s(void 0,C)},0),!0):C}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,c=e.length,u=1,f=l+c;n.maxEditLength&&(f=Math.min(f,n.maxEditLength));var d=(r=n.timeout)!==null&&r!==void 0?r:1/0,p=Date.now()+d,m=[{oldPos:-1,lastComponent:void 0}],y=this.extractCommon(m[0],t,e,0);if(m[0].oldPos+1>=c&&y+1>=l)return a([{value:this.join(t),count:t.length}]);var g=-1/0,k=1/0;function L(){for(var C=Math.max(g,-u);C<=Math.min(k,u);C+=2){var A=void 0,M=m[C-1],P=m[C+1];M&&(m[C-1]=void 0);var O=!1;if(P){var T=P.oldPos-C;O=P&&0<=T&&T<l}var U=M&&M.oldPos+1<c;if(!O&&!U){m[C]=void 0;continue}if(!U||O&&M.oldPos+1<P.oldPos?A=i.addToPath(P,!0,void 0,0):A=i.addToPath(M,void 0,!0,1),y=i.extractCommon(A,t,e,C),A.oldPos+1>=c&&y+1>=l)return a(j2(i,A.lastComponent,t,e,i.useLongestToken));m[C]=A,A.oldPos+1>=c&&(k=Math.min(k,C-1)),y+1>=l&&(g=Math.max(g,C+1))}u++}if(s)(function C(){setTimeout(function(){if(u>f||Date.now()>p)return s();L()||C()},0)})();else for(;u<=f&&Date.now()<=p;){var I=L();if(I)return I}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,i=r.length,a=e.oldPos,l=a-n,c=0;l+1<s&&a+1<i&&this.equals(t[l+1],r[a+1]);)l++,a++,c++;return c&&(e.lastComponent={count:c,previousComponent:e.lastComponent}),e.oldPos=a,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function j2(o,e,t,r,n){for(var s=[],i;e;)s.push(e),i=e.previousComponent,delete e.previousComponent,e=i;s.reverse();for(var a=0,l=s.length,c=0,u=0;a<l;a++){var f=s[a];if(f.removed){if(f.value=o.join(r.slice(u,u+f.count)),u+=f.count,a&&s[a-1].added){var p=s[a-1];s[a-1]=s[a],s[a]=p}}else{if(!f.added&&n){var d=t.slice(c,c+f.count);d=d.map(function(y,g){var k=r[u+g];return k.length>y.length?k:y}),f.value=o.join(d)}else f.value=o.join(t.slice(c,c+f.count));c+=f.count,f.added||(u+=f.count)}}var m=s[l-1];return l>1&&typeof m.value=="string"&&(m.added||m.removed)&&o.equals("",m.value)&&(s[l-2].value+=m.value,s.pop()),s}var O5=new en;function W2(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Lb=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Tb=/\S/,ap=new en;ap.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Tb.test(o)&&!Tb.test(e)};ap.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Lb.test(e[t])&&Lb.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Ab(o,e,t){return t=W2(t,{ignoreWhitespace:!0}),ap.diff(o,e,t)}var lp=new en;lp.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function K2(o,e,t){return lp.diff(o,e,t)}var G2=new en;G2.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var J2=new en;J2.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function Wl(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Wl=function(e){return typeof e}:Wl=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wl(o)}function op(o){return Q2(o)||Y2(o)||Z2(o)||X2()}function Q2(o){if(Array.isArray(o))return np(o)}function Y2(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function Z2(o,e){if(o){if(typeof o=="string")return np(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return np(o,e)}}function np(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function X2(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var eL=Object.prototype.toString,ha=new en;ha.useLongestToken=!0;ha.tokenize=lp.tokenize;ha.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,i){return typeof i=="undefined"?t:i}:r;return typeof o=="string"?o:JSON.stringify(sp(o,null,null,n),n,"  ")};ha.equals=function(o,e){return en.prototype.equals.call(ha,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function sp(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var i;if(eL.call(o)==="[object Array]"){for(e.push(o),i=new Array(o.length),t.push(i),s=0;s<o.length;s+=1)i[s]=sp(o[s],e,t,r,n);return e.pop(),t.pop(),i}if(o&&o.toJSON&&(o=o.toJSON()),Wl(o)==="object"&&o!==null){e.push(o),i={},t.push(i);var a=[],l;for(l in o)o.hasOwnProperty(l)&&a.push(l);for(a.sort(),s=0;s<a.length;s+=1)l=a[s],i[l]=sp(o[l],e,t,r,l);e.pop(),t.pop()}else i=o;return i}var ip=new en;ip.tokenize=function(o){return o.slice()};ip.join=ip.removeEmpty=function(o){return o};function Mb(o,e,t,r,n,s,i){i||(i={}),typeof i.context=="undefined"&&(i.context=4);var a=K2(t,r,i);if(!a)return;a.push({value:"",lines:[]});function l(k){return k.map(function(L){return" "+L})}for(var c=[],u=0,f=0,d=[],p=1,m=1,y=function(L){var I=a[L],C=I.lines||I.value.replace(/\n$/,"").split(`
`);if(I.lines=C,I.added||I.removed){var A;if(!u){var M=a[L-1];u=p,f=m,M&&(d=i.context>0?l(M.lines.slice(-i.context)):[],u-=d.length,f-=d.length)}(A=d).push.apply(A,op(C.map(function(X){return(I.added?"+":"-")+X}))),I.added?m+=C.length:p+=C.length}else{if(u)if(C.length<=i.context*2&&L<a.length-2){var P;(P=d).push.apply(P,op(l(C)))}else{var O,T=Math.min(C.length,i.context);(O=d).push.apply(O,op(l(C.slice(0,T))));var U={oldStart:u,oldLines:p-u+T,newStart:f,newLines:m-f+T,lines:d};if(L>=a.length-2&&C.length<=i.context){var j=/\n$/.test(t),Q=/\n$/.test(r),N=C.length==0&&d.length>U.oldLines;!j&&N&&t.length>0&&d.splice(U.oldLines,0,"\\ No newline at end of file"),(!j&&!N||!Q)&&d.push("\\ No newline at end of file")}c.push(U),u=0,f=0,d=[]}p+=C.length,m+=C.length}},g=0;g<a.length;g++)y(g);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:c}}var Fb=require("obsidian");var Kl=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Gl=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let i=0;i<r.lines.length;i+=1){let a=r.lines[i];if(a.startsWith("+")||a.startsWith("-")){let l=i,c=l;for(;c<r.lines.length-1&&(r.lines[c+1].startsWith("+")||r.lines[c+1].startsWith("-"));)c+=1;let u=r.lines.slice(l,c+1).filter(d=>d.startsWith("-")).map(d=>d.slice(1)),f=r.lines.slice(l,c+1).filter(d=>d.startsWith("+")).map(d=>d.slice(1));t.push(new Kl({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:u,file2Lines:f})),n+=u.length,s+=f.length,i+=c-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function cp(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function ga(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function ya(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function ni(o){return o!==""?o:"\u200E"}var br=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var wo=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Jl=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof Tt){Gs(e.ydoc,t,e);return}else if(e instanceof zo){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new br({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),wo.build(t),new br({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),wo.build(t),new br({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),wo.build(t),new br({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new br({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),wo.build(t),new br({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new br({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),wo.build(t),new br({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=ga({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=ga({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=ga({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=ga({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=ya({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=ya({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=cp({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=cp({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=ya({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=ya({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var si="system3-differences-view";async function Pb(o,e){o.detachLeavesOfType(si);let t=o.getLeaf(!0);t.setViewState({type:si,active:!0,state:e}),o.revealLeaf(t)}var Ql=class extends Fb.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[];let r=this.constructor.name;this.log=Fe(`[${r}]`,"log")}async getContent(t){return t instanceof Tt?t.text:t instanceof zo?t.contents:await this.app.vault.read(t)}getViewType(){return si}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=Mb(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));if(this.fileDifferences=Gl.fromParsedDiff(t),this.fileDifferences.differences.length===0){if(this.file1Content!==this.file2Content){if(this.log("byte level difference with differ equivalence",this.file1Content.length,this.file2Content.length),je().enableDeltaLogging){let s=this.file1Content||"",i=this.file2Content||"",a=Math.max(s.length,i.length);for(let l=0;l<a;l++){let c=l<s.length?s.charCodeAt(l):void 0,u=l<i.length?i.charCodeAt(l):void 0;if(c!==u){let f=c!==void 0?`0x${c.toString(16).padStart(2,"0")}`:"EOF",d=u!==void 0?`0x${u.toString(16).padStart(2,"0")}`:"EOF";this.log(`Byte difference at position ${l}: file1=${c} (${f}), file2=${u} (${d})`)}}}await this.modify(this.state.file2,this.file1Content||"")}this.leaf.detach()}}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new br({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),wo.build(r),new br({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async modify(t,r){if(t instanceof Tt){Gs(t.ydoc,r,t);return}else if(t instanceof zo){t.contents=r;return}await this.app.vault.modify(t,r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var i,a,l;let r=0,n=0,s=Math.max(((i=this.file1Lines)==null?void 0:i.length)||0,((a=this.file2Lines)==null?void 0:a.length)||0);for(;r<=s||n<=s;){let c=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===n);if(c!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,c),r+=c.file1Lines.length,n+=c.file2Lines.length}else{let u=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:ni(u),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new Jl(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),c=this.buildDiffLine(i,a,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(c)}for(let s=0;s<r.file2Lines.length;s+=1){let i=r.file1Lines[s],a=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),c=this.buildDiffLine(a,i,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(c)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=ni(t);else if(t!=null&&r!=null){let i=Ab(r,t);for(let a of i){if(a.removed)continue;let l=document.createElement("span");l.textContent=ni(a.value),a.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let i=document.createElement("span");i.textContent=ni(t),i.classList.add(n),s.appendChild(i)}else s.textContent=ni(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var Yl=class extends Lt{constructor(t){super();this.view=t.view,this.canvas=t.view.canvas,this.relayCanvas=t.canvas,this.unsubscribes=[],this.relayCanvasView=t,this.observedTextNodes=new Set,this.install()}destroy(){this.canvas&&(this.unsubscribes.forEach(t=>t()),this.unsubscribes=[]),this.relayCanvasView.tracking=!1,this.canvas=null,this.relayCanvas=null,this.relayCanvasView=null,this.unsubscribes.length=0}observeNode(t){if(!this.observedTextNodes.has(t.id)&&t.type==="text"){let r=this.relayCanvas.textNode(t),n=t.id,s=i=>{let a=this.canvas.nodes.get(n);a&&(a.setText(r.toString()),this.canvas.markDirty(a))};r.observe(s),this.unsubscribes.push(()=>{this.relayCanvas.textNode(t).unobserve(s),this.observedTextNodes.delete(n)})}}markDirty(t){let r=this.canvas.nodes.get(t.id);r&&this.canvas.markDirty(r)}install(){var c;if(!this.canvas)return;this.debug("connecting canvas view to canvas",(c=this.view.file)==null?void 0:c.path,this.relayCanvas.path);let t=this,r=yt.exportCanvasData(this.relayCanvas.ydoc),n=r.nodes.length>0||r.edges.length>0;this.relayCanvas.hasLocalDB()&&n&&this.canvas.importData(r,!0),this.unsubscribes.push(Zo(this.canvas,{requestSave(u){return function(){let f=u.call(this);try{t.relayCanvas.importFromView(t.view)}catch(d){t.log(d)}return f}},applyHistory(u){return function(f){let d=u.call(this,f);try{t.relayCanvas.importFromView(t.view)}catch(p){t.log(p)}return d}}}));let i=(u,f)=>{var m,y,g,k;let d="";if(d+=`Transaction origin: ${u.transaction.origin} ${(y=(m=u.transaction.origin)==null?void 0:m.constructor)==null?void 0:y.name}
`,this.relayCanvas||this.log("relay canvas is already destroyed"),!this.canvas){this.log("canvas is already destroyed");return}if(!((g=this.view.file)!=null&&g.path.endsWith(this.relayCanvas.path))){this.log("event is for another node");return}if(u.transaction.origin===this.relayCanvas)return;let p=yt.exportCanvasData(this.relayCanvas.ydoc);for(let[L,I]of u.changes.keys)d+=`key: ${L} action: ${I.action}

`;this.debug(d),this.debug("importing data",(k=this.view.file)==null?void 0:k.path,this.relayCanvas.path,p),this.canvas.importData(p,!0),this.canvas.requestSave();for(let L of u.keysChanged){let I=f.get(L);I&&(this.canvas.nodes.has(I.id)&&this.observeNode(I.getData()),this.canvas.markMoved(I),this.canvas.markDirty(I))}},a=u=>i(u,this.canvas.nodes);this.relayCanvas.ynodes.observe(a),this.unsubscribes.push(()=>{this.relayCanvas.ynodes.unobserve(a)});for(let[,u]of this.relayCanvas.ynodes)this.observeNode(u);let l=u=>i(u,this.canvas.edges);this.relayCanvas.yedges.observe(l),this.unsubscribes.push(()=>{this.relayCanvas.yedges.unobserve(l)}),this.relayCanvasView.tracking=!0}};var Zl=require("@codemirror/state"),Rb=require("@codemirror/view");var wN=Zl.Facet.define({combine(o){return o[o.length-1]}}),Eb=Zl.Annotation.define(),up=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};this.embed=!1;var t,r,n,s;this.editor=e,this.connectionManager=this.editor.state.field(xo),this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor),this.node=this.getNode(),this._ytext=this.getYText(),this._ytext&&this.view&&(this.log=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(r=this.node)==null?void 0:r.id}]`,"log"),this.warn=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(n=this.node)==null?void 0:n.id}]`,"warn"),this.debug=Fe(`[LiveNodePluginValue][${this.view.canvas.path}#${(s=this.node)==null?void 0:s.id}]`,"debug"),this.debug("created"),this._observer=async(i,a)=>{var l;if(this._ytext=this.getYText(),this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(a.origin!==this){let c=i.delta,u=[],f=0;for(let d=0;d<c.length;d++){let p=c[d];p.insert!=null?u.push({from:f,to:f,insert:p.insert}):p.delete!=null?(u.push({from:f,to:f+p.delete,insert:""}),f+=p.delete):p.retain!=null&&(f+=p.retain)}(l=this.view)!=null&&l.canvas&&e.dispatch({changes:u,annotations:[Eb.of(this.editor)]})}},this.observer=(i,a)=>{var l;try{(l=this._observer)==null||l.call(this,i,a)}catch(c){c instanceof RangeError&&console.warn("range errors!")}},this._ytext.observe(this.observer))}getNode(){let e=this.editor.state.values.find(t=>{if(t&&t.node)return t.node});if(e)return this.node=e.node,this.node}getYText(){var t,r,n,s,i;this.view=(t=this.connectionManager)==null?void 0:t.findCanvas(this.editor);let e=this.editor.state.values.find(a=>{if(a&&a.node)return a.node});if(!e){this.observer&&((r=this._ytext)==null||r.unobserve(this.observer));return}return e.node.id!==((n=this.node)==null?void 0:n.id)&&this.observer&&((s=this._ytext)==null||s.unobserve(this.observer)),this.node=e.node,(i=this.view)==null?void 0:i.canvas.textNode(e.node)}update(e){var r;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Eb)===this.editor)return;let t=this.getYText();t&&((r=t.doc)==null||r.transact(()=>{let n=0;e.changes.iterChanges((s,i,a,l,c)=>{let u=c.sliceString(0,c.length,`
`);s!==i&&t.delete(s+n,i-s),u.length>0&&t.insert(s+n,u),n+=u.length-(i-s)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Db=Rb.ViewPlugin.fromClass(up);var rL=3;function fp(o,e){o.iterateAllLeaves(t=>{t.view instanceof ii.MarkdownView&&e(t.view)})}function dp(o,e){o.iterateAllLeaves(t=>{t.view.getViewType()==="canvas"&&je().enableCanvasSync&&e(t.view)})}function oL(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(((t=o[i].view.file)==null?void 0:t.path)!==((r=e[i].view.file)==null?void 0:r.path)||((n=o[i].document)==null?void 0:n.path)!==((s=e[i].document)==null?void 0:s.path))return!1;return!0}var Xl=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new cs(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){var e;this.release(),(e=this.banner)==null||e.destroy(),this.banner=void 0,this.view=null}};function ro(o){return o instanceof Tn&&o.document!==void 0&&o.document.text!==void 0}function nL(o){return o instanceof ec&&o.document!==void 0}var ec=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.canvas=r,this.document=r,this.tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.canvas.connect().then(e=>{e||(this.shouldConnect=!1)}):this.canvas.disconnect()}offlineBanner(){if(this.shouldConnect){let e=new cs(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Jd({target:e,anchor:e.firstChild,props:{view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.canvas.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.canvas.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.canvas.state,remote:this.canvas.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}attach(){return this.canvas.userLock=!0,this.setConnectionDot(),this.plugin||(this.plugin=new Yl(this)),new Promise(e=>this.canvas.whenReady().then(t=>{this._parent.networkStatus.online&&this.canvas.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.canvas.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.canvas.connect()}release(){var e,t,r;(e=this.plugin)==null||e.destroy(),this.plugin=void 0,(t=this._viewActions)==null||t.$destroy(),this._viewActions=void 0,(r=this._banner)==null||r.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.canvas.disconnect(),this.canvas.userLock=!1}destroy(){var e;(e=this.plugin)==null||e.destroy(),this.plugin=null,this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.canvas=null}},Tn=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new cs(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new cs(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Jd({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;if(this.view.getMode()==="preview")return!1;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},tc=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new rc.Compartment,this.log=Fe("[LiveViews]","log"),this.warn=Fe("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,c,u)=>{let f=this.metadataListeners.get(l);f==null||f(c,u)},i=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(i)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let a=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(c=>{this.views.forEach(u=>{var f;((f=u.document)==null?void 0:f.sharedFolder)===l&&u.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,c)=>{this.sharedFolders.has(c)||(l(),this.folderListeners.delete(c))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,a(l))})})),Nt.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([xo.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Pb(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return fp(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),dp(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(fp(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),dp(this.workspace,r=>{var i;let n=(i=r.file)==null?void 0:i.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return fp(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getDoc(r),a=new Tn(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new Xl(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),dp(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let i=n.proxy.getCanvas(r),a=new ec(this,t,i);e.push(a)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let i=new Xl(this,t,()=>this.loginManager.openLoginPage());e.push(i)}}),e}findView(e){return this.views.filter(ro).find(t=>t.view.editor.cm===e)}findCanvas(e){let t=e.state.values.find(r=>{if(r&&r.node)return r.node});if(t)return this.views.filter(nL).find(r=>r.view.canvas===t.node.canvas)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof Tn).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=rL){let r=this.workspace.getActiveViewOfType(ii.MarkdownView),n=0,s=e.sort((a,l)=>l.view.leaf.activeTime-a.view.leaf.activeTime),i=new Set;for(let a of s)a instanceof Tn&&(a.view===r||i.has(a.document)?(a.canConnect=!0,i.add(a.document)):n<t?(a.canConnect=!0,i.add(a.document),n++):a.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(i=>{if(n.document==i.document&&n.view==i.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=Fe(r,"debug"),s=(f,d)=>{n(f,d.map(p=>{var m;return{type:p.constructor.name,file:(m=p.document)==null?void 0:m.path,canConnect:p.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let i=[];try{i=await this.getViews()}catch(f){return this.warn("[System 3][Relay][Live Views] error getting views",f),!1}let a=this.findFolders();if(a.length===0&&i.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?a.forEach(f=>{f.connect()}):this.sharedFolders.forEach(f=>{f.disconnect()});let[l,c]=this.deduplicate(i);if(s("Releasing Views",c),this.releaseViews(c),c.length===0&&oL(l,this.views)){let f=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",f)}else{let f=await this.viewsReady(l);s("Ready Views",f);let d=await this.viewsAttachedWithConnectionPool(f);s("Attached Views",d),this.views=l}n("loading plugins"),this.load();let u=ii.moment.utc();return n(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Fe(e,"warn"),r=ii.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(xo.init(()=>this)),wb,Db,Sb,kb,Cb]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},xo=rc.StateField.define({create(o){},update(o,e){return o}});var ai=require("obsidian");function sL(o){Le(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Ub(o){let e,t,r,n;return{c(){e=S("span"),t=V(o[3]),r=V("%"),h(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),he(e,"opacity","1")},m(s,i){x(s,e,i),v(e,t),v(e,r)},p(s,i){i&8&&J(t,s[3]),i&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1siabfk")&&h(e,"class",n)},d(s){s&&_(e)}}}function iL(o){let e,t,r;return t=new to({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=S("span"),D(t.$$.fragment),h(e,"class","notebook system3-icon svelte-1siabfk"),h(e,"aria-label","Tracking Changes")},m(n,s){x(n,e,s),E(t,e,null),r=!0},p:z,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){w(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}function aL(o){let e,t,r,n,s,i,a,l;return t=new to({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new Yo({props:{class:"inline-icon"}}),{c(){var c;e=S("span"),D(t.$$.fragment),r=F(),n=S("span"),D(s.$$.fragment),h(e,"class","notebook system3-icon hidden svelte-1siabfk"),h(e,"aria-label","Tracking Changes"),h(n,"class",i="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),h(n,"aria-label",a=`${((c=o[2])==null?void 0:c.relay.name)||"Relay Server"} (${o[0]})`)},m(c,u){x(c,e,u),E(t,e,null),x(c,r,u),x(c,n,u),E(s,n,null),l=!0},p(c,u){var f;(!l||u&1&&i!==(i="satellite system3-icon system3-"+c[0]+" svelte-1siabfk"))&&h(n,"class",i),(!l||u&5&&a!==(a=`${((f=c[2])==null?void 0:f.relay.name)||"Relay Server"} (${c[0]})`))&&h(n,"aria-label",a)},i(c){l||(b(t.$$.fragment,c),b(s.$$.fragment,c),l=!0)},o(c){w(t.$$.fragment,c),w(s.$$.fragment,c),l=!1},d(c){c&&(_(e),_(r),_(n)),R(t),R(s)}}}function lL(o){let e,t,r,n,s,i=o[5]&&Ub(o),a=[aL,iL],l=[];function c(u,f){return u[1]?0:1}return r=c(o,-1),n=l[r]=a[r](o),{c(){e=S("div"),i&&i.c(),t=F(),n.c(),h(e,"class","system3-folder-icons svelte-1siabfk")},m(u,f){x(u,e,f),i&&i.m(e,null),v(e,t),l[r].m(e,null),s=!0},p(u,[f]){u[5]?i?i.p(u,f):(i=Ub(u),i.c(),i.m(e,t)):i&&(i.d(1),i=null);let d=r;r=c(u,f),r===d?l[r].p(u,f):(oe(),w(l[d],1,1,()=>{l[d]=null}),ne(),n=l[r],n?n.p(u,f):(n=l[r]=a[r](u),n.c()),b(n,1),n.m(e,null))},i(u){s||(b(n),s=!0)},o(u){w(n),s=!1},d(u){u&&_(e),i&&i.d(),l[r].d()}}}function cL(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:i}=e,{progress:a=0}=e,{syncStatus:l="pending"}=e;return o.$$set=c=>{"status"in c&&t(0,n=c.status),"relayId"in c&&t(1,s=c.relayId),"remote"in c&&t(2,i=c.remote),"progress"in c&&t(3,a=c.progress),"syncStatus"in c&&t(4,l=c.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||a<100)&&a>0)}},[n,s,i,a,l,r]}var pp=class extends K{constructor(e){super(),G(this,e,cL,lL,W,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},sL)}},Ob=pp;function uL(o){Le(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function fL(o){let e,t,r;return{c(){e=S("div"),t=S("span"),r=V(o[0]),h(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),h(e,"aria-label",o[1])},m(n,s){x(n,e,s),v(e,t),v(t,r)},p(n,[s]){s&1&&J(r,n[0]),s&2&&h(e,"aria-label",n[1])},i:z,o:z,d(n){n&&_(e)}}}function dL(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var mp=class extends K{constructor(e){super(),G(this,e,dL,fL,W,{text:0,label:1},uL)}},$b=mp;function pL(o){Le(o,"svelte-1ljf67u",".system3-uploadpill.svelte-1ljf67u{text-wrap:nowrap}")}function mL(o){let e,t,r,n;return{c(){e=S("div"),t=S("span"),r=V(o[0]),h(e,"class","nav-file-tag system3-uploadpill svelte-1ljf67u"),h(e,"aria-label",o[1]),h(e,"style",n=o[2]?`color:${o[2]}`:"")},m(s,i){x(s,e,i),v(e,t),v(t,r)},p(s,[i]){i&1&&J(r,s[0]),i&2&&h(e,"aria-label",s[1]),i&4&&n!==(n=s[2]?`color:${s[2]}`:"")&&h(e,"style",n)},i:z,o:z,d(s){s&&_(e)}}}function hL(o,e,t){let{text:r}=e,{label:n}=e,{color:s}=e;return o.$$set=i=>{"text"in i&&t(0,r=i.text),"label"in i&&t(1,n=i.label),"color"in i&&t(2,s=i.color)},[r,n,s]}var hp=class extends K{constructor(e){super(),G(this,e,hL,mL,W,{text:0,label:1,color:2},pL)}},Nb=hp;var gp=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},An=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},yp=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new gp(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},bp=class extends An{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new yp(t.selfEl,n):(r&&r.destroy(),null)}},vp=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(s=>{s.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new Ob({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let n=[];n.push(this.sharedFolder.subscribe(this.el,s=>{this.pill.$set({status:s.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),n.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,s=>{s&&this.pill.$set({progress:s.percent,syncStatus:s.status})})),this.unsubscribe=()=>n.forEach(s=>s())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},_p=class extends An{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new vp(t.selfEl,n):(r&&r.destroy(),null)}},xp=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},wp=class extends An{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkPath(t.path)&&Tt.checkExtension(t.path)?n||new xp(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},Sp=class{constructor(e,t){this.el=e;this.file=t;this.unsubscribes=[];this.el.querySelectorAll(".system3-uploadpill").forEach(r=>{r.remove()}),this.unsubscribes.push(this.file.subscribe(()=>{this.setText()}))}setText(){var e;if(this.file){if(this.file.inMeta){(e=this.pill)==null||e.$destroy();return}this.pill?this.pill.$set({text:this.file.tag}):this.pill=new Nb({target:this.el,props:{text:this.file.tag}})}}destroy(){var e;this.unsubscribes.forEach(t=>t()),this.el.querySelectorAll(".system3-uploadpill").forEach(t=>{t.remove()}),(e=this.pill)==null||e.$destroy(),this.file=null}},kp=class extends An{visitFile(e,t,r,n){if(n&&!Tt.checkExtension(e.path)&&!yt.checkExtension(e.path)&&n.isSyncableTFile(e)&&n.ready&&n.connected)try{let s=n.proxy.viewSyncFile(e.path);if(s&&Hr(s))return r&&r.file===s?r:new Sp(t.selfEl,s)}catch(s){Fe("FilePillVisitor.visitFile","error")(s)}return r&&r.destroy(),null}},Ip=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new $b({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Cp=class extends An{visitFile(e,t,r,n){return n&&n.checkPath(e.path)&&!n.isSyncableTFile(e)?r||new Ip(t.selfEl):(r&&r.destroy(),null)}},Lp=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},Tp=class extends An{visitFile(e,t,r,n){if(n)try{let s=n.getVirtualPath(e.path),i=n.syncStore.get(s);if(!i)return null;let a=n.files.get(i);return!(a instanceof Tt)||!a?null:r||new Lp(t.el,a,e)}catch(s){return null}return r&&r.destroy(),null}},oc=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,i)=>{let a=s.get(n),l=i.visitFolder(e,n,a,r);a&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof ai.TFolder)this.walk(s,r);else if(s instanceof ai.TFile){let i=this.getFileExplorerItem(this.fileExplorer,s);if(!i)return;this.storage.forEach((a,l)=>{let c=a.get(i),u=l.visitFile(s,i,c,r);c&&!u?a.delete(i):u&&a.set(i,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},nc=class{constructor(e,t,r,n){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{Ey([Ho.enableDocumentStatus],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.fset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(s.syncSettingsManager.subscribe(i=>{this.quickRefresh()})),this.unsubscribes.push(s.subscribe(this,()=>{this.quickRefresh()})),this.unsubscribes.push(s.syncStore.subscribe(i=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new bp),e.push(new _p),vn(Ho.enableDocumentStatus,()=>{e.push(new Tp),e.push(new wp(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),e.push(new kp),e.push(new Cp),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new oc(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let i=this.vault.getAbstractFileByPath(s);i instanceof ai.TFolder&&n.walk(i)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new oc(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof ai.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var Ix=require("obsidian");function Pe(o,e,t,r){function n(s){return s instanceof t?s:new t(function(i){i(s)})}return new(t||(t=Promise))(function(s,i){function a(u){try{c(r.next(u))}catch(f){i(f)}}function l(u){try{c(r.throw(u))}catch(f){i(f)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((r=r.apply(o,e||[])).next())})}var oo=require("obsidian");function gL(o){let e,t,r;return{c(){e=eo("svg"),t=eo("g"),r=eo("path"),h(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),h(r,"fill","#5865F2"),h(r,"fill-rule","nonzero"),h(e,"width",o[0]),h(e,"height",o[0]),h(e,"viewBox","0 -28.5 256 256"),h(e,"version","1.1"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),h(e,"preserveAspectRatio","xMidYMid")},m(n,s){x(n,e,s),v(e,t),v(t,r)},p(n,[s]){s&1&&h(e,"width",n[0]),s&1&&h(e,"height",n[0])},i:z,o:z,d(n){n&&_(e)}}}function yL(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var Ap=class extends K{constructor(e){super(),G(this,e,yL,gL,W,{size:0})}},sc=Ap;function bL(o){Le(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function Bb(o){let e,t,r,n,s,i,a,l,c,u,f,d,p;return a=new sc({props:{size:20}}),{c(){e=S("div"),t=S("div"),r=F(),n=S("div"),s=S("span"),i=S("a"),D(a.$$.fragment),l=F(),c=S("span"),c.textContent="Join the community",h(t,"class","arrow svelte-4t8k3t"),h(i,"href","https://discord.system3.md"),h(i,"target","_blank"),h(i,"rel","noopener noreferrer"),h(i,"class","menu-item svelte-4t8k3t"),he(s,"text-align","center"),he(s,"display","flex"),h(n,"class","menu-content svelte-4t8k3t"),h(e,"class","menu-dropdown svelte-4t8k3t")},m(m,y){x(m,e,y),v(e,t),v(e,r),v(e,n),v(n,s),v(s,i),E(a,i,null),v(i,l),v(i,c),f=!0,d||(p=rs(u=o[1].call(null,e)),d=!0)},i(m){f||(b(a.$$.fragment,m),f=!0)},o(m){w(a.$$.fragment,m),f=!1},d(m){m&&_(e),R(a),d=!1,p()}}}function vL(o){let e,t,r,n,s,i,a;r=new Pd({props:{size:"20px"}});let l=o[0]&&Bb(o);return{c(){e=S("div"),t=S("button"),D(r.$$.fragment),n=F(),l&&l.c(),h(t,"class","menu-button svelte-4t8k3t"),h(e,"class","menu-container svelte-4t8k3t")},m(c,u){x(c,e,u),v(e,t),E(r,t,null),v(e,n),l&&l.m(e,null),s=!0,i||(a=H(t,"click",Dl(o[2])),i=!0)},p(c,[u]){c[0]?l?u&1&&b(l,1):(l=Bb(c),l.c(),b(l,1),l.m(e,null)):l&&(oe(),w(l,1,1,()=>{l=null}),ne())},i(c){s||(b(r.$$.fragment,c),b(l),s=!0)},o(c){w(r.$$.fragment,c),w(l),s=!1},d(c){c&&_(e),R(r),l&&l.d(),i=!1,a()}}}function _L(o,e,t){let r=!1;function n(i){let a=l=>{let c=document.querySelector(".menu-button");!i.contains(l.target)&&l.target!==c&&!(c!=null&&c.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",a)},0),{destroy(){document.removeEventListener("click",a)}}}function s(i){i.stopPropagation(),t(0,r=!r)}return[r,n,s]}var Mp=class extends K{constructor(e){super(),G(this,e,_L,vL,W,{},bL)}},Vb=Mp;function xL(o){Le(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function wL(o){let e,t;return{c(){e=eo("svg"),t=eo("path"),h(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),h(e,"class","relay-text svelte-ycfe1d"),h(e,"width",o[0]),h(e,"height",o[1]),h(e,"viewBox","0 0 154.24573 66.293579"),h(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){x(r,e,n),v(e,t)},p:z,i:z,o:z,d(r){r&&_(e)}}}function SL(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=i=>{"size"in i&&t(2,r=i.size)},[n,s,r]}var Fp=class extends K{constructor(e){super(),G(this,e,SL,wL,W,{size:2},xL)}},ic=Fp;function kL(o){Le(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function IL(o){let e,t,r,n,s,i;return e=new ic({props:{size:140}}),{c(){D(e.$$.fragment),t=F(),r=S("p"),r.textContent="Real-time collaboration in Obsidian",n=F(),s=S("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,h(r,"class","subtitle svelte-120r7kg"),h(s,"class","description svelte-120r7kg")},m(a,l){E(e,a,l),x(a,t,l),x(a,r,l),x(a,n,l),x(a,s,l),i=!0},p:z,i(a){i||(b(e.$$.fragment,a),i=!0)},o(a){w(e.$$.fragment,a),i=!1},d(a){a&&(_(t),_(r),_(n),_(s)),R(e,a)}}}var Pp=class extends K{constructor(e){super(),G(this,e,null,IL,W,{},kL)}},Hb=Pp;var ac=require("obsidian");function CL(o){Le(o,"svelte-1rfjxfa",`.help-section.svelte-1rfjxfa{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1rfjxfa{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1rfjxfa{position:relative;max-width:640px;margin:0 auto}.why-signin.svelte-1rfjxfa:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-signin.svelte-1rfjxfa{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-signin.svelte-1rfjxfa:hover{color:var(--text-normal)}.help-content.svelte-1rfjxfa{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1rfjxfa{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1rfjxfa{opacity:1;visibility:visible}.popover.svelte-1rfjxfa:not(.visible){transition-delay:0s}.arrow.svelte-1rfjxfa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1rfjxfa{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function LL(o){let e,t,r,n;return{c(){e=S("div"),t=S("div"),r=F(),n=S("p"),n.textContent=`${zb}`,h(t,"class","arrow svelte-1rfjxfa"),h(e,"class","popover svelte-1rfjxfa"),Me(e,"visible",o[0])},m(s,i){x(s,e,i),v(e,t),v(e,r),v(e,n),o[9](e)},p(s,i){i&1&&Me(e,"visible",s[0])},d(s){s&&_(e),o[9](null)}}}function TL(o){let e,t=o[0]&&qb(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=qb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function qb(o){let e,t;return{c(){e=S("div"),t=S("p"),t.textContent=`${zb}`,h(e,"class","help-content svelte-1rfjxfa")},m(r,n){x(r,e,n),v(e,t)},p:z,d(r){r&&_(e)}}}function AL(o){let e,t,r,n,s,i,a,l,c,u,f,d;function p(g,k){return g[1]?TL:LL}let m=p(o,-1),y=m(o);return l=new sc({}),{c(){e=S("div"),t=S("div"),r=S("button"),r.textContent="Why do I need to sign in?",n=F(),y.c(),s=F(),i=S("div"),a=S("a"),D(l.$$.fragment),c=V(`
		Join the project on Discord`),h(r,"class","why-signin svelte-1rfjxfa"),Me(r,"mobile",o[1]),h(t,"class","help-container svelte-1rfjxfa"),h(e,"class","help-section svelte-1rfjxfa"),h(a,"href","https://discord.system3.md"),h(a,"class","discord-link svelte-1rfjxfa"),h(i,"class","footer svelte-1rfjxfa")},m(g,k){x(g,e,k),v(e,t),v(t,r),o[8](r),v(t,n),y.m(t,null),x(g,s,k),x(g,i,k),v(i,a),E(l,a,null),v(a,c),u=!0,f||(d=[H(r,"mouseenter",o[4]),H(r,"mouseleave",o[5]),H(r,"click",o[6])],f=!0)},p(g,[k]){(!u||k&2)&&Me(r,"mobile",g[1]),m===(m=p(g,k))&&y?y.p(g,k):(y.d(1),y=m(g),y&&(y.c(),y.m(t,null)))},i(g){u||(b(l.$$.fragment,g),u=!0)},o(g){w(l.$$.fragment,g),u=!1},d(g){g&&(_(e),_(s),_(i)),o[8](null),y.d(),R(l),f=!1,Ie(d)}}}var zb="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. Using an identity provider helps to prevent spam accounts and ensures secure authentication.";function ML(o,e,t){var r;let n=!1,s=!1,i,a;function l(){s||t(0,n=!0)}function c(){s||t(0,n=!1)}function u(){s&&t(0,n=!n)}function f(p){_t[p?"unshift":"push"](()=>{i=p,t(2,i)})}function d(p){_t[p?"unshift":"push"](()=>{a=p,t(3,a)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,s=t(7,r=ac.Platform===null||ac.Platform===void 0?void 0:ac.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[n,s,i,a,l,c,u,r,f,d]}var Ep=class extends K{constructor(e){super(),G(this,e,ML,AL,W,{},CL)}},jb=Ep;var Wb=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],lc=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=Wb[Li()%Wb.length]}};function FL(o){Le(o,"svelte-18fffd7",".avatar.svelte-18fffd7.svelte-18fffd7{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.avatar.svelte-18fffd7>img.svelte-18fffd7{margin:0px}.initial.svelte-18fffd7.svelte-18fffd7{color:var(--text-on-accent)}img.svelte-18fffd7.svelte-18fffd7{width:100%;height:100%;object-fit:cover}")}function PL(o){let e,t;return{c(){e=S("span"),t=V(o[5]),h(e,"class","initial svelte-18fffd7"),he(e,"font-size",o[4])},m(r,n){x(r,e,n),v(e,t)},p(r,n){n&32&&J(t,r[5]),n&16&&he(e,"font-size",r[4])},d(r){r&&_(e)}}}function EL(o){let e,t,r,n;return{c(){e=S("img"),hr(e.src,t=o[0].picture)||h(e,"src",t),h(e,"alt",o[1]),h(e,"referrerpolicy","no-referrer"),h(e,"class","svelte-18fffd7")},m(s,i){x(s,e,i),r||(n=H(e,"error",o[6]),r=!0)},p(s,i){i&1&&!hr(e.src,t=s[0].picture)&&h(e,"src",t),i&2&&h(e,"alt",s[1])},d(s){s&&_(e),r=!1,n()}}}function RL(o){let e;function t(s,i){return!s[3]&&s[0].picture?EL:PL}let r=t(o,-1),n=r(o);return{c(){e=S("div"),n.c(),h(e,"class","avatar svelte-18fffd7"),he(e,"width",o[2]),he(e,"height",o[2])},m(s,i){x(s,e,i),n.m(e,null)},p(s,[i]){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),i&4&&he(e,"width",s[2]),i&4&&he(e,"height",s[2])},i:z,o:z,d(s){s&&_(e),n.d()}}}function DL(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function UL(o,e,t){let r,n,s,{user:i}=e,{alt:a="Profile picture"}=e,{size:l="40px"}=e,c=!1;function u(){t(3,c=!0)}return o.$$set=f=>{"user"in f&&t(0,i=f.user),"alt"in f&&t(1,a=f.alt),"size"in f&&t(2,l=f.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=i.name?i.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,n=DL(l))}if(o.$$.dirty&132){e:t(4,s=`${parseFloat(l)/2}${n}`)}},[i,a,l,c,s,r,u,n]}var Rp=class extends K{constructor(e){super(),G(this,e,UL,RL,W,{user:0,alt:1,size:2},FL)}},Kb=Rp;var QB=require("obsidian");function OL(o){Le(o,"svelte-zlums1",".setting-item-control.svelte-zlums1{width:unset !important;margin-top:unset !important}.setting-item.svelte-zlums1{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-zlums1{min-width:0;margin-top:auto;margin-bottom:auto}")}function $L(o){let e,t,r,n,s,i=(o[0].name||"")+"",a,l,c,u,f=(o[0].email||"")+"",d,p,m,y;t=new Kb({props:{size:"2.5em",user:o[0]}});let g=o[2].default,k=ye(g,o,o[1],null);return{c(){e=S("div"),D(t.$$.fragment),r=F(),n=S("div"),s=S("div"),a=V(i),l=F(),c=S("br"),u=F(),d=V(f),p=F(),m=S("div"),k&&k.c(),h(s,"class","setting-item-description"),h(n,"class","setting-item-info svelte-zlums1"),he(n,"display","grid"),h(m,"class","setting-item-control svelte-zlums1"),h(e,"class","setting-item svelte-zlums1")},m(L,I){x(L,e,I),E(t,e,null),v(e,r),v(e,n),v(n,s),v(s,a),v(s,l),v(s,c),v(s,u),v(s,d),v(e,p),v(e,m),k&&k.m(m,null),y=!0},p(L,[I]){let C={};I&1&&(C.user=L[0]),t.$set(C),(!y||I&1)&&i!==(i=(L[0].name||"")+"")&&J(a,i),(!y||I&1)&&f!==(f=(L[0].email||"")+"")&&J(d,f),k&&k.p&&(!y||I&2)&&ve(k,g,L,L[1],y?be(g,L[1],I,null):_e(L[1]),null)},i(L){y||(b(t.$$.fragment,L),b(k,L),y=!0)},o(L){w(t.$$.fragment,L),w(k,L),y=!1},d(L){L&&_(e),R(t),k&&k.d(L)}}}function NL(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=i=>{"user"in i&&t(0,s=i.user),"$$scope"in i&&t(1,n=i.$$scope)},[s,n,r]}var Dp=class extends K{constructor(e){super(),G(this,e,NL,$L,W,{user:0},OL)}},li=Dp;var cc=require("obsidian");function BL(o){Le(o,"svelte-1da9go9",".help-container.svelte-1da9go9.svelte-1da9go9{position:relative;display:inline-block}button.svelte-1da9go9.svelte-1da9go9{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-1da9go9.svelte-1da9go9:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-1da9go9.svelte-1da9go9:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.help-container.svelte-1da9go9>.popover.svelte-1da9go9{position:absolute;z-index:70;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.help-container.svelte-1da9go9>.popover.left.svelte-1da9go9{right:100%;margin-right:8px}.help-container.svelte-1da9go9>.popover.right.svelte-1da9go9{left:0}.arrow.svelte-1da9go9.svelte-1da9go9{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-1da9go9.svelte-1da9go9{right:8px}.arrow.right.svelte-1da9go9.svelte-1da9go9{left:8px}p.svelte-1da9go9.svelte-1da9go9{margin:0;color:var(--text-normal)}")}function Gb(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("div"),r=F(),n=S("p"),s=V(o[0]),h(t,"class","arrow svelte-1da9go9"),Me(t,"left",o[4]==="left"),Me(t,"right",o[4]==="right"),h(n,"class","svelte-1da9go9"),h(e,"class","popover svelte-1da9go9"),Me(e,"left",o[4]==="left"),Me(e,"right",o[4]==="right")},m(i,a){x(i,e,a),v(e,t),v(e,r),v(e,n),v(n,s),o[9](e)},p(i,a){a&16&&Me(t,"left",i[4]==="left"),a&16&&Me(t,"right",i[4]==="right"),a&1&&J(s,i[0]),a&16&&Me(e,"left",i[4]==="left"),a&16&&Me(e,"right",i[4]==="right")},d(i){i&&_(e),o[9](null)}}}function VL(o){let e,t,r,n,s,i,a;r=new ua({props:{size:16}});let l=o[1]&&Gb(o);return{c(){e=S("div"),t=S("button"),D(r.$$.fragment),n=F(),l&&l.c(),h(t,"type","button"),h(t,"class","svelte-1da9go9"),h(e,"class","help-container svelte-1da9go9")},m(c,u){x(c,e,u),v(e,t),E(r,t,null),o[8](t),v(e,n),l&&l.m(e,null),s=!0,i||(a=[H(t,"mouseenter",o[5]),H(t,"mouseleave",o[6]),H(t,"click",o[7])],i=!0)},p(c,[u]){c[1]?l?l.p(c,u):(l=Gb(c),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(c){s||(b(r.$$.fragment,c),s=!0)},o(c){w(r.$$.fragment,c),s=!1},d(c){c&&_(e),R(r),o[8](null),l&&l.d(),i=!1,Ie(a)}}}function HL(o,e,t){let{helpText:r}=e,n=!1,s="right",i,a;function l(){t(1,n=!0)}function c(){t(1,n=!1)}function u(){t(1,n=!n)}function f(p){_t[p?"unshift":"push"](()=>{i=p,t(2,i)})}function d(p){_t[p?"unshift":"push"](()=>{a=p,t(3,a)})}return o.$$set=p=>{"helpText"in p&&t(0,r=p.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(n&&i&&a){let p=i.getBoundingClientRect(),m=a.getBoundingClientRect(),y=window.innerWidth;t(4,s=p.right+m.width>y-20?"left":"right")}}},[r,n,i,a,s,l,c,u,f,d]}var Up=class extends K{constructor(e){super(),G(this,e,HL,VL,W,{helpText:0},BL)}},Jb=Up;function qL(o){Le(o,"svelte-5o4y9d",".setting-item-name.svelte-5o4y9d{display:flex;align-items:center;gap:8px;overflow:unset}.help-button.svelte-5o4y9d{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-5o4y9d:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-5o4y9d:active{color:var(--text-normal)}.help-content.svelte-5o4y9d{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-5o4y9d{margin:0}")}var zL=o=>({}),Qb=o=>({}),jL=o=>({}),Yb=o=>({}),WL=o=>({}),Zb=o=>({});function KL(o){let e;return{c(){e=V(o[0])},m(t,r){x(t,e,r)},p(t,r){r&1&&J(e,t[0])},d(t){t&&_(e)}}}function Xb(o){let e,t,r,n,s=[JL,GL],i=[];function a(l,c){return l[3]?0:1}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(oe(),w(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){w(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function GL(o){let e,t;return e=new Jb({props:{helpText:o[1]}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function JL(o){let e,t,r,n,s;return t=new ua({props:{size:16}}),{c(){e=S("button"),D(t.$$.fragment),h(e,"class","help-button svelte-5o4y9d"),h(e,"aria-expanded",o[2])},m(i,a){x(i,e,a),E(t,e,null),r=!0,n||(s=H(e,"click",o[4]),n=!0)},p(i,a){(!r||a&4)&&h(e,"aria-expanded",i[2])},i(i){r||(b(t.$$.fragment,i),r=!0)},o(i){w(t.$$.fragment,i),r=!1},d(i){i&&_(e),R(t),n=!1,s()}}}function QL(o){let e,t,r=o[7].description,n=ye(r,o,o[6],Qb);return{c(){e=S("div"),n&&n.c(),h(e,"class","setting-item-description")},m(s,i){x(s,e,i),n&&n.m(e,null),t=!0},p(s,i){n&&n.p&&(!t||i&64)&&ve(n,r,s,s[6],t?be(r,s[6],i,zL):_e(s[6]),Qb)},i(s){t||(b(n,s),t=!0)},o(s){w(n,s),t=!1},d(s){s&&_(e),n&&n.d(s)}}}function ev(o){let e,t,r;return{c(){e=S("div"),t=S("p"),r=V(o[1]),h(t,"class","svelte-5o4y9d"),h(e,"class","help-content svelte-5o4y9d"),Me(e,"expanded",o[2])},m(n,s){x(n,e,s),v(e,t),v(t,r)},p(n,s){s&2&&J(r,n[1]),s&4&&Me(e,"expanded",n[2])},d(n){n&&_(e)}}}function YL(o){let e,t,r,n,s,i,a,l,c,u=o[7].name,f=ye(u,o,o[6],Zb),d=f||KL(o),p=o[1]&&Xb(o),m=o[7].description,y=ye(m,o,o[6],Yb),g=y||QL(o),k=o[1]&&o[2]&&o[3]&&ev(o),L=o[7].default,I=ye(L,o,o[6],null);return{c(){e=S("div"),t=S("div"),r=S("div"),d&&d.c(),n=F(),p&&p.c(),s=F(),g&&g.c(),i=F(),k&&k.c(),a=F(),l=S("div"),I&&I.c(),h(r,"class","setting-item-name svelte-5o4y9d"),h(t,"class","setting-item-info"),h(l,"class","setting-item-control"),h(e,"class","setting-item setting-item-heading mod-list-item")},m(C,A){x(C,e,A),v(e,t),v(t,r),d&&d.m(r,null),v(r,n),p&&p.m(r,null),v(t,s),g&&g.m(t,null),v(t,i),k&&k.m(t,null),v(e,a),v(e,l),I&&I.m(l,null),c=!0},p(C,[A]){f?f.p&&(!c||A&64)&&ve(f,u,C,C[6],c?be(u,C[6],A,WL):_e(C[6]),Zb):d&&d.p&&(!c||A&1)&&d.p(C,c?A:-1),C[1]?p?(p.p(C,A),A&2&&b(p,1)):(p=Xb(C),p.c(),b(p,1),p.m(r,null)):p&&(oe(),w(p,1,1,()=>{p=null}),ne()),y?y.p&&(!c||A&64)&&ve(y,m,C,C[6],c?be(m,C[6],A,jL):_e(C[6]),Yb):g&&g.p&&(!c||A&64)&&g.p(C,c?A:-1),C[1]&&C[2]&&C[3]?k?k.p(C,A):(k=ev(C),k.c(),k.m(t,null)):k&&(k.d(1),k=null),I&&I.p&&(!c||A&64)&&ve(I,L,C,C[6],c?be(L,C[6],A,null):_e(C[6]),null)},i(C){c||(b(d,C),b(p),b(g,C),b(I,C),c=!0)},o(C){w(d,C),w(p),w(g,C),w(I,C),c=!1},d(C){C&&_(e),d&&d.d(C),p&&p.d(),g&&g.d(C),k&&k.d(),I&&I.d(C)}}}function ZL(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:i=""}=e,{helpText:a=void 0}=e,l=!1,c=!1;function u(){c&&t(2,l=!l)}return o.$$set=f=>{"name"in f&&t(0,i=f.name),"helpText"in f&&t(1,a=f.helpText),"$$scope"in f&&t(6,n=f.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,c=t(5,s=cc.Platform===null||cc.Platform===void 0?void 0:cc.Platform.isMobile)!==null&&s!==void 0?s:!1)}},[i,a,l,c,u,s,n,r]}var Op=class extends K{constructor(e){super(),G(this,e,ZL,YL,W,{name:0,helpText:1},qL)}},qe=Op;var ci=[];function XL(o,e){return{subscribe:Ce(o,e).subscribe}}function Ce(o,e=z){let t,r=new Set;function n(a){if(W(o,a)&&(o=a,t)){let l=!ci.length;for(let c of r)c[1](),ci.push(c,o);if(l){for(let c=0;c<ci.length;c+=2)ci[c][0](ci[c+1]);ci.length=0}}}function s(a){n(a(o))}function i(a,l=z){let c=[a,l];return r.add(c),r.size===1&&(t=e(n,s)||z),a(o),()=>{r.delete(c),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:i}}function Ze(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return XL(t,(i,a)=>{let l=!1,c=[],u=0,f=z,d=()=>{if(u)return;f();let m=e(r?c[0]:c,i,a);s?i(m):f=Qe(m)?m:z},p=n.map((m,y)=>Rt(m,g=>{c[y]=g,u&=~(1<<y),l&&d()},()=>{u|=1<<y}));return l=!0,d(),function(){Ie(p),f(),l=!1}})}function tv(o){let e=o-1;return e*e*e+1}function us(o){return--o*o*o*o*o+1}function fs(o,{delay:e=0,duration:t=400,easing:r=tv,axis:n="y"}={}){let s=getComputedStyle(o),i=+s.opacity,a=n==="y"?"height":"width",l=parseFloat(s[a]),c=n==="y"?["top","bottom"]:["left","right"],u=c.map(k=>`${k[0].toUpperCase()}${k.slice(1)}`),f=parseFloat(s[`padding${u[0]}`]),d=parseFloat(s[`padding${u[1]}`]),p=parseFloat(s[`margin${u[0]}`]),m=parseFloat(s[`margin${u[1]}`]),y=parseFloat(s[`border${u[0]}Width`]),g=parseFloat(s[`border${u[1]}Width`]);return{delay:e,duration:t,easing:r,css:k=>`overflow: hidden;opacity: ${Math.min(k*20,1)*i};${a}: ${k*l}px;padding-${c[0]}: ${k*f}px;padding-${c[1]}: ${k*d}px;margin-${c[0]}: ${k*p}px;margin-${c[1]}: ${k*m}px;border-${c[0]}-width: ${k*y}px;border-${c[1]}-width: ${k*g}px;`}}function eT(o){Le(o,"svelte-umtfyz",`.continue.svelte-umtfyz{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-umtfyz{color:var(--text-muted)}.link.svelte-umtfyz:hover{color:var(--text-normal)}.not-working.svelte-umtfyz{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-umtfyz{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-umtfyz:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-umtfyz{height:auto;padding:0}.welcome.svelte-umtfyz{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyAgIHdpZHRoPSIxOCIgICBoZWlnaHQ9IjE4IiAgIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgICBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJ4TWlkWU1pZCIgICB2ZXJzaW9uPSIxLjEiICAgaWQ9InN2ZzYiICAgc29kaXBvZGk6ZG9jbmFtZT0iZGlzY29yZC5zdmciICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICA8ZGVmcyAgICAgaWQ9ImRlZnMxMCIgLz4gIDxzb2RpcG9kaTpuYW1lZHZpZXcgICAgIGlkPSJuYW1lZHZpZXc4IiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiICAgICBib3JkZXJvcGFjaXR5PSIxLjAiICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIgICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiICAgICBzaG93Z3JpZD0iZmFsc2UiICAgICBpbmtzY2FwZTp6b29tPSIyNC4yNSIgICAgIGlua3NjYXBlOmN4PSI0LjM3MTEzNCIgICAgIGlua3NjYXBlOmN5PSIxNC40NTM2MDgiICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMDY0IiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjE4OTAiICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMTA5NiIgICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc2IiAvPiAgPGcgICAgIGlkPSJnNCIgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMDg4NzYxMiwwLDAsMS4wNDc4NTU0LC0xMC40NTgyNzYsMzMuNDI2NTI1KSI+ICAgIDxwYXRoICAgICAgIGQ9Ik0gMjE2Ljg1NjM0LDE2LjU5NjYwMyBDIDIwMC4yODUsOC44NDMyODY3IDE4Mi41NjYxNCwzLjIwODQ5ODggMTY0LjA0MTU2LDAgYyAtMi4yNzUwNCw0LjExMzE4MTEgLTQuOTMyOTQsOS42NDU0OTkxIC02Ljc2NTQ2LDE0LjA0NjQzOCAtMTkuNjkyMTEsLTIuOTYxNDQ4IC0zOS4yMDMxMywtMi45NjE0NDggLTU4LjUzMzA4NCwwIEMgOTYuOTEwODQyLDkuNjQ1NDk5MSA5NC4xOTI1ODQsNC4xMTMxODExIDkxLjg5NzE4OSwwIDczLjM1MjYwNywzLjIwODQ5ODggNTUuNjEzMzk1LDguODYzOTkxMiAzOS4wNDIwNTgsMTYuNjM3NjYxIDUuNjE3NTIyOSw2Ny4xNDY1MTQgLTMuNDQzMzE5MSwxMTYuNDAwODEgMS4wODcxMTA3LDE2NC45NTU3MiAyMy4yNTYwMiwxODEuNTEwOTEgNDQuNzQwMzYzLDE5MS41Njc3IDY1Ljg2MjEzMywxOTguMTQ4NTggYyA1LjIxNTA4MiwtNy4xNzc0NSA5Ljg2NjIzLC0xNC44MDcyNSAxMy44NzMwODEsLTIyLjg0ODMyIC03LjYzMTE5NSwtMi44OTk2OSAtMTQuOTQwMjQyLC02LjQ3ODA2IC0yMS44NDY0MjcsLTEwLjYzMjMgMS44MzIxNzQsLTEuMzU3MzcgMy42MjQzNDMsLTIuNzc2NTEgNS4zNTU4MDMsLTQuMjM2NyA0Mi4xMjI4MiwxOS43MDE5MyA4Ny44OTAzNCwxOS43MDE5MyAxMjkuNTA5OTMsMCAxLjc1MTgyLDEuNDYwMTkgMy41NDM2MywyLjg3OTMzIDUuMzU1ODEsNC4yMzY3IC02LjkyNjU0LDQuMTc0NiAtMTQuMjU1NTksNy43NTI5NyAtMjEuODg2NzksMTAuNjUzIDQuMDA2ODUsOC4wMjAzNyA4LjYzOCwxNS42NzA4NyAxMy44NzMwOCwyMi44NDc5NyAyMS4xNDIxMywtNi41ODA4OCA0Mi42NDY0LC0xNi42MzczMSA2NC44MTUzMywtMzMuMjEzMjEgNS4zMTU4LC01Ni4yODc1MiAtOS4wODA4NiwtMTA1LjA4OTQ3NyAtMzguMDU1NjEsLTE0OC4zNTkxMTcgeiBNIDg1LjQ3Mzg3NSwxMzUuMDk0ODkgYyAtMTIuNjQ0ODQ3LDAgLTIzLjAxNDY1MywtMTEuODA0NzMgLTIzLjAxNDY1MywtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODM3MywtMjYuMjAwMzQxIDIzLjAxNDY1MywtMjYuMjAwMzQxIDEyLjg2NjYzMSwwIDIzLjIzNjA4NSwxMS44MDQzODQgMjMuMDE0NjU1LDI2LjIwMDM0MSAwLjAyLDE0LjM3NTI2IC0xMC4xNDgwMjQsMjYuMTc5OTkgLTIzLjAxNDY1NSwyNi4xNzk5OSB6IG0gODUuMDUxMzY1LDAgYyAtMTIuNjQ0ODUsMCAtMjMuMDE0NjYsLTExLjgwNDczIC0yMy4wMTQ2NiwtMjYuMTc5OTkgMCwtMTQuMzc1MjUzIDEwLjE0ODAzLC0yNi4yMDAzNDEgMjMuMDE0NjYsLTI2LjIwMDM0MSAxMi44NjYyOCwwIDIzLjIzNjA4LDExLjgwNDM4NCAyMy4wMTQ2NSwyNi4yMDAzNDEgMCwxNC4zNzUyNiAtMTAuMTQ4MzcsMjYuMTc5OTkgLTIzLjAxNDY1LDI2LjE3OTk5IHoiICAgICAgIGZpbGw9IiM1ODY1ZjIiICAgICAgIGZpbGwtcnVsZT0ibm9uemVybyIgICAgICAgaWQ9InBhdGgyIiAvPiAgPC9nPjwvc3ZnPg==);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.discord-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.discord-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxOHB4IiBoZWlnaHQ9IjE4cHgiIHZpZXdCb3g9Ii0xNSAtMTUgMjg2IDI4NiIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIj4gICAgPHRpdGxlPk1pY3Jvc29mdDwvdGl0bGU+ICAgIDxnPiAgICAgICAgPHBvbHlnb24gZmlsbD0iI0YxNTExQiIgcG9pbnRzPSIxMjEuNjY2MDk1IDEyMS42NjYwOTUgMCAxMjEuNjY2MDk1IDAgMCAxMjEuNjY2MDk1IDAiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiM4MENDMjgiIHBvaW50cz0iMjU2IDEyMS42NjYwOTUgMTM0LjMzNTM1NiAxMjEuNjY2MDk1IDEzNC4zMzUzNTYgMCAyNTYgMCIvPiAgICAgICAgPHBvbHlnb24gZmlsbD0iIzAwQURFRiIgcG9pbnRzPSIxMjEuNjYzMTk0IDI1Ni4wMDIxODggMCAyNTYuMDAyMTg4IDAgMTM0LjMzNjA5NSAxMjEuNjYzMTk0IDEzNC4zMzYwOTUiLz4gICAgICAgIDxwb2x5Z29uIGZpbGw9IiNGQkJDMDkiIHBvaW50cz0iMjU2IDI1Ni4wMDIxODggMTM0LjMzNTM1NiAyNTYuMDAyMTg4IDEzNC4zMzUzNTYgMTM0LjMzNjA5NSAyNTYgMTM0LjMzNjA5NSIvPiAgICA8L2c+PC9zdmc+);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.microsoft-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.microsoft-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.github-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgd2lkdGg9IjE2LjE5NjU4NSIKICAgaGVpZ2h0PSIxNS42NTQ3NjgiCiAgIGZpbGw9Im5vbmUiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzQiCiAgIHNvZGlwb2RpOmRvY25hbWU9ImdoLnN2ZyIKICAgaW5rc2NhcGU6dmVyc2lvbj0iMS4xLjIgKDBhMDBjZjUzMzksIDIwMjItMDItMDQpIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM4IiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0ibmFtZWR2aWV3NiIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlY2hlY2tlcmJvYXJkPSIwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBmaXQtbWFyZ2luLXRvcD0iMCIKICAgICBmaXQtbWFyZ2luLWxlZnQ9IjAiCiAgICAgZml0LW1hcmdpbi1yaWdodD0iMCIKICAgICBmaXQtbWFyZ2luLWJvdHRvbT0iMCIKICAgICBpbmtzY2FwZTp6b29tPSI0OC41IgogICAgIGlua3NjYXBlOmN4PSI4IgogICAgIGlua3NjYXBlOmN5PSI4LjAxMDMwOTMiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIzNzY0IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjIxMTIiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjgiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjQwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ic3ZnNCIgLz4KICA8cGF0aAogICAgIGZpbGwtcnVsZT0iZXZlbm9kZCIKICAgICBjbGlwLXJ1bGU9ImV2ZW5vZGQiCiAgICAgZD0ibSA4LjAwMTc3OTksMC4wMDIzNzIxNiBhIDgsOCAwIDAgMCAtMi41MywxNS41ODk5OTk4NCBjIDAuNCwwLjA3IDAuNTUsLTAuMTcgMC41NSwtMC4zOCB2IC0xLjMzIGMgLTIuMjIsMC40OCAtMi42OSwtMS4wNyAtMi42OSwtMS4wNyAtMC4zNiwtMC45MiAtMC44OCwtMS4xNyAtMC44OCwtMS4xNyAtMC43MywtMC40OSAwLjA1LC0wLjQ4IDAuMDUsLTAuNDggMC44LDAuMDYgMS4yMywwLjgzIDEuMjMsMC44MyAwLjcyLDEuMjMgMS44OCwwLjg3IDIuMzMsMC42NiAwLjA3LC0wLjUyIDAuMjgsLTAuODcgMC41MSwtMS4wNyAtMS43OCwtMC4yIC0zLjY1LC0wLjg5IC0zLjY1LC0zLjk0OTk5OTggMCwtMC44NyAwLjMxLC0xLjU4IDAuODIsLTIuMTQgLTAuMDgsLTAuMiAtMC4zNiwtMS4wMSAwLjA4LC0yLjEgMCwwIDAuNjcsLTAuMjIgMi4yLDAuODIgYSA3LjY1LDcuNjUgMCAwIDEgNC4wMDAwMDAxLDAgYyAxLjUzLC0xLjA0IDIuMiwtMC44MiAyLjIsLTAuODIgMC40NCwxLjA5IDAuMTYsMS45IDAuMDgsMi4xIDAuNTEsMC41NiAwLjgyLDEuMjcgMC44MiwyLjE0IDAsMy4wNjk5OTk4IC0xLjg3LDMuNzQ5OTk5OCAtMy42NTAwMDAxLDMuOTQ5OTk5OCAwLjI5LDAuMjUgMC41NDAwMDAxLDAuNzQgMC41NDAwMDAxLDEuNDggdiAyLjIgYyAwLDAuMjEgMC4xNSwwLjQ1IDAuNTUsMC4zOCBBIDgsOCAwIDAgMCA4LjAwMTc3OTksMC4wMDIzNzIxNiBaIgogICAgIGZpbGw9IiMyNDI5MmYiCiAgICAgaWQ9InBhdGgyIiAvPgo8L3N2Zz4K);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.github-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.github-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.oidc-sign-in-button.svelte-umtfyz{width:100%;height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMkM2LjQ4IDIgMiA2LjQ4IDIgMTJzNC40OCAxMCAxMCAxMCAxMC00LjQ4IDEwLTEwUzE3LjUyIDIgMTIgMnoiIHN0cm9rZT0iIzYzNjM2MyIgc3Ryb2tlLXdpZHRoPSIyIi8+PHBhdGggZD0iTTggMTJoOE0xMiA4bDQgNC00IDQiIHN0cm9rZT0iIzYzNjM2MyIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.oidc-sign-in-button.svelte-umtfyz:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.oidc-sign-in-button.svelte-umtfyz:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}.login-buttons.svelte-umtfyz{display:flex;flex-direction:column;gap:0.85rem;padding:1rem;background:var(--background-modifier-border-hover);border-radius:0.5rem}.choose-another.svelte-umtfyz{text-align:center;margin-top:0.25rem;margin-bottom:1rem;font-size:0.85em;color:var(--text-normal)}`)}function rv(o,e,t){let r=o.slice();return r[58]=e[t],r}function ov(o,e,t){let r=o.slice();return r[58]=e[t],r}function tT(o){let e,t,r,n,s,i,a,l,c,u;t=new Hb({});let f=[nT,oT],d=[];function p(L,I){return L[5]?0:1}n=p(o,[-1,-1,-1]),s=d[n]=f[n](o);function m(L,I){if(L[11])return lT;if(L[7])return aT}let y=m(o,[-1,-1,-1]),g=y&&y(o),k=o[3].provider&&!o[7]&&av(o);return c=new jb({}),{c(){e=S("div"),D(t.$$.fragment),r=F(),s.c(),i=F(),g&&g.c(),a=F(),k&&k.c(),l=F(),D(c.$$.fragment),h(e,"class","welcome svelte-umtfyz")},m(L,I){x(L,e,I),E(t,e,null),v(e,r),d[n].m(e,null),v(e,i),g&&g.m(e,null),x(L,a,I),k&&k.m(L,I),x(L,l,I),E(c,L,I),u=!0},p(L,I){let C=n;n=p(L,I),n===C?d[n].p(L,I):(oe(),w(d[C],1,1,()=>{d[C]=null}),ne(),s=d[n],s?s.p(L,I):(s=d[n]=f[n](L),s.c()),b(s,1),s.m(e,i)),y===(y=m(L,I))&&g?g.p(L,I):(g&&g.d(1),g=y&&y(L),g&&(g.c(),g.m(e,null))),L[3].provider&&!L[7]?k?k.p(L,I):(k=av(L),k.c(),k.m(l.parentNode,l)):k&&(k.d(1),k=null)},i(L){u||(b(t.$$.fragment,L),b(s),b(c.$$.fragment,L),u=!0)},o(L){w(t.$$.fragment,L),w(s),w(c.$$.fragment,L),u=!1},d(L){L&&(_(e),_(a),_(l)),R(t),d[n].d(),g&&g.d(),k&&k.d(L),R(c,L)}}}function rT(o){let e,t,r,n,s,i,a;e=new qe({props:{$$slots:{name:[uT],default:[cT]},$$scope:{ctx:o}}}),r=new qe({props:{name:"Account"}}),s=new li({props:{user:o[4].user,$$slots:{default:[fT]},$$scope:{ctx:o}}});let l=o[34].default,c=ye(l,o,o[42],null);return{c(){D(e.$$.fragment),t=F(),D(r.$$.fragment),n=F(),D(s.$$.fragment),i=F(),c&&c.c()},m(u,f){E(e,u,f),x(u,t,f),E(r,u,f),x(u,n,f),E(s,u,f),x(u,i,f),c&&c.m(u,f),a=!0},p(u,f){let d={};f[1]&2048&&(d.$$scope={dirty:f,ctx:u}),e.$set(d);let p={};f[0]&16&&(p.user=u[4].user),f[1]&2048&&(p.$$scope={dirty:f,ctx:u}),s.$set(p),c&&c.p&&(!a||f[1]&2048)&&ve(c,l,u,u[42],a?be(l,u[42],f,null):_e(u[42]),null)},i(u){a||(b(e.$$.fragment,u),b(r.$$.fragment,u),b(s.$$.fragment,u),b(c,u),a=!0)},o(u){w(e.$$.fragment,u),w(r.$$.fragment,u),w(s.$$.fragment,u),w(c,u),a=!1},d(u){u&&(_(t),_(n),_(i)),R(e,u),R(r,u),R(s,u),c&&c.d(u)}}}function oT(o){let e,t=[],r=new Map,n=ke(o[6]),s=i=>i[58];for(let i=0;i<n.length;i+=1){let a=rv(o,n,i),l=s(a);r.set(l,t[i]=nv(l,a))}return{c(){e=S("div");for(let i=0;i<t.length;i+=1)t[i].c();h(e,"class","login-buttons svelte-umtfyz")},m(i,a){x(i,e,a);for(let l=0;l<t.length;l+=1)t[l]&&t[l].m(e,null)},p(i,a){a[0]&18114|a[1]&2&&(n=ke(i[6]),t=Qo(t,a,s,1,i,n,r,e,Vl,nv,null,rv))},i:z,o:z,d(i){i&&_(e);for(let a=0;a<t.length;a+=1)t[a].d()}}}function nT(o){let e,t=[],r=new Map,n,s=ke(o[6]),i=a=>a[58];for(let a=0;a<s.length;a+=1){let l=ov(o,s,a),c=i(l);r.set(c,t[a]=sv(c,l))}return{c(){e=S("div");for(let a=0;a<t.length;a+=1)t[a].c();h(e,"class","login-buttons svelte-umtfyz")},m(a,l){x(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,l){l[0]&1073760192&&(s=ke(a[6]),oe(),t=Qo(t,l,i,1,a,s,r,e,oi,sv,null,ov),ne())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)w(t[l]);n=!1},d(a){a&&_(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function sT(o){let e,t,r=(o[10][o[58]]||ds(o[58]))+"",n,s,i,a,l;return{c(){e=S("button"),t=V("Sign in with "),n=V(r),h(e,"class",s=kt(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-umtfyz"),e.disabled=i=!0},m(c,u){x(c,e,u),v(e,t),v(e,n),l=!0},p(c,u){o=c,(!l||u[0]&1088)&&r!==(r=(o[10][o[58]]||ds(o[58]))+"")&&J(n,r),(!l||u[0]&64&&s!==(s=kt(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-umtfyz"))&&h(e,"class",s)},i(c){l||(c&&vo(()=>{l&&(a||(a=is(e,fs,{duration:o[9]?300:0,easing:us},!0)),a.run(1))}),l=!0)},o(c){c&&(a||(a=is(e,fs,{duration:o[9]?300:0,easing:us},!1)),a.run(0)),l=!1},d(c){c&&_(e),c&&a&&a.end()}}}function iT(o){let e,t,r,n=(o[10][o[58]]||ds(o[58]))+"",s,i,a,l,c,u,f,d,p;function m(){return o[37](o[58])}return{c(){e=S("a"),t=S("button"),r=V("Sign in with "),s=V(n),c=F(),h(t,"class",i=kt(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-umtfyz"),t.disabled=a=o[7]||!o[1][o[58]],h(e,"href",u=o[1][o[58]].fullAuthUrl),h(e,"target","_blank")},m(y,g){x(y,e,g),v(e,t),v(t,r),v(t,s),v(e,c),f=!0,d||(p=H(t,"click",m),d=!0)},p(y,g){o=y,(!f||g[0]&1088)&&n!==(n=(o[10][o[58]]||ds(o[58]))+"")&&J(s,n),(!f||g[0]&64&&i!==(i=kt(`${o[58].startsWith("oidc")?"oidc":o[58]}-sign-in-button`)+" svelte-umtfyz"))&&h(t,"class",i),(!f||g[0]&194&&a!==(a=o[7]||!o[1][o[58]]))&&(t.disabled=a),(!f||g[0]&66&&u!==(u=o[1][o[58]].fullAuthUrl))&&h(e,"href",u)},i(y){f||(y&&vo(()=>{f&&(l||(l=is(t,fs,{duration:o[9]?300:0,easing:us},!0)),l.run(1))}),f=!0)},o(y){y&&(l||(l=is(t,fs,{duration:o[9]?300:0,easing:us},!1)),l.run(0)),f=!1},d(y){y&&_(e),y&&l&&l.end(),d=!1,p()}}}function nv(o,e){let t,r,n,s,i=[iT,sT],a=[];function l(c,u){return c[1][c[58]]?0:1}return r=l(e,[-1,-1,-1]),n=a[r]=i[r](e),{key:o,first:null,c(){t=me(),n.c(),s=me(),this.first=t},m(c,u){x(c,t,u),a[r].m(c,u),x(c,s,u)},p(c,u){e=c;let f=r;r=l(e,u),r===f?a[r].p(e,u):(oe(),w(a[f],1,1,()=>{a[f]=null}),ne(),n=a[r],n?n.p(e,u):(n=a[r]=i[r](e),n.c()),b(n,1),n.m(s.parentNode,s))},d(c){c&&(_(t),_(s)),a[r].d(c)}}}function sv(o,e){let t,r,n=(e[10][e[58]]||ds(e[58]))+"",s,i,a,l,c,u,f;function d(){return e[36](e[58])}return{key:o,first:null,c(){t=S("button"),r=V("Sign in with "),s=V(n),h(t,"class",i=kt(`${e[58].startsWith("oidc")?"oidc":e[58]}-sign-in-button`)+" svelte-umtfyz"),t.disabled=a=e[7]||!e[8].contains(e[58]),this.first=t},m(p,m){x(p,t,m),v(t,r),v(t,s),c=!0,u||(f=H(t,"click",function(){Qe((0,oo.debounce)(d))&&(0,oo.debounce)(d).apply(this,arguments)}),u=!0)},p(p,m){e=p,(!c||m[0]&1088)&&n!==(n=(e[10][e[58]]||ds(e[58]))+"")&&J(s,n),(!c||m[0]&64&&i!==(i=kt(`${e[58].startsWith("oidc")?"oidc":e[58]}-sign-in-button`)+" svelte-umtfyz"))&&h(t,"class",i),(!c||m[0]&448&&a!==(a=e[7]||!e[8].contains(e[58])))&&(t.disabled=a)},i(p){c||(p&&vo(()=>{c&&(l||(l=is(t,fs,{duration:e[9]?300:0,easing:us},!0)),l.run(1))}),c=!0)},o(p){p&&(l||(l=is(t,fs,{duration:e[9]?300:0,easing:us},!1)),l.run(0)),c=!1},d(p){p&&_(t),p&&l&&l.end(),u=!1,f()}}}function aT(o){let e,t,r,n,s,i,a,l;return{c(){e=S("div"),t=S("p"),t.textContent="Continue in your browser...",r=F(),n=S("p"),s=V(`Not working?
					`),i=S("button"),i.textContent="(try again)",h(t,"class","continue svelte-umtfyz"),h(i,"class","link link-button svelte-umtfyz"),h(n,"class","not-working svelte-umtfyz")},m(c,u){x(c,e,u),v(e,t),v(e,r),v(e,n),v(n,s),v(n,i),a||(l=H(i,"click",o[40]),a=!0)},p:z,d(c){c&&_(e),a=!1,l()}}}function lT(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[12]&&o[2]&&iv(o);return{c(){e=S("p"),t=V(o[11]),r=V("."),n=S("br"),s=F(),d&&d.c(),i=F(),a=S("p"),l=V(`Not working?
				`),c=S("button"),c.textContent="(try again)",h(c,"class","link link-button svelte-umtfyz"),h(a,"class","not-working svelte-umtfyz")},m(p,m){x(p,e,m),v(e,t),v(e,r),v(e,n),v(e,s),d&&d.m(e,null),x(p,i,m),x(p,a,m),v(a,l),v(a,c),u||(f=H(c,"click",o[39]),u=!0)},p(p,m){m[0]&2048&&J(t,p[11]),p[12]&&p[2]?d?d.p(p,m):(d=iv(p),d.c(),d.m(e,null)):d&&(d.d(1),d=null)},d(p){p&&(_(e),_(i),_(a)),d&&d.d(),u=!1,f()}}}function iv(o){let e,t,r,n;return{c(){e=V("Already logged in? "),t=S("button"),t.textContent="(click here)",h(t,"class","link link-button svelte-umtfyz")},m(s,i){x(s,e,i),x(s,t,i),r||(n=H(t,"click",function(){Qe((0,oo.debounce)(o[38]))&&(0,oo.debounce)(o[38]).apply(this,arguments)}),r=!0)},p(s,i){o=s},d(s){s&&(_(e),_(t)),r=!1,n()}}}function av(o){let e,t,r,n;return{c(){e=S("p"),t=S("button"),t.textContent="(choose another provider)",h(t,"class","link link-button svelte-umtfyz"),h(e,"class","choose-another svelte-umtfyz")},m(s,i){x(s,e,i),v(e,t),r||(n=H(t,"click",(0,oo.debounce)(o[41])),r=!0)},p:z,d(s){s&&_(e),r=!1,n()}}}function cT(o){let e,t;return e=new Vb({}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uT(o){let e,t;return e=new ic({props:{slot:"name"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p:z,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function fT(o){let e,t,r;return{c(){e=S("button"),e.textContent="Logout"},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,oo.debounce)(o[35])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function dT(o){let e,t,r,n,s=[rT,tT],i=[];function a(l,c){return l[4].hasUser&&l[4].user?0:1}return e=a(o,[-1,-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(oe(),w(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){w(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}var pT="system3-relay-auth-providers-";function ds(o){return o?o=="oidc"?"OIDC":o=="github"?"GitHub":o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():""}function mT(o,e,t){let r,n,s,i,a,l,c,u,f=z,d=()=>(f(),f=Rt(T,ge=>t(4,u=ge)),T),p,m,y,g,k,L,I,C;o.$$.on_destroy.push(()=>f());let{$$slots:A={},$$scope:M}=e,{plugin:P}=e,O=Fe("LoggedIn.svelte","error"),T,U=Ce(!oo.Platform.isIosApp);ce(o,U,ge=>t(5,p=ge));let j=Ce(!1);ce(o,j,ge=>t(7,y=ge)),d(T=P.loginManager);let Q=Ce(!1);ce(o,Q,ge=>t(12,C=ge));let N=Ce(!1),X=Ce(!0);ce(o,X,ge=>t(44,s=ge));let $=Ce("");ce(o,$,ge=>t(2,r=ge));let B=xt.getInstance();ce(o,B,ge=>t(45,i=ge));let pe={},Z=Ce(!1);ce(o,Z,ge=>t(47,l=ge));let ae=T.loginSettings;ce(o,ae,ge=>t(3,c=ge));let ue=Ce([]);ce(o,ue,ge=>t(46,a=ge));let ee=Ce(!1);ce(o,ee,ge=>t(9,k=ge));function q(){var ge;let Je=((ge=T.pb)===null||ge===void 0?void 0:ge.baseUrl)||"default";return`${pT}${Je}`}function Y(){let ge=["google","microsoft"];return i.getFlag("enableDiscordLogin")&&ge.push("discord"),i.getFlag("enableGitHubLogin")&&ge.push("github"),ge}function Te(){try{let ge=q(),Je=localStorage.getItem(ge);if(Je)return JSON.parse(Je)}catch(ge){O("Failed to load cached providers:",ge)}return Y()}function fe(ge){try{let Je=q();localStorage.setItem(Je,JSON.stringify(ge))}catch(Je){O("Failed to save cached providers:",Je)}}let Ee=Ze([$,B],()=>{let ge=["google","microsoft"];return i.getFlag("enableDiscordLogin")&&ge.push("discord"),i.getFlag("enableGitHubLogin")&&ge.push("github"),i.getFlag("enableOIDCLogin")&&ge.push("oidc"),ge});ce(o,Ee,ge=>t(43,n=ge));let xe=Ze([$,T.loginSettings,B,Z,ue],()=>{if(c&&c.provider)return[c.provider];if(r!=="")return[r];if(l&&Object.keys(pe).length>0){let Je=Object.keys(pe),Xe=[];Je.includes("google")&&Xe.push("google"),Je.includes("microsoft")&&Xe.push("microsoft"),Je.includes("discord")&&i.getFlag("enableDiscordLogin")&&Xe.push("discord"),Je.includes("github")&&i.getFlag("enableGitHubLogin")&&Xe.push("github"),Je.forEach(Ao=>{Ao.startsWith("oidc")&&i.getFlag("enableOIDCLogin")&&Xe.push(Ao)});let _r=JSON.stringify(Xe.sort())!==JSON.stringify(a.sort());return ee.set(_r),fe(Xe),Xe}if(a.length>0&&!l)return a;let ge=["google","microsoft"];return i.getFlag("enableDiscordLogin")&&ge.push("discord"),i.getFlag("enableGitHubLogin")&&ge.push("github"),ge});ce(o,xe,ge=>t(6,m=ge));function se(){T.clearPreferredProvider(),$.set(""),Gt()}let Ae=Ze([$,P.loginSettings,B,Z],()=>r?[r]:Object.keys(pe));ce(o,Ae,ge=>t(8,g=ge));let we=Ze([Z],()=>{var ge;let Je={};for(let Xe of Object.keys(pe)){let _r=pe[Xe];!((ge=_r==null?void 0:_r.info)===null||ge===void 0)&&ge.displayName?Je[Xe]=_r.info.displayName:Je[Xe]=ds(Xe)}return Je});ce(o,we,ge=>t(10,L=ge));let Ve,ut=Ce("");ce(o,ut,ge=>t(11,I=ge));function Zt(){return Pe(this,void 0,void 0,function*(){P.loginManager.logout(),N.set(!1),j.set(!1),$.set(""),Q.set(!1)})}function Kt(ge){return Pe(this,void 0,void 0,function*(){try{$.set(ge),(yield P.loginManager.login(ge))&&N.set(!0)}catch(Je){U.set(!1),N.set(!1);let Xe=pe[ge];Xe&&(window.open(Xe.fullAuthUrl,"_blank"),Dt(ge))}})}let Ar=Ce(P.loginManager.pb);function rn(){Ar.set(P.loginManager.pb)}function Gt(){try{let ge=s?ft:fetch;T.initiateManualOAuth2CodeFlow(ge,n).then(Je=>{t(1,pe=Je),Z.set(!0),T.updateWebviewIntercepts(Je)}).catch(Je=>{let Xe=Je.message;throw Xe=Xe,ut.set(Xe),N.set(!1),$.set(""),Je})}catch(ge){ut.set(ge.message)}}dt(()=>{N.set(!1);let ge=Te();ue.set(ge),Gt()});function Dt(ge){return Pe(this,void 0,void 0,function*(){let Je=pe[ge];if(Je)return $.set(ge),yield P.loginManager.poll(Je).then(Xe=>{N.set(!0),j.set(!1),ut.set("")}).catch(Xe=>{Q.set(!0),j.set(!1),N.set(!1),ut.set(Xe.message)})})}function To(ge){let Je=ge.target;Je.focus(),Je.select(),navigator.clipboard.writeText(Je.value).then(()=>new oo.Notice("Invite link copied")).catch(Xe=>{}),Dt(r)}let on=()=>{Zt()},io=async ge=>{j.set(!0),await Kt(ge)},nn=ge=>{j.set(!0),Dt(ge)},Dn=()=>{Dt(r)},Un=()=>{j.set(!1),U.set(!1),ut.set(""),$.set(""),Z.set(!1),Gt()},sn=()=>{j.set(!1),U.set(!1),ut.set(""),$.set("")},On=()=>{se()};return o.$$set=ge=>{"plugin"in ge&&t(33,P=ge.plugin),"$$scope"in ge&&t(42,M=ge.$$scope)},[T,pe,r,c,u,p,m,y,g,k,L,I,C,U,j,Q,X,$,B,Z,ae,ue,ee,Ee,xe,se,Ae,we,ut,Zt,Kt,Gt,Dt,P,A,on,io,nn,Dn,Un,sn,On,M]}var $p=class extends K{constructor(e){super(),G(this,e,mT,dT,W,{plugin:33},eT,[-1,-1,-1])}},lv=$p;function cv(o,e,t){let r=o.slice();return r[5]=e[t],r}var hT=o=>({}),uv=o=>({}),gT=o=>({}),fv=o=>({});function yT(o){let e;return{c(){e=V(o[0])},m(t,r){x(t,e,r)},p(t,r){r&1&&J(e,t[0])},d(t){t&&_(e)}}}function bT(o){let e,t=ke(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=dv(cv(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=me()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);x(n,e,s)},p(n,s){if(s&2){t=ke(n[1]);let i;for(i=0;i<t.length;i+=1){let a=cv(n,t,i);r[i]?r[i].p(a,s):(r[i]=dv(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),ze(r,n)}}}function dv(o){let e;return{c(){e=S("div"),e.textContent=`${o[5]} `},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function vT(o){let e,t=o[1].length>0&&bT(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&_(e),t&&t.d(r)}}}function _T(o){let e,t,r,n,s,i,a,l,c=o[4].name,u=ye(c,o,o[3],fv),f=u||yT(o),d=o[4].description,p=ye(d,o,o[3],uv),m=p||vT(o),y=o[4].default,g=ye(y,o,o[3],null);return{c(){e=S("div"),t=S("div"),r=S("div"),f&&f.c(),n=F(),s=S("div"),m&&m.c(),i=F(),a=S("div"),g&&g.c(),h(r,"class","setting-item-name"),he(r,"display","grid"),he(r,"align-items","center"),h(s,"class","setting-item-description"),h(t,"class","setting-item-info"),he(t,"display","grid"),h(a,"class","setting-item-control"),h(e,"class","setting-item")},m(k,L){x(k,e,L),v(e,t),v(t,r),f&&f.m(r,null),v(t,n),v(t,s),m&&m.m(s,null),v(e,i),v(e,a),g&&g.m(a,null),l=!0},p(k,[L]){u?u.p&&(!l||L&8)&&ve(u,c,k,k[3],l?be(c,k[3],L,gT):_e(k[3]),fv):f&&f.p&&(!l||L&1)&&f.p(k,l?L:-1),p&&p.p&&(!l||L&8)&&ve(p,d,k,k[3],l?be(d,k[3],L,hT):_e(k[3]),uv),g&&g.p&&(!l||L&8)&&ve(g,y,k,k[3],l?be(y,k[3],L,null):_e(k[3]),null)},i(k){l||(b(f,k),b(m,k),b(g,k),l=!0)},o(k){w(f,k),w(m,k),w(g,k),l=!1},d(k){k&&_(e),f&&f.d(k),m&&m.d(k),g&&g.d(k)}}}function xT(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i}=e,a=i!==void 0?i.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,i=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,a,i,n,r]}var Np=class extends K{constructor(e){super(),G(this,e,xT,_T,W,{name:0,description:2})}},Oe=Np;function wT(o){Le(o,"svelte-11hpkul",".setting-item-control.svelte-11hpkul{width:unset !important;margin-top:unset !important}.setting-item.svelte-11hpkul{flex-direction:unset !important}.setting-item-info.svelte-11hpkul{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-11hpkul{min-width:0}.truncate.svelte-11hpkul *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var ST=o=>({}),pv=o=>({}),kT=o=>({}),mv=o=>({});function IT(o){let e;return{c(){e=V(o[0])},m(t,r){x(t,e,r)},p(t,r){r&1&&J(e,t[0])},d(t){t&&_(e)}}}function hv(o){let e,t;return{c(){e=S("div"),t=V(o[1]),h(e,"class","setting-item-description")},m(r,n){x(r,e,n),v(e,t)},p(r,n){n&2&&J(t,r[1])},d(r){r&&_(e)}}}function CT(o){let e,t=o[1]&&hv(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[1]?t?t.p(r,n):(t=hv(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function LT(o){let e,t,r,n,s,i,a,l=o[3].name,c=ye(l,o,o[2],mv),u=c||IT(o),f=o[3].description,d=ye(f,o,o[2],pv),p=d||CT(o),m=o[3].default,y=ye(m,o,o[2],null);return{c(){e=S("div"),t=S("div"),r=S("div"),u&&u.c(),n=F(),p&&p.c(),s=F(),i=S("div"),y&&y.c(),h(r,"class","setting-item-name truncate svelte-11hpkul"),h(t,"class","setting-item-info svelte-11hpkul"),h(i,"class","setting-item-control svelte-11hpkul"),h(e,"class","setting-item mod-list-item svelte-11hpkul")},m(g,k){x(g,e,k),v(e,t),v(t,r),u&&u.m(r,null),v(t,n),p&&p.m(t,null),v(e,s),v(e,i),y&&y.m(i,null),a=!0},p(g,[k]){c?c.p&&(!a||k&4)&&ve(c,l,g,g[2],a?be(l,g[2],k,kT):_e(g[2]),mv):u&&u.p&&(!a||k&1)&&u.p(g,a?k:-1),d?d.p&&(!a||k&4)&&ve(d,f,g,g[2],a?be(f,g[2],k,ST):_e(g[2]),pv):p&&p.p&&(!a||k&2)&&p.p(g,a?k:-1),y&&y.p&&(!a||k&4)&&ve(y,m,g,g[2],a?be(m,g[2],k,null):_e(g[2]),null)},i(g){a||(b(u,g),b(p,g),b(y,g),a=!0)},o(g){w(u,g),w(p,g),w(y,g),a=!1},d(g){g&&_(e),u&&u.d(g),p&&p.d(g),y&&y.d(g)}}}function TT(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:i=""}=e;return o.$$set=a=>{"name"in a&&t(0,s=a.name),"description"in a&&t(1,i=a.description),"$$scope"in a&&t(2,n=a.$$scope)},[s,i,n,r]}var Bp=class extends K{constructor(e){super(),G(this,e,TT,LT,W,{name:0,description:1},wT)}},At=Bp;function AT(o){Le(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function MT(o){let e,t;return e=new Vd({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p:z,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function FT(o){let e,t,r,n,s=o[3].default,i=ye(s,o,o[2],null),a=i||MT(o);return{c(){e=S("div"),a&&a.c(),h(e,"class","clickable-icon extra-setting-button svelte-y529x8"),h(e,"aria-label",o[0]),h(e,"role","button"),h(e,"tabindex","0")},m(l,c){x(l,e,c),a&&a.m(e,null),t=!0,r||(n=[H(e,"click",o[1]),H(e,"keydown",o[1])],r=!0)},p(l,[c]){i&&i.p&&(!t||c&4)&&ve(i,s,l,l[2],t?be(s,l[2],c,null):_e(l[2]),null),(!t||c&1)&&h(e,"aria-label",l[0])},i(l){t||(b(a,l),t=!0)},o(l){w(a,l),t=!1},d(l){l&&_(e),a&&a.d(l),r=!1,Ie(n)}}}function PT(o,e,t){let{$$slots:r={},$$scope:n}=e,s=Ye(),{label:i="Options"}=e;function a(l){(l instanceof MouseEvent||l instanceof KeyboardEvent&&(l.key==="Enter"||l.key===" "))&&s("settings")}return o.$$set=l=>{"label"in l&&t(0,i=l.label),"$$scope"in l&&t(2,n=l.$$scope)},[i,a,n,r]}var Vp=class extends K{constructor(e){super(),G(this,e,PT,FT,W,{label:0},AT)}},ps=Vp;function Hp(o){return Array.isArray(o.permissionParents)}function ET(o){let e,t,r,n,s,i;t=new Yo({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let a=o[3].default,l=ye(a,o,o[2],null);return{c(){e=S("span"),D(t.$$.fragment),r=F(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),he(e,"display","flex"),he(e,"align-items","center"),he(e,"width","100%")},m(c,u){x(c,e,u),E(t,e,null),v(e,r),l&&l.m(e,null),n=!0,s||(i=[H(e,"keypress",o[0]),H(e,"click",o[0])],s=!0)},p(c,[u]){l&&l.p&&(!n||u&4)&&ve(l,a,c,c[2],n?be(a,c[2],u,null):_e(c[2]),null)},i(c){n||(b(t.$$.fragment,c),b(l,c),n=!0)},o(c){w(t.$$.fragment,c),w(l,c),n=!1},d(c){c&&_(e),R(t),l&&l.d(c),s=!1,Ie(i)}}}function RT(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,i=Ye();function a(){s&&i("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[a,s,n,r]}var qp=class extends K{constructor(e){super(),G(this,e,RT,ET,W,{relay:1})}},ba=qp;function DT(o){let e,t,r,n,s,i;t=new _o({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let a=o[4].default,l=ye(a,o,o[3],null);return{c(){e=S("span"),D(t.$$.fragment),r=F(),l&&l.c(),h(e,"role","button"),h(e,"tabindex","0"),he(e,"display","inline-flex"),he(e,"align-items","center"),he(e,"width","100%")},m(c,u){x(c,e,u),E(t,e,null),v(e,r),l&&l.m(e,null),n=!0,s||(i=[H(e,"keypress",o[0]),H(e,"click",o[0])],s=!0)},p(c,[u]){l&&l.p&&(!n||u&8)&&ve(l,a,c,c[3],n?be(a,c[3],u,null):_e(c[3]),null)},i(c){n||(b(t.$$.fragment,c),b(l,c),n=!0)},o(c){w(t.$$.fragment,c),w(l,c),n=!1},d(c){c&&_(e),R(t),l&&l.d(c),s=!1,Ie(i)}}}function UT(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,{remoteFolder:i=void 0}=e,a=Ye();function l(){var c;s&&a("manageSharedFolder",{folder:s,relay:((c=s==null?void 0:s.remote)===null||c===void 0?void 0:c.relay)||(i==null?void 0:i.relay),remoteFolder:i})}return o.$$set=c=>{"folder"in c&&t(1,s=c.folder),"remoteFolder"in c&&t(2,i=c.remoteFolder),"$$scope"in c&&t(3,n=c.$$scope)},[l,s,i,n,r]}var zp=class extends K{constructor(e){super(),G(this,e,UT,DT,W,{folder:1,remoteFolder:2})}},va=zp;function OT(o){let e,t;return e=new _o({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function $T(o){let e,t;return e=new as({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function NT(o){let e,t,r,n,s,i,a,l=[$T,OT],c=[];function u(p,m){var y;return(y=p[0])!=null&&y.private?0:1}t=u(o,-1),r=c[t]=l[t](o);let f=o[3].default,d=ye(f,o,o[2],null);return{c(){e=S("span"),r.c(),n=F(),d&&d.c(),h(e,"role","button"),h(e,"tabindex","0"),he(e,"display","inline-flex"),he(e,"align-items","center"),he(e,"width","100%")},m(p,m){x(p,e,m),c[t].m(e,null),v(e,n),d&&d.m(e,null),s=!0,i||(a=[H(e,"keypress",o[1]),H(e,"click",o[1])],i=!0)},p(p,[m]){let y=t;t=u(p,m),t!==y&&(oe(),w(c[y],1,1,()=>{c[y]=null}),ne(),r=c[t],r||(r=c[t]=l[t](p),r.c()),b(r,1),r.m(e,n)),d&&d.p&&(!s||m&4)&&ve(d,f,p,p[2],s?be(f,p[2],m,null):_e(p[2]),null)},i(p){s||(b(r),b(d,p),s=!0)},o(p){w(r),w(d,p),s=!1},d(p){p&&_(e),c[t].d(),d&&d.d(p),i=!1,Ie(a)}}}function BT(o,e,t){let{$$slots:r={},$$scope:n}=e,{remoteFolder:s}=e,i=Ye();function a(){i("manageRemoteFolder",{remoteFolder:s,relay:s==null?void 0:s.relay})}return o.$$set=l=>{"remoteFolder"in l&&t(0,s=l.remoteFolder),"$$scope"in l&&t(2,n=l.$$scope)},[s,a,n,r]}var jp=class extends K{constructor(e){super(),G(this,e,BT,NT,W,{remoteFolder:0})}},uc=jp;function VT(o){let e,t;return e=new va({props:{folder:o[0],$$slots:{default:[qT]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[2]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.folder=r[0]),n&17&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function HT(o){let e,t;return e=new uc({props:{remoteFolder:o[0].remote,$$slots:{default:[zT]},$$scope:{ctx:o}}}),e.$on("manageRemoteFolder",o[1]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.remoteFolder=r[0].remote),n&17&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function qT(o){let e,t=o[0].name+"",r;return{c(){e=S("span"),r=V(t),he(e,"overflow","hidden"),he(e,"text-overflow","ellipsis"),he(e,"white-space","nowrap")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&J(r,t)},d(n){n&&_(e)}}}function zT(o){let e,t=o[0].name+"",r;return{c(){e=S("span"),r=V(t),he(e,"flex","1"),he(e,"min-width","0"),he(e,"text-overflow","ellipsis"),he(e,"white-space","nowrap")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&J(r,t)},d(n){n&&_(e)}}}function gv(o){let e,t,r,n,s;return t=new sd({props:{size:16,class:"svg-icon"}}),n=new ba({props:{relay:o[0].remote.relay,$$slots:{default:[jT]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=S("span"),D(t.$$.fragment),r=F(),D(n.$$.fragment),he(e,"width","16px"),he(e,"flex-shrink","0"),he(e,"display","flex"),he(e,"justify-content","center")},m(i,a){x(i,e,a),E(t,e,null),x(i,r,a),E(n,i,a),s=!0},p(i,a){let l={};a&1&&(l.relay=i[0].remote.relay),a&17&&(l.$$scope={dirty:a,ctx:i}),n.$set(l)},i(i){s||(b(t.$$.fragment,i),b(n.$$.fragment,i),s=!0)},o(i){w(t.$$.fragment,i),w(n.$$.fragment,i),s=!1},d(i){i&&(_(e),_(r)),R(t),R(n,i)}}}function jT(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=S("span"),r=V(t),he(e,"flex","1"),he(e,"min-width","0"),he(e,"text-overflow","ellipsis"),he(e,"white-space","nowrap")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&J(r,t)},d(n){n&&_(e)}}}function WT(o){let e,t,r,n,s,i,a=[HT,VT],l=[];function c(f,d){return f[0].remote?0:1}r=c(o,-1),n=l[r]=a[r](o);let u=o[0].remote&&gv(o);return{c(){e=S("span"),t=S("span"),n.c(),s=F(),u&&u.c(),he(t,"display","inline-flex"),he(t,"align-items","center"),he(t,"width","200px"),he(t,"min-width","200px"),he(t,"flex-shrink","0"),he(e,"display","inline-flex"),he(e,"align-items","center"),he(e,"width","100%"),he(e,"gap","8px")},m(f,d){x(f,e,d),v(e,t),l[r].m(t,null),v(e,s),u&&u.m(e,null),i=!0},p(f,[d]){let p=r;r=c(f,d),r===p?l[r].p(f,d):(oe(),w(l[p],1,1,()=>{l[p]=null}),ne(),n=l[r],n?n.p(f,d):(n=l[r]=a[r](f),n.c()),b(n,1),n.m(t,null)),f[0].remote?u?(u.p(f,d),d&1&&b(u,1)):(u=gv(f),u.c(),b(u,1),u.m(e,null)):u&&(oe(),w(u,1,1,()=>{u=null}),ne())},i(f){i||(b(n),b(u),i=!0)},o(f){w(n),w(u),i=!1},d(f){f&&_(e),l[r].d(),u&&u.d()}}}function KT(o,e,t){let{folder:r}=e;function n(a){gr.call(this,o,a)}function s(a){gr.call(this,o,a)}function i(a){gr.call(this,o,a)}return o.$$set=a=>{"folder"in a&&t(0,r=a.folder)},[r,n,s,i]}var Wp=class extends K{constructor(e){super(),G(this,e,KT,WT,W,{folder:0})}},yv=Wp;var sr=require("obsidian");var So=require("obsidian");function GT(o){Le(o,"svelte-1fe7ajn",".input-with-icon.svelte-1fe7ajn{position:relative;width:100%}.secret-text-toggle-icon.svelte-1fe7ajn{display:flex;align-items:center;justify-content:center;cursor:pointer;width:24px;height:24px;position:absolute;right:4px;top:50%;transform:translateY(-50%);border-radius:4px}.secret-text-toggle-icon.svelte-1fe7ajn:hover{background-color:var(--background-modifier-hover)}.system3-secret-text.svelte-1fe7ajn{padding-inline-end:28px !important;font-family:monospace !important}.system3-input-invalid.svelte-1fe7ajn{border:1px solid var(--color-red) !important}")}function JT(o){let e,t,r,n;return{c(){e=S("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","password"),e.readOnly=o[3],h(e,"class",t=kt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){x(s,e,i),r||(n=[H(e,"click",function(){Qe(o[4]?(0,So.debounce)(o[12]):null)&&(o[4]?(0,So.debounce)(o[12]):null).apply(this,arguments)}),H(e,"input",o[15]),H(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=kt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&_(e),r=!1,Ie(n)}}}function QT(o){let e,t,r,n;return{c(){e=S("input"),e.value=o[0],h(e,"placeholder",o[2]),h(e,"type","text"),e.readOnly=o[3],h(e,"class",t=kt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn"),e.disabled=o[1]},m(s,i){x(s,e,i),r||(n=[H(e,"click",function(){Qe(o[4]?(0,So.debounce)(o[12]):null)&&(o[4]?(0,So.debounce)(o[12]):null).apply(this,arguments)}),H(e,"input",o[14]),H(e,"keydown",o[10])],r=!0)},p(s,i){o=s,i&1&&e.value!==o[0]&&(e.value=o[0]),i&4&&h(e,"placeholder",o[2]),i&8&&(e.readOnly=o[3]),i&32&&t!==(t=kt(`system3-secret-text ${o[5]?"system3-input-invalid":""}`)+" svelte-1fe7ajn")&&h(e,"class",t),i&2&&(e.disabled=o[1])},d(s){s&&_(e),r=!1,Ie(n)}}}function YT(o){let e,t,r,n,s,i,a;function l(f,d){return f[6]?QT:JT}let c=l(o,-1),u=c(o);return{c(){e=S("div"),u.c(),t=F(),r=S("div"),h(r,"class","secret-text-toggle-icon svelte-1fe7ajn"),h(r,"role","button"),h(r,"tabindex","0"),h(r,"aria-label",n=o[6]?"Hide text":"Show text"),h(e,"class","input-with-icon svelte-1fe7ajn")},m(f,d){x(f,e,d),u.m(e,null),v(e,t),v(e,r),i||(a=[rs(s=o[11].call(null,r)),H(r,"click",o[16]),H(r,"keypress",o[17])],i=!0)},p(f,[d]){c===(c=l(f,d))&&u?u.p(f,d):(u.d(1),u=c(f),u&&(u.c(),u.m(e,t))),d&64&&n!==(n=f[6]?"Hide text":"Show text")&&h(r,"aria-label",n)},i:z,o:z,d(f){f&&_(e),u.d(),i=!1,Ie(a)}}}function ZT(o,e,t){let r,n,s=Ye(),{value:i}=e,{disabled:a=!1}=e,{placeholder:l="please wait..."}=e,{readonly:c=!0}=e,{copyOnClick:u=!0}=e,{successMessage:f="Copied to clipboard"}=e,{invalid:d=!1}=e,p=Ce(!1);ce(o,p,P=>t(6,r=P));let m=Ce(!1);ce(o,m,P=>t(19,n=P));let y;function g(P){P.key==="Enter"&&!a&&s("enter")}function k(P){y=P;let O=()=>{n?((0,So.setIcon)(P,"clipboard-check"),P.addClass("mod-success")):((0,So.setIcon)(P,r?"eye-off":"eye"),P.removeClass("mod-success"))},T=p.subscribe(()=>{O()}),U=m.subscribe(()=>{O()});return O(),{destroy(){T(),U()}}}function L(P){!u||!i||a||navigator.clipboard.writeText(i).then(()=>{new So.Notice(f),m.set(!0),setTimeout(()=>{m.set(!1)},800)}).catch(O=>{console.error("Failed to copy: ",O)})}let I=P=>{t(0,i=P.currentTarget.value),s("input",P)},C=P=>{t(0,i=P.currentTarget.value),s("input",P)},A=()=>p.update(P=>!P),M=()=>p.update(P=>!P);return o.$$set=P=>{"value"in P&&t(0,i=P.value),"disabled"in P&&t(1,a=P.disabled),"placeholder"in P&&t(2,l=P.placeholder),"readonly"in P&&t(3,c=P.readonly),"copyOnClick"in P&&t(4,u=P.copyOnClick),"successMessage"in P&&t(13,f=P.successMessage),"invalid"in P&&t(5,d=P.invalid)},[i,a,l,c,u,d,r,s,p,m,g,k,L,f,I,C,A,M]}var Kp=class extends K{constructor(e){super(),G(this,e,ZT,YT,W,{value:0,disabled:1,placeholder:2,readonly:3,copyOnClick:4,successMessage:13,invalid:5},GT)}},fc=Kp;var om=require("obsidian");var Bv=require("obsidian");var tm=require("obsidian");var xv=require("obsidian");function XT(o){Le(o,"svelte-1dpxzin",".folder-suggest-wrapper.svelte-1dpxzin{position:relative;width:100%}.folder-suggest-input.svelte-1dpxzin{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.suggestion-container.svelte-1dpxzin{position:fixed;z-index:9999;box-sizing:border-box;background:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:6px;box-shadow:var(--shadow-s);overflow-y:auto;overflow-x:hidden}.suggestion.svelte-1dpxzin{overflow-y:auto;overflow-x:hidden;max-height:100%}.suggestion-note.svelte-1dpxzin{color:var(--text-muted);font-style:italic}")}function bv(o,e,t){let r=o.slice();return r[31]=e[t],r[33]=t,r}function vv(o){let e,t,r,n,s,i,a=ke(o[2]),l=[];for(let c=0;c<a.length;c+=1)l[c]=_v(bv(o,a,c));return{c(){e=S("div"),t=S("div");for(let c=0;c<l.length;c+=1)l[c].c();h(t,"class","suggestion svelte-1dpxzin"),h(e,"class","suggestion-container svelte-1dpxzin")},m(c,u){x(c,e,u),v(e,t);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(t,null);s||(i=[rs(r=oA.call(null,e)),rs(n=o[6].call(null,e))],s=!0)},p(c,u){if(u[0]&2060){a=ke(c[2]);let f;for(f=0;f<a.length;f+=1){let d=bv(c,a,f);l[f]?l[f].p(d,u):(l[f]=_v(d),l[f].c(),l[f].m(t,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=a.length}},d(c){c&&_(e),ze(l,c),s=!1,Ie(i)}}}function eA(o){let e=o[31]+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&4&&e!==(e=r[31]+"")&&J(t,e)},d(r){r&&_(t)}}}function tA(o){let e,t=o[31].substring(9)+"",r;return{c(){e=S("span"),e.textContent=`Create:
								`,r=V(t),h(e,"class","suggestion-note svelte-1dpxzin")},m(n,s){x(n,e,s),x(n,r,s)},p(n,s){s[0]&4&&t!==(t=n[31].substring(9)+"")&&J(r,t)},d(n){n&&(_(e),_(r))}}}function _v(o){let e,t,r,n,s,i,a,l,c,u;function f(k,L){return L[0]&4&&(n=null),n==null&&(n=!!k[31].startsWith("[Create] ")),n?tA:eA}let d=f(o,[-1,-1]),p=d(o);function m(){return o[18](o[31])}function y(...k){return o[19](o[31],...k)}function g(){return o[20](o[33])}return{c(){e=S("div"),t=S("div"),r=S("div"),p.c(),s=F(),i=S("div"),i.innerHTML='<div class="suggestion-icon"></div>',a=F(),h(r,"class","suggestion-title"),h(t,"class","suggestion-content"),h(i,"class","suggestion-aux"),h(e,"class","suggestion-item mod-complex"),h(e,"role","option"),h(e,"aria-selected",l=o[33]===o[3]),h(e,"tabindex","-1"),Me(e,"is-selected",o[33]===o[3])},m(k,L){x(k,e,L),v(e,t),v(t,r),p.m(r,null),v(e,s),v(e,i),v(e,a),c||(u=[H(e,"mousedown",Rl(o[15])),H(e,"click",m),H(e,"keydown",y),H(e,"mouseenter",g)],c=!0)},p(k,L){o=k,d===(d=f(o,L))&&p?p.p(o,L):(p.d(1),p=d(o),p&&(p.c(),p.m(r,null))),L[0]&8&&l!==(l=o[33]===o[3])&&h(e,"aria-selected",l),L[0]&8&&Me(e,"is-selected",o[33]===o[3])},d(k){k&&_(e),p.d(),c=!1,Ie(u)}}}function rA(o){let e,t,r,n,s,i,a=o[4]&&o[2].length>0&&vv(o);return{c(){e=S("div"),t=S("input"),r=F(),a&&a.c(),n=me(),h(t,"type","text"),h(t,"placeholder",o[0]),h(t,"class","folder-suggest-input svelte-1dpxzin"),h(e,"class","folder-suggest-wrapper svelte-1dpxzin")},m(l,c){x(l,e,c),v(e,t),o[16](t),rt(t,o[5]),x(l,r,c),a&&a.m(l,c),x(l,n,c),s||(i=[H(t,"input",o[17]),H(t,"input",o[8]),H(t,"keydown",o[7]),H(t,"focus",o[9]),H(t,"blur",o[10])],s=!0)},p(l,c){c[0]&1&&h(t,"placeholder",l[0]),c[0]&32&&t.value!==l[5]&&rt(t,l[5]),l[4]&&l[2].length>0?a?a.p(l,c):(a=vv(l),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},i:z,o:z,d(l){l&&(_(e),_(r),_(n)),o[16](null),a&&a.d(l),s=!1,Ie(i)}}}function oA(o){return document.body.appendChild(o),{destroy(){o.remove()}}}function nA(o,e,t){function r(Z){return setTimeout(()=>{u=Z,I()},0),{destroy(){}}}let{app:n}=e,{value:s=""}=e,{placeholder:i="Choose or create folder..."}=e,{blockedPaths:a=new Set}=e,l=Ye(),c,u,f=[],d=-1,p=!1,m=s||"/",y=!1;function g(Z){let ae=Z.toLowerCase(),ue=[],ee=Te=>{if(a.has(Te.path)&&Te.path!=="/")return;let fe=Te.path.toLowerCase(),Ee=(Te.path.startsWith("/")?Te.path:"/"+Te.path).toLowerCase();if((!ae||fe.includes(ae)||Ee.includes(ae))&&!a.has(Te.path)){let se=Te.path.startsWith("/")?Te.path:"/"+Te.path;ue.push(se)}for(let se of Te.children)se instanceof xv.TFolder&&ee(se)},q=n.vault.getRoot();ee(q);let Y=Z.trim();if(Y&&!ue.includes(Y)){let Te=Y.startsWith("/")?Y:"/"+Y;ue.unshift(`[Create] ${Te}`)}return ue.slice(0,100)}function k(){return Pe(this,void 0,void 0,function*(){t(2,f=g(m)),f.length>0?(t(4,p=!0),t(3,d=0),yield Zf()):L()})}function L(){t(4,p=!1),t(2,f=[]),t(3,d=-1)}function I(){if(!c||!u)return;let Z=c.getBoundingClientRect(),ae=window.innerWidth,ue=window.innerHeight;u.style.position="fixed",u.style.zIndex="9999";let ee=ae<768,q=40,Y=8,Te=Math.min(f.length*q+Y,ee?240:300);if(u.style.top="",u.style.bottom="",u.style.left="",u.style.right="",u.style.transform="",ee){let fe=ue-Z.bottom,Ee=Z.top;u.style.left="10px",u.style.right="10px",u.style.width="auto",fe<Te+10&&Ee>Te+10?(u.style.bottom=`${ue-Z.top+2}px`,u.style.maxHeight=`${Te}px`,u.style.height=""):(u.style.bottom=`${ue-Z.bottom-2}px`,u.style.maxHeight=`${Math.min(Te,fe-10)}px`,u.style.height="",u.style.transform="translateY(-100%)")}else{let fe=Math.max(Z.width,350),Ee=Math.min(fe,ae-Z.left-20);u.style.left=`${Z.left}px`,u.style.top=`${Z.bottom+2}px`,u.style.width=`${Ee}px`,u.style.maxHeight=`${Te}px`,u.style.height=""}}function C(Z){let ae=Z;Z.startsWith("[Create] ")&&(ae=Z.substring(9)),t(5,m=ae),t(12,s=ae),l("select",{value:ae}),L(),c==null||c.blur()}function A(Z){if(!p){(Z.key==="Enter"&&m.trim()||Z.key==="Tab"&&!Z.shiftKey&&m.trim())&&(Z.preventDefault(),C(m.trim()));return}switch(Z.key){case"ArrowDown":Z.preventDefault(),t(3,d=Math.min(d+1,f.length-1));break;case"ArrowUp":Z.preventDefault(),t(3,d=Math.max(d-1,-1));break;case"Enter":Z.preventDefault(),d>=0?C(f[d]):m.trim()&&C(m.trim());break;case"Escape":Z.preventDefault(),L();break;case"Tab":Z.shiftKey||(Z.preventDefault(),d>=0?C(f[d]):f.length>0?C(f[0]):m.trim()&&C(m.trim()));break}}function M(){y=!0,t(12,s=m),l("input",{value:m}),k()}function P(){!y&&m==="/"&&(t(5,m=""),t(12,s="")),t(2,f=g(m||"")),f.length>0&&(t(4,p=!0),t(3,d=0))}function O(Z){setTimeout(()=>{u!=null&&u.contains(document.activeElement)||L()},200)}function T(Z){C(Z)}function U(Z){!(c!=null&&c.contains(Z.target))&&!(u!=null&&u.contains(Z.target))&&L()}function j(){p&&I()}dt(()=>{document.addEventListener("click",U),window.addEventListener("resize",j)}),ns(()=>{document.removeEventListener("click",U),window.removeEventListener("resize",j)});function Q(Z){gr.call(this,o,Z)}function N(Z){_t[Z?"unshift":"push"](()=>{c=Z,t(1,c)})}function X(){m=this.value,t(5,m)}let $=Z=>T(Z),B=(Z,ae)=>ae.key==="Enter"&&T(Z),pe=Z=>t(3,d=Z);return o.$$set=Z=>{"app"in Z&&t(13,n=Z.app),"value"in Z&&t(12,s=Z.value),"placeholder"in Z&&t(0,i=Z.placeholder),"blockedPaths"in Z&&t(14,a=Z.blockedPaths)},[i,c,f,d,p,m,r,A,M,P,O,T,s,n,a,Q,N,X,$,B,pe]}var Gp=class extends K{constructor(e){super(),G(this,e,nA,rA,W,{app:13,value:12,placeholder:0,blockedPaths:14},XT,[-1,-1])}},wv=Gp;function sA(o){let e,t,r,n;function s(a){o[8](a)}let i={app:o[0],placeholder:o[2],blockedPaths:o[4]()};return o[3]!==void 0&&(i.value=o[3]),t=new wv({props:i}),_t.push(()=>Hl(t,"value",s)),t.$on("select",o[5]),{c(){e=S("div"),D(t.$$.fragment),h(e,"class","folder-select-input")},m(a,l){x(a,e,l),E(t,e,null),n=!0},p(a,[l]){let c={};l&1&&(c.app=a[0]),l&4&&(c.placeholder=a[2]),!r&&l&8&&(r=!0,c.value=a[3],Nl(()=>r=!1)),t.$set(c)},i(a){n||(b(t.$$.fragment,a),n=!0)},o(a){w(t.$$.fragment,a),n=!1},d(a){a&&_(e),R(t)}}}function iA(o,e,t){let r,n=z,s=()=>(n(),n=Rt(l,m=>t(7,r=m)),l);o.$$.on_destroy.push(()=>n());let{app:i}=e,{sharedFolders:a}=e,{selectedFolder:l}=e;s();let{placeholder:c="Choose or create folder..."}=e,u="";function f(){return new Set(a.filter(m=>!!m.relayId).map(m=>m.path))}function d(m){let y=m.detail.value;t(3,u=y),l.set(y)}function p(m){u=m,t(3,u),t(7,r)}return o.$$set=m=>{"app"in m&&t(0,i=m.app),"sharedFolders"in m&&t(6,a=m.sharedFolders),"selectedFolder"in m&&s(t(1,l=m.selectedFolder)),"placeholder"in m&&t(2,c=m.placeholder)},o.$$.update=()=>{if(o.$$.dirty&136){e:r&&r!==u&&t(3,u=r)}},[i,l,c,u,f,d,a,r,p]}var Jp=class extends K{constructor(e){super(),G(this,e,iA,sA,W,{app:0,sharedFolders:6,selectedFolder:1,placeholder:2})}},Sv=Jp;function aA(o){Le(o,"svelte-1cvg97u",".faint.svelte-1cvg97u.svelte-1cvg97u{color:var(--text-faint)}.breadcrumb-container.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:8px;overflow:hidden}.breadcrumb-item-wrapper.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:0.3em;min-width:0}.breadcrumb-item.svelte-1cvg97u.svelte-1cvg97u{display:flex;align-items:center;gap:0.3em;cursor:pointer;min-width:0}.breadcrumb-text.svelte-1cvg97u.svelte-1cvg97u{display:inline-block}@media(max-width: 768px){.breadcrumb-item-wrapper.svelte-1cvg97u.svelte-1cvg97u:last-child{flex:1;min-width:0;overflow:hidden}.middle-item.svelte-1cvg97u .breadcrumb-text.svelte-1cvg97u{display:none}.last-item.svelte-1cvg97u.svelte-1cvg97u{overflow:hidden}.last-item.svelte-1cvg97u .breadcrumb-text.svelte-1cvg97u{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}")}function kv(o,e,t){let r=o.slice();return r[6]=e[t],r[8]=t,r}function lA(o){let e,t;return e=new md({props:{size:16,class:"breadcrumb-separator"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Iv(o){let e,t,r;var n=o[2](o[6]);function s(i,a){return{props:{class:"svg-icon breadcrumb-icon"}}}return n&&(e=Ko(n,s(o))),{c(){e&&D(e.$$.fragment),t=me()},m(i,a){e&&E(e,i,a),x(i,t,a),r=!0},p(i,a){if(a&1&&n!==(n=i[2](i[6]))){if(e){oe();let l=e;w(l.$$.fragment,1,0,()=>{R(l,1)}),ne()}n?(e=Ko(n,s(i,a)),D(e.$$.fragment),b(e.$$.fragment,1),E(e,t.parentNode,t)):e=null}},i(i){r||(e&&b(e.$$.fragment,i),r=!0)},o(i){e&&w(e.$$.fragment,i),r=!1},d(i){i&&_(t),e&&R(e,i)}}}function cA(o){let e;function t(s,i){return s[6].remoteFolder.name?mA:pA}let r=t(o,-1),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function uA(o){let e=o[6].folder.name+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[6].folder.name+"")&&J(t,e)},d(r){r&&_(t)}}}function fA(o){let e;function t(s,i){return s[6].relay.name?gA:hA}let r=t(o,-1),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function dA(o){let e=o[6].text+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[6].text+"")&&J(t,e)},d(r){r&&_(t)}}}function pA(o){let e;return{c(){e=S("span"),e.textContent="(Untitled folder)",h(e,"class","faint svelte-1cvg97u")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function mA(o){let e=o[6].remoteFolder.name+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[6].remoteFolder.name+"")&&J(t,e)},d(r){r&&_(t)}}}function hA(o){let e;return{c(){e=S("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-1cvg97u")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function gA(o){let e=o[6].relay.name+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[6].relay.name+"")&&J(t,e)},d(r){r&&_(t)}}}function Cv(o){let e,t,r,n=o[2](o[6]),s,i,a,l,c,u,f,d=o[8]>0&&lA(o),p=n&&Iv(o);function m(I,C){if(I[6].type==="text")return dA;if(I[6].type==="relay")return fA;if(I[6].type==="folder")return uA;if(I[6].type==="remoteFolder")return cA}let y=m(o,-1),g=y&&y(o);function k(){return o[3](o[6])}function L(...I){return o[4](o[6],...I)}return{c(){d&&d.c(),e=F(),t=S("span"),r=S("span"),p&&p.c(),s=F(),i=S("span"),g&&g.c(),l=F(),h(i,"class","breadcrumb-text svelte-1cvg97u"),h(r,"tabindex","0"),h(r,"role","button"),h(r,"class",a="breadcrumb-item "+(o[8]===0?"first-item":"")+" "+(o[8]===o[0].length-1?"last-item":"")+" "+(o[8]>0&&o[8]<o[0].length-1?"middle-item":"")+" svelte-1cvg97u"),h(t,"class","breadcrumb-item-wrapper svelte-1cvg97u")},m(I,C){d&&d.m(I,C),x(I,e,C),x(I,t,C),v(t,r),p&&p.m(r,null),v(r,s),v(r,i),g&&g.m(i,null),v(t,l),c=!0,u||(f=[H(r,"click",k),H(r,"keypress",L)],u=!0)},p(I,C){o=I,C&1&&(n=o[2](o[6])),n?p?(p.p(o,C),C&1&&b(p,1)):(p=Iv(o),p.c(),b(p,1),p.m(r,s)):p&&(oe(),w(p,1,1,()=>{p=null}),ne()),y===(y=m(o,C))&&g?g.p(o,C):(g&&g.d(1),g=y&&y(o),g&&(g.c(),g.m(i,null))),(!c||C&1&&a!==(a="breadcrumb-item "+(o[8]===0?"first-item":"")+" "+(o[8]===o[0].length-1?"last-item":"")+" "+(o[8]>0&&o[8]<o[0].length-1?"middle-item":"")+" svelte-1cvg97u"))&&h(r,"class",a)},i(I){c||(b(d),b(p),c=!0)},o(I){w(d),w(p),c=!1},d(I){I&&(_(e),_(t)),d&&d.d(I),p&&p.d(),g&&g.d(),u=!1,Ie(f)}}}function Qp(o){let e,t,r=ke(o[0]),n=[];for(let i=0;i<r.length;i+=1)n[i]=Cv(kv(o,r,i));let s=i=>w(n[i],1,1,()=>{n[i]=null});return{c(){e=S(o[1]);for(let i=0;i<n.length;i+=1)n[i].c();db(o[1])(e,{class:"breadcrumb-container svelte-1cvg97u"})},m(i,a){x(i,e,a);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null);t=!0},p(i,a){if(a&5){r=ke(i[0]);let l;for(l=0;l<r.length;l+=1){let c=kv(i,r,l);n[l]?(n[l].p(c,a),b(n[l],1)):(n[l]=Cv(c),n[l].c(),b(n[l],1),n[l].m(e,null))}for(oe(),l=r.length;l<n.length;l+=1)s(l);ne()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)b(n[a]);t=!0}},o(i){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)w(n[a]);t=!1},d(i){i&&_(e),ze(n,i)}}}function yA(o){let e=o[1],t,r,n=o[1]&&Qp(o);return{c(){n&&n.c(),t=me()},m(s,i){n&&n.m(s,i),x(s,t,i)},p(s,[i]){s[1]?e?W(e,s[1])?(n.d(1),n=Qp(s),e=s[1],n.c(),n.m(t.parentNode,t)):n.p(s,i):(n=Qp(s),e=s[1],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=s[1])},i:z,o(s){w(n,s),r=!1},d(s){s&&_(t),n&&n.d(s)}}}function Lv(o){o.onClick&&o.onClick()}function bA(o,e,t){let{items:r}=e,{element:n="h4"}=e,s=Ye();function i(c){var u;switch(c.type){case"home":return Cd;case"relay":return Yo;case"folder":return to;case"remoteFolder":return!((u=c.remoteFolder)===null||u===void 0)&&u.private?as:_o;default:return null}}let a=c=>Lv(c),l=(c,u)=>{(u.key==="Enter"||u.key===" ")&&Lv(c)};return o.$$set=c=>{"items"in c&&t(0,r=c.items),"element"in c&&t(1,n=c.element)},[r,n,i,a,l]}var Yp=class extends K{constructor(e){super(),G(this,e,bA,yA,W,{items:0,element:1},aA)}},ko=Yp;function vA(o){Le(o,"svelte-1r8auw9",".folder-transformation.svelte-1r8auw9{display:flex;align-items:center;padding:8px 12px;background:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;gap:8px}.folder-transformation.readonly.svelte-1r8auw9{background:var(--background-secondary);border:1px solid var(--background-modifier-border)}.folder-state.svelte-1r8auw9{display:flex;align-items:center;gap:6px}.folder-name.svelte-1r8auw9{font-weight:500;color:var(--text-normal);white-space:nowrap}.clear-button.svelte-1r8auw9{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:16px;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:2px;margin-left:auto}.clear-button.svelte-1r8auw9:hover{background:var(--background-modifier-hover);color:var(--text-normal)}.folder-select-button.svelte-1r8auw9{width:100%;min-height:3em;text-align:left}")}function _A(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("button"),r=V(o[3]),h(t,"class","mod-cta folder-select-button svelte-1r8auw9"),h(e,"class","folder-suggest-container")},m(i,a){x(i,e,a),v(e,t),v(t,r),n||(s=H(t,"click",o[8]),n=!0)},p(i,a){a&8&&J(r,i[3])},i:z,o:z,d(i){i&&_(e),n=!1,s()}}}function xA(o){let e,t,r,n,s,i=[kA,SA,wA],a=[];function l(u,f){return u[6]?0:u[2]?1:2}t=l(o,-1),r=a[t]=i[t](o);let c=!o[4]&&Tv(o);return{c(){e=S("div"),r.c(),n=F(),c&&c.c(),h(e,"class","folder-transformation svelte-1r8auw9"),Me(e,"readonly",o[4])},m(u,f){x(u,e,f),a[t].m(e,null),v(e,n),c&&c.m(e,null),s=!0},p(u,f){let d=t;t=l(u,f),t===d?a[t].p(u,f):(oe(),w(a[d],1,1,()=>{a[d]=null}),ne(),r=a[t],r?r.p(u,f):(r=a[t]=i[t](u),r.c()),b(r,1),r.m(e,n)),u[4]?c&&(c.d(1),c=null):c?c.p(u,f):(c=Tv(u),c.c(),c.m(e,null)),(!s||f&16)&&Me(e,"readonly",u[4])},i(u){s||(b(r),s=!0)},o(u){w(r),s=!1},d(u){u&&_(e),a[t].d(),c&&c.d()}}}function wA(o){let e,t,r,n,s,i;return t=new _o({props:{class:"svg-icon folder-icon"}}),{c(){e=S("div"),D(t.$$.fragment),r=F(),n=S("span"),s=V(o[5]),h(n,"class","folder-name svelte-1r8auw9"),h(e,"class","folder-state svelte-1r8auw9")},m(a,l){x(a,e,l),E(t,e,null),v(e,r),v(e,n),v(n,s),i=!0},p(a,l){(!i||l&32)&&J(s,a[5])},i(a){i||(b(t.$$.fragment,a),i=!0)},o(a){w(t.$$.fragment,a),i=!1},d(a){a&&_(e),R(t)}}}function SA(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,y;t=new Sd({props:{class:"svg-icon folder-icon"}}),a=new ad({props:{class:"svg-icon arrow-icon"}});let g=[CA,IA],k=[];function L(I,C){return I[1]?0:1}return u=L(o,-1),f=k[u]=g[u](o),{c(){e=S("div"),D(t.$$.fragment),r=F(),n=S("span"),s=V(o[5]),i=F(),D(a.$$.fragment),l=F(),c=S("div"),f.c(),d=F(),p=S("span"),m=V(o[5]),h(n,"class","folder-name svelte-1r8auw9"),h(e,"class","folder-state svelte-1r8auw9"),h(p,"class","folder-name svelte-1r8auw9"),h(c,"class","folder-state svelte-1r8auw9")},m(I,C){x(I,e,C),E(t,e,null),v(e,r),v(e,n),v(n,s),x(I,i,C),E(a,I,C),x(I,l,C),x(I,c,C),k[u].m(c,null),v(c,d),v(c,p),v(p,m),y=!0},p(I,C){(!y||C&32)&&J(s,I[5]);let A=u;u=L(I,C),u!==A&&(oe(),w(k[A],1,1,()=>{k[A]=null}),ne(),f=k[u],f||(f=k[u]=g[u](I),f.c()),b(f,1),f.m(c,d)),(!y||C&32)&&J(m,I[5])},i(I){y||(b(t.$$.fragment,I),b(a.$$.fragment,I),b(f),y=!0)},o(I){w(t.$$.fragment,I),w(a.$$.fragment,I),w(f),y=!1},d(I){I&&(_(e),_(i),_(l),_(c)),R(t),R(a,I),k[u].d()}}}function kA(o){let e,t;return e=new ko({props:{element:"div",items:[{type:"relay",relay:o[0].relay},{type:"remoteFolder",remoteFolder:o[0]}]}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.items=[{type:"relay",relay:r[0].relay},{type:"remoteFolder",remoteFolder:r[0]}]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function IA(o){let e,t;return e=new _o({props:{class:"svg-icon folder-icon"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function CA(o){let e,t;return e=new as({props:{class:"svg-icon folder-icon"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Tv(o){let e,t,r;return{c(){e=S("button"),e.textContent="\xD7",h(e,"class","clear-button svelte-1r8auw9")},m(n,s){x(n,e,s),t||(r=H(e,"click",o[7]),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function LA(o){let e,t,r,n,s=[xA,_A],i=[];function a(l,c){return l[0]?0:1}return t=a(o,-1),r=i[t]=s[t](o),{c(){e=S("div"),r.c(),h(e,"class","folder-selector")},m(l,c){x(l,e,c),i[t].m(e,null),n=!0},p(l,[c]){let u=t;t=a(l,c),t===u?i[t].p(l,c):(oe(),w(i[u],1,1,()=>{i[u]=null}),ne(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),b(r,1),r.m(e,null))},i(l){n||(b(r),n=!0)},o(l){w(r),n=!1},d(l){l&&_(e),i[t].d()}}}function TA(o,e,t){let r,n,s,{selectedItem:i=void 0}=e,{isPrivate:a=!1}=e,{showTransformation:l=!1}=e,{selectButtonText:c="Choose a folder..."}=e,{readonly:u=!1}=e,f=Ye();function d(){f("clear")}function p(){f("select")}return o.$$set=m=>{"selectedItem"in m&&t(0,i=m.selectedItem),"isPrivate"in m&&t(1,a=m.isPrivate),"showTransformation"in m&&t(2,l=m.showTransformation),"selectButtonText"in m&&t(3,c=m.selectButtonText),"readonly"in m&&t(4,u=m.readonly)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(6,r=i&&typeof i=="object")}if(o.$$.dirty&1){e:t(9,n=typeof i=="string"?i:"")}if(o.$$.dirty&512){e:t(5,s=n?n.split("/").pop()||n:"")}},[i,a,l,c,u,s,r,d,p,n]}var Zp=class extends K{constructor(e){super(),G(this,e,TA,LA,W,{selectedItem:0,isPrivate:1,showTransformation:2,selectButtonText:3,readonly:4},vA)}},_a=Zp;function Av(o,e,t){let r=o.slice();return r[23]=e[t],r}function Mv(o,e,t){let r=o.slice();return r[26]=e[t],r[28]=t,r}var AA=o=>({item:o&8}),Fv=o=>({item:o[26],index:o[28]}),MA=o=>({item:o&8}),Pv=o=>({item:o[26],index:o[28]});function FA(o){let e=o[26]+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n&8&&e!==(e=r[26]+"")&&J(t,e)},d(r){r&&_(t)}}}function PA(o){let e;return{c(){e=S("div"),h(e,"class","suggestion-icon")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function Ev(o){let e,t,r,n,s,i,a,l,c,u,f=o[13].suggestion,d=ye(f,o,o[12],Pv),p=d||FA(o),m=o[13]["suggestion-aux"],y=ye(m,o,o[12],Fv),g=y||PA(o);function k(){return o[17](o[26])}function L(...C){return o[18](o[26],...C)}function I(){return o[19](o[28])}return{c(){e=S("div"),t=S("div"),r=S("div"),p&&p.c(),n=F(),s=S("div"),g&&g.c(),i=F(),h(r,"class","suggestion-title"),h(t,"class","suggestion-content"),h(s,"class","suggestion-aux"),h(e,"class","suggestion-item mod-complex"),h(e,"role","option"),h(e,"aria-selected",a=o[28]===o[4]),h(e,"tabindex","-1"),Me(e,"is-selected",o[28]===o[4])},m(C,A){x(C,e,A),v(e,t),v(t,r),p&&p.m(r,null),v(e,n),v(e,s),g&&g.m(s,null),v(e,i),l=!0,c||(u=[H(e,"mousedown",Rl(o[14])),H(e,"click",k),H(e,"keydown",L),H(e,"mouseenter",I)],c=!0)},p(C,A){o=C,d?d.p&&(!l||A&4104)&&ve(d,f,o,o[12],l?be(f,o[12],A,MA):_e(o[12]),Pv):p&&p.p&&(!l||A&8)&&p.p(o,l?A:-1),y&&y.p&&(!l||A&4104)&&ve(y,m,o,o[12],l?be(m,o[12],A,AA):_e(o[12]),Fv),(!l||A&16&&a!==(a=o[28]===o[4]))&&h(e,"aria-selected",a),(!l||A&16)&&Me(e,"is-selected",o[28]===o[4])},i(C){l||(b(p,C),b(g,C),l=!0)},o(C){w(p,C),w(g,C),l=!1},d(C){C&&_(e),p&&p.d(C),g&&g.d(C),c=!1,Ie(u)}}}function Rv(o){let e,t,r=o[23].command+"",n,s,i,a=o[23].purpose+"",l,c;return{c(){e=S("div"),t=S("span"),n=V(r),s=F(),i=S("span"),l=V(a),c=F(),h(t,"class","prompt-instruction-command"),h(e,"class","prompt-instruction")},m(u,f){x(u,e,f),v(e,t),v(t,n),v(e,s),v(e,i),v(i,l),v(e,c)},p(u,f){f&2&&r!==(r=u[23].command+"")&&J(n,r),f&2&&a!==(a=u[23].purpose+"")&&J(l,a)},d(u){u&&_(e)}}}function EA(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,y=ke(o[3]),g=[];for(let C=0;C<y.length;C+=1)g[C]=Ev(Mv(o,y,C));let k=C=>w(g[C],1,1,()=>{g[C]=null}),L=ke(o[1]),I=[];for(let C=0;C<L.length;C+=1)I[C]=Rv(Av(o,L,C));return{c(){e=S("div"),t=S("div"),r=S("input"),n=F(),s=S("div"),i=F(),a=S("div"),l=F(),c=S("div");for(let C=0;C<g.length;C+=1)g[C].c();u=F(),f=S("div");for(let C=0;C<I.length;C+=1)I[C].c();h(r,"type","text"),h(r,"placeholder",o[0]),h(r,"class","prompt-input"),h(r,"autocapitalize","off"),h(r,"spellcheck","false"),h(r,"enterkeyhint","done"),h(s,"class","prompt-input-cta"),h(a,"class","search-input-clear-button"),h(t,"class","prompt-input-container"),h(c,"class","prompt-results"),h(f,"class","prompt-instructions"),h(e,"class","prompt")},m(C,A){x(C,e,A),v(e,t),v(t,r),o[15](r),rt(r,o[5]),v(t,n),v(t,s),v(t,i),v(t,a),v(e,l),v(e,c);for(let M=0;M<g.length;M+=1)g[M]&&g[M].m(c,null);v(e,u),v(e,f);for(let M=0;M<I.length;M+=1)I[M]&&I[M].m(f,null);d=!0,p||(m=[H(r,"input",o[16]),H(r,"input",o[7]),H(r,"keydown",o[6])],p=!0)},p(C,[A]){if((!d||A&1)&&h(r,"placeholder",C[0]),A&32&&r.value!==C[5]&&rt(r,C[5]),A&4376){y=ke(C[3]);let M;for(M=0;M<y.length;M+=1){let P=Mv(C,y,M);g[M]?(g[M].p(P,A),b(g[M],1)):(g[M]=Ev(P),g[M].c(),b(g[M],1),g[M].m(c,null))}for(oe(),M=y.length;M<g.length;M+=1)k(M);ne()}if(A&2){L=ke(C[1]);let M;for(M=0;M<L.length;M+=1){let P=Av(C,L,M);I[M]?I[M].p(P,A):(I[M]=Rv(P),I[M].c(),I[M].m(f,null))}for(;M<I.length;M+=1)I[M].d(1);I.length=L.length}},i(C){if(!d){for(let A=0;A<y.length;A+=1)b(g[A]);d=!0}},o(C){g=g.filter(Boolean);for(let A=0;A<g.length;A+=1)w(g[A]);d=!1},d(C){C&&_(e),o[15](null),ze(g,C),ze(I,C),p=!1,Ie(m)}}}function RA(o,e,t){let{$$slots:r={},$$scope:n}=e,{placeholder:s="Search..."}=e,{autofocus:i=!1}=e,{onSelect:a=()=>{}}=e,{getSuggestions:l=()=>[]}=e,{instructions:c=[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Select"},{command:"Esc",purpose:"Cancel"}]}=e,u=Ye(),f,d=[],p=0,m="";function y(){t(3,d=l(m)),t(4,p=0)}function g(U){a(U),u("select",{item:U})}function k(U){switch(U.key){case"ArrowDown":U.preventDefault(),t(4,p=Math.min(p+1,d.length-1));break;case"ArrowUp":U.preventDefault(),t(4,p=Math.max(p-1,-1));break;case"Enter":U.preventDefault(),p>=0?g(d[p]):m.trim()&&d.length===0&&u("customInput",{value:m.trim()});break;case"Tab":U.shiftKey||(U.preventDefault(),p>=0?g(d[p]):d.length>0&&g(d[0]));break}}function L(){y(),u("input",{value:m})}function I(U){g(U)}dt(()=>{i&&f&&setTimeout(()=>{f.focus()},10),y()});function C(U){gr.call(this,o,U)}function A(U){_t[U?"unshift":"push"](()=>{f=U,t(2,f)})}function M(){m=this.value,t(5,m)}let P=U=>I(U),O=(U,j)=>j.key==="Enter"&&I(U),T=U=>t(4,p=U);return o.$$set=U=>{"placeholder"in U&&t(0,s=U.placeholder),"autofocus"in U&&t(9,i=U.autofocus),"onSelect"in U&&t(10,a=U.onSelect),"getSuggestions"in U&&t(11,l=U.getSuggestions),"instructions"in U&&t(1,c=U.instructions),"$$scope"in U&&t(12,n=U.$$scope)},[s,c,f,d,p,m,k,L,I,i,a,l,n,r,C,A,M,P,O,T]}var Xp=class extends K{constructor(e){super(),G(this,e,RA,EA,W,{placeholder:0,autofocus:9,onSelect:10,getSuggestions:11,instructions:1})}},dc=Xp;function DA(o){let e,t;return e=new ko({props:{element:"div",items:[{type:"relay",relay:o[5].relay},{type:"remoteFolder",remoteFolder:o[5]}]}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.items=[{type:"relay",relay:r[5].relay},{type:"remoteFolder",remoteFolder:r[5]}]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function UA(o){let e,t;return e=new dc({props:{placeholder:o[0],autofocus:o[1],onSelect:o[2],getSuggestions:o[3],instructions:[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Add folder to vault"},{command:"Esc",purpose:"Cancel"}],$$slots:{suggestion:[DA,({item:r})=>({5:r}),({item:r})=>r?32:0]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,[n]){let s={};n&1&&(s.placeholder=r[0]),n&2&&(s.autofocus=r[1]),n&4&&(s.onSelect=r[2]),n&96&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function OA(o,e,t){let{availableFolders:r}=e,{placeholder:n="Search folders..."}=e,{autofocus:s=!1}=e,{onSelect:i=()=>{}}=e;function a(l){let c=l.toLowerCase();return r.filter(f=>{var d;let p=(f.name||"").toLowerCase(),m=(((d=f.relay)===null||d===void 0?void 0:d.name)||"").toLowerCase();return!!f.relay.name&&f.name&&(p.includes(c)||m.includes(c))}).sort((f,d)=>{let p=`${f.relay.name} / ${f.name}`,m=`${d.relay.name} / ${d.name}`;return p.localeCompare(m)}).slice(0,100)}return o.$$set=l=>{"availableFolders"in l&&t(4,r=l.availableFolders),"placeholder"in l&&t(0,n=l.placeholder),"autofocus"in l&&t(1,s=l.autofocus),"onSelect"in l&&t(2,i=l.onSelect)},[n,s,i,a,r]}var em=class extends K{constructor(e){super(),G(this,e,OA,UA,W,{availableFolders:4,placeholder:0,autofocus:1,onSelect:2})}},Dv=em;var Uv=require("obsidian"),ui=class extends Uv.Modal{constructor(t,r,n,s){super(t);this.ComponentClass=r;this.componentProps=n;this.onSelect=s}onOpen(){let{modalEl:t}=this,r=t.closest(".modal-container");t.style.display="none";let n=r||t;this.component=new this.ComponentClass({target:n,props:{...this.componentProps,autofocus:!0,onSelect:s=>{this.onSelect(s),this.close()}}})}onClose(){var t;(t=this.component)==null||t.$destroy()}destroy(){this.onSelect=null,this.componentProps=null,this.ComponentClass=null}};var pc=class extends ui{constructor(e,t,r){super(e,Dv,{availableFolders:t,placeholder:"Search folders..."},r)}};function $A(o){Le(o,"svelte-djtxkf","span.error.svelte-djtxkf{flex:auto;align-content:center}.section.svelte-djtxkf{margin-bottom:24px}")}function Ov(o){let e,t,r,n,s;return t=new qe({props:{name:"Remote folder"}}),n=new _a({props:{selectedItem:o[5],selectButtonText:"Choose a folder..."}}),n.$on("clear",o[12]),n.$on("select",o[13]),{c(){e=S("div"),D(t.$$.fragment),r=F(),D(n.$$.fragment),h(e,"class","section svelte-djtxkf")},m(i,a){x(i,e,a),E(t,e,null),v(e,r),E(n,e,null),s=!0},p(i,a){let l={};a&32&&(l.selectedItem=i[5]),n.$set(l)},i(i){s||(b(t.$$.fragment,i),b(n.$$.fragment,i),s=!0)},o(i){w(t.$$.fragment,i),w(n.$$.fragment,i),s=!1},d(i){i&&_(e),R(t),R(n)}}}function NA(o){let e,t,r,n;return{c(){e=S("input"),h(e,"type","text"),e.disabled=t=!o[5]},m(s,i){x(s,e,i),rt(e,o[6]),r||(n=H(e,"input",o[14]),r=!0)},p(s,i){i&32&&t!==(t=!s[5])&&(e.disabled=t),i&64&&e.value!==s[6]&&rt(e,s[6])},d(s){s&&_(e),r=!1,n()}}}function BA(o){let e,t;return e=new Sv({props:{app:o[0],sharedFolders:o[3],selectedFolder:o[9]}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&8&&(s.sharedFolders=r[3]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function $v(o){let e,t;return{c(){e=S("span"),t=V(o[7]),h(e,"class","mod-warning error svelte-djtxkf")},m(r,n){x(r,e,n),v(e,t)},p(r,n){n&128&&J(t,r[7])},d(r){r&&_(e)}}}function VA(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,y,g,k=!o[1]&&o[2].length>0&&Ov(o);s=new Oe({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[NA]},$$scope:{ctx:o}}}),a=new Oe({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[BA]},$$scope:{ctx:o}}});let L=o[7]&&$v(o);return{c(){e=S("div"),e.textContent="Add to vault",t=F(),r=S("div"),k&&k.c(),n=F(),D(s.$$.fragment),i=F(),D(a.$$.fragment),l=F(),c=S("div"),L&&L.c(),u=F(),f=S("button"),d=V("Confirm"),h(e,"class","modal-title"),h(f,"class","mod-cta"),f.disabled=p=!o[5]||!o[6].trim(),h(c,"class","modal-button-container"),h(r,"class","modal-content")},m(I,C){x(I,e,C),x(I,t,C),x(I,r,C),k&&k.m(r,null),v(r,n),E(s,r,null),v(r,i),E(a,r,null),v(r,l),v(r,c),L&&L.m(c,null),v(c,u),v(c,f),v(f,d),m=!0,y||(g=H(f,"click",function(){Qe((0,tm.debounce)(o[15]))&&(0,tm.debounce)(o[15]).apply(this,arguments)}),y=!0)},p(I,[C]){o=I,!o[1]&&o[2].length>0?k?(k.p(o,C),C&6&&b(k,1)):(k=Ov(o),k.c(),b(k,1),k.m(r,n)):k&&(oe(),w(k,1,1,()=>{k=null}),ne());let A={};C&65632&&(A.$$scope={dirty:C,ctx:o}),s.$set(A);let M={};C&65545&&(M.$$scope={dirty:C,ctx:o}),a.$set(M),o[7]?L?L.p(o,C):(L=$v(o),L.c(),L.m(c,u)):L&&(L.d(1),L=null),(!m||C&96&&p!==(p=!o[5]||!o[6].trim()))&&(f.disabled=p)},i(I){m||(b(k),b(s.$$.fragment,I),b(a.$$.fragment,I),m=!0)},o(I){w(k),w(s.$$.fragment,I),w(a.$$.fragment,I),m=!1},d(I){I&&(_(e),_(t),_(r)),k&&k.d(),R(s),R(a),L&&L.d(),y=!1,g()}}}function HA(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{availableFolders:i=[]}=e,{sharedFolders:a}=e,{onConfirm:l}=e,c=s,u=(s==null?void 0:s.name)||"",f=Ce("/");ce(o,f,I=>t(8,r=I));let d="",p=s,m=new pc(n,i,I=>{t(5,c=I)});dt(()=>{!s&&i.length>0&&setTimeout(()=>{m.open()},100)}),ns(()=>{m.close(),m.destroy()});let y=()=>{t(5,c=void 0),t(6,u="")},g=()=>{m.open()};function k(){u=this.value,t(6,u),t(5,c),t(11,p)}let L=async()=>{if(!c){t(7,d="Please select a remote folder");return}if(!u.trim()){t(7,d="Please enter a folder name");return}l(c,u,r||"/").catch(I=>{t(7,d=I.message)})};return o.$$set=I=>{"app"in I&&t(0,n=I.app),"remoteFolder"in I&&t(1,s=I.remoteFolder),"availableFolders"in I&&t(2,i=I.availableFolders),"sharedFolders"in I&&t(3,a=I.sharedFolders),"onConfirm"in I&&t(4,l=I.onConfirm)},o.$$.update=()=>{if(o.$$.dirty&2080){e:c!==p&&(c&&t(6,u=c.name||""),t(11,p=c))}},[n,s,i,a,l,c,u,d,r,f,m,p,y,g,k,L]}var rm=class extends K{constructor(e){super(),G(this,e,HA,VA,W,{app:0,remoteFolder:1,availableFolders:2,sharedFolders:3,onConfirm:4},$A)}},Nv=rm;var Mn=class extends Bv.Modal{constructor(t,r,n,s,i){super(t);this.sharedFolders=r;this.remoteFolder=n;this.availableFolders=s;this.onConfirm=i;this.onConfirm=i}onOpen(){let{contentEl:t}=this;this.component=new Nv({target:t,props:{remoteFolder:this.remoteFolder,availableFolders:this.availableFolders,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy(),this.onConfirm=null,this.sharedFolders=null,this.remoteFolder=void 0,this.availableFolders.length=0}};var e_=require("obsidian"),t_=ln($n());function qA(o){Le(o,"svelte-zmx7zz","span.faint.svelte-zmx7zz{color:var(--text-faint)}div.spacer.svelte-zmx7zz{height:3em}")}function Vv(o,e,t){let r=o.slice();return r[35]=e[t],r}function Hv(o,e,t){let r=o.slice();return r[38]=e[t],r[39]=e,r[40]=t,r}function qv(o,e,t){let r=o.slice();return r[41]=e[t],r}function zv(o,e,t){let r=o.slice();return r[44]=e[t],r}function zA(o){let e,t,r,n,s,i,a,l;function c(f){o[20](f)}let u={disabled:o[6],placeholder:"Enter share key",readonly:!1,copyOnClick:!1,invalid:o[5]};return o[4]!==void 0&&(u.value=o[4]),e=new fc({props:u}),_t.push(()=>Hl(e,"value",c)),e.$on("input",o[16]),e.$on("enter",function(){Qe((0,sr.debounce)(o[21]))&&(0,sr.debounce)(o[21]).apply(this,arguments)}),{c(){D(e.$$.fragment),r=F(),n=S("button"),s=V("Join"),h(n,"class","mod-cta"),n.disabled=o[6]},m(f,d){E(e,f,d),x(f,r,d),x(f,n,d),v(n,s),i=!0,a||(l=H(n,"click",function(){Qe((0,sr.debounce)(o[22]))&&(0,sr.debounce)(o[22]).apply(this,arguments)}),a=!0)},p(f,d){o=f;let p={};d[0]&64&&(p.disabled=o[6]),d[0]&32&&(p.invalid=o[5]),!t&&d[0]&16&&(t=!0,p.value=o[4],Nl(()=>t=!1)),e.$set(p),(!i||d[0]&64)&&(n.disabled=o[6])},i(f){i||(b(e.$$.fragment,f),i=!0)},o(f){w(e.$$.fragment,f),i=!1},d(f){f&&(_(r),_(n)),R(e,f),a=!1,l()}}}function jA(o){let e;return{c(){e=S("span"),e.textContent="Relay Servers",h(e,"slot","name"),he(e,"display","inline-flex"),he(e,"align-items","center")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function WA(o){let e,t;function r(){return o[24](o[44])}return e=new ps({}),e.$on("settings",r),{c(){D(e.$$.fragment)},m(n,s){E(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function KA(o){let e;return{c(){e=S("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function GA(o){let e=o[44].name+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&256&&e!==(e=r[44].name+"")&&J(t,e)},d(r){r&&_(t)}}}function JA(o){let e;function t(s,i){return s[44].name?GA:KA}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function QA(o){let e,t;return e=new ba({props:{slot:"name",relay:o[44],$$slots:{default:[JA]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[23]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.relay=r[44]),n[0]&256|n[1]&65536&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function jv(o){let e,t;return e=new At({props:{$$slots:{name:[QA],default:[WA]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&256|n[1]&65536&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function YA(o){let e,t,r;return{c(){e=S("button"),e.textContent="Create",h(e,"class","mod-cta")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,sr.debounce)(o[25])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function Wv(o){let e,t;return e=new Oe({props:{description:"No shared folders on this device. Share folders from a Relay Server's settings page to begin collaboration."}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function ZA(o){let e,t;function r(){return o[30](o[41])}return e=new ps({}),e.$on("settings",function(){Qe((0,sr.debounce)(r))&&(0,sr.debounce)(r).apply(this,arguments)}),{c(){D(e.$$.fragment)},m(n,s){E(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function XA(o){let e,t;function r(){return o[29](o[41])}return e=new ps({}),e.$on("settings",function(){Qe((0,sr.debounce)(r))&&(0,sr.debounce)(r).apply(this,arguments)}),{c(){D(e.$$.fragment)},m(n,s){E(e,n,s),t=!0},p(n,s){o=n},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function eM(o){let e,t,r,n,s=[XA,ZA],i=[];function a(l,c){return l[41].remote?0:1}return e=a(o,[-1,-1]),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?i[e].p(l,c):(oe(),w(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){w(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function tM(o){let e,t;return e=new yv({props:{folder:o[41],slot:"name"}}),e.$on("manageSharedFolder",o[26]),e.$on("manageRemoteFolder",o[27]),e.$on("manageRelay",o[28]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.folder=r[41]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Kv(o){let e,t;return e=new At({props:{$$slots:{name:[tM],default:[eM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&384|n[1]&65536&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function rM(o){let e,t,r;return{c(){e=S("button"),e.textContent="Add folder",h(e,"class","mod-cta"),h(e,"aria-label","Add shared folder to vault"),he(e,"max-width","8em")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,sr.debounce)(o[19])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function Gv(o){let e,t,r,n,s,i;r=new qe({props:{name:"Subscriptions",helpText:"Subscriptions are tied to each Relay Server, not to your user account. Modify and cancel your subscription via our payment processor Stripe."}});let a=ke(o[9].values()),l=[];for(let u=0;u<a.length;u+=1)l[u]=Jv(Hv(o,a,u));let c=u=>w(l[u],1,1,()=>{l[u]=null});return{c(){e=S("div"),t=F(),D(r.$$.fragment),n=F();for(let u=0;u<l.length;u+=1)l[u].c();s=me(),h(e,"class","spacer svelte-zmx7zz")},m(u,f){x(u,e,f),x(u,t,f),E(r,u,f),x(u,n,f);for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(u,f);x(u,s,f),i=!0},p(u,f){if(f[0]&8705){a=ke(u[9].values());let d;for(d=0;d<a.length;d+=1){let p=Hv(u,a,d);l[d]?(l[d].p(p,f),b(l[d],1)):(l[d]=Jv(p),l[d].c(),b(l[d],1),l[d].m(s.parentNode,s))}for(oe(),d=a.length;d<l.length;d+=1)c(d);ne()}},i(u){if(!i){b(r.$$.fragment,u);for(let f=0;f<a.length;f+=1)b(l[f]);i=!0}},o(u){w(r.$$.fragment,u),l=l.filter(Boolean);for(let f=0;f<l.length;f+=1)w(l[f]);i=!1},d(u){u&&(_(e),_(t),_(n),_(s)),R(r,u),ze(l,u)}}}function oM(o){let e,t,r,n;function s(){return o[32](o[38],o[39],o[40])}return{c(){e=S("button"),e.textContent="Manage",t=F()},m(i,a){x(i,e,a),x(i,t,a),r||(n=H(e,"click",function(){Qe((0,sr.debounce)(s))&&(0,sr.debounce)(s).apply(this,arguments)}),r=!0)},p(i,a){o=i},d(i){i&&(_(e),_(t)),r=!1,n()}}}function nM(o){let e;return{c(){e=S("span"),e.textContent="(Untitled Relay Server)",h(e,"class","faint svelte-zmx7zz")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function sM(o){let e=o[38].relay.name+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[38].relay.name+"")&&J(t,e)},d(r){r&&_(t)}}}function iM(o){let e;function t(s,i){return s[38].relay.name?sM:nM}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=F()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function aM(o){let e,t;return e=new ba({props:{slot:"name",relay:o[38].relay,$$slots:{default:[iM]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[31]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.relay=r[38].relay),n[0]&512|n[1]&65536&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Jv(o){let e,t;return e=new At({props:{name:"",description:o[38].cancelAt?o[13](o[38].cancelAt):"",$$slots:{name:[aM],default:[oM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&512&&(s.description=r[38].cancelAt?r[13](r[38].cancelAt):""),n[0]&513|n[1]&65536&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function lM(o){let e,t,r=o[10].values().length===0,n,s,i;e=new qe({props:{name:"Hosts",helpText:"Manage self-hosted Relay Servers"}});let a=r&&Qv(o),l=ke(o[10].values()),c=[];for(let f=0;f<l.length;f+=1)c[f]=Yv(Vv(o,l,f));let u=f=>w(c[f],1,1,()=>{c[f]=null});return{c(){D(e.$$.fragment),t=F(),a&&a.c(),n=F();for(let f=0;f<c.length;f+=1)c[f].c();s=me()},m(f,d){E(e,f,d),x(f,t,d),a&&a.m(f,d),x(f,n,d);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(f,d);x(f,s,d),i=!0},p(f,d){if(d[0]&1024&&(r=f[10].values().length===0),r?a?d[0]&1024&&b(a,1):(a=Qv(f),a.c(),b(a,1),a.m(n.parentNode,n)):a&&(oe(),w(a,1,1,()=>{a=null}),ne()),d[0]&1024){l=ke(f[10].values());let p;for(p=0;p<l.length;p+=1){let m=Vv(f,l,p);c[p]?(c[p].p(m,d),b(c[p],1)):(c[p]=Yv(m),c[p].c(),b(c[p],1),c[p].m(s.parentNode,s))}for(oe(),p=l.length;p<c.length;p+=1)u(p);ne()}},i(f){if(!i){b(e.$$.fragment,f),b(a);for(let d=0;d<l.length;d+=1)b(c[d]);i=!0}},o(f){w(e.$$.fragment,f),w(a),c=c.filter(Boolean);for(let d=0;d<c.length;d+=1)w(c[d]);i=!1},d(f){f&&(_(t),_(n),_(s)),R(e,f),a&&a.d(f),ze(c,f)}}}function Qv(o){let e,t;return e=new Oe({props:{description:"See our documentation for how to host a Relay Server."}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Yv(o){var r,n;let e,t;return e=new At({props:{name:(r=o[35])==null?void 0:r.name,description:(n=o[35])==null?void 0:n.url}}),{c(){D(e.$$.fragment)},m(s,i){E(e,s,i),t=!0},p(s,i){var l,c;let a={};i[0]&1024&&(a.name=(l=s[35])==null?void 0:l.name),i[0]&1024&&(a.description=(c=s[35])==null?void 0:c.url),e.$set(a)},i(s){t||(b(e.$$.fragment,s),t=!0)},o(s){w(e.$$.fragment,s),t=!1},d(s){R(e,s)}}}function cM(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[7].items().length===0,p,m,y,g,k=o[3].values().length>0,L,I=je().enableSelfManageHosts,C,A;e=new qe({props:{name:"Join a Relay Server"}}),r=new Oe({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[zA]},$$scope:{ctx:o}}}),s=new qe({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[jA]},$$scope:{ctx:o}}});let M=ke(o[8].values().filter(Hp).sort(Zv)),P=[];for(let $=0;$<M.length;$+=1)P[$]=jv(zv(o,M,$));let O=$=>w(P[$],1,1,()=>{P[$]=null});l=new Oe({props:{name:"",description:"",$$slots:{default:[YA]},$$scope:{ctx:o}}}),u=new qe({props:{name:"My vault",helpText:"The following Shared Folders have been added to your vault. You can see what Relay Server a Shared Folder is connected to below."}});let T=d&&Wv(o),U=ke(o[7].items().sort(Xv)),j=[];for(let $=0;$<U.length;$+=1)j[$]=Kv(qv(o,U,$));let Q=$=>w(j[$],1,1,()=>{j[$]=null});y=new At({props:{name:"",$$slots:{default:[rM]},$$scope:{ctx:o}}});let N=k&&Gv(o),X=I&&lM(o);return{c(){D(e.$$.fragment),t=F(),D(r.$$.fragment),n=F(),D(s.$$.fragment),i=F();for(let $=0;$<P.length;$+=1)P[$].c();a=F(),D(l.$$.fragment),c=F(),D(u.$$.fragment),f=F(),T&&T.c(),p=F();for(let $=0;$<j.length;$+=1)j[$].c();m=F(),D(y.$$.fragment),g=F(),N&&N.c(),L=F(),X&&X.c(),C=me()},m($,B){E(e,$,B),x($,t,B),E(r,$,B),x($,n,B),E(s,$,B),x($,i,B);for(let pe=0;pe<P.length;pe+=1)P[pe]&&P[pe].m($,B);x($,a,B),E(l,$,B),x($,c,B),E(u,$,B),x($,f,B),T&&T.m($,B),x($,p,B);for(let pe=0;pe<j.length;pe+=1)j[pe]&&j[pe].m($,B);x($,m,B),E(y,$,B),x($,g,B),N&&N.m($,B),x($,L,B),X&&X.m($,B),x($,C,B),A=!0},p($,B){let pe={};B[0]&112|B[1]&65536&&(pe.$$scope={dirty:B,ctx:$}),r.$set(pe);let Z={};if(B[1]&65536&&(Z.$$scope={dirty:B,ctx:$}),s.$set(Z),B[0]&4352){M=ke($[8].values().filter(Hp).sort(Zv));let ee;for(ee=0;ee<M.length;ee+=1){let q=zv($,M,ee);P[ee]?(P[ee].p(q,B),b(P[ee],1)):(P[ee]=jv(q),P[ee].c(),b(P[ee],1),P[ee].m(a.parentNode,a))}for(oe(),ee=M.length;ee<P.length;ee+=1)O(ee);ne()}let ae={};if(B[1]&65536&&(ae.$$scope={dirty:B,ctx:$}),l.$set(ae),B[0]&128&&(d=$[7].items().length===0),d?T?B[0]&128&&b(T,1):(T=Wv($),T.c(),b(T,1),T.m(p.parentNode,p)):T&&(oe(),w(T,1,1,()=>{T=null}),ne()),B[0]&49536){U=ke($[7].items().sort(Xv));let ee;for(ee=0;ee<U.length;ee+=1){let q=qv($,U,ee);j[ee]?(j[ee].p(q,B),b(j[ee],1)):(j[ee]=Kv(q),j[ee].c(),b(j[ee],1),j[ee].m(m.parentNode,m))}for(oe(),ee=U.length;ee<j.length;ee+=1)Q(ee);ne()}let ue={};B[1]&65536&&(ue.$$scope={dirty:B,ctx:$}),y.$set(ue),B[0]&8&&(k=$[3].values().length>0),k?N?(N.p($,B),B[0]&8&&b(N,1)):(N=Gv($),N.c(),b(N,1),N.m(L.parentNode,L)):N&&(oe(),w(N,1,1,()=>{N=null}),ne()),I&&X.p($,B)},i($){if(!A){b(e.$$.fragment,$),b(r.$$.fragment,$),b(s.$$.fragment,$);for(let B=0;B<M.length;B+=1)b(P[B]);b(l.$$.fragment,$),b(u.$$.fragment,$),b(T);for(let B=0;B<U.length;B+=1)b(j[B]);b(y.$$.fragment,$),b(N),b(X),A=!0}},o($){w(e.$$.fragment,$),w(r.$$.fragment,$),w(s.$$.fragment,$),P=P.filter(Boolean);for(let B=0;B<P.length;B+=1)w(P[B]);w(l.$$.fragment,$),w(u.$$.fragment,$),w(T),j=j.filter(Boolean);for(let B=0;B<j.length;B+=1)w(j[B]);w(y.$$.fragment,$),w(N),w(X),A=!1},d($){$&&(_(t),_(n),_(i),_(a),_(c),_(f),_(p),_(m),_(g),_(L),_(C)),R(e,$),R(r,$),R(s,$),ze(P,$),R(l,$),R(u,$),T&&T.d($),ze(j,$),R(y,$),N&&N.d($),X&&X.d($)}}}function Zv(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function Xv(o,e){return o.remote&&!e.remote?-1:e.remote&&!o.remote||o.name>e.name?1:-1}function uM(o,e,t){let r,n,s=z,i=()=>(s(),s=Rt(m,se=>t(8,n=se)),m),a,l=z,c=()=>(l(),l=Rt(g,se=>t(9,a=se)),g),u,f=z,d=()=>(f(),f=Rt(y,se=>t(10,u=se)),y);o.$$.on_destroy.push(()=>s()),o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>f());let{plugin:p}=e,{relays:m}=e;i();let{providers:y}=e;d();let{subscriptions:g}=e;c();let k=p.sharedFolders;ce(o,k,se=>t(7,r=se));let L="",I=!1,C=!1,A=Ye();function M(se){se&&A("manageRelay",{relay:se})}function P(se){if(!se)return"Active";let Ae=om.moment.utc(),we=om.moment.utc(se),Ve=we.diff(Ae,"days");return Ve<=0?"Subscription has ended":Ve===1?"Active for 1 more day":Ve>31?`Ends on ${we.format("YYYY-MM-DD")}`:`Active for ${Ve} more days`}function O(se,Ae){se&&A("manageSharedFolder",{folder:se,relay:Ae})}function T(se){se&&A("manageRemoteFolder",{remoteFolder:se})}function U(){t(5,I=!1)}function j(se){return Pe(this,void 0,void 0,function*(){try{t(6,C=!0);let Ae=yield p.relayManager.acceptInvitation(se).catch(we=>{throw we.status===429&&new sr.Notice("Slow down"),we});t(6,C=!1),A("joinRelay",{relay:Ae})}catch(Ae){t(5,I=!0),t(6,C=!1)}})}function Q(){A("createRelay")}function N(se,Ae,we){return Pe(this,void 0,void 0,function*(){let Ve=(0,e_.normalizePath)((0,t_.join)(we,Ae));p.app.vault.getFolderByPath(Ve)===null&&(yield p.app.vault.createFolder(Ve));let ut=p.sharedFolders.new(Ve,se.guid,se.relay.guid);return ut.remote=se,ut})}function X(){let se=[];n.values().forEach(we=>{we.folders&&we.folders.values().forEach(Ve=>{r.items().some(Zt=>{var Kt;return((Kt=Zt.remote)===null||Kt===void 0?void 0:Kt.id)===Ve.id})||se.push(Ve)})}),new Mn(p.app,p.sharedFolders,void 0,se,N).open()}function $(se){L=se,t(4,L)}let B=()=>j(L),pe=()=>j(L);function Z(se){gr.call(this,o,se)}let ae=se=>{M(se)},ue=()=>Q();function ee(se){gr.call(this,o,se)}function q(se){gr.call(this,o,se)}function Y(se){gr.call(this,o,se)}let Te=se=>{T(se.remote)},fe=se=>{let Ae=n.values().find(we=>{var Ve;return((Ve=se.remote)==null?void 0:Ve.relay.guid)===we.guid});O(se,Ae)};function Ee(se){gr.call(this,o,se)}let xe=async(se,Ae,we)=>{if(!se.token){let Zt=await p.relayManager.getSubscriptionToken(se);Qs(g,Ae[we].token=Zt,a)}let Ve=se.id,ut=se.token;window.open(p.buildApiUrl(`/subscriptions/${Ve}/manage?token=${ut}`),"_blank")};return o.$$set=se=>{"plugin"in se&&t(0,p=se.plugin),"relays"in se&&i(t(1,m=se.relays)),"providers"in se&&d(t(2,y=se.providers)),"subscriptions"in se&&c(t(3,g=se.subscriptions))},[p,m,y,g,L,I,C,r,n,a,u,k,M,P,O,T,U,j,Q,X,$,B,pe,Z,ae,ue,ee,q,Y,Te,fe,Ee,xe]}var nm=class extends K{constructor(e){super(),G(this,e,uM,cM,W,{plugin:0,relays:1,providers:2,subscriptions:3},qA,[-1,-1])}},Io=nm;var It=require("obsidian");var $_=ln($n());function fM(o){Le(o,"svelte-15ov1wm",".lock-icon.svelte-15ov1wm{width:16px;height:16px;opacity:0.5;display:flex;align-items:center;justify-content:center}")}function dM(o){let e,t,r;return t=new Md({props:{class:"svg-icon"}}),{c(){e=S("span"),D(t.$$.fragment),h(e,"class","lock-icon svelte-15ov1wm")},m(n,s){x(n,e,s),E(t,e,null),r=!0},p:z,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){w(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}var sm=class extends K{constructor(e){super(),G(this,e,null,dM,W,{},fM)}},mc=sm;function pM(o){Le(o,"svelte-1ezpbya",'.system3-disk-usage-container.svelte-1ezpbya{width:100%;background-color:var(--interactive-normal);overflow:hidden}.system3-disk-usage-bar.svelte-1ezpbya{height:0.5rem;background-color:var(--color-accent);transition:width 0.6s ease}.system3-disk-usage-report.svelte-1ezpbya{text-align:center}.system3-disk-usage-bar[data-state="warning"].svelte-1ezpbya{height:0.3rem;background-color:var(--red);transition:width 0.6s ease}')}function mM(o){let e,t,r,n,s,i;return{c(){e=S("div"),t=S("div"),n=F(),s=S("div"),i=V(o[1]),h(t,"class","system3-disk-usage-bar svelte-1ezpbya"),he(t,"width",o[0]+"%"),h(t,"data-state",r=o[0]>90?"warning":""),h(e,"class","system3-disk-usage-container svelte-1ezpbya"),h(s,"class","system3-disk-usage-report svelte-1ezpbya")},m(a,l){x(a,e,l),v(e,t),x(a,n,l),x(a,s,l),v(s,i)},p(a,[l]){l&1&&he(t,"width",a[0]+"%"),l&1&&r!==(r=a[0]>90?"warning":"")&&h(t,"data-state",r),l&2&&J(i,a[1])},i:z,o:z,d(a){a&&(_(e),_(n),_(s))}}}function hM(o,e,t){let{diskUsagePercentage:r=0}=e,{text:n=""}=e;return r=Math.max(0,r),r=Math.min(100,r),o.$$set=s=>{"diskUsagePercentage"in s&&t(0,r=s.diskUsagePercentage),"text"in s&&t(1,n=s.text)},[r,n]}var im=class extends K{constructor(e){super(),G(this,e,hM,mM,W,{diskUsagePercentage:0,text:1},pM)}},r_=im;var d_=require("obsidian");var o_=require("obsidian");function gM(o){Le(o,"svelte-pb1sr8",".suggestion-create-prefix.svelte-pb1sr8{color:var(--text-muted);font-style:italic}.suggestion-action.svelte-pb1sr8{color:var(--text-muted);font-size:var(--font-smaller)}.suggestion-icon.svelte-pb1sr8{display:flex;align-items:center}.system3-svg-icon{color:var(--text-muted);opacity:0.6}")}function yM(o){let e=o[10].path+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n&1024&&e!==(e=r[10].path+"")&&J(t,e)},d(r){r&&_(t)}}}function bM(o){let e,t=o[10].path+"",r;return{c(){e=S("span"),e.textContent="Create: ",r=V(t),h(e,"class","suggestion-create-prefix svelte-pb1sr8")},m(n,s){x(n,e,s),x(n,r,s)},p(n,s){s&1024&&t!==(t=n[10].path+"")&&J(r,t)},d(n){n&&(_(e),_(r))}}}function vM(o){let e;function t(s,i){return s[10].isCreate?bM:yM}let r=t(o,-1),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function _M(o){let e;return{c(){e=S("div"),h(e,"class","suggestion-icon svelte-pb1sr8")},m(t,r){x(t,e,r)},i:z,o:z,d(t){t&&_(e)}}}function xM(o){let e,t,r;return t=new to({props:{class:"system3-svg-icon",size:16}}),{c(){e=S("div"),D(t.$$.fragment),h(e,"class","suggestion-icon svelte-pb1sr8")},m(n,s){x(n,e,s),E(t,e,null),r=!0},i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){w(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}function wM(o){let e;return{c(){e=S("span"),e.textContent="Enter to create",h(e,"class","suggestion-action svelte-pb1sr8")},m(t,r){x(t,e,r)},i:z,o:z,d(t){t&&_(e)}}}function SM(o){let e,t,r,n,s=[wM,xM,_M],i=[];function a(l,c){return l[10].isCreate?0:l[10].isShared&&!l[10].hasRelay?1:2}return e=a(o,-1),t=i[e]=s[e](o),{c(){t.c(),r=me()},m(l,c){i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e!==u&&(oe(),w(i[u],1,1,()=>{i[u]=null}),ne(),t=i[e],t||(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r))},i(l){n||(b(t),n=!0)},o(l){w(t),n=!1},d(l){l&&_(r),i[e].d(l)}}}function kM(o){let e,t;return e=new dc({props:{placeholder:o[0],autofocus:o[1],onSelect:o[3],getSuggestions:o[2],instructions:[{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}],$$slots:{"suggestion-aux":[SM,({item:r})=>({10:r}),({item:r})=>r?1024:0],suggestion:[vM,({item:r})=>({10:r}),({item:r})=>r?1024:0]},$$scope:{ctx:o}}}),e.$on("customInput",o[9]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,[n]){let s={};n&1&&(s.placeholder=r[0]),n&2&&(s.autofocus=r[1]),n&3072&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function IM(o,e,t){let{app:r}=e,{placeholder:n="Choose or create folder..."}=e,{blockedPaths:s=new Set}=e,{sharedFolders:i}=e,{autofocus:a=!1}=e,{onSelect:l=()=>{}}=e;function c(p){let m=new Map;i&&i.forEach(A=>{m.set(A.path,!!A.relayId)});let y=p.toLowerCase(),g=[],k=new Set,L=A=>{if(!(s.has(A.path)&&A.path!=="/")){if((!y||A.path.toLowerCase().includes(y))&&!s.has(A.path)){let M=m.has(A.path),P=m.get(A.path)||!1;g.push({path:A.path,isCreate:!1,isShared:M,hasRelay:P}),k.add(A.path.toLowerCase())}for(let M of A.children)M instanceof o_.TFolder&&L(M)}},I=r.vault.getRoot();L(I);let C=p.trim();return C&&!k.has(C.toLowerCase())&&g.unshift({path:C,isCreate:!0,isShared:!1,hasRelay:!1}),g.sort((A,M)=>A.isCreate&&!M.isCreate?-1:!A.isCreate&&M.isCreate?1:A.isShared&&!A.hasRelay&&(!M.isShared||M.hasRelay)?-1:M.isShared&&!M.hasRelay&&(!A.isShared||A.hasRelay)?1:A.path.localeCompare(M.path)),g.slice(0,100)}function u(p){l(p.path)}function f(p){l(p)}let d=p=>f(p.detail.value);return o.$$set=p=>{"app"in p&&t(5,r=p.app),"placeholder"in p&&t(0,n=p.placeholder),"blockedPaths"in p&&t(6,s=p.blockedPaths),"sharedFolders"in p&&t(7,i=p.sharedFolders),"autofocus"in p&&t(1,a=p.autofocus),"onSelect"in p&&t(8,l=p.onSelect)},[n,a,c,u,f,r,s,i,l,d]}var am=class extends K{constructor(e){super(),G(this,e,IM,kM,W,{app:5,placeholder:0,blockedPaths:6,sharedFolders:7,autofocus:1,onSelect:8},gM)}},n_=am;var fi=class extends ui{constructor(e,t="Choose or create folder...",r=new Set,n,s){super(e,n_,{app:e,placeholder:t,blockedPaths:r,sharedFolders:n},s)}};var gc=Ce({});function CM(o,e,t,r="error",n,s="client"){gc.update(i=>({...i,[o]:{message:e,details:t,type:r,visible:!0,autoDismiss:n!=null?n:5e3,source:s}}))}function s_(o){gc.update(e=>({...e,[o]:{...e[o],visible:!1}}))}function hc(o,e,t,r="error",n){CM(o,e,t,r,n,"server")}function Jt(o,e="An error occurred"){var r,n,s;let t=`server-error-${Date.now()}`;if(o.status===403){let i=((r=o.body)==null?void 0:r.message)||o.message||"Permission denied",a=(n=o.body)==null?void 0:n.details;hc(t,i,a,"error",7e3)}else if(o.status>=400&&o.status<500){let i=((s=o.body)==null?void 0:s.message)||o.message||e;hc(t,i,void 0,"error",5e3)}else o.status>=500?hc(t,"Server error occurred",o.message,"error",8e3):hc(t,e,o.message,"error",5e3)}function LM(o){Le(o,"svelte-y144a4",".share-folder-modal.svelte-y144a4.svelte-y144a4{min-width:500px;max-width:600px}@media(max-width: 768px){.share-folder-modal.svelte-y144a4.svelte-y144a4{min-width:100vw;max-width:100vw;margin:0;border-radius:0;height:100vh;max-height:100vh}}.section.svelte-y144a4.svelte-y144a4{margin-bottom:24px}.search-container.svelte-y144a4.svelte-y144a4{margin-bottom:12px}.search-input.svelte-y144a4.svelte-y144a4{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.user-list.svelte-y144a4.svelte-y144a4{max-height:300px;overflow-y:auto;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary)}.user-item.svelte-y144a4.svelte-y144a4{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--background-modifier-border);gap:12px}.user-item.svelte-y144a4.svelte-y144a4:last-child{border-bottom:none}.user-item.svelte-y144a4.svelte-y144a4:hover:not(.is-current-user){background:var(--background-modifier-hover)}.user-item.is-current-user.svelte-y144a4.svelte-y144a4{opacity:0.6;cursor:not-allowed}.user-checkbox.svelte-y144a4.svelte-y144a4{margin:0;cursor:pointer}.user-avatar.svelte-y144a4.svelte-y144a4{width:32px;height:32px;border-radius:50%;background:var(--interactive-accent);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:500;flex-shrink:0}.user-avatar.svelte-y144a4 img.svelte-y144a4{width:100%;height:100%;border-radius:50%;object-fit:cover}.user-info.svelte-y144a4.svelte-y144a4{flex:1;min-width:0}.user-name.svelte-y144a4.svelte-y144a4{font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-status.svelte-y144a4.svelte-y144a4{font-size:0.8em;color:var(--text-muted);font-style:italic;margin-left:auto}.no-users.svelte-y144a4.svelte-y144a4{text-align:center;padding:40px;color:var(--text-muted)}.modal-button-container.svelte-y144a4.svelte-y144a4{display:flex;justify-content:flex-end;align-items:center;margin-top:24px;gap:12px}.modal-button-container.users-step.svelte-y144a4.svelte-y144a4{justify-content:space-between}button.svelte-y144a4.svelte-y144a4:disabled{opacity:0.5;cursor:not-allowed}.checkbox-container.svelte-y144a4.svelte-y144a4{cursor:pointer}")}function i_(o,e,t){let r=o.slice();return r[38]=e[t],r}function TM(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,y,g,k,L,I,C,A,M,P,O;s=new qe({props:{name:"Selected Folder"}}),a=new _a({props:{selectedItem:o[4],showTransformation:!0,isPrivate:o[2],readonly:!0}}),u=new qe({props:{name:"Users"}});function T(Q,N){return Q[7].length===0?FM:MM}let U=T(o,[-1,-1]),j=U(o);return{c(){e=S("div"),e.textContent="Add Users to Folder",t=F(),r=S("div"),n=S("div"),D(s.$$.fragment),i=F(),D(a.$$.fragment),l=F(),c=S("div"),D(u.$$.fragment),f=F(),d=S("div"),p=S("input"),m=F(),y=S("div"),j.c(),g=F(),k=S("div"),L=S("button"),L.textContent="Back",I=F(),C=S("button"),C.textContent="Share",h(e,"class","modal-title"),h(n,"class","section svelte-y144a4"),h(p,"type","text"),h(p,"placeholder","Search users by name..."),h(p,"class","search-input svelte-y144a4"),h(d,"class","search-container svelte-y144a4"),h(y,"class","user-list svelte-y144a4"),h(c,"class","section svelte-y144a4"),h(L,"class","mod-muted svelte-y144a4"),h(C,"class","mod-cta svelte-y144a4"),C.disabled=A=!1,h(k,"class","modal-button-container users-step svelte-y144a4"),h(r,"class","modal-content share-folder-modal svelte-y144a4")},m(Q,N){x(Q,e,N),x(Q,t,N),x(Q,r,N),v(r,n),E(s,n,null),v(n,i),E(a,n,null),v(r,l),v(r,c),E(u,c,null),v(c,f),v(c,d),v(d,p),rt(p,o[6]),v(c,m),v(c,y),j.m(y,null),v(r,g),v(r,k),v(k,L),v(k,I),v(k,C),o[28](r),M=!0,P||(O=[H(p,"input",o[25]),H(L,"click",o[15]),H(C,"click",o[14])],P=!0)},p(Q,N){let X={};N[0]&16&&(X.selectedItem=Q[4]),N[0]&4&&(X.isPrivate=Q[2]),a.$set(X),N[0]&64&&p.value!==Q[6]&&rt(p,Q[6]),U===(U=T(Q,N))&&j?j.p(Q,N):(j.d(1),j=U(Q),j&&(j.c(),j.m(y,null)))},i(Q){M||(b(s.$$.fragment,Q),b(a.$$.fragment,Q),b(u.$$.fragment,Q),M=!0)},o(Q){w(s.$$.fragment,Q),w(a.$$.fragment,Q),w(u.$$.fragment,Q),M=!1},d(Q){Q&&(_(e),_(t),_(r)),R(s),R(a),R(u),j.d(),o[28](null),P=!1,Ie(O)}}}function AM(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[2]?"Add Users":"Share",p,m,y,g,k;s=new qe({props:{name:"Folder"}}),a=new _a({props:{selectedItem:o[4],showTransformation:!0,isPrivate:o[2],selectButtonText:"Choose or create folder..."}}),a.$on("clear",o[11]),a.$on("select",o[16]);let L=o[0].version>0&&c_(o);return{c(){e=S("div"),e.textContent="Share a folder",t=F(),r=S("div"),n=S("div"),D(s.$$.fragment),i=F(),D(a.$$.fragment),l=F(),L&&L.c(),c=F(),u=S("div"),f=S("button"),p=V(d),h(e,"class","modal-title"),h(n,"class","section svelte-y144a4"),h(f,"class","mod-cta svelte-y144a4"),f.disabled=m=!o[4]&&!o[3].trim(),h(u,"class","modal-button-container svelte-y144a4"),h(r,"class","modal-content share-folder-modal svelte-y144a4")},m(I,C){x(I,e,C),x(I,t,C),x(I,r,C),v(r,n),E(s,n,null),v(n,i),E(a,n,null),v(r,l),L&&L.m(r,null),v(r,c),v(r,u),v(u,f),v(f,p),o[24](r),y=!0,g||(k=H(f,"click",o[12]),g=!0)},p(I,C){let A={};C[0]&16&&(A.selectedItem=I[4]),C[0]&4&&(A.isPrivate=I[2]),a.$set(A),I[0].version>0?L?(L.p(I,C),C[0]&1&&b(L,1)):(L=c_(I),L.c(),b(L,1),L.m(r,c)):L&&(oe(),w(L,1,1,()=>{L=null}),ne()),(!y||C[0]&4)&&d!==(d=I[2]?"Add Users":"Share")&&J(p,d),(!y||C[0]&24&&m!==(m=!I[4]&&!I[3].trim()))&&(f.disabled=m)},i(I){y||(b(s.$$.fragment,I),b(a.$$.fragment,I),b(L),y=!0)},o(I){w(s.$$.fragment,I),w(a.$$.fragment,I),w(L),y=!1},d(I){I&&(_(e),_(t),_(r)),R(s),R(a),L&&L.d(),o[24](null),g=!1,k()}}}function MM(o){let e,t=ke(o[7]),r=[];for(let n=0;n<t.length;n+=1)r[n]=l_(i_(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=me()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);x(n,e,s)},p(n,s){if(s[0]&8320){t=ke(n[7]);let i;for(i=0;i<t.length;i+=1){let a=i_(n,t,i);r[i]?r[i].p(a,s):(r[i]=l_(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),ze(r,n)}}}function FM(o){let e,t=o[6]?"No users found":"No users available",r;return{c(){e=S("div"),r=V(t),h(e,"class","no-users svelte-y144a4")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s[0]&64&&t!==(t=n[6]?"No users found":"No users available")&&J(r,t)},d(n){n&&_(e)}}}function PM(o){let e=u_(o[38].user.name)+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&128&&e!==(e=u_(r[38].user.name)+"")&&J(t,e)},d(r){r&&_(t)}}}function EM(o){let e,t,r;return{c(){e=S("img"),hr(e.src,t=o[38].user.picture)||h(e,"src",t),h(e,"alt",r=o[38].user.name),h(e,"class","svelte-y144a4")},m(n,s){x(n,e,s)},p(n,s){s[0]&128&&!hr(e.src,t=n[38].user.picture)&&h(e,"src",t),s[0]&128&&r!==(r=n[38].user.name)&&h(e,"alt",r)},d(n){n&&_(e)}}}function a_(o){let e;return{c(){e=S("div"),e.textContent="Required (You)",h(e,"class","user-status svelte-y144a4")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function l_(o){let e,t,r,n,s,i,a,l,c,u=o[38].user.name+"",f,d,p,m,y;function g(M,P){return M[38].user.picture?EM:PM}let k=g(o,[-1,-1]),L=k(o),I=o[38].isCurrentUser&&a_(o);function C(){return o[26](o[38])}function A(...M){return o[27](o[38],...M)}return{c(){e=S("div"),t=S("input"),s=F(),i=S("div"),L.c(),a=F(),l=S("div"),c=S("div"),f=V(u),d=F(),I&&I.c(),p=F(),h(t,"type","checkbox"),t.checked=r=o[38].selected,t.disabled=n=o[38].isCurrentUser,h(t,"class","user-checkbox svelte-y144a4"),h(t,"tabindex","-1"),h(i,"class","user-avatar svelte-y144a4"),h(c,"class","user-name svelte-y144a4"),h(l,"class","user-info svelte-y144a4"),h(e,"class","user-item svelte-y144a4"),h(e,"role","button"),h(e,"tabindex","0"),Me(e,"is-current-user",o[38].isCurrentUser)},m(M,P){x(M,e,P),v(e,t),v(e,s),v(e,i),L.m(i,null),v(e,a),v(e,l),v(l,c),v(c,f),v(e,d),I&&I.m(e,null),v(e,p),m||(y=[H(e,"click",C),H(e,"keydown",A)],m=!0)},p(M,P){o=M,P[0]&128&&r!==(r=o[38].selected)&&(t.checked=r),P[0]&128&&n!==(n=o[38].isCurrentUser)&&(t.disabled=n),k===(k=g(o,P))&&L?L.p(o,P):(L.d(1),L=k(o),L&&(L.c(),L.m(i,null))),P[0]&128&&u!==(u=o[38].user.name+"")&&J(f,u),o[38].isCurrentUser?I||(I=a_(o),I.c(),I.m(e,p)):I&&(I.d(1),I=null),P[0]&128&&Me(e,"is-current-user",o[38].isCurrentUser)},d(M){M&&_(e),L.d(),I&&I.d(),m=!1,Ie(y)}}}function c_(o){let e,t;return e=new Oe({props:{name:"Private",description:"Only selected users can access this folder",$$slots:{default:[RM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&4|n[1]&1024&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function RM(o){let e,t,r,n,s,i;return{c(){e=S("div"),t=S("input"),r=F(),n=S("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[2]),h(e,"tabindex","0"),h(e,"class","checkbox-container svelte-y144a4"),Me(e,"is-enabled",o[2])},m(a,l){x(a,e,l),v(e,t),t.checked=o[2],v(e,r),v(e,n),s||(i=[H(t,"change",o[21]),H(e,"keypress",o[22]),H(e,"click",o[23])],s=!0)},p(a,l){l[0]&4&&(t.checked=a[2]),l[0]&4&&h(e,"aria-checked",a[2]),l[0]&4&&Me(e,"is-enabled",a[2])},d(a){a&&_(e),s=!1,Ie(i)}}}function DM(o){let e,t,r,n,s=[AM,TM],i=[];function a(l,c){return l[1]==="main"?0:l[1]==="users"?1:-1}return~(e=a(o,[-1,-1]))&&(t=i[e]=s[e](o)),{c(){t&&t.c(),r=me()},m(l,c){~e&&i[e].m(l,c),x(l,r,c),n=!0},p(l,c){let u=e;e=a(l,c),e===u?~e&&i[e].p(l,c):(t&&(oe(),w(i[u],1,1,()=>{i[u]=null}),ne()),~e?(t=i[e],t?t.p(l,c):(t=i[e]=s[e](l),t.c()),b(t,1),t.m(r.parentNode,r)):t=null)},i(l){n||(b(t),n=!0)},o(l){w(t),n=!1},d(l){l&&_(r),~e&&i[e].d(l)}}}function u_(o){return o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}function UM(o,e,t){let r,n,s;var i;let{app:a}=e,{relay:l}=e,{relayManager:c}=e,{sharedFolders:u}=e,{onConfirm:f}=e,d="main",p=!1,m="",y="",g=Ce(new Set(!((i=c.user)===null||i===void 0)&&i.id?[c.user.id]:[]));ce(o,g,fe=>t(30,r=fe));let k=Ce("");ce(o,k,fe=>t(6,n=fe));let L,I=()=>new Set(u.filter(fe=>!!fe.relayId).map(fe=>fe.path)).add("/"),C=Ze([c.relayRoles],([fe])=>Array.from(fe.values()).filter(Ee=>Ee.relayId===l.id).map(Ee=>Ee.user)),A=Ze([C,g],([fe,Ee])=>{var xe;let se=(xe=c.user)===null||xe===void 0?void 0:xe.id;return fe.map(Ae=>{let we=se===Ae.id,Ve=Ee.has(Ae.id)||we;return{user:Ae,selected:Ve,isCurrentUser:we}})}),M=Ze([A,k],([fe,Ee])=>{if(!Ee||Ee.trim()==="")return fe;let xe=Ee.toLowerCase().trim();return fe.filter(se=>se.user.name.toLowerCase().includes(xe))}),P=Ze([M],([fe])=>fe.sort((Ee,xe)=>Ee.user.name.localeCompare(xe.user.name)));ce(o,P,fe=>t(7,s=fe));function O(){t(4,y=""),t(3,m="")}function T(){!y&&m.trim()&&t(4,y=m.trim()),p?t(1,d="users"):j()}function U(fe){fe.isCurrentUser||g.update(Ee=>{let xe=new Set(Ee);return xe.has(fe.user.id)?xe.delete(fe.user.id):xe.add(fe.user.id),xe})}function j(){return Pe(this,void 0,void 0,function*(){var fe;!y&&m.trim()&&t(4,y=m.trim());try{let Ee=(fe=c.user)===null||fe===void 0?void 0:fe.id,xe=r,se=Array.from(xe).filter(Ae=>Ae!==Ee);yield f(y,y.split("/").pop()||"",p,se)}catch(Ee){Jt(Ee,"Failed to share folder.")}})}function Q(){t(1,d="main")}function N(fe){t(4,y=fe),t(3,m=fe)}function X(){new fi(a,"Choose or create folder...",I(),u,N).open()}let $=fe=>{fe.key==="Tab"&&B(fe)};dt(()=>(document.addEventListener("keydown",$),y||setTimeout(()=>{X()},100),()=>{document.removeEventListener("keydown",$)}));function B(fe){if(!L)return;let Ee=L.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),xe=Ee[0],se=Ee[Ee.length-1];fe.shiftKey?document.activeElement===xe&&(fe.preventDefault(),se.focus()):document.activeElement===se&&(fe.preventDefault(),xe.focus())}function pe(){p=this.checked,t(2,p)}let Z=()=>t(2,p=!p),ae=()=>t(2,p=!p);function ue(fe){_t[fe?"unshift":"push"](()=>{L=fe,t(5,L)})}function ee(){n=this.value,k.set(n)}let q=fe=>U(fe),Y=(fe,Ee)=>{(Ee.key==="Enter"||Ee.key===" ")&&(Ee.preventDefault(),U(fe))};function Te(fe){_t[fe?"unshift":"push"](()=>{L=fe,t(5,L)})}return o.$$set=fe=>{"app"in fe&&t(17,a=fe.app),"relay"in fe&&t(0,l=fe.relay),"relayManager"in fe&&t(18,c=fe.relayManager),"sharedFolders"in fe&&t(19,u=fe.sharedFolders),"onConfirm"in fe&&t(20,f=fe.onConfirm)},[l,d,p,m,y,L,n,s,g,k,P,O,T,U,j,Q,X,a,c,u,f,pe,Z,ae,ue,ee,q,Y,Te]}var lm=class extends K{constructor(e){super(),G(this,e,UM,DM,W,{app:17,relay:0,relayManager:18,sharedFolders:19,onConfirm:20},LM,[-1,-1])}},f_=lm;var yc=class extends d_.Modal{constructor(t,r,n,s,i){super(t);this.relay=r;this.sharedFolders=n;this.relayManager=s;this.onConfirm=i}onOpen(){let{contentEl:t}=this;this.component=new f_({target:t,props:{app:this.app,relay:this.relay,relayManager:this.relayManager,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s,i)=>{let a=await this.onConfirm(r,n,s,i);return this.close(),a}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}destroy(){this.relay=null,this.sharedFolders=null,this.relayManager=null,this.onConfirm=null}};var cm=require("obsidian");function OM(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function $M(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let n=o[r];switch(t){case"NORMAL":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="EMPHASIS",e+="<u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="NORMAL",e+="</u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":n.type==="TEXT"?e+=n.value:n.type==="STAR"?e+="*":n.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function Fn(o){let e=OM(o);return $M(e)}function NM(o){Le(o,"svelte-uwwzsp",`div.spacer.svelte-uwwzsp{height:3em}.faint.svelte-uwwzsp{color:var(--text-faint) !important}.edit-members-button.svelte-uwwzsp{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-uwwzsp:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-uwwzsp:focus{outline:none;color:var(--icon-color-focus)}.share-key-container.svelte-uwwzsp{width:100%}.share-key-disabled-notice.svelte-uwwzsp{color:var(--text-error) !important;font-size:0.85em !important}.relay-host-check.svelte-uwwzsp{text-align:right}input.system3-updating.svelte-uwwzsp{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-uwwzsp{border:1px solid var(--color-red) !important}.admin-toggle-btn.svelte-uwwzsp{background:none;border:none;box-shadow:none;color:var(--text-muted);font-size:0.9em;cursor:pointer;padding:0;margin-left:8px}.admin-toggle-btn.svelte-uwwzsp:hover{color:var(--text-normal);text-decoration:underline}`)}function p_(o,e,t){let r=o.slice();return r[83]=e[t],r}function m_(o,e,t){let r=o.slice();return r[86]=e[t],r}function h_(o,e,t){let r=o.slice();return r[89]=e[t],r}function g_(o){let e,t;return e=new Oe({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[BM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&16529|n[2]&1073741824&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function BM(o){let e,t,r,n;return{c(){e=S("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=kt((o[14]?"system3-updating":"")+(o[7]?"":" system3-input-invalid"))+" svelte-uwwzsp")},m(s,i){x(s,e,i),rt(e,o[0].name),o[65](e),r||(n=[H(e,"input",o[64]),H(e,"input",o[48])],r=!0)},p(s,i){i[0]&16512&&t!==(t=kt((s[14]?"system3-updating":"")+(s[7]?"":" system3-input-invalid"))+" svelte-uwwzsp")&&h(e,"class",t),i[0]&1&&e.value!==s[0].name&&rt(e,s[0].name)},d(s){s&&_(e),o[65](null),r=!1,Ie(n)}}}function y_(o){let e,t=o[17]?"View as member":"View as admin",r,n,s;return{c(){e=S("button"),r=V(t),h(e,"class","admin-toggle-btn svelte-uwwzsp")},m(i,a){x(i,e,a),v(e,r),n||(s=H(e,"click",o[66]),n=!0)},p(i,a){a[0]&131072&&t!==(t=i[17]?"View as member":"View as admin")&&J(r,t)},d(i){i&&_(e),n=!1,s()}}}function VM(o){let e,t=o[15]&&o[16]&&y_(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[15]&&r[16]?t?t.p(r,n):(t=y_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function b_(o){let e,t;return e=new At({props:{$$slots:{name:[jM],default:[qM]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&786434|n[2]&1073741824&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function v_(o){let e,t;function r(){return o[68](o[89])}return e=new ps({props:{label:"Add to vault",$$slots:{default:[HM]},$$scope:{ctx:o}}}),e.$on("settings",function(){Qe((0,It.debounce)(r))&&(0,It.debounce)(r).apply(this,arguments)}),{c(){D(e.$$.fragment)},m(n,s){E(e,n,s),t=!0},p(n,s){o=n;let i={};s[2]&1073741824&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function HM(o){let e,t;return e=new da({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p:z,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function qM(o){let e=!o[19].some(s)&&bo(o[1].relayManager.userCan(["folder","read_content"],o[89])),t,r,n;function s(...l){return o[62](o[89],...l)}let i=e&&v_(o);function a(){return o[69](o[89])}return r=new ps({}),r.$on("settings",function(){Qe((0,It.debounce)(a))&&(0,It.debounce)(a).apply(this,arguments)}),{c(){i&&i.c(),t=F(),D(r.$$.fragment)},m(l,c){i&&i.m(l,c),x(l,t,c),E(r,l,c),n=!0},p(l,c){o=l,c[0]&786434&&(e=!o[19].some(s)&&bo(o[1].relayManager.userCan(["folder","read_content"],o[89]))),e?i?(i.p(o,c),c[0]&786434&&b(i,1)):(i=v_(o),i.c(),b(i,1),i.m(t.parentNode,t)):i&&(oe(),w(i,1,1,()=>{i=null}),ne())},i(l){n||(b(i),b(r.$$.fragment,l),n=!0)},o(l){w(i),w(r.$$.fragment,l),n=!1},d(l){l&&_(t),i&&i.d(l),R(r,l)}}}function zM(o){let e=o[89].name+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&262144&&e!==(e=r[89].name+"")&&J(t,e)},d(r){r&&_(t)}}}function jM(o){let e,t;function r(){return o[67](o[89])}return e=new uc({props:{remoteFolder:o[89],slot:"name",$$slots:{default:[zM]},$$scope:{ctx:o}}}),e.$on("manageRemoteFolder",r),{c(){D(e.$$.fragment)},m(n,s){E(e,n,s),t=!0},p(n,s){o=n;let i={};s[0]&262144&&(i.remoteFolder=o[89]),s[0]&262144|s[2]&1073741824&&(i.$$scope={dirty:s,ctx:o}),e.$set(i)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){R(e,n)}}}function __(o){let e=o[17]?bo(o[1].relayManager.userCan(["folder","manage_users"],o[89])):bo(o[1].relayManager.userCan(["folder","read_content"],o[89])),t,r,n=e&&b_(o);return{c(){n&&n.c(),t=me()},m(s,i){n&&n.m(s,i),x(s,t,i),r=!0},p(s,i){i[0]&393218&&(e=s[17]?bo(s[1].relayManager.userCan(["folder","manage_users"],s[89])):bo(s[1].relayManager.userCan(["folder","read_content"],s[89]))),e?n?(n.p(s,i),i[0]&393218&&b(n,1)):(n=b_(s),n.c(),b(n,1),n.m(t.parentNode,t)):n&&(oe(),w(n,1,1,()=>{n=null}),ne())},i(s){r||(b(n),r=!0)},o(s){w(n),r=!1},d(s){s&&_(t),n&&n.d(s)}}}function WM(o){let e,t,r;return{c(){e=S("button"),e.textContent="Share a folder",h(e,"class","mod-cta"),h(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){x(n,e,s),t||(r=H(e,"click",function(){Qe((0,It.debounce)(o[70]))&&(0,It.debounce)(o[70]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&_(e),t=!1,r()}}}function x_(o){let e,t,r,n,s,i,a,l=[GM,KM],c=[];function u(f,d){return f[20]?0:1}return t=u(o,[-1,-1,-1]),r=c[t]=l[t](o),{c(){e=S("div"),r.c(),h(e,"class","edit-members-button svelte-uwwzsp"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[20]?"Done editing":"Edit members")},m(f,d){x(f,e,d),c[t].m(e,null),s=!0,i||(a=[H(e,"click",o[52]),H(e,"keypress",o[52])],i=!0)},p(f,d){let p=t;t=u(f,d),t!==p&&(oe(),w(c[p],1,1,()=>{c[p]=null}),ne(),r=c[t],r||(r=c[t]=l[t](f),r.c()),b(r,1),r.m(e,null)),(!s||d[0]&1048576&&n!==(n=f[20]?"Done editing":"Edit members"))&&h(e,"aria-label",n)},i(f){s||(b(r),s=!0)},o(f){w(r),s=!1},d(f){f&&_(e),c[t].d(),i=!1,Ie(a)}}}function KM(o){let e,t;return e=new ma({props:{class:"svg-icon"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function GM(o){let e,t;return e=new la({props:{class:"svg-icon"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function JM(o){let e,t,r=o[15]&&x_(o);return{c(){r&&r.c(),e=me()},m(n,s){r&&r.m(n,s),x(n,e,s),t=!0},p(n,s){n[15]?r?(r.p(n,s),s[0]&32768&&b(r,1)):(r=x_(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),w(r,1,1,()=>{r=null}),ne())},i(n){t||(b(r),t=!0)},o(n){w(r),t=!1},d(n){n&&_(e),r&&r.d(n)}}}function QM(o){let e,t=o[83].role+"",r;return{c(){e=S("span"),r=V(t),h(e,"class","role-label")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s[0]&64&&t!==(t=n[83].role+"")&&J(r,t)},d(n){n&&_(e)}}}function YM(o){let e;function t(s,i){return s[20]?XM:ZM}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function ZM(o){let e,t,r,n,s,i,a,l,c=ke(o[21]),u=[];for(let f=0;f<c.length;f+=1)u[f]=w_(m_(o,c,f));return{c(){var f,d;e=S("div"),t=S("select");for(let p=0;p<u.length;p+=1)u[p].c();h(t,"class","dropdown"),t.disabled=r=o[83].userId===((f=o[1].loginManager.user)==null?void 0:f.id),h(t,"aria-label",n=o[83].userId===((d=o[1].loginManager.user)==null?void 0:d.id)?"Cannot modify your own role":void 0),h(t,"data-role-id",i=o[83].id),he(e,"display","flex"),he(e,"gap","8px"),he(e,"align-items","center")},m(f,d){x(f,e,d),v(e,t);for(let p=0;p<u.length;p+=1)u[p]&&u[p].m(t,null);Xs(t,o[83].role),a||(l=H(t,"change",o[51]),a=!0)},p(f,d){var p,m;if(d[0]&2097152){c=ke(f[21]);let y;for(y=0;y<c.length;y+=1){let g=m_(f,c,y);u[y]?u[y].p(g,d):(u[y]=w_(g),u[y].c(),u[y].m(t,null))}for(;y<u.length;y+=1)u[y].d(1);u.length=c.length}d[0]&2097218&&r!==(r=f[83].userId===((p=f[1].loginManager.user)==null?void 0:p.id))&&(t.disabled=r),d[0]&2097218&&n!==(n=f[83].userId===((m=f[1].loginManager.user)==null?void 0:m.id)?"Cannot modify your own role":void 0)&&h(t,"aria-label",n),d[0]&2097216&&s!==(s=f[83].role)&&Xs(t,f[83].role),d[0]&2097216&&i!==(i=f[83].id)&&h(t,"data-role-id",i)},d(f){f&&_(e),ze(u,f),a=!1,l()}}}function XM(o){var r;let e,t=o[83].userId!==((r=o[1].loginManager.user)==null?void 0:r.id)&&S_(o);return{c(){t&&t.c(),e=me()},m(n,s){t&&t.m(n,s),x(n,e,s)},p(n,s){var i;n[83].userId!==((i=n[1].loginManager.user)==null?void 0:i.id)?t?t.p(n,s):(t=S_(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(n){n&&_(e),t&&t.d(n)}}}function w_(o){let e,t=o[86].name+"",r,n;return{c(){e=S("option"),r=V(t),e.__value=n=o[86].name,rt(e,e.__value)},m(s,i){x(s,e,i),v(e,r)},p(s,i){i[0]&2097152&&t!==(t=s[86].name+"")&&J(r,t),i[0]&2097152&&n!==(n=s[86].name)&&(e.__value=n,rt(e,e.__value))},d(s){s&&_(e)}}}function S_(o){let e,t,r;function n(){return o[71](o[83])}return{c(){e=S("button"),e.textContent="Kick",h(e,"class","mod-destructive")},m(s,i){x(s,e,i),t||(r=H(e,"click",function(){Qe((0,It.debounce)(n))&&(0,It.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&_(e),t=!1,r()}}}function eF(o){let e;function t(s,i){return s[15]?YM:QM}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function k_(o){let e,t;return e=new li({props:{user:o[83].user,$$slots:{default:[eF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&64&&(s.user=r[83].user),n[0]&3178562|n[2]&1073741824&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function tF(o){let e,t=o[6].values().length+"",r,n,s=o[11].userLimit+"",i,a;return{c(){e=S("span"),r=V(t),n=V(" of "),i=V(s),a=V(" seats used"),h(e,"class","faint svelte-uwwzsp")},m(l,c){x(l,e,c),v(e,r),v(e,n),v(e,i),v(e,a)},p(l,c){c[0]&64&&t!==(t=l[6].values().length+"")&&J(r,t),c[0]&2048&&s!==(s=l[11].userLimit+"")&&J(i,s)},d(l){l&&_(e)}}}function I_(o){let e,t;return e=new mc({}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function rF(o){let e,t,r,n,s,i,a,l,c,u,f,d=!o[9]&&I_(o);return{c(){e=S("div"),d&&d.c(),t=F(),r=S("div"),n=S("input"),i=F(),a=S("div"),h(n,"type","checkbox"),n.checked=o[8],n.disabled=s=!o[9],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",o[8]),h(r,"tabindex","0"),h(r,"class",l=o[9]?"checkbox-container":"checkbox-container checkbox-locked"),Me(r,"is-enabled",o[8]),h(e,"class","setting-item-control")},m(p,m){x(p,e,m),d&&d.m(e,null),v(e,t),v(e,r),v(r,n),v(r,i),v(r,a),c=!0,u||(f=[H(n,"change",o[72]),H(r,"keypress",o[73]),H(r,"click",o[74])],u=!0)},p(p,m){p[9]?d&&(oe(),w(d,1,1,()=>{d=null}),ne()):d?m[0]&512&&b(d,1):(d=I_(p),d.c(),b(d,1),d.m(e,t)),(!c||m[0]&256)&&(n.checked=p[8]),(!c||m[0]&512&&s!==(s=!p[9]))&&(n.disabled=s),(!c||m[0]&256)&&h(r,"aria-checked",p[8]),(!c||m[0]&512&&l!==(l=p[9]?"checkbox-container":"checkbox-container checkbox-locked"))&&h(r,"class",l),(!c||m[0]&768)&&Me(r,"is-enabled",p[8])},i(p){c||(b(d),c=!0)},o(p){w(d),c=!1},d(p){p&&_(e),d&&d.d(),u=!1,Ie(f)}}}function oF(o){let e;return{c(){e=S("div"),e.textContent="The owner of this Relay Server has disabled key sharing.",h(e,"class","setting-item-description mod-warning")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function nF(o){let e;return{c(){e=S("div"),e.textContent="The owner of this Relay Server has enabled key sharing.",h(e,"class","setting-item-description")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function sF(o){let e;return{c(){e=S("div"),e.textContent="Allow others to join this Relay Server with a Share Key.",h(e,"class","setting-item-description")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function iF(o){let e;function t(s,i){return s[9]?sF:s[8]?nF:oF}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){e=S("fragment"),n.c(),h(e,"slot","description")},m(s,i){x(s,e,i),n.m(e,null)},p(s,i){r!==(r=t(s,i))&&(n.d(1),n=r(s),n&&(n.c(),n.m(e,null)))},d(s){s&&_(e),n.d()}}}function C_(o){let e,t,r,n;e=new Oe({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[cF]},$$scope:{ctx:o}}});let s=o[9]&&L_(o);return{c(){D(e.$$.fragment),t=F(),s&&s.c(),r=me()},m(i,a){E(e,i,a),x(i,t,a),s&&s.m(i,a),x(i,r,a),n=!0},p(i,a){let l={};a[0]&288|a[2]&1073741824&&(l.$$scope={dirty:a,ctx:i}),e.$set(l),i[9]?s?(s.p(i,a),a[0]&512&&b(s,1)):(s=L_(i),s.c(),b(s,1),s.m(r.parentNode,r)):s&&(oe(),w(s,1,1,()=>{s=null}),ne())},i(i){n||(b(e.$$.fragment,i),b(s),n=!0)},o(i){w(e.$$.fragment,i),w(s),n=!1},d(i){i&&(_(t),_(r)),R(e,i),s&&s.d(i)}}}function aF(o){let e,t;return e=new fc({props:{value:o[5]?o[5].key:"please wait...",disabled:!o[8],placeholder:"please wait...",readonly:!0,copyOnClick:!0,successMessage:"Invite link copied"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&32&&(s.value=r[5]?r[5].key:"please wait..."),n[0]&256&&(s.disabled=!r[8]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function lF(o){let e;return{c(){e=S("span"),e.textContent="Share key is currently disabled",h(e,"role","button"),h(e,"tabindex","0"),h(e,"class","input-like share-key-disabled-notice svelte-uwwzsp")},m(t,r){x(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function cF(o){let e,t,r,n,s=[lF,aF],i=[];function a(l,c){return l[8]?1:0}return t=a(o,[-1,-1,-1]),r=i[t]=s[t](o),{c(){e=S("div"),r.c(),h(e,"class","share-key-container svelte-uwwzsp")},m(l,c){x(l,e,c),i[t].m(e,null),n=!0},p(l,c){let u=t;t=a(l,c),t===u?i[t].p(l,c):(oe(),w(i[u],1,1,()=>{i[u]=null}),ne(),r=i[t],r?r.p(l,c):(r=i[t]=s[t](l),r.c()),b(r,1),r.m(e,null))},i(l){n||(b(r),n=!0)},o(l){w(r),n=!1},d(l){l&&_(e),i[t].d()}}}function L_(o){let e,t;return e=new Oe({props:{name:"Rotate key",description:"Create a new share key. The old key will no longer work.",$$slots:{default:[uF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[2]&1073741824&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uF(o){let e,t,r;return{c(){e=S("button"),e.textContent="Rotate key",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,It.debounce)(o[46])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function T_(o){let e,t,r,n,s,i,a,l;e=new qe({props:{name:"Plan"}});let c=[dF,fF],u=[];function f(m,y){return m[23]?0:1}r=f(o,[-1,-1,-1]),n=u[r]=c[r](o);let d=o[24]&&o[24].quota>0&&F_(o),p=o[0].provider&&P_(o);return{c(){D(e.$$.fragment),t=F(),n.c(),s=F(),d&&d.c(),i=F(),p&&p.c(),a=me()},m(m,y){E(e,m,y),x(m,t,y),u[r].m(m,y),x(m,s,y),d&&d.m(m,y),x(m,i,y),p&&p.m(m,y),x(m,a,y),l=!0},p(m,y){let g=r;r=f(m,y),r===g?u[r].p(m,y):(oe(),w(u[g],1,1,()=>{u[g]=null}),ne(),n=u[r],n?n.p(m,y):(n=u[r]=c[r](m),n.c()),b(n,1),n.m(s.parentNode,s)),m[24]&&m[24].quota>0?d?(d.p(m,y),y[0]&16777216&&b(d,1)):(d=F_(m),d.c(),b(d,1),d.m(i.parentNode,i)):d&&(oe(),w(d,1,1,()=>{d=null}),ne()),m[0].provider?p?(p.p(m,y),y[0]&1&&b(p,1)):(p=P_(m),p.c(),b(p,1),p.m(a.parentNode,a)):p&&(oe(),w(p,1,1,()=>{p=null}),ne())},i(m){l||(b(e.$$.fragment,m),b(n),b(d),b(p),l=!0)},o(m){w(e.$$.fragment,m),w(n),w(d),w(p),l=!1},d(m){m&&(_(t),_(s),_(i),_(a)),R(e,m),u[r].d(m),d&&d.d(m),p&&p.d(m)}}}function fF(o){let e,t;return e=new Oe({props:{name:`Plan: ${o[11].plan}`,description:o[11].cta||"Thanks for supporting Relay development",$$slots:{default:[pF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&2048&&(s.name=`Plan: ${r[11].plan}`),n[0]&2048&&(s.description=r[11].cta||"Thanks for supporting Relay development"),n[0]&2048|n[2]&1073741824&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function dF(o){let e,t,r=!o[12].values()[0].active||o[12].values()[0].cancelAt,n,s;e=new Oe({props:{name:`Plan: ${o[11].plan}`,description:"",$$slots:{description:[hF],default:[mF]},$$scope:{ctx:o}}});let i=r&&M_(o);return{c(){D(e.$$.fragment),t=F(),i&&i.c(),n=me()},m(a,l){E(e,a,l),x(a,t,l),i&&i.m(a,l),x(a,n,l),s=!0},p(a,l){let c={};l[0]&2048&&(c.name=`Plan: ${a[11].plan}`),l[0]&8394752|l[2]&1073741824&&(c.$$scope={dirty:l,ctx:a}),e.$set(c),l[0]&4096&&(r=!a[12].values()[0].active||a[12].values()[0].cancelAt),r?i?(i.p(a,l),l[0]&4096&&b(i,1)):(i=M_(a),i.c(),b(i,1),i.m(n.parentNode,n)):i&&(oe(),w(i,1,1,()=>{i=null}),ne())},i(a){s||(b(e.$$.fragment,a),b(i),s=!0)},o(a){w(e.$$.fragment,a),w(i),s=!1},d(a){a&&(_(t),_(n)),R(e,a),i&&i.d(a)}}}function pF(o){let e,t,r;return{c(){e=S("button"),e.textContent="Upgrade",h(e,"class","mod-cta")},m(n,s){x(n,e,s),t||(r=H(e,"click",function(){Qe((0,It.debounce)(o[77]))&&(0,It.debounce)(o[77]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&_(e),t=!1,r()}}}function A_(o){let e,t,r;return{c(){e=S("button"),e.textContent="Cancel",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=H(e,"click",function(){Qe((0,It.debounce)(o[76]))&&(0,It.debounce)(o[76]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&_(e),t=!1,r()}}}function mF(o){let e,t,r=o[12].values()[0].active&&!o[12].values()[0].cancelAt,n,s,i,a=r&&A_(o);return{c(){e=S("button"),e.textContent="Manage",t=F(),a&&a.c(),n=me()},m(l,c){x(l,e,c),x(l,t,c),a&&a.m(l,c),x(l,n,c),s||(i=H(e,"click",function(){Qe((0,It.debounce)(o[75]))&&(0,It.debounce)(o[75]).apply(this,arguments)}),s=!0)},p(l,c){o=l,c[0]&4096&&(r=o[12].values()[0].active&&!o[12].values()[0].cancelAt),r?a?a.p(o,c):(a=A_(o),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null)},d(l){l&&(_(e),_(t),_(n)),a&&a.d(l),s=!1,i()}}}function hF(o){let e,t=o[11].cta+"",r;return{c(){e=S("fragment"),r=V(t),h(e,"slot","description")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s[0]&2048&&t!==(t=n[11].cta+"")&&J(r,t)},d(n){n&&_(e)}}}function M_(o){let e,t;return e=new Oe({props:{description:"",$$slots:{name:[yF],default:[gF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&4096|n[2]&1073741824&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function gF(o){let e=o[30](o[12].values()[0].cancelAt)+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&4096&&e!==(e=r[30](r[12].values()[0].cancelAt)+"")&&J(t,e)},d(r){r&&_(t)}}}function yF(o){let e;return{c(){e=S("span"),e.textContent="Status: Cancelled",h(e,"slot","name"),h(e,"class","mod-warning")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function F_(o){let e,t,r,n,s,i,a,l,c,u;return e=new qe({props:{name:"Storage"}}),r=new r_({props:{diskUsagePercentage:Math.round(o[24].usage*100/o[24].quota)}}),s=new At({props:{name:"Usage",description:"Storage for images, audio, video, etc",$$slots:{default:[bF]},$$scope:{ctx:o}}}),a=new At({props:{name:"Total storage",description:"Total available storage.",$$slots:{default:[vF]},$$scope:{ctx:o}}}),c=new At({props:{name:"File size limit",description:"Maximum supported file size.",$$slots:{default:[_F]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=F(),D(r.$$.fragment),n=F(),D(s.$$.fragment),i=F(),D(a.$$.fragment),l=F(),D(c.$$.fragment)},m(f,d){E(e,f,d),x(f,t,d),E(r,f,d),x(f,n,d),E(s,f,d),x(f,i,d),E(a,f,d),x(f,l,d),E(c,f,d),u=!0},p(f,d){let p={};d[0]&16777216&&(p.diskUsagePercentage=Math.round(f[24].usage*100/f[24].quota)),r.$set(p);let m={};d[0]&16777216|d[2]&1073741824&&(m.$$scope={dirty:d,ctx:f}),s.$set(m);let y={};d[0]&16777216|d[2]&1073741824&&(y.$$scope={dirty:d,ctx:f}),a.$set(y);let g={};d[0]&16777216|d[2]&1073741824&&(g.$$scope={dirty:d,ctx:f}),c.$set(g)},i(f){u||(b(e.$$.fragment,f),b(r.$$.fragment,f),b(s.$$.fragment,f),b(a.$$.fragment,f),b(c.$$.fragment,f),u=!0)},o(f){w(e.$$.fragment,f),w(r.$$.fragment,f),w(s.$$.fragment,f),w(a.$$.fragment,f),w(c.$$.fragment,f),u=!1},d(f){f&&(_(t),_(n),_(i),_(l)),R(e,f),R(r,f),R(s,f),R(a,f),R(c,f)}}}function bF(o){let e=di(o[24].usage)+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&16777216&&e!==(e=di(r[24].usage)+"")&&J(t,e)},d(r){r&&_(t)}}}function vF(o){let e=di(o[24].quota)+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&16777216&&e!==(e=di(r[24].quota)+"")&&J(t,e)},d(r){r&&_(t)}}}function _F(o){let e=di(o[24].maxFileSize)+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&16777216&&e!==(e=di(r[24].maxFileSize)+"")&&J(t,e)},d(r){r&&_(t)}}}function P_(o){let e,t,r,n,s,i,a,l,c,u=[wF,xF],f=[];function d(m,y){return m[0].provider.selfHosted?0:1}e=d(o,[-1,-1,-1]),t=f[e]=u[e](o),n=new Oe({props:{name:"Name",description:"",$$slots:{default:[SF]},$$scope:{ctx:o}}}),i=new Oe({props:{name:"Domain",description:"",$$slots:{default:[kF]},$$scope:{ctx:o}}});let p=o[0].provider.selfHosted&&E_(o);return{c(){t.c(),r=F(),D(n.$$.fragment),s=F(),D(i.$$.fragment),a=F(),p&&p.c(),l=me()},m(m,y){f[e].m(m,y),x(m,r,y),E(n,m,y),x(m,s,y),E(i,m,y),x(m,a,y),p&&p.m(m,y),x(m,l,y),c=!0},p(m,y){let g=e;e=d(m,y),e!==g&&(oe(),w(f[g],1,1,()=>{f[g]=null}),ne(),t=f[e],t||(t=f[e]=u[e](m),t.c()),b(t,1),t.m(r.parentNode,r));let k={};y[0]&1|y[2]&1073741824&&(k.$$scope={dirty:y,ctx:m}),n.$set(k);let L={};y[0]&1|y[2]&1073741824&&(L.$$scope={dirty:y,ctx:m}),i.$set(L),m[0].provider.selfHosted?p?p.p(m,y):(p=E_(m),p.c(),p.m(l.parentNode,l)):p&&(p.d(1),p=null)},i(m){c||(b(t),b(n.$$.fragment,m),b(i.$$.fragment,m),c=!0)},o(m){w(t),w(n.$$.fragment,m),w(i.$$.fragment,m),c=!1},d(m){m&&(_(r),_(s),_(a),_(l)),f[e].d(m),R(n,m),R(i,m),p&&p.d(m)}}}function xF(o){let e,t;return e=new qe({props:{name:"Host"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function wF(o){let e,t;return e=new qe({props:{name:"Self hosting"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function SF(o){let e=o[0].provider.name+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.name+"")&&J(t,e)},d(r){r&&_(t)}}}function kF(o){let e=o[0].provider.url+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].provider.url+"")&&J(t,e)},d(r){r&&_(t)}}}function E_(o){let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:LF,then:CF,catch:IF,value:82};return Jo(t=o[29](o[0]),r),{c(){e=me(),r.block.c()},m(n,s){x(n,e,s),r.block.m(n,r.anchor=s),r.mount=()=>e.parentNode,r.anchor=e},p(n,s){o=n,r.ctx=o,s[0]&1&&t!==(t=o[29](o[0]))&&Jo(t,r)||ri(r,o,s)},d(n){n&&_(e),r.block.d(n),r.token=null,r=null}}}function IF(o){return{c:z,m:z,p:z,d:z}}function CF(o){let e,t=o[82].level==="warning"&&R_(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[82].level==="warning"?t?t.p(r,n):(t=R_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function R_(o){let e,t,r=Fn(o[82].status)+"",n,s=o[82].link&&D_(o);return{c(){e=S("p"),t=new Cn(!1),n=F(),s&&s.c(),t.a=n,h(e,"class","mod-warning relay-host-check svelte-uwwzsp")},m(i,a){x(i,e,a),t.m(r,e),v(e,n),s&&s.m(e,null)},p(i,a){a[0]&1&&r!==(r=Fn(i[82].status)+"")&&t.p(r),i[82].link?s?s.p(i,a):(s=D_(i),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},d(i){i&&_(e),s&&s.d()}}}function D_(o){let e,t,r,n=Fn(o[82].link.text)+"",s;return{c(){e=S("br"),t=F(),r=S("a"),h(r,"href",s=o[82].link.url)},m(i,a){x(i,e,a),x(i,t,a),x(i,r,a),r.innerHTML=n},p(i,a){a[0]&1&&n!==(n=Fn(i[82].link.text)+"")&&(r.innerHTML=n),a[0]&1&&s!==(s=i[82].link.url)&&h(r,"href",s)},d(i){i&&(_(e),_(t),_(r))}}}function LF(o){return{c:z,m:z,p:z,d:z}}function U_(o){let e,t,r,n;return e=new qe({props:{name:"Membership"}}),r=new Oe({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[TF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=F(),D(r.$$.fragment)},m(s,i){E(e,s,i),x(s,t,i),E(r,s,i),n=!0},p(s,i){let a={};i[2]&1073741824&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),w(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function TF(o){let e,t,r;return{c(){e=S("button"),e.textContent="Leave",h(e,"class","mod-warning")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,It.debounce)(o[78])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function O_(o){let e,t,r,n;return e=new qe({props:{name:"Danger zone"}}),r=new Oe({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[FF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=F(),D(r.$$.fragment)},m(s,i){E(e,s,i),x(s,t,i),E(r,s,i),n=!0},p(s,i){let a={};i[0]&4096|i[2]&1073741824&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),w(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function AF(o){let e,t,r;return{c(){e=S("button"),e.textContent="Destroy",h(e,"class","mod-warning")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,It.debounce)(o[49])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function MF(o){let e,t;return{c(){e=S("button"),e.textContent="Destroy",e.disabled=t=!0,h(e,"class","mod-warning"),h(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){x(r,e,n)},p:z,d(r){r&&_(e)}}}function FF(o){let e,t;function r(i,a){return a[0]&4096&&(e=null),e==null&&(e=i[12].values().length>0&&!i[12].values()[0].cancelAt),e?MF:AF}let n=r(o,[-1,-1,-1]),s=n(o);return{c(){s.c(),t=me()},m(i,a){s.m(i,a),x(i,t,a)},p(i,a){n===(n=r(i,a))&&s?s.p(i,a):(s.d(1),s=n(i),s&&(s.c(),s.m(t.parentNode,t)))},d(i){i&&_(t),s.d(i)}}}function PF(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,y,g,k,L,I,C,A,M,P=!o[11].owner||o[10].filter(o[61]).values().length>1,O,T,U;e=new ko({props:{items:[{type:"home",onClick:o[63]},{type:"relay",relay:o[0]}]}});let j=o[13]&&g_(o);n=new qe({props:{name:"Shared Folders on this Relay Server",$$slots:{default:[VM]},$$scope:{ctx:o}}});let Q=ke(o[18].values()),N=[];for(let q=0;q<Q.length;q+=1)N[q]=__(h_(o,Q,q));let X=q=>w(N[q],1,1,()=>{N[q]=null});a=new Oe({props:{description:"",name:"",$$slots:{default:[WM]},$$scope:{ctx:o}}}),d=new qe({props:{name:"Users",$$slots:{default:[JM]},$$scope:{ctx:o}}});let $=ke(o[6].values().sort(o[31])),B=[];for(let q=0;q<$.length;q+=1)B[q]=k_(p_(o,$,q));let pe=q=>w(B[q],1,1,()=>{B[q]=null});y=new Oe({props:{description:"",name:"",$$slots:{default:[tF]},$$scope:{ctx:o}}}),k=new qe({props:{name:"Sharing",helpText:"Share keys can be shared with collaborators so that they can join the Relay Server. Once you have added all of your collaborators, you can disable the share key to prevent anyone from joining, even if they have the key."}}),I=new At({props:{name:o[9]?"Enable key sharing":"Key sharing",$$slots:{description:[iF],default:[rF]},$$scope:{ctx:o}}});let Z=o[8]&&C_(o),ae=o[22]&&T_(o),ue=P&&U_(o),ee=o[25]&&O_(o);return{c(){D(e.$$.fragment),t=F(),j&&j.c(),r=F(),D(n.$$.fragment),s=F();for(let q=0;q<N.length;q+=1)N[q].c();i=F(),D(a.$$.fragment),l=F(),c=S("div"),u=F(),f=S("div"),D(d.$$.fragment),p=F();for(let q=0;q<B.length;q+=1)B[q].c();m=F(),D(y.$$.fragment),g=F(),D(k.$$.fragment),L=F(),D(I.$$.fragment),C=F(),Z&&Z.c(),A=F(),ae&&ae.c(),M=F(),ue&&ue.c(),O=F(),ee&&ee.c(),T=me(),h(c,"class","spacer svelte-uwwzsp"),h(f,"class","users-header")},m(q,Y){E(e,q,Y),x(q,t,Y),j&&j.m(q,Y),x(q,r,Y),E(n,q,Y),x(q,s,Y);for(let Te=0;Te<N.length;Te+=1)N[Te]&&N[Te].m(q,Y);x(q,i,Y),E(a,q,Y),x(q,l,Y),x(q,c,Y),x(q,u,Y),x(q,f,Y),E(d,f,null),x(q,p,Y);for(let Te=0;Te<B.length;Te+=1)B[Te]&&B[Te].m(q,Y);x(q,m,Y),E(y,q,Y),x(q,g,Y),E(k,q,Y),x(q,L,Y),E(I,q,Y),x(q,C,Y),Z&&Z.m(q,Y),x(q,A,Y),ae&&ae.m(q,Y),x(q,M,Y),ue&&ue.m(q,Y),x(q,O,Y),ee&&ee.m(q,Y),x(q,T,Y),U=!0},p(q,Y){let Te={};Y[0]&1&&(Te.items=[{type:"home",onClick:q[63]},{type:"relay",relay:q[0]}]),e.$set(Te),q[13]?j?(j.p(q,Y),Y[0]&8192&&b(j,1)):(j=g_(q),j.c(),b(j,1),j.m(r.parentNode,r)):j&&(oe(),w(j,1,1,()=>{j=null}),ne());let fe={};if(Y[0]&229376|Y[2]&1073741824&&(fe.$$scope={dirty:Y,ctx:q}),n.$set(fe),Y[0]&917506|Y[1]&536871040){Q=ke(q[18].values());let we;for(we=0;we<Q.length;we+=1){let Ve=h_(q,Q,we);N[we]?(N[we].p(Ve,Y),b(N[we],1)):(N[we]=__(Ve),N[we].c(),b(N[we],1),N[we].m(i.parentNode,i))}for(oe(),we=Q.length;we<N.length;we+=1)X(we);ne()}let Ee={};Y[0]&7|Y[2]&1073741824&&(Ee.$$scope={dirty:Y,ctx:q}),a.$set(Ee);let xe={};if(Y[0]&1081344|Y[2]&1073741824&&(xe.$$scope={dirty:Y,ctx:q}),d.$set(xe),Y[0]&3178562|Y[1]&1572865){$=ke(q[6].values().sort(q[31]));let we;for(we=0;we<$.length;we+=1){let Ve=p_(q,$,we);B[we]?(B[we].p(Ve,Y),b(B[we],1)):(B[we]=k_(Ve),B[we].c(),b(B[we],1),B[we].m(m.parentNode,m))}for(oe(),we=$.length;we<B.length;we+=1)pe(we);ne()}let se={};Y[0]&2112|Y[2]&1073741824&&(se.$$scope={dirty:Y,ctx:q}),y.$set(se);let Ae={};Y[0]&512&&(Ae.name=q[9]?"Enable key sharing":"Key sharing"),Y[0]&768|Y[2]&1073741824&&(Ae.$$scope={dirty:Y,ctx:q}),I.$set(Ae),q[8]?Z?(Z.p(q,Y),Y[0]&256&&b(Z,1)):(Z=C_(q),Z.c(),b(Z,1),Z.m(A.parentNode,A)):Z&&(oe(),w(Z,1,1,()=>{Z=null}),ne()),q[22]?ae?(ae.p(q,Y),Y[0]&4194304&&b(ae,1)):(ae=T_(q),ae.c(),b(ae,1),ae.m(M.parentNode,M)):ae&&(oe(),w(ae,1,1,()=>{ae=null}),ne()),Y[0]&3073&&(P=!q[11].owner||q[10].filter(q[61]).values().length>1),P?ue?(ue.p(q,Y),Y[0]&3073&&b(ue,1)):(ue=U_(q),ue.c(),b(ue,1),ue.m(O.parentNode,O)):ue&&(oe(),w(ue,1,1,()=>{ue=null}),ne()),q[25]?ee?(ee.p(q,Y),Y[0]&33554432&&b(ee,1)):(ee=O_(q),ee.c(),b(ee,1),ee.m(T.parentNode,T)):ee&&(oe(),w(ee,1,1,()=>{ee=null}),ne())},i(q){if(!U){b(e.$$.fragment,q),b(j),b(n.$$.fragment,q);for(let Y=0;Y<Q.length;Y+=1)b(N[Y]);b(a.$$.fragment,q),b(d.$$.fragment,q);for(let Y=0;Y<$.length;Y+=1)b(B[Y]);b(y.$$.fragment,q),b(k.$$.fragment,q),b(I.$$.fragment,q),b(Z),b(ae),b(ue),b(ee),U=!0}},o(q){w(e.$$.fragment,q),w(j),w(n.$$.fragment,q),N=N.filter(Boolean);for(let Y=0;Y<N.length;Y+=1)w(N[Y]);w(a.$$.fragment,q),w(d.$$.fragment,q),B=B.filter(Boolean);for(let Y=0;Y<B.length;Y+=1)w(B[Y]);w(y.$$.fragment,q),w(k.$$.fragment,q),w(I.$$.fragment,q),w(Z),w(ae),w(ue),w(ee),U=!1},d(q){q&&(_(t),_(r),_(s),_(i),_(l),_(c),_(u),_(f),_(p),_(m),_(g),_(L),_(C),_(A),_(M),_(O),_(T)),R(e,q),j&&j.d(q),R(n,q),ze(N,q),R(a,q),R(d),ze(B,q),R(y,q),R(k,q),R(I,q),Z&&Z.d(q),ae&&ae.d(q),ue&&ue.d(q),ee&&ee.d(q)}}}function di(o,e=2){if(o===0)return"0 MB";let t=1024,r=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],n=Math.floor(Math.log(o)/Math.log(t));return(o/Math.pow(t,n)).toFixed(e)+" "+r[n]}function EF(o,e){var t,r;let n={Owner:0,Member:1,Reader:2};return((t=n[o.name])!==null&&t!==void 0?t:999)-((r=n[e.name])!==null&&r!==void 0?r:999)}function RF(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function DF(o,e,t){let r,n,s,i,a,l=z,c=()=>(l(),l=Rt(ae,te=>t(10,a=te)),ae),u,f=z,d=()=>(f(),f=Rt(N,te=>t(11,u=te)),N),p,m,y,g,k,L,I,C,A=z,M=()=>(A(),A=Rt(Z,te=>t(19,C=te)),Z),P,O,T,U,j,Q;o.$$.on_destroy.push(()=>l()),o.$$.on_destroy.push(()=>f()),o.$$.on_destroy.push(()=>A());let{relay:N}=e;d();let X=N.folders;ce(o,X,te=>t(18,I=te));let $=Ce(!1);ce(o,$,te=>t(17,L=te));let{plugin:B}=e,pe=Ze([X,B.relayManager.relayRoles,B.relayManager.folderRoles],([te,Ne,et])=>{let Pt=Array.from(te.values()),Mo=Pt.filter(zr=>bo(B.relayManager.userCan(["folder","read_content"],zr))),Mr=Pt.filter(zr=>bo(B.relayManager.userCan(["folder","manage_users"],zr)));return Mo.length!==Mr.length});ce(o,pe,te=>t(16,k=te));let{sharedFolders:Z}=e;M();let{relayRoles:ae}=e;c(),B.relayManager.refreshRelay(N);function ue(te){return Pe(this,void 0,void 0,function*(){let Ne=yield B.loginManager.checkRelayHost(te.guid);if(Ne.status===200)return Ne.json})}function ee(te){if(!te)return"Active";let Ne=cm.moment.utc(),et=cm.moment.utc(te),Pt=et.diff(Ne,"days");return Pt<=0?"Subscription has ended":Pt===1?"Active for 1 more day":Pt>31?`Ends on ${et.format("YYYY-MM-DD")}`:`Active for ${Pt} more days`}function q(te,Ne){var et;return te.role==="Owner"&&Ne.role==="Owner"?te.userId===((et=B.loginManager.user)===null||et===void 0?void 0:et.id)?-1:1:te.role==="Owner"&&Ne.role!=="Owner"?-1:te.role!=="Owner"&&Ne.role==="Owner"||te.user.name>Ne.user.name?1:-1}let Y=Ze([B.relayManager.roles],([te])=>te.values().sort(EF));ce(o,Y,te=>t(21,O=te));let Te=u.subscriptions;ce(o,Te,te=>t(12,p=te));let fe=Ze(p,te=>{if(te.values().length===0)return;let Ne=te.values()[0];return Ne.token||B.relayManager.getSubscriptionToken(Ne).then(et=>{Ne.token=et}),Ne});ce(o,fe,te=>t(23,U=te));let Ee=u.storageQuota;ce(o,Ee,te=>t(24,j=te));let xe=a.filter(te=>te.relayId===N.id);ce(o,xe,te=>t(6,r=te));let se=Ce(!0);ce(o,se,te=>t(7,n=te));let Ae;dt(()=>{Ae&&Ae.value===""&&Ae.focus()});let we=Ye();function Ve(te){return Pe(this,void 0,void 0,function*(){var Ne;if(!(!((Ne=B.loginManager)===null||Ne===void 0)&&Ne.user))return;let et={relay:te.id,quantity:10,user_email:B.loginManager.user.email},Pt=btoa(JSON.stringify(et)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(B.buildApiUrl(`/subscribe/${Pt}`),"_blank")})}function ut(te){return Pe(this,void 0,void 0,function*(){let Ne=te.token,et=te.id;window.open(B.buildApiUrl(`/subscriptions/${et}/manage?token=${Ne}`),"_blank")})}function Zt(te){return Pe(this,void 0,void 0,function*(){let Ne=te.token,et=te.id;window.open(B.buildApiUrl(`/subscriptions/${et}/cancel?token=${Ne}`),"_blank")})}function Kt(te){i&&(Dt.set(te),B.relayManager.toggleRelayInvitation(Gt,s).then(Ne=>{Dt.set(Ne.enabled)}).catch(Ne=>{Dt.set(!te),Jt(Ne,"Failed to toggle share key")}))}function Ar(){return Pe(this,void 0,void 0,function*(){B.relayManager.leaveRelay(N),we("goBack",{clear:!0})})}function rn(){return Pe(this,void 0,void 0,function*(){we("goBack",{clear:!0})})}let Gt,Dt=Ce(!0);ce(o,Dt,te=>t(8,s=te));let To=Ce(!1);ce(o,To,te=>t(20,P=te)),B.relayManager.getRelayInvitation(N).then(te=>{te&&(t(5,Gt=te),Dt.set(te.enabled))});function on(){return Pe(this,void 0,void 0,function*(){if(Gt)try{t(5,Gt=yield B.relayManager.rotateKey(Gt))}catch(te){Jt(te,"Failed to rotate key.")}})}let io=Ce(!1);ce(o,io,te=>t(14,y=te));let nn=B.timeProvider.debounce(()=>{B.relayManager.updateRelay(N).then(()=>{io.set(!1)})},500);function Dn(){se.set(RF(Ae.value)),n&&Ae.value!==""&&(io.set(!0),nn())}function Un(){B.relayManager.destroyRelay(N),we("goBack",{})}function sn(te){B.relayManager.kick(te).catch(Ne=>{Jt(Ne,"Failed to remove user")})}function On(te,Ne){return Pe(this,void 0,void 0,function*(){try{yield B.relayManager.updateRelayRole(te,Ne)}catch(et){throw Jt(et,"Failed to change user role."),et}})}function ge(te){return Pe(this,void 0,void 0,function*(){let Ne=te.target,et=r.get(Ne.dataset.roleId);if(et){let Pt=et.role;try{yield On(et,Ne.value)}catch(Mo){Ne.value=Pt}}})}function Je(te){(te instanceof MouseEvent||te instanceof KeyboardEvent&&(te.key==="Enter"||te.key===" "))&&To.update(Ne=>!Ne)}let Xe=B.relayManager.userCan(["relay","manage_users"],N);ce(o,Xe,te=>t(15,g=te));let _r=B.relayManager.userCan(["relay","manage_sharing"],N);ce(o,_r,te=>t(9,i=te));let Ao=B.relayManager.userCan(["relay","rename"],N);ce(o,Ao,te=>t(13,m=te));let ie=B.relayManager.userCan(["relay","delete"],N);ce(o,ie,te=>t(25,Q=te));let $e=B.relayManager.userCan(["subscription","manage"],N);ce(o,$e,te=>t(22,T=te));function at(te,Ne,et,Pt){return Pe(this,void 0,void 0,function*(){let Mo=(0,It.normalizePath)(te),Mr=Z.find(xi=>xi.path==Mo);if(B.vault.getFolderByPath(Mo)===null&&(yield B.vault.createFolder(Mo)),!Mr){let xi=Ts();Mr=Z.new(Mo,xi,N.guid,!0)}let zr=yield B.relayManager.createRemoteFolder(Mr,N,et!=null?et:!1,Ne);if(et&&Pt&&Pt.length>0)for(let xi of Pt)yield B.relayManager.addFolderRole(zr,xi,"Member");return Mr.remote=zr,Mr.connect(),B.sharedFolders.notifyListeners(),Pt&&Pt.length>0&&setTimeout(()=>{we("manageRemoteFolder",{remoteFolder:zr})},100),Mr})}let ar=new yc(B.app,N,Z,B.relayManager,at);function lr(te){return Pe(this,void 0,void 0,function*(){function Ne(et,Pt,Mo){return Pe(this,void 0,void 0,function*(){let Mr=(0,It.normalizePath)((0,$_.join)(Mo,Pt));B.vault.getFolderByPath(Mr)===null&&(yield B.vault.createFolder(Mr));let zr=B.sharedFolders.new(Mr,et.guid,et.relay.guid,!0);return zr.remote=et,B.sharedFolders.notifyListeners(),we("manageRemoteFolder",{remoteFolder:zr.remote}),zr})}new Mn(B.app,B.sharedFolders,te,[],Ne).open()})}ns(()=>{ar==null||ar.destroy()});let ru=te=>te.role==="Owner"&&te.relayId===N.id,le=(te,Ne)=>Ne.guid===te.guid,We=()=>we("goBack",{clear:!0});function mt(){N.name=this.value,d(t(0,N))}function bt(te){_t[te?"unshift":"push"](()=>{Ae=te,t(4,Ae)})}let cr=()=>$.update(te=>!te),an=te=>{we("manageRemoteFolder",{remoteFolder:te})},_i=te=>{lr(te)},A1=te=>{we("manageRemoteFolder",{remoteFolder:te})},M1=()=>{N.version===0?new fi(B.app,"Choose or create folder...",new Set(Z.filter(Ne=>!!Ne.relayId).map(Ne=>Ne.path)).add("/"),Z,at).open():ar.open()},F1=te=>{sn(te)},P1=te=>Kt(te.currentTarget.checked),E1=()=>Kt(!s),R1=()=>Kt(!s),D1=()=>{ut(U)},U1=()=>{Zt(U)},O1=()=>{Ve(u)},$1=()=>{Ar()};return o.$$set=te=>{"relay"in te&&d(t(0,N=te.relay)),"plugin"in te&&t(1,B=te.plugin),"sharedFolders"in te&&M(t(2,Z=te.sharedFolders)),"relayRoles"in te&&c(t(3,ae=te.relayRoles))},[N,B,Z,ae,Ae,Gt,r,n,s,i,a,u,p,m,y,g,k,L,I,C,P,O,T,U,j,Q,X,$,pe,ue,ee,q,Y,Te,fe,Ee,xe,se,we,Ve,ut,Zt,Kt,Ar,Dt,To,on,io,Dn,Un,sn,ge,Je,Xe,_r,Ao,ie,$e,at,ar,lr,ru,le,We,mt,bt,cr,an,_i,A1,M1,F1,P1,E1,R1,D1,U1,O1,$1]}var um=class extends K{constructor(e){super(),G(this,e,DF,PF,W,{relay:0,plugin:1,sharedFolders:2,relayRoles:3},NM,[-1,-1,-1])}},pi=um;function UF(o){let e,t,r,n,s,i;return r=new dd({}),{c(){e=S("div"),t=S("div"),D(r.$$.fragment),h(t,"class","clickable-icon"),h(t,"aria-label","Back"),h(t,"tabindex","0"),h(t,"role","button"),h(e,"class","modal-setting-nav-bar")},m(a,l){x(a,e,l),v(e,t),E(r,t,null),n=!0,s||(i=[H(t,"click",o[0]),H(t,"keypress",o[1])],s=!0)},p:z,i(a){n||(b(r.$$.fragment,a),n=!0)},o(a){w(r.$$.fragment,a),n=!1},d(a){a&&_(e),R(r),s=!1,Ie(i)}}}function OF(o){let e=Ye();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var fm=class extends K{constructor(e){super(),G(this,e,OF,UF,W,{})}},N_=fm;var pm=require("obsidian");function B_(o){let e,t,r,n,s,i;return e=new qe({props:{name:"Danger zone"}}),r=new Oe({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[$F]},$$scope:{ctx:o}}}),s=new Oe({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[NF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=F(),D(r.$$.fragment),n=F(),D(s.$$.fragment)},m(a,l){E(e,a,l),x(a,t,l),E(r,a,l),x(a,n,l),E(s,a,l),i=!0},p(a,l){let c={};l&256&&(c.$$scope={dirty:l,ctx:a}),r.$set(c);let u={};l&256&&(u.$$scope={dirty:l,ctx:a}),s.$set(u)},i(a){i||(b(e.$$.fragment,a),b(r.$$.fragment,a),b(s.$$.fragment,a),i=!0)},o(a){w(e.$$.fragment,a),w(r.$$.fragment,a),w(s.$$.fragment,a),i=!1},d(a){a&&(_(t),_(n)),R(e,a),R(r,a),R(s,a)}}}function $F(o){let e,t,r;return{c(){e=S("button"),e.textContent="Delete metadata",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,pm.debounce)(o[6])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function NF(o){let e,t,r;return{c(){e=S("button"),e.textContent="Move to trash",h(e,"class","mod-warning")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,pm.debounce)(o[7])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function BF(o){let e,t,r,n,s,i;e=new ko({props:{items:[{type:"home",onClick:o[5]},{type:"folder",folder:o[0]}]}});let a=o[0]&&B_(o);return{c(){D(e.$$.fragment),t=F(),r=S("div"),r.innerHTML=`<p style="margin: 1em; text-align: center">This Shared Folder is not on a Relay Server, or else you do not have
		permission to access it.</p>`,n=F(),a&&a.c(),s=me(),he(r,"padding","1em"),he(r,"margin","1em"),he(r,"background","var(--background-secondary)")},m(l,c){E(e,l,c),x(l,t,c),x(l,r,c),x(l,n,c),a&&a.m(l,c),x(l,s,c),i=!0},p(l,[c]){let u={};c&1&&(u.items=[{type:"home",onClick:l[5]},{type:"folder",folder:l[0]}]),e.$set(u),l[0]?a?(a.p(l,c),c&1&&b(a,1)):(a=B_(l),a.c(),b(a,1),a.m(s.parentNode,s)):a&&(oe(),w(a,1,1,()=>{a=null}),ne())},i(l){i||(b(e.$$.fragment,l),b(a),i=!0)},o(l){w(e.$$.fragment,l),w(a),i=!1},d(l){l&&(_(t),_(r),_(n),_(s)),R(e,l),a&&a.d(l)}}}function VF(o,e,t){let{plugin:r}=e,{sharedFolder:n}=e,s=Ye();function i(){return Pe(this,void 0,void 0,function*(){n&&r.sharedFolders.delete(n),s("goBack",{clear:!0})})}function a(){if(n){let f=r.vault.getFolderByPath(n.path);f&&r.app.vault.trash(f,!1)}s("goBack",{})}let l=()=>s("goBack",{clear:!0}),c=()=>{i()},u=()=>{a()};return o.$$set=f=>{"plugin"in f&&t(4,r=f.plugin),"sharedFolder"in f&&t(0,n=f.sharedFolder)},[n,s,i,a,r,l,c,u]}var dm=class extends K{constructor(e){super(),G(this,e,VF,BF,W,{plugin:4,sharedFolder:0})}},bc=dm;var Co=require("obsidian");var hx=require("obsidian"),gx=ln($n());var j_=require("obsidian");function HF(o){Le(o,"svelte-1iq1qoa",".search-container.svelte-1iq1qoa.svelte-1iq1qoa{margin-bottom:16px}.search-input.svelte-1iq1qoa.svelte-1iq1qoa{width:100%;padding:8px 12px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal)}.user-list.svelte-1iq1qoa.svelte-1iq1qoa{flex:1;max-height:400px;overflow-y:auto;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);margin-bottom:16px}.user-item.svelte-1iq1qoa.svelte-1iq1qoa{display:flex;align-items:center;padding:12px;border-bottom:1px solid var(--background-modifier-border);cursor:pointer;gap:12px}.user-item.svelte-1iq1qoa.svelte-1iq1qoa:last-child{border-bottom:none}.user-item.svelte-1iq1qoa.svelte-1iq1qoa:hover:not(.has-access){background:var(--background-modifier-hover)}.user-item.has-access.svelte-1iq1qoa.svelte-1iq1qoa{opacity:0.6;cursor:not-allowed}.user-checkbox.svelte-1iq1qoa.svelte-1iq1qoa{margin:0;cursor:pointer}.user-avatar.svelte-1iq1qoa.svelte-1iq1qoa{width:32px;height:32px;border-radius:50%;background:var(--interactive-accent);display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:500;flex-shrink:0}.user-avatar.svelte-1iq1qoa img.svelte-1iq1qoa{width:100%;height:100%;border-radius:50%;object-fit:cover}.user-info.svelte-1iq1qoa.svelte-1iq1qoa{flex:1;min-width:0}.user-name.svelte-1iq1qoa.svelte-1iq1qoa{font-weight:500;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.user-status.svelte-1iq1qoa.svelte-1iq1qoa{font-size:0.8em;color:var(--text-muted);font-style:italic}.no-users.svelte-1iq1qoa.svelte-1iq1qoa{text-align:center;padding:40px;color:var(--text-muted)}.modal-button-container.svelte-1iq1qoa.svelte-1iq1qoa{display:flex;justify-content:space-between;align-items:center;margin-top:16px}.selection-count.svelte-1iq1qoa.svelte-1iq1qoa{color:var(--text-muted);font-size:0.9em}button.svelte-1iq1qoa.svelte-1iq1qoa:disabled{opacity:0.5;cursor:not-allowed}")}function V_(o,e,t){let r=o.slice();return r[22]=e[t],r}function qF(o){let e,t=ke(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=H_(V_(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=me()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);x(n,e,s)},p(n,s){if(s&130){t=ke(n[1]);let i;for(i=0;i<t.length;i+=1){let a=V_(n,t,i);r[i]?r[i].p(a,s):(r[i]=H_(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),ze(r,n)}}}function zF(o){let e,t=o[0]?"No users found":"No users available",r;return{c(){e=S("div"),r=V(t),h(e,"class","no-users svelte-1iq1qoa")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s&1&&t!==(t=n[0]?"No users found":"No users available")&&J(r,t)},d(n){n&&_(e)}}}function jF(o){let e=q_(o[22].user.name)+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n&2&&e!==(e=q_(r[22].user.name)+"")&&J(t,e)},d(r){r&&_(t)}}}function WF(o){let e,t,r;return{c(){e=S("img"),hr(e.src,t=o[22].user.picture)||h(e,"src",t),h(e,"alt",r=o[22].user.name),h(e,"class","svelte-1iq1qoa")},m(n,s){x(n,e,s)},p(n,s){s&2&&!hr(e.src,t=n[22].user.picture)&&h(e,"src",t),s&2&&r!==(r=n[22].user.name)&&h(e,"alt",r)},d(n){n&&_(e)}}}function KF(o){let e;return{c(){e=S("div"),e.textContent="(You)",h(e,"class","user-status svelte-1iq1qoa")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function GF(o){let e;return{c(){e=S("div"),e.textContent="Already has access",h(e,"class","user-status svelte-1iq1qoa")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function H_(o){let e,t,r,n,s,i,a,l,c,u=o[22].user.name+"",f,d,p,m,y;function g(...T){return o[14](o[22],...T)}function k(T,U){return T[22].user.picture?WF:jF}let L=k(o,-1),I=L(o);function C(T,U){if(T[22].hasAccess)return GF;if(T[22].isCurrentUser)return KF}let A=C(o,-1),M=A&&A(o);function P(){return o[15](o[22])}function O(...T){return o[16](o[22],...T)}return{c(){e=S("div"),t=S("input"),s=F(),i=S("div"),I.c(),a=F(),l=S("div"),c=S("div"),f=V(u),d=F(),M&&M.c(),p=F(),h(t,"type","checkbox"),t.checked=r=o[22].selected,t.disabled=n=o[22].hasAccess,h(t,"class","user-checkbox svelte-1iq1qoa"),h(i,"class","user-avatar svelte-1iq1qoa"),h(c,"class","user-name svelte-1iq1qoa"),h(l,"class","user-info svelte-1iq1qoa"),h(e,"class","user-item svelte-1iq1qoa"),h(e,"role","button"),h(e,"tabindex","0"),Me(e,"has-access",o[22].hasAccess),Me(e,"is-owner",o[22].isOwner),Me(e,"is-current-user",o[22].isCurrentUser)},m(T,U){x(T,e,U),v(e,t),v(e,s),v(e,i),I.m(i,null),v(e,a),v(e,l),v(l,c),v(c,f),v(e,d),M&&M.m(e,null),v(e,p),m||(y=[H(t,"click",g),H(e,"click",P),H(e,"keydown",O)],m=!0)},p(T,U){o=T,U&2&&r!==(r=o[22].selected)&&(t.checked=r),U&2&&n!==(n=o[22].hasAccess)&&(t.disabled=n),L===(L=k(o,U))&&I?I.p(o,U):(I.d(1),I=L(o),I&&(I.c(),I.m(i,null))),U&2&&u!==(u=o[22].user.name+"")&&J(f,u),A!==(A=C(o,U))&&(M&&M.d(1),M=A&&A(o),M&&(M.c(),M.m(e,p))),U&2&&Me(e,"has-access",o[22].hasAccess),U&2&&Me(e,"is-owner",o[22].isOwner),U&2&&Me(e,"is-current-user",o[22].isCurrentUser)},d(T){T&&_(e),I.d(),M&&M.d(),m=!1,Ie(y)}}}function JF(o){let e,t,r,n,s,i,a,l,c,u,f=o[2]===0?"No users selected":`${o[2]} user${o[2]===1?"":"s"} selected`,d,p,m,y,g,k,L;function I(M,P){return M[1].length===0?zF:qF}let C=I(o,-1),A=C(o);return{c(){e=S("div"),e.textContent="Invite users to this folder",t=F(),r=S("div"),n=S("div"),s=S("input"),i=F(),a=S("div"),A.c(),l=F(),c=S("div"),u=S("span"),d=V(f),p=F(),m=S("button"),y=V("Add Users"),h(e,"class","modal-title"),h(s,"type","text"),h(s,"placeholder","Search users by name..."),h(s,"class","search-input svelte-1iq1qoa"),h(n,"class","search-container svelte-1iq1qoa"),h(a,"class","user-list svelte-1iq1qoa"),h(u,"class","selection-count svelte-1iq1qoa"),h(m,"class","mod-cta svelte-1iq1qoa"),m.disabled=g=o[2]===0,h(c,"class","modal-button-container svelte-1iq1qoa"),h(r,"class","modal-content user-select-modal")},m(M,P){x(M,e,P),x(M,t,P),x(M,r,P),v(r,n),v(n,s),rt(s,o[0]),v(r,i),v(r,a),A.m(a,null),v(r,l),v(r,c),v(c,u),v(u,d),v(c,p),v(c,m),v(m,y),k||(L=[H(s,"input",o[13]),H(m,"click",o[8])],k=!0)},p(M,[P]){P&1&&s.value!==M[0]&&rt(s,M[0]),C===(C=I(M,P))&&A?A.p(M,P):(A.d(1),A=C(M),A&&(A.c(),A.m(a,null))),P&4&&f!==(f=M[2]===0?"No users selected":`${M[2]} user${M[2]===1?"":"s"} selected`)&&J(d,f),P&4&&g!==(g=M[2]===0)&&(m.disabled=g)},i:z,o:z,d(M){M&&(_(e),_(t),_(r)),A.d(),k=!1,Ie(L)}}}function q_(o){return o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}function QF(o,e,t){let r,n,s,i,{relayManager:a}=e,{folder:l}=e,{onAdd:c}=e,{preSelectedUserIds:u=[]}=e,f=Ce(new Set([...u]));ce(o,f,T=>t(17,r=T));let d=Ce("");ce(o,d,T=>t(0,n=T));let p=Ze([a.relayRoles],([T])=>T.values().filter(U=>U.relayId===l.relayId).map(U=>U.user)),m=Ze([a.folderRoles],([T])=>T.values().filter(U=>U.sharedFolderId===l.id)),y=Ze([p,m,f],([T,U,j])=>{var Q;let N=new Set(U.map(B=>B.userId)),X=new Set(U.filter(B=>B.role==="Owner").map(B=>B.userId)),$=(Q=a.user)===null||Q===void 0?void 0:Q.id;return T.map(B=>{let pe=X.has(B.id),Z=$===B.id,ae=j.has(B.id);return{user:B,hasAccess:N.has(B.id),selected:ae,isOwner:pe,isCurrentUser:Z}})}),g=Ze([y,d],([T,U])=>{if(!U)return T;let j=U.toLowerCase();return T.filter(Q=>Q.user.name.toLowerCase().includes(j))}),k=Ze([g],([T])=>T.sort((U,j)=>U.hasAccess&&!j.hasAccess?1:!U.hasAccess&&j.hasAccess?-1:U.user.name.localeCompare(j.user.name)));ce(o,k,T=>t(1,s=T));let L=Ze([f],([T])=>T.size);ce(o,L,T=>t(2,i=T));function I(T){T.hasAccess||f.update(U=>{let j=new Set(U);return j.has(T.user.id)?j.delete(T.user.id):j.add(T.user.id),j})}function C(){return Pe(this,void 0,void 0,function*(){let T=r;if(T.size!==0)try{yield c(Array.from(T),"Member")}catch(U){Jt(U)}})}function A(){n=this.value,d.set(n)}let M=(T,U)=>{U.stopPropagation(),I(T)},P=T=>I(T),O=(T,U)=>{(U.key==="Enter"||U.key===" ")&&(U.preventDefault(),I(T))};return o.$$set=T=>{"relayManager"in T&&t(9,a=T.relayManager),"folder"in T&&t(10,l=T.folder),"onAdd"in T&&t(11,c=T.onAdd),"preSelectedUserIds"in T&&t(12,u=T.preSelectedUserIds)},[n,s,i,f,d,k,L,I,C,a,l,c,u,A,M,P,O]}var mm=class extends K{constructor(e){super(),G(this,e,QF,JF,W,{relayManager:9,folder:10,onAdd:11,preSelectedUserIds:12},HF)}},z_=mm;var vc=class extends j_.Modal{constructor(t,r,n,s,i){super(t);this.relayManager=r;this.folder=n;this.onAdd=s;this.preSelectedUserIds=i}onOpen(){let{contentEl:t}=this;this.component=new z_({target:t,props:{relayManager:this.relayManager,folder:this.folder,preSelectedUserIds:this.preSelectedUserIds,onAdd:async(r,n)=>{await this.onAdd(r,n),this.close()}}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function YF(o){Le(o,"svelte-fmnezc",`div.spacer.svelte-fmnezc{height:3em}.local-settings.svelte-fmnezc{margin-left:-1em;padding-left:1em;border-left:1px solid var(--color-accent)}.system3-input-invalid.svelte-fmnezc{border:1px solid var(--color-red) !important}input.system3-updating.svelte-fmnezc{border:1px solid var(--color-accent) !important}.edit-members-button.svelte-fmnezc{display:flex;cursor:pointer;padding:4px;margin-bottom:-4px;border-radius:var(--radius-s);color:var(--icon-color);transition:color 0.15s ease-in-out,
			background-color 0.15s ease-in-out}.edit-members-button.svelte-fmnezc:hover{color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}.edit-members-button.svelte-fmnezc:focus{outline:none;color:var(--icon-color-focus)}select.dropdown.svelte-fmnezc:disabled{opacity:1 !important;color:var(--text-muted) !important;-webkit-text-fill-color:var(--text-muted) !important}`)}function W_(o,e,t){let r=o.slice();return r[67]=e[t][0],r[68]=e[t][1],r}function K_(o,e,t){let r=o.slice();return r[71]=e[t],r}function G_(o,e,t){let r=o.slice();return r[71]=e[t],r}function J_(o){let e;return{c(){e=S("div"),e.innerHTML=`<p style="margin: 1em; text-align: center">As Relay Server owner, you can manage this Shared Folder but cannot access
			its contents. You must be added to the Shared Folder in order to
			collaborate.</p>`,he(e,"padding","1em"),he(e,"margin","1em"),he(e,"background","var(--background-secondary)")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function Q_(o){let e,t;return e=new Oe({props:{name:"Name",description:"Set the Shared Folder's default name. A Shared Folder can always be renamed locally.",$$slots:{default:[ZF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&16521|n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function ZF(o){let e,t,r,n;return{c(){e=S("input"),h(e,"type","text"),h(e,"spellcheck","false"),h(e,"placeholder","Example: Shared Notes"),h(e,"class",t=kt((o[14]?"system3-updating":"")+(o[7]?"":" system3-input-invalid"))+" svelte-fmnezc")},m(s,i){x(s,e,i),rt(e,o[0].name),o[55](e),r||(n=[H(e,"input",o[54]),H(e,"input",o[47])],r=!0)},p(s,i){i[0]&16512&&t!==(t=kt((s[14]?"system3-updating":"")+(s[7]?"":" system3-input-invalid"))+" svelte-fmnezc")&&h(e,"class",t),i[0]&1&&e.value!==s[0].name&&rt(e,s[0].name)},d(s){s&&_(e),o[55](null),r=!1,Ie(n)}}}function Y_(o){let e,t,r,n;return e=new qe({props:{name:"Add to vault"}}),r=new Oe({props:{name:"Add this folder to your vault",description:"Download and sync this folder to your local device",$$slots:{default:[XF]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment),t=F(),D(r.$$.fragment)},m(s,i){E(e,s,i),x(s,t,i),E(r,s,i),n=!0},p(s,i){let a={};i[2]&16384&&(a.$$scope={dirty:i,ctx:s}),r.$set(a)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),w(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function XF(o){let e,t,r;return{c(){e=S("button"),e.textContent="Add to vault",h(e,"class","mod-cta")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,Co.debounce)(o[46])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function Z_(o){let e,t,r,n,s;e=new qe({props:{name:"Users with access",helpText:o[6]?"":"This folder is accessible to everyone on this Relay Server.",$$slots:{default:[rP]},$$scope:{ctx:o}}});let i=ke(o[8]),a=[];for(let u=0;u<i.length;u+=1)a[u]=rx(K_(o,i,u));let l=u=>w(a[u],1,1,()=>{a[u]=null}),c=o[6]&&o[11]&&ox(o);return{c(){D(e.$$.fragment),t=F();for(let u=0;u<a.length;u+=1)a[u].c();r=F(),c&&c.c(),n=me()},m(u,f){E(e,u,f),x(u,t,f);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(u,f);x(u,r,f),c&&c.m(u,f),x(u,n,f),s=!0},p(u,f){let d={};if(f[0]&64&&(d.helpText=u[6]?"":"This folder is accessible to everyone on this Relay Server."),f[0]&67588|f[2]&16384&&(d.$$scope={dirty:f,ctx:u}),e.$set(d),f[0]&198976|f[1]&18432){i=ke(u[8]);let p;for(p=0;p<i.length;p+=1){let m=K_(u,i,p);a[p]?(a[p].p(m,f),b(a[p],1)):(a[p]=rx(m),a[p].c(),b(a[p],1),a[p].m(r.parentNode,r))}for(oe(),p=i.length;p<a.length;p+=1)l(p);ne()}u[6]&&u[11]?c?(c.p(u,f),f[0]&2112&&b(c,1)):(c=ox(u),c.c(),b(c,1),c.m(n.parentNode,n)):c&&(oe(),w(c,1,1,()=>{c=null}),ne())},i(u){if(!s){b(e.$$.fragment,u);for(let f=0;f<i.length;f+=1)b(a[f]);b(c),s=!0}},o(u){w(e.$$.fragment,u),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)w(a[f]);w(c),s=!1},d(u){u&&(_(t),_(r),_(n)),R(e,u),ze(a,u),c&&c.d(u)}}}function X_(o){let e,t,r,n,s,i,a,l=[tP,eP],c=[];function u(f,d){return f[16]?0:1}return t=u(o,[-1,-1,-1]),r=c[t]=l[t](o),{c(){e=S("div"),r.c(),h(e,"class","edit-members-button svelte-fmnezc"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-label",n=o[16]?"Cancel editing users":"Edit users")},m(f,d){x(f,e,d),c[t].m(e,null),s=!0,i||(a=[H(e,"click",o[41]),H(e,"keypress",o[41])],i=!0)},p(f,d){let p=t;t=u(f,d),t!==p&&(oe(),w(c[p],1,1,()=>{c[p]=null}),ne(),r=c[t],r||(r=c[t]=l[t](f),r.c()),b(r,1),r.m(e,null)),(!s||d[0]&65536&&n!==(n=f[16]?"Cancel editing users":"Edit users"))&&h(e,"aria-label",n)},i(f){s||(b(r),s=!0)},o(f){w(r),s=!1},d(f){f&&_(e),c[t].d(),i=!1,Ie(a)}}}function eP(o){let e,t;return e=new ma({props:{class:"svg-icon"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function tP(o){let e,t;return e=new la({props:{class:"svg-icon"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function rP(o){let e,t,r=o[2].private&&o[11]&&X_(o);return{c(){r&&r.c(),e=me()},m(n,s){r&&r.m(n,s),x(n,e,s),t=!0},p(n,s){n[2].private&&n[11]?r?(r.p(n,s),s[0]&2052&&b(r,1)):(r=X_(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),w(r,1,1,()=>{r=null}),ne())},i(n){t||(b(r),t=!0)},o(n){w(r),t=!1},d(n){n&&_(e),r&&r.d(n)}}}function ex(o){let e;function t(s,i){return s[16]?sP:s[11]?nP:oP}let r=t(o,[-1,-1,-1]),n=r(o);return{c(){n.c(),e=me()},m(s,i){n.m(s,i),x(s,e,i)},p(s,i){r===(r=t(s,i))&&n?n.p(s,i):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n.d(s)}}}function oP(o){let e,t=o[71].role+"",r;return{c(){e=S("span"),r=V(t),h(e,"class","role-label")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s[0]&256&&t!==(t=n[71].role+"")&&J(r,t)},d(n){n&&_(e)}}}function nP(o){let e,t,r,n,s,i,a=ke(o[17]),l=[];for(let c=0;c<a.length;c+=1)l[c]=tx(G_(o,a,c));return{c(){e=S("div"),t=S("select");for(let c=0;c<l.length;c+=1)l[c].c();h(t,"class","dropdown svelte-fmnezc"),h(t,"data-role-id",n=o[71].id),he(e,"display","flex"),he(e,"gap","8px"),he(e,"align-items","center")},m(c,u){x(c,e,u),v(e,t);for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(t,null);Xs(t,o[71].role),s||(i=H(t,"change",o[45]),s=!0)},p(c,u){if(u[0]&131072){a=ke(c[17]);let f;for(f=0;f<a.length;f+=1){let d=G_(c,a,f);l[f]?l[f].p(d,u):(l[f]=tx(d),l[f].c(),l[f].m(t,null))}for(;f<l.length;f+=1)l[f].d(1);l.length=a.length}u[0]&131328&&r!==(r=c[71].role)&&Xs(t,c[71].role),u[0]&131328&&n!==(n=c[71].id)&&h(t,"data-role-id",n)},d(c){c&&_(e),ze(l,c),s=!1,i()}}}function sP(o){let e,t,r;function n(){return o[56](o[71])}return{c(){e=S("button"),e.textContent="Remove",h(e,"class","mod-destructive")},m(s,i){x(s,e,i),t||(r=H(e,"click",function(){Qe((0,Co.debounce)(n))&&(0,Co.debounce)(n).apply(this,arguments)}),t=!0)},p(s,i){o=s},d(s){s&&_(e),t=!1,r()}}}function tx(o){let e,t=o[71].name+"",r,n;return{c(){e=S("option"),r=V(t),e.__value=n=o[71].name,rt(e,e.__value)},m(s,i){x(s,e,i),v(e,r)},p(s,i){i[0]&131072&&t!==(t=s[71].name+"")&&J(r,t),i[0]&131072&&n!==(n=s[71].name)&&(e.__value=n,rt(e,e.__value))},d(s){s&&_(e)}}}function iP(o){let e,t=o[6]&&ex(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[6]?t?t.p(r,n):(t=ex(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function rx(o){let e,t;return e=new li({props:{user:o[71].user,$$slots:{default:[iP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&256&&(s.user=r[71].user),n[0]&198976|n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function ox(o){let e,t;return e=new Oe({props:{description:"",name:"",$$slots:{default:[aP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&65536|n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function aP(o){let e,t,r,n;return{c(){e=S("button"),t=V("Add User"),h(e,"class","mod-cta"),h(e,"aria-label","Add user to private folder"),e.disabled=o[16]},m(s,i){x(s,e,i),v(e,t),r||(n=H(e,"click",(0,Co.debounce)(o[44])),r=!0)},p(s,i){i[0]&65536&&(e.disabled=s[16])},d(s){s&&_(e),r=!1,n()}}}function nx(o){let e,t,r,n,s,i;t=new qe({props:{name:"Sync settings for this device",helpText:"You must have attachment storage available in order to sync attachments."}});let a=o[2].name!==o[9].name&&sx(o),l=ke(o[5]),c=[];for(let d=0;d<l.length;d+=1)c[d]=ax(W_(o,l,d));let u=d=>w(c[d],1,1,()=>{c[d]=null}),f=o[10]&&o[15]&&lx(o);return{c(){e=S("div"),D(t.$$.fragment),r=F(),a&&a.c(),n=F();for(let d=0;d<c.length;d+=1)c[d].c();s=F(),f&&f.c(),h(e,"class","local-settings svelte-fmnezc")},m(d,p){x(d,e,p),E(t,e,null),v(e,r),a&&a.m(e,null),v(e,n);for(let m=0;m<c.length;m+=1)c[m]&&c[m].m(e,null);v(e,s),f&&f.m(e,null),i=!0},p(d,p){if(d[2].name!==d[9].name?a?(a.p(d,p),p[0]&516&&b(a,1)):(a=sx(d),a.c(),b(a,1),a.m(e,n)):a&&(oe(),w(a,1,1,()=>{a=null}),ne()),p[0]&263216|p[1]&1){l=ke(d[5]);let m;for(m=0;m<l.length;m+=1){let y=W_(d,l,m);c[m]?(c[m].p(y,p),b(c[m],1)):(c[m]=ax(y),c[m].c(),b(c[m],1),c[m].m(e,s))}for(oe(),m=l.length;m<c.length;m+=1)u(m);ne()}d[10]&&d[15]?f?(f.p(d,p),p[0]&33792&&b(f,1)):(f=lx(d),f.c(),b(f,1),f.m(e,null)):f&&(oe(),w(f,1,1,()=>{f=null}),ne())},i(d){if(!i){b(t.$$.fragment,d),b(a);for(let p=0;p<l.length;p+=1)b(c[p]);b(f),i=!0}},o(d){w(t.$$.fragment,d),w(a),c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)w(c[p]);w(f),i=!1},d(d){d&&_(e),R(t),a&&a.d(),ze(c,d),f&&f.d()}}}function sx(o){let e,t;return e=new Oe({props:{name:"Local path",description:"This folder has a different name in your Vault",$$slots:{default:[lP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&512|n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function lP(o){let e,t=o[9].path+"",r;return{c(){e=V("/"),r=V(t)},m(n,s){x(n,e,s),x(n,r,s)},p(n,s){s[0]&512&&t!==(t=n[9].path+"")&&J(r,t)},d(n){n&&(_(e),_(r))}}}function ix(o){let e,t;return e=new mc({}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function cP(o){let e,t,r,n,s,i,a,l,c,u,f,d=o[10]&&ix(o);function p(...g){return o[57](o[67],...g)}function m(){return o[58](o[67])}function y(){return o[59](o[67])}return{c(){e=S("div"),d&&d.c(),t=F(),r=S("div"),n=S("input"),i=F(),a=S("div"),h(n,"type","checkbox"),n.checked=s=o[18][o[67]]&&!o[10],n.disabled=o[4],h(a,"class","checkbox-toggle"),h(r,"role","checkbox"),h(r,"aria-checked",l=o[18][o[67]]&&!o[10]),h(r,"tabindex","0"),h(r,"class","checkbox-container"),Me(r,"is-enabled",o[18][o[67]]&&!o[10]),h(e,"class","setting-item-control")},m(g,k){x(g,e,k),d&&d.m(e,null),v(e,t),v(e,r),v(r,n),v(r,i),v(r,a),c=!0,u||(f=[H(n,"change",p),H(r,"keypress",m),H(r,"click",y)],u=!0)},p(g,k){o=g,o[10]?d?k[0]&1024&&b(d,1):(d=ix(o),d.c(),b(d,1),d.m(e,t)):d&&(oe(),w(d,1,1,()=>{d=null}),ne()),(!c||k[0]&263200&&s!==(s=o[18][o[67]]&&!o[10]))&&(n.checked=s),(!c||k[0]&16)&&(n.disabled=o[4]),(!c||k[0]&263200&&l!==(l=o[18][o[67]]&&!o[10]))&&h(r,"aria-checked",l),(!c||k[0]&263200)&&Me(r,"is-enabled",o[18][o[67]]&&!o[10])},i(g){c||(b(d),c=!0)},o(g){w(d),c=!1},d(g){g&&_(e),d&&d.d(),u=!1,Ie(f)}}}function ax(o){let e,t;return e=new At({props:{name:o[68].name,description:o[68].description,$$slots:{default:[cP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&32&&(s.name=r[68].name),n[0]&32&&(s.description=r[68].description),n[0]&263216|n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function lx(o){let e,t;return e=new At({props:{name:"",$$slots:{default:[uP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&32768|n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uP(o){let e,t,r;return{c(){e=S("button"),e.textContent="Buy storage",h(e,"class","mod-cta")},m(n,s){x(n,e,s),t||(r=H(e,"click",function(){Qe((0,Co.debounce)(o[60]))&&(0,Co.debounce)(o[60]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&_(e),t=!1,r()}}}function cx(o){let e,t;return e=new qe({props:{name:"Danger zone"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function ux(o){let e,t,r,n=o[20]&&fx(o),s=o[19]&&px(o);return{c(){n&&n.c(),e=F(),s&&s.c(),t=me()},m(i,a){n&&n.m(i,a),x(i,e,a),s&&s.m(i,a),x(i,t,a),r=!0},p(i,a){i[20]?n?(n.p(i,a),a[0]&1048576&&b(n,1)):(n=fx(i),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(oe(),w(n,1,1,()=>{n=null}),ne()),i[19]?s?(s.p(i,a),a[0]&524288&&b(s,1)):(s=px(i),s.c(),b(s,1),s.m(t.parentNode,t)):s&&(oe(),w(s,1,1,()=>{s=null}),ne())},i(i){r||(b(n),b(s),r=!0)},o(i){w(n),w(s),r=!1},d(i){i&&(_(e),_(t)),n&&n.d(i),s&&s.d(i)}}}function fx(o){var n,s;let e,t,r=!((n=o[0])!=null&&n.private)&&((s=o[0])==null?void 0:s.relay.version)>0&&dx(o);return{c(){r&&r.c(),e=me()},m(i,a){r&&r.m(i,a),x(i,e,a),t=!0},p(i,a){var l,c;!((l=i[0])!=null&&l.private)&&((c=i[0])==null?void 0:c.relay.version)>0?r?(r.p(i,a),a[0]&1&&b(r,1)):(r=dx(i),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),w(r,1,1,()=>{r=null}),ne())},i(i){t||(b(r),t=!0)},o(i){w(r),t=!1},d(i){i&&_(e),r&&r.d(i)}}}function dx(o){let e,t;return e=new Oe({props:{name:"Make private",description:"Convert this folder to a private folder and manage access",$$slots:{default:[fP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function fP(o){let e,t,r;return{c(){e=S("button"),e.textContent="Make private",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,Co.debounce)(o[43])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function px(o){let e,t;return e=new Oe({props:{name:"Remove from Relay Server",description:"Deletes the remote folder from the Relay Server. Local files will be preserved.",$$slots:{default:[dP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function dP(o){let e,t,r;return{c(){e=S("button"),e.textContent="Delete from Relay Server",h(e,"class","mod-destructive")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,Co.debounce)(o[40])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function mx(o){let e,t;return e=new Oe({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[pP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[2]&16384&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function pP(o){let e,t,r;return{c(){e=S("button"),e.textContent="Move to trash",h(e,"class","mod-warning")},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,Co.debounce)(o[61])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function mP(o){let e,t,r,n,s,i,a,l,c=o[9]&&o[18]&&o[15]&&je().enableAttachmentSync,u,f,d,p,m,y,g;e=new ko({props:{items:[{type:"home",onClick:o[52]},{type:"relay",relay:o[2].relay,onClick:o[53]},{type:"remoteFolder",remoteFolder:{...o[2],name:o[2].name,private:o[6]}}]}});let k=o[11]&&!o[12]&&J_(o),L=o[13]&&Q_(o),I=!o[9]&&o[12]&&Y_(o),C=o[15]&&Z_(o),A=c&&nx(o),M=(o[19]||o[20]||o[9])&&cx(o),P=o[15]&&ux(o),O=o[9]&&mx(o);return{c(){D(e.$$.fragment),t=F(),k&&k.c(),r=F(),L&&L.c(),n=F(),I&&I.c(),s=F(),C&&C.c(),i=F(),a=S("div"),l=F(),A&&A.c(),u=F(),f=S("div"),d=F(),M&&M.c(),p=F(),P&&P.c(),m=F(),O&&O.c(),y=me(),h(a,"class","spacer svelte-fmnezc"),h(f,"class","spacer svelte-fmnezc")},m(T,U){E(e,T,U),x(T,t,U),k&&k.m(T,U),x(T,r,U),L&&L.m(T,U),x(T,n,U),I&&I.m(T,U),x(T,s,U),C&&C.m(T,U),x(T,i,U),x(T,a,U),x(T,l,U),A&&A.m(T,U),x(T,u,U),x(T,f,U),x(T,d,U),M&&M.m(T,U),x(T,p,U),P&&P.m(T,U),x(T,m,U),O&&O.m(T,U),x(T,y,U),g=!0},p(T,U){let j={};U[0]&68&&(j.items=[{type:"home",onClick:T[52]},{type:"relay",relay:T[2].relay,onClick:T[53]},{type:"remoteFolder",remoteFolder:{...T[2],name:T[2].name,private:T[6]}}]),e.$set(j),T[11]&&!T[12]?k||(k=J_(T),k.c(),k.m(r.parentNode,r)):k&&(k.d(1),k=null),T[13]?L?(L.p(T,U),U[0]&8192&&b(L,1)):(L=Q_(T),L.c(),b(L,1),L.m(n.parentNode,n)):L&&(oe(),w(L,1,1,()=>{L=null}),ne()),!T[9]&&T[12]?I?(I.p(T,U),U[0]&4608&&b(I,1)):(I=Y_(T),I.c(),b(I,1),I.m(s.parentNode,s)):I&&(oe(),w(I,1,1,()=>{I=null}),ne()),T[15]?C?(C.p(T,U),U[0]&32768&&b(C,1)):(C=Z_(T),C.c(),b(C,1),C.m(i.parentNode,i)):C&&(oe(),w(C,1,1,()=>{C=null}),ne()),U[0]&295424&&(c=T[9]&&T[18]&&T[15]&&je().enableAttachmentSync),c?A?(A.p(T,U),U[0]&295424&&b(A,1)):(A=nx(T),A.c(),b(A,1),A.m(u.parentNode,u)):A&&(oe(),w(A,1,1,()=>{A=null}),ne()),T[19]||T[20]||T[9]?M?U[0]&1573376&&b(M,1):(M=cx(T),M.c(),b(M,1),M.m(p.parentNode,p)):M&&(oe(),w(M,1,1,()=>{M=null}),ne()),T[15]?P?(P.p(T,U),U[0]&32768&&b(P,1)):(P=ux(T),P.c(),b(P,1),P.m(m.parentNode,m)):P&&(oe(),w(P,1,1,()=>{P=null}),ne()),T[9]?O?(O.p(T,U),U[0]&512&&b(O,1)):(O=mx(T),O.c(),b(O,1),O.m(y.parentNode,y)):O&&(oe(),w(O,1,1,()=>{O=null}),ne())},i(T){g||(b(e.$$.fragment,T),b(L),b(I),b(C),b(A),b(M),b(P),b(O),g=!0)},o(T){w(e.$$.fragment,T),w(L),w(I),w(C),w(A),w(M),w(P),w(O),g=!1},d(T){T&&(_(t),_(r),_(n),_(s),_(i),_(a),_(l),_(u),_(f),_(d),_(p),_(m),_(y)),R(e,T),k&&k.d(T),L&&L.d(T),I&&I.d(T),C&&C.d(T),A&&A.d(T),M&&M.d(T),P&&P.d(T),O&&O.d(T)}}}function hP(o,e){var t,r;let n={Owner:0,Member:1,Reader:2};return((t=n[o.name])!==null&&t!==void 0?t:999)-((r=n[e.name])!==null&&r!==void 0?r:999)}function gP(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function yP(o,e,t){let r,n,s,i,a,l,c,u=z,f=()=>(u(),u=Rt(U,le=>t(2,c=le)),U),d,p=z,m=()=>(p(),p=Rt(j,le=>t(63,d=le)),j),y,g,k,L,I,C,A,M,P,O;o.$$.on_destroy.push(()=>u()),o.$$.on_destroy.push(()=>p());let{plugin:T}=e,{remoteFolder:U}=e;f();let{sharedFolders:j}=e;m();let{relayRoles:Q}=e,{folderRoles:N}=e,{errorLog:X=Fe("ManageRemoveFolder.svelte","error")}=e;T.relayManager.refreshRemoteFolder(U);let $=Ze([Q],([le])=>{var We;return(We=le.find(mt=>mt.relayId===c.relayId))===null||We===void 0?void 0:We.relay});ce(o,$,le=>t(15,I=le));let B=Ze(d,le=>le.find(We=>We.guid===U.guid));ce(o,B,le=>t(9,a=le));let pe=Ze([T.relayManager.roles],([le])=>le.values().sort(hP));ce(o,pe,le=>t(17,A=le));let Z=Ze([N,Q],([le,We])=>{if(c.private){let bt=[];for(let cr of le.values())cr.sharedFolderId===c.id&&We.some(an=>an.userId===cr.userId)&&bt.push(cr);return bt}let mt=[];for(let bt of We.values())bt.relayId===c.relayId&&mt.push(bt);return mt});ce(o,Z,le=>t(8,i=le));let ae=Ce(!1);ce(o,ae,le=>t(16,C=le));let ue=Ce(!0);ce(o,ue,le=>t(7,s=le));let ee,q=Ce(!1);ce(o,q,le=>t(14,L=le));let Y=U.name;dt(()=>{ee&&ee.value===""&&ee.focus()});function Te(le){return Pe(this,void 0,void 0,function*(){var We;if(!(!((We=T.loginManager)===null||We===void 0)&&We.user))return;let mt={relay:le.id,quantity:10,user_email:T.loginManager.user.email},bt=btoa(JSON.stringify(mt)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(T.buildApiUrl(`/subscribe/${bt}?action="buy_storage"`),"_blank")})}let fe=a==null?void 0:a.syncSettingsManager;ce(o,fe,le=>t(18,M=le));let Ee=Ze([B,Q],([le,We])=>{var mt,bt,cr;return((cr=(bt=(mt=We.find(an=>{var _i;return an.relay===((_i=le==null?void 0:le.remote)===null||_i===void 0?void 0:_i.relay)}))===null||mt===void 0?void 0:mt.relay)===null||bt===void 0?void 0:bt.storageQuota)===null||cr===void 0?void 0:cr.quota)===0});ce(o,Ee,le=>t(10,l=le));let xe=!1;function se(le,We){return Pe(this,void 0,void 0,function*(){if(!xe&&!l&&fe){t(4,xe=!0);try{yield fe.toggleCategory(le,We),t(5,n=Object.entries(fe.getCategories()))}catch(mt){}finally{t(4,xe=!1)}}})}let Ae=Ye(),we=T.relayManager.userCan(["folder","read_content"],U);ce(o,we,le=>t(12,g=le));let Ve=T.relayManager.userCan(["folder","rename"],U);ce(o,Ve,le=>t(13,k=le));let ut=T.relayManager.userCan(["folder","delete"],U);ce(o,ut,le=>t(19,P=le));let Zt=T.relayManager.userCan(["folder","manage_users"],U);ce(o,Zt,le=>t(11,y=le));let Kt=T.relayManager.userCan(["folder","make_private"],U);ce(o,Kt,le=>t(20,O=le));function Ar(le){le&&Ae("manageRelay",{relay:le})}function rn(){return Pe(this,void 0,void 0,function*(){a&&T.sharedFolders.delete(a),Ae("goBack",{clear:!0})})}function Gt(){if(a){let le=T.vault.getFolderByPath(a.path);le&&T.app.vault.trash(le,!1)}}function Dt(){return Pe(this,void 0,void 0,function*(){try{if(yield T.relayManager.deleteRemote(U),a){Qs(B,a.remote=void 0,a),T.sharedFolders.notifyListeners(),Ae("manageSharedFolder",{folder:a});return}}catch(le){X("Failed to delete remote folder:",le)}Ae("goBack",{})})}function To(le){(le instanceof MouseEvent||le instanceof KeyboardEvent&&(le.key==="Enter"||le.key===" "))&&ae.update(We=>!We)}function on(le){return Pe(this,void 0,void 0,function*(){try{yield T.relayManager.removeFolderRole(le)}catch(We){Jt(We,"Failed to remove user from folder.")}})}function io(){return Pe(this,void 0,void 0,function*(){try{let le=yield T.relayManager.updateFolderPrivacy(U,!0);f(t(0,U=le)),nn()}catch(le){Jt(le,"Failed to make folder private. Permission denied.")}})}function nn(){new vc(T.app,T.relayManager,U,(We,mt)=>Pe(this,void 0,void 0,function*(){try{for(let bt of We)yield T.relayManager.addFolderRole(U,bt,mt)}catch(bt){Jt(bt,"Failed to add users to folder.")}})).open()}function Dn(le,We){return Pe(this,void 0,void 0,function*(){try{yield T.relayManager.updateFolderRole(le,We)}catch(mt){throw Jt(mt,"Failed to change user role."),mt}})}function Un(le){return Pe(this,void 0,void 0,function*(){let We=le.target,mt=i.find(bt=>bt.id===We.dataset.roleId);if(mt){let bt=mt.role;try{yield Dn(mt,We.value)}catch(cr){We.value=bt}}})}function sn(){return Pe(this,void 0,void 0,function*(){function le(We,mt,bt){return Pe(this,void 0,void 0,function*(){let cr=(0,hx.normalizePath)((0,gx.join)(bt,mt));T.vault.getFolderByPath(cr)===null&&(yield T.vault.createFolder(cr));let an=T.sharedFolders.new(cr,We.guid,We.relay.guid,!0);return an.remote=We,T.sharedFolders.notifyListeners(),Ae("manageRemoteFolder",{remoteFolder:We}),an})}new Mn(T.app,T.sharedFolders,U,[],le).open()})}let On=T.timeProvider.debounce(()=>Pe(void 0,void 0,void 0,function*(){try{let le=U.name.trim(),We=yield T.relayManager.updateRemoteFolder(U,{name:le});We&&(U.update(We),Y=We.name),q.set(!1)}catch(le){X("Failed to update folder name:",le),(le==null?void 0:le.status)===400&&ue.set(!1),q.set(!1)}}),500);function ge(){ue.set(gP(ee.value));let le=ee.value.trim();s&&le!==""&&le!==Y&&(q.set(!0),On())}let Je=()=>Ae("goBack",{clear:!0}),Xe=()=>Ar(c.relay);function _r(){U.name=this.value,f(t(0,U))}function Ao(le){_t[le?"unshift":"push"](()=>{ee=le,t(3,ee)})}let ie=le=>{"sharedFolder"in le&&on(le)},$e=(le,We)=>se(le,We.currentTarget.checked),at=le=>se(le,!M[le]),ar=le=>se(le,!M[le]),lr=()=>{Te(I)},ru=()=>{Gt()};o.$$set=le=>{"plugin"in le&&t(48,T=le.plugin),"remoteFolder"in le&&f(t(0,U=le.remoteFolder)),"sharedFolders"in le&&m(t(1,j=le.sharedFolders)),"relayRoles"in le&&t(49,Q=le.relayRoles),"folderRoles"in le&&t(50,N=le.folderRoles),"errorLog"in le&&t(51,X=le.errorLog)},o.$$.update=()=>{if(o.$$.dirty[0]&4){e:t(6,r=(c==null?void 0:c.private)||!1)}};e:t(5,n=fe?Object.entries(fe.getCategories()):[]);return[U,j,c,ee,xe,n,r,s,i,a,l,y,g,k,L,I,C,A,M,P,O,$,B,pe,Z,ae,ue,q,Te,fe,Ee,se,Ae,we,Ve,ut,Zt,Kt,Ar,Gt,Dt,To,on,io,nn,Un,sn,ge,T,Q,N,X,Je,Xe,_r,Ao,ie,$e,at,ar,lr,ru]}var hm=class extends K{constructor(e){super(),G(this,e,yP,mP,W,{plugin:48,remoteFolder:0,sharedFolders:1,relayRoles:49,folderRoles:50,errorLog:51},YF,[-1,-1,-1])}},_c=hm;function bP(o){Le(o,"svelte-gjlxvj",".toast.svelte-gjlxvj.svelte-gjlxvj{position:absolute;top:20px;left:50%;transform:translateX(-50%);display:flex;align-items:flex-start;gap:12px;padding:12px 16px;border-radius:8px;border:1px solid;background:var(--background-primary);color:var(--text-normal);box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);min-height:48px;max-width:500px;min-width:300px;width:max-content;animation:svelte-gjlxvj-slideDown 0.3s ease-out;pointer-events:auto}.toast-error.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-error)}.toast-warning.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-warning)}.toast-success.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--text-success, #4caf50)}.toast-info.svelte-gjlxvj.svelte-gjlxvj{border-color:var(--interactive-accent)}@keyframes svelte-gjlxvj-slideDown{from{opacity:0;transform:translateX(-50%) translateY(-10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}.toast-icon.svelte-gjlxvj.svelte-gjlxvj{display:flex;align-items:center;flex-shrink:0;margin-top:1px}.toast-error.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-error)}.toast-warning.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-warning)}.toast-success.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--text-success, #4caf50)}.toast-info.svelte-gjlxvj .toast-icon.svelte-gjlxvj{color:var(--interactive-accent)}.toast-content.svelte-gjlxvj.svelte-gjlxvj{flex:1;min-width:0}.toast-message.svelte-gjlxvj.svelte-gjlxvj{font-weight:500;margin-bottom:2px;line-height:1.4;color:var(--text-normal)}.toast-details.svelte-gjlxvj.svelte-gjlxvj{font-size:0.9em;color:var(--text-muted);line-height:1.3}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj{display:flex;align-items:center;justify-content:center;width:24px;height:24px;border:none;background:transparent;border-radius:4px;cursor:pointer;color:var(--text-muted);transition:all 0.15s ease-in-out;padding:0;flex-shrink:0}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj:hover{background:var(--background-modifier-hover);color:var(--text-error)}.toast-dismiss.svelte-gjlxvj.svelte-gjlxvj:focus{outline:2px solid var(--interactive-accent);outline-offset:1px}")}function yx(o){let e,t;return{c(){e=S("div"),t=V(o[1]),h(e,"class","toast-details svelte-gjlxvj")},m(r,n){x(r,e,n),v(e,t)},p(r,n){n&2&&J(t,r[1])},d(r){r&&_(e)}}}function vP(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,y;var g=o[3];function k(I,C){return{props:{class:"svg-icon"}}}g&&(r=Ko(g,k(o)));let L=o[1]&&yx(o);return f=new Kd({props:{class:"svg-icon"}}),{c(){e=S("div"),t=S("div"),r&&D(r.$$.fragment),n=F(),s=S("div"),i=S("div"),a=V(o[0]),l=F(),L&&L.c(),c=F(),u=S("button"),D(f.$$.fragment),h(t,"class","toast-icon svelte-gjlxvj"),h(i,"class","toast-message svelte-gjlxvj"),h(s,"class","toast-content svelte-gjlxvj"),h(u,"class","toast-dismiss svelte-gjlxvj"),h(u,"aria-label","Dismiss error"),h(e,"class",d=kt(o[2])+" svelte-gjlxvj"),h(e,"role","alert"),h(e,"aria-live","polite")},m(I,C){x(I,e,C),v(e,t),r&&E(r,t,null),v(e,n),v(e,s),v(s,i),v(i,a),v(s,l),L&&L.m(s,null),v(e,c),v(e,u),E(f,u,null),p=!0,m||(y=H(u,"click",o[4]),m=!0)},p(I,[C]){if(C&8&&g!==(g=I[3])){if(r){oe();let A=r;w(A.$$.fragment,1,0,()=>{R(A,1)}),ne()}g?(r=Ko(g,k(I,C)),D(r.$$.fragment),b(r.$$.fragment,1),E(r,t,null)):r=null}(!p||C&1)&&J(a,I[0]),I[1]?L?L.p(I,C):(L=yx(I),L.c(),L.m(s,null)):L&&(L.d(1),L=null),(!p||C&4&&d!==(d=kt(I[2])+" svelte-gjlxvj"))&&h(e,"class",d)},i(I){p||(r&&b(r.$$.fragment,I),b(f.$$.fragment,I),p=!0)},o(I){r&&w(r.$$.fragment,I),w(f.$$.fragment,I),p=!1},d(I){I&&_(e),r&&R(r),L&&L.d(),R(f),m=!1,y()}}}function _P(o,e,t){let r,n,{message:s}=e,{details:i=""}=e,{type:a="error"}=e,{autoDismiss:l=5e3}=e,c=Ye(),u;dt(()=>(l>0&&(u=window.setTimeout(()=>{c("dismiss")},l)),()=>{u&&clearTimeout(u)}));function f(){u&&clearTimeout(u),c("dismiss")}return o.$$set=d=>{"message"in d&&t(0,s=d.message),"details"in d&&t(1,i=d.details),"type"in d&&t(5,a=d.type),"autoDismiss"in d&&t(6,l=d.autoDismiss)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,r=a==="error"?ls:a==="warning"?gd:a==="success"?ca:pa)}if(o.$$.dirty&32){e:t(2,n=`toast toast-${a}`)}},[s,i,n,r,f,a,l]}var gm=class extends K{constructor(e){super(),G(this,e,_P,vP,W,{message:0,details:1,type:5,autoDismiss:6},bP)}},bx=gm;function xP(o){Le(o,"svelte-ml1z9c",".toast-container.svelte-ml1z9c{position:fixed;top:0;left:0;width:100vw;height:0;pointer-events:none;z-index:1000}")}function vx(o,e,t){let r=o.slice();return r[3]=e[t][0],r[4]=e[t][1],r}function _x(o,e){let t,r,n;function s(){return e[2](e[3])}return r=new bx({props:{message:e[4].message,details:e[4].details,type:e[4].type,autoDismiss:e[4].autoDismiss,source:e[4].source}}),r.$on("dismiss",s),{key:o,first:null,c(){t=me(),D(r.$$.fragment),this.first=t},m(i,a){x(i,t,a),E(r,i,a),n=!0},p(i,a){e=i;let l={};a&1&&(l.message=e[4].message),a&1&&(l.details=e[4].details),a&1&&(l.type=e[4].type),a&1&&(l.autoDismiss=e[4].autoDismiss),a&1&&(l.source=e[4].source),r.$set(l)},i(i){n||(b(r.$$.fragment,i),n=!0)},o(i){w(r.$$.fragment,i),n=!1},d(i){i&&_(t),R(r,i)}}}function wP(o){let e,t=[],r=new Map,n,s=ke(o[0]),i=a=>a[3];for(let a=0;a<s.length;a+=1){let l=vx(o,s,a),c=i(l);r.set(c,t[a]=_x(c,l))}return{c(){e=S("div");for(let a=0;a<t.length;a+=1)t[a].c();h(e,"class","toast-container svelte-ml1z9c")},m(a,l){x(a,e,l);for(let c=0;c<t.length;c+=1)t[c]&&t[c].m(e,null);n=!0},p(a,[l]){l&1&&(s=ke(a[0]),oe(),t=Qo(t,l,i,1,a,s,r,e,oi,_x,null,vx),ne())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(t[l]);n=!0}},o(a){for(let l=0;l<t.length;l+=1)w(t[l]);n=!1},d(a){a&&_(e);for(let l=0;l<t.length;l+=1)t[l].d()}}}function SP(o,e,t){let r,n;ce(o,gc,i=>t(1,n=i));let s=i=>s_(i);return o.$$.update=()=>{if(o.$$.dirty&2){e:t(0,r=Object.entries(n).filter(([i,a])=>a.visible))}},[r,n,s]}var ym=class extends K{constructor(e){super(),G(this,e,SP,wP,W,{},xP)}},xx=ym;function kP(o){Le(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function IP(o){let e,t,r,n,s=o[0].networkStatus.status&&wx(o);return{c(){e=S("div"),t=S("span"),s&&s.c(),h(t,"class","system3-announcement svelte-d22j3"),he(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),h(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),h(e,"role","button"),h(e,"tabindex","0"),he(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(i,a){x(i,e,a),v(e,t),s&&s.m(t,null),r||(n=[H(e,"click",o[22]),H(e,"keypress",o[23])],r=!0)},p(i,a){i[0].networkStatus.status?s?s.p(i,a):(s=wx(i),s.c(),s.m(t,null)):s&&(s.d(1),s=null),a&1&&he(t,"color",i[0].networkStatus.status.color?i[0].networkStatus.status.color:"var(--text-on-accent)",1),a&1&&he(e,"background-color",i[0].networkStatus.status.backgroundColor?i[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:z,o:z,d(i){i&&_(e),s&&s.d(),r=!1,Ie(n)}}}function CP(o){let e,t;return e=new N_({}),e.$on("goBack",o[14]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p:z,i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function wx(o){let e,t=Fn(o[0].networkStatus.status.status)+"",r;return{c(){e=new Cn(!1),r=me(),e.a=r},m(n,s){e.m(t,n,s),x(n,r,s)},p(n,s){s&1&&t!==(t=Fn(n[0].networkStatus.status.status)+"")&&e.p(t)},d(n){n&&(_(r),e.d())}}}function LP(o){let e,t;return e=new lv({props:{plugin:o[0],$$slots:{default:[FP]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&134217729&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function TP(o){let e,t;return e=new pi({props:{plugin:o[0],relayRoles:o[5],relay:o[2],sharedFolders:o[9]}}),e.$on("goBack",o[14]),e.$on("close",o[15]),e.$on("manageSharedFolder",o[11]),e.$on("manageRemoteFolder",o[12]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function AP(o){let e,t;return e=new bc({props:{plugin:o[0],sharedFolder:o[1]}}),e.$on("goBack",o[14]),e.$on("close",o[15]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function MP(o){let e,t;return e=new _c({props:{plugin:o[0],remoteFolder:o[3],sharedFolders:o[9],relayRoles:o[5],folderRoles:o[4].folderRoles}}),e.$on("goBack",o[14]),e.$on("close",o[15]),e.$on("manageRelay",o[10]),e.$on("manageSharedFolder",o[11]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&8&&(s.remoteFolder=r[3]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function FP(o){let e,t;return e=new Io({props:{relays:o[6],subscriptions:o[7],providers:o[8],plugin:o[0]}}),e.$on("manageRelay",o[10]),e.$on("manageSharedFolder",o[11]),e.$on("manageRemoteFolder",o[12]),e.$on("createRelay",o[13]),e.$on("joinRelay",o[16]),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function PP(o){let e,t;return e=new xx({}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Sx(o){let e,t=o[0].version+"",r;return{c(){e=S("span"),r=V(t),h(e,"class","relay-version svelte-d22j3")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&J(r,t)},d(n){n&&_(e)}}}function EP(o){let e,t,r,n,s,i,a,l=je().enableToasts,c,u,f,d=[CP,IP],p=[];function m(C,A){return C[2]||C[1]||C[3]?0:C[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=p[e]=d[e](o));let y=[MP,AP,TP,LP],g=[];function k(C,A){return C[3]?0:C[1]?1:C[2]?2:3}s=k(o,-1),i=g[s]=y[s](o);let L=l&&PP(o),I=o[0].manifest.version!==o[0].version&&Sx(o);return{c(){t&&t.c(),r=F(),n=S("div"),i.c(),a=F(),L&&L.c(),c=F(),I&&I.c(),u=me(),h(n,"class","vertical-tab-content svelte-d22j3")},m(C,A){~e&&p[e].m(C,A),x(C,r,A),x(C,n,A),g[s].m(n,null),x(C,a,A),L&&L.m(C,A),x(C,c,A),I&&I.m(C,A),x(C,u,A),f=!0},p(C,[A]){let M=e;e=m(C,A),e===M?~e&&p[e].p(C,A):(t&&(oe(),w(p[M],1,1,()=>{p[M]=null}),ne()),~e?(t=p[e],t?t.p(C,A):(t=p[e]=d[e](C),t.c()),b(t,1),t.m(r.parentNode,r)):t=null);let P=s;s=k(C,A),s===P?g[s].p(C,A):(oe(),w(g[P],1,1,()=>{g[P]=null}),ne(),i=g[s],i?i.p(C,A):(i=g[s]=y[s](C),i.c()),b(i,1),i.m(n,null)),C[0].manifest.version!==C[0].version?I?I.p(C,A):(I=Sx(C),I.c(),I.m(u.parentNode,u)):I&&(I.d(1),I=null)},i(C){f||(b(t),b(i),b(L),f=!0)},o(C){w(t),w(i),w(L),f=!1},d(C){C&&(_(r),_(n),_(a),_(c),_(u)),~e&&p[e].d(C),g[s].d(),L&&L.d(C),I&&I.d(C)}}}function RP(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,i=n.app,a=n.relayManager,l=a.relayRoles,c=a.relays;ce(o,c,X=>t(21,r=X));let u=a.subscriptions,f=a.providers,d=n.sharedFolders,p,m=Io,y,g,k=[{component:Io}],{close:L}=e;function I(X){if(t(2,y=void 0),t(1,p=void 0),t(3,g=void 0),X==="/"){t(20,m=Io);return}let $=new URLSearchParams(X.split("?")[1]||""),B=$.get("id");if(X.startsWith("/relays")){B?(t(2,y=a.relays.find(pe=>pe.guid===B||pe.id===B)),t(20,m=pi)):t(20,m=Io);return}if(X.startsWith("/shared-folders")){if(B){t(1,p=d.find(Z=>Z.guid===B));let pe=$.get("relay");pe&&t(2,y=a.relays.find(Z=>Z.guid===pe||Z.id===pe)),p!=null&&p.remote?(t(3,g=p.remote),t(2,y=p.remote.relay),t(20,m=_c)):t(20,m=bc)}return}}function C(X){k.push({currentRelay:y,sharedFolder:p,remoteFolder:g,component:m}),t(2,y=X.detail.relay),t(1,p=void 0),t(3,g=void 0),t(20,m=pi)}function A(X){k.push({currentRelay:y,sharedFolder:p,remoteFolder:g,component:m}),t(1,p=X.detail.folder),t(3,g=X.detail.remoteFolder),t(2,y=X.detail.relay),t(20,m=bc)}function M(X){k.push({currentRelay:y,sharedFolder:p,remoteFolder:g,component:m}),t(1,p=void 0),t(3,g=X.detail.remoteFolder),t(2,y=X.detail.relay),t(20,m=_c)}function P(X){return Pe(this,void 0,void 0,function*(){try{k.push({currentRelay:y,sharedFolder:p,remoteFolder:g,component:m}),t(2,y=yield n.relayManager.createRelay("")),t(20,m=pi)}catch($){Jt($,"Failed to create relay")}})}function O(X){if(X.detail.clear){k.length=0,t(2,y=void 0),t(1,p=void 0),t(3,g=void 0),t(20,m=Io);return}let $=k.pop();if($)for(;$;){if(!$.currentRelay&&!$.sharedFolder&&!$.remoteFolder)t(2,y=$.currentRelay),t(1,p=$.sharedFolder),t(3,g=$.remoteFolder),t(20,m=$.component);else if($.sharedFolder&&d.has($.sharedFolder)){t(2,y=$.currentRelay),t(1,p=$.sharedFolder),t(3,g=$.remoteFolder),t(20,m=$.component);break}else if($.remoteFolder){t(2,y=$.currentRelay),t(1,p=$.sharedFolder),t(3,g=$.remoteFolder),t(20,m=$.component);break}else if($.currentRelay&&a.relays.get($.currentRelay.id)){t(2,y=$.currentRelay),t(1,p=$.sharedFolder),t(3,g=$.remoteFolder),t(20,m=$.component);break}$=k.pop()}else t(2,y=void 0),t(1,p=void 0),t(3,g=void 0),t(20,m=Io)}function T(X){k.length=0,L()}function U(X){t(2,y=X.detail.relay),t(20,m=pi)}function j(){var X;!((X=n.networkStatus.status)===null||X===void 0)&&X.versions&&(n.releaseSettings.get().channel==="stable"?n.installVersion(n.networkStatus.status.versions.stable):n.releaseSettings.get().channel==="beta"&&n.installVersion(n.networkStatus.status.versions.beta))}let Q=()=>{var X,$;(X=n.networkStatus.status)!=null&&X.versions?j():($=n.networkStatus.status)!=null&&$.link&&window.open(n.networkStatus.status.link)},N=()=>{var X,$;(X=n.networkStatus.status)!=null&&X.versions?j():($=n.networkStatus.status)!=null&&$.link&&window.open(n.networkStatus.status.link)};return o.$$set=X=>{"plugin"in X&&t(0,n=X.plugin),"path"in X&&t(18,s=X.path),"close"in X&&t(19,L=X.close)},o.$$.update=()=>{if(o.$$.dirty&262144){e:s&&I(s)}if(o.$$.dirty&2097156){e:y&&!r.has(y.id)&&(t(2,y=void 0),t(20,m=Io))}if(o.$$.dirty&2){e:p&&!d.has(p)&&(t(1,p=void 0),t(3,g=void 0),t(20,m=Io))}if(o.$$.dirty&1048590){e:(m||y||p||g)&&setTimeout(()=>{let X=document.querySelector(".vertical-tab-content");X&&(X.scrollTop=0)},0)}},[n,p,y,g,a,l,c,u,f,d,C,A,M,P,O,T,U,j,s,L,m,r,Q,N]}var bm=class extends K{constructor(e){super(),G(this,e,RP,EP,W,{plugin:0,path:18,close:19},kP)}},kx=bm;var xc=class extends Ix.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new kx({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var Sc=require("obsidian");var wc=class extends Zi{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};function DP(o){if("email"in o&&"name"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}if("email"in o&&"login"in o&&"avatar_url"in o){let e=o,t=(e.name||e.login).split(" ");return{name:e.name||e.login,given_name:t[0]||e.login,family_name:t.slice(1).join(" ")||"",email:e.email,picture:e.avatar_url}}if("mail"in o&&"displayName"in o){let e=o;return{name:e.displayName,given_name:e.givenName,family_name:e.surname,email:e.mail}}if("email"in o&&"given_name"in o&&"family_name"in o){let e=o;return{name:e.name||`${e.given_name} ${e.family_name}`,given_name:e.given_name,family_name:e.family_name,email:e.email,picture:e.picture}}return null}function UP(o,e,t,r){let n=r?DP(r):null;return new lc(o,(t==null?void 0:t.name)||(n==null?void 0:n.name)||"",(t==null?void 0:t.email)||(n==null?void 0:n.email)||"",(t==null?void 0:t.picture)||(n==null?void 0:n.picture)||"",e)}var vm=class{constructor(e,t,r){this.fullAuthUrl=e,this.info=t,this.login=r}},kc=class extends st{constructor(t,r,n,s,i,a){var c;super();this.beforeLogin=s;this.loginSettings=i;let l=Fe("[Pocketbase]","debug");this.authStore=new wc(`pocketbase_auth_${t}`),this.endpointManager=a,this.pb=new ts(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(u,f)=>(l(u,f),f.fetch=ft,f.headers=Object.assign({},f.headers,{"Relay-Version":"0.6.0"}),{url:u,options:f}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(c=this.pb.authStore.model)!=null&&c.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).then(()=>{this.getFlags()}).catch(u=>{u.status===404&&this.logout()}),Nt.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),i=new Date(s.exp*1e3),a=new Date,l=Math.ceil((i.getTime()-a.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:i.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t,r){var n,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(n=t==null?void 0:t.meta)==null?void 0:n.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(i=>{this.log(i)}),r&&this.loginSettings.set({provider:r}),!0):(this.notifyListeners(),!1)}clearPreferredProvider(){this.loginSettings.set({provider:void 0})}async checkRelayHost(t){let r={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.6.0"};return(0,Sc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/relay/${t}/check-host`,method:"GET",headers:r})}getFlags(){let t={Authorization:`Bearer ${this.pb.authStore.token}`,"Relay-Version":"0.6.0"};(0,Sc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/flags`,method:"GET",headers:t}).then(r=>{if(r.status===200){let n=r.json;xt.getInstance().applyServerFlags(n)}}).catch(r=>{this.log(r)})}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,Sc.requestUrl)({url:`${this.endpointManager.getApiUrl()}/whoami`,method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}getEndpointManager(){return this.endpointManager}async validateAndApplyEndpoints(t){let r=await this.endpointManager.validateAndSetEndpoints(t);if(r.success&&this.endpointManager.hasValidatedEndpoints()){let n=Fe("[Pocketbase]","debug");this.pb=new ts(this.endpointManager.getAuthUrl(),this.authStore),this.pb.beforeSend=(s,i)=>(n(s,i),i.fetch=ft,i.headers=Object.assign({},i.headers,{"Relay-Version":"0.6.0"}),{url:s,options:i}),this.log("Updated PocketBase instance with validated endpoints")}return r}get hasUser(){return this.user!==void 0}makeUser(t,r){var n;return UP((n=t.model)==null?void 0:n.id,t.token,t.model,r)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}getWebviewIntercepts(t){var a;let r=this.pb.buildUrl("/api/oauth2-redirect"),n=l=>{let c=l.replace(/\//g,"\\/");return new RegExp(`^${c}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},s=l=>{let c=new URL(l),f=`${c.protocol}//${c.host}${c.pathname}`.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${f}.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i")},i=[n("https://accounts.google.com/o/oauth2/auth"),n("https://github.com/login/oauth/authorize"),n("https://discord.com/api/oauth2/authorize"),n("https://login.microsoftonline.com/common/oauth2/v2.0/authorize")];if(t){let l=t.oidc;(a=l==null?void 0:l.info)!=null&&a.authUrl&&(console.log("[OIDC Provider] Creating dynamic intercept for authUrl:",l.info.authUrl),i.push(s(l.info.authUrl)))}else i.push(new RegExp(`.*?/auth.*?[?&]redirect_uri=(${r}|${encodeURIComponent(r)})`,"i"));return i}updateWebviewIntercepts(t){let r=this.getWebviewIntercepts(t);return console.log("[OIDC Provider] Updated webview intercepts:",r.map(n=>n.source)),r}async initiateManualOAuth2CodeFlow(t,r){this.beforeLogin();let n=await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError}),s=this.pb.buildUrl("/api/oauth2-redirect"),i={};for(let a of r){let l=n.authProviders.find(u=>u.name===a);if(!l){this.log(`Warning: unable to find provider: ${a}`);continue}let c=async u=>this.pb.collection("users").authWithOAuth2Code(l.name,u,l.codeVerifier,s,{fetch:t}).then(f=>(this.setup(f,l.name),f));i[a]=new vm(l.authUrl+s,l,c)}if(Object.keys(i).length===0)throw new Error(`No valid providers found from requested list: ${r.join(", ")}`);return i}async poll(t){let r=0,n=1e3;return new Promise((s,i)=>{let a=setInterval(()=>{if(r+=1,r>=30)return clearInterval(a),i(new Error(`Auth timeout: Timed out after ${r*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.info.state.slice(0,15)).then(l=>{if(l)return clearInterval(a),s(t.login(l.code))}).catch(l=>{})},n)})}async login(t){this.beforeLogin();let r=await this.pb.collection("users").authWithOAuth2({provider:t});return this.setup(r,t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Ex=require("obsidian");function OP(o){Le(o,"svelte-74c8lg",".endpoint-config-modal.svelte-74c8lg.svelte-74c8lg{padding:0}.tenant-list-section.svelte-74c8lg.svelte-74c8lg{margin:16px 0}.tenant-card.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;justify-content:space-between;padding:12px;margin:8px 0;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);cursor:pointer;transition:all 0.2s ease}.tenant-card.svelte-74c8lg.svelte-74c8lg:hover{background:var(--background-modifier-hover)}.tenant-card.active.svelte-74c8lg.svelte-74c8lg{border-color:var(--interactive-accent);background:var(--background-modifier-hover)}.tenant-info.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:12px;flex:1}.tenant-logo.svelte-74c8lg.svelte-74c8lg{width:4em;height:4em;object-fit:contain;border-radius:4px;background:var(--background-secondary);padding:4px}.tenant-details.svelte-74c8lg.svelte-74c8lg{flex:1}.tenant-name.svelte-74c8lg.svelte-74c8lg{font-weight:500;color:var(--text-normal);margin-bottom:2px}.tenant-url.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;color:var(--text-muted);font-family:var(--font-monospace)}.tenant-env.svelte-74c8lg.svelte-74c8lg{font-size:0.8em;color:var(--text-faint);text-transform:capitalize}.tenant-actions.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:center;gap:8px}.add-tenant-container.svelte-74c8lg.svelte-74c8lg{display:flex;gap:8px;align-items:center}.endpoint-url-input.svelte-74c8lg.svelte-74c8lg{flex:1;padding:6px 12px;border:1px solid var(--background-modifier-border);border-radius:var(--radius-s);background:var(--background-primary);color:var(--text-normal)}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg{border-color:var(--text-error) !important;box-shadow:0 0 0 1px var(--text-error) !important;transition:border-color 0.3s ease, box-shadow 0.3s ease}.endpoint-input-invalid.svelte-74c8lg.svelte-74c8lg:focus{border-color:var(--text-error) !important;box-shadow:0 0 0 2px var(--text-error) !important}.add-tenant-container.svelte-74c8lg button.mod-cta.svelte-74c8lg{background:var(--interactive-accent);color:var(--text-on-accent);padding:6px 12px;white-space:nowrap}.error-banner.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;justify-content:space-between;margin:12px 0;padding:10px 12px;background-color:rgba(255, 0, 0, 0.1);color:var(--text-normal);border:1px solid rgba(255, 0, 0, 0.3);border-radius:var(--radius-s);animation:svelte-74c8lg-error-slide-in 0.3s ease-out}.error-content.svelte-74c8lg.svelte-74c8lg{display:flex;align-items:flex-start;gap:8px;flex:1}.error-icon.svelte-74c8lg.svelte-74c8lg{font-size:1em;line-height:1.2;margin-top:2px}.error-text.svelte-74c8lg.svelte-74c8lg{font-size:0.85em;line-height:1.4;color:var(--text-normal)}.error-dismiss.svelte-74c8lg.svelte-74c8lg{background:none;border:none;color:var(--text-muted);font-size:1.2em;font-weight:normal;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;transition:opacity 0.2s ease;opacity:0.6}.error-dismiss.svelte-74c8lg.svelte-74c8lg:hover{opacity:1}@keyframes svelte-74c8lg-error-slide-in{0%{opacity:0;transform:translateY(-10px)}100%{opacity:1;transform:translateY(0)}}.apply-section.svelte-74c8lg.svelte-74c8lg{display:flex;justify-content:flex-end;margin-top:20px;padding-top:16px;border-top:1px solid var(--background-modifier-border)}.apply-btn.svelte-74c8lg.svelte-74c8lg{padding:8px 20px;font-size:0.9em}")}function Cx(o,e,t){let r=o.slice();return r[32]=e[t],r}function $P(o){let e,t,r,n,s,i=o[5]?"Adding...":"Add Tenant",a,l,c,u;return{c(){e=S("div"),t=S("input"),n=F(),s=S("button"),a=V(i),h(t,"type","text"),h(t,"placeholder","https://auth.example.com"),h(t,"class","endpoint-url-input svelte-74c8lg"),h(t,"title",r=o[6].error),Me(t,"endpoint-input-invalid",!o[6].isValid||o[2]),h(s,"class","mod-cta svelte-74c8lg"),s.disabled=l=o[5]||!o[0].trim()||!o[6].isValid,h(e,"class","add-tenant-container svelte-74c8lg")},m(f,d){x(f,e,d),v(e,t),rt(t,o[0]),v(e,n),v(e,s),v(s,a),c||(u=[H(t,"input",o[20]),H(s,"click",o[12])],c=!0)},p(f,d){d[0]&64&&r!==(r=f[6].error)&&h(t,"title",r),d[0]&1&&t.value!==f[0]&&rt(t,f[0]),d[0]&68&&Me(t,"endpoint-input-invalid",!f[6].isValid||f[2]),d[0]&32&&i!==(i=f[5]?"Adding...":"Add Tenant")&&J(a,i),d[0]&97&&l!==(l=f[5]||!f[0].trim()||!f[6].isValid)&&(s.disabled=l)},d(f){f&&_(e),c=!1,Ie(u)}}}function Lx(o){let e,t,r,n,s,i,a,l,c,u;return{c(){e=S("div"),t=S("div"),r=S("span"),r.textContent="\u26A0\uFE0F",n=F(),s=S("span"),i=V(o[1]),a=F(),l=S("button"),l.textContent="\xD7",h(r,"class","error-icon svelte-74c8lg"),h(s,"class","error-text svelte-74c8lg"),h(t,"class","error-content svelte-74c8lg"),h(l,"class","error-dismiss svelte-74c8lg"),h(l,"title","Dismiss error"),h(e,"class","error-banner svelte-74c8lg")},m(f,d){x(f,e,d),v(e,t),v(t,r),v(t,n),v(t,s),v(s,i),v(e,a),v(e,l),c||(u=H(l,"click",o[11]),c=!0)},p(f,d){d[0]&2&&J(i,f[1])},d(f){f&&_(e),c=!1,u()}}}function Tx(o){let e,t,r;return{c(){e=S("img"),hr(e.src,t=o[8].logo)||h(e,"src",t),h(e,"alt",r=o[8].customer||"Default Tenant"),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){x(n,e,s)},p(n,s){s[0]&256&&!hr(e.src,t=n[8].logo)&&h(e,"src",t),s[0]&256&&r!==(r=n[8].customer||"Default Tenant")&&h(e,"alt",r)},d(n){n&&_(e)}}}function Ax(o){let e,t,r;return{c(){e=S("img"),hr(e.src,t=o[32].logo)||h(e,"src",t),h(e,"alt",r=o[32].name),h(e,"class","tenant-logo svelte-74c8lg")},m(n,s){x(n,e,s)},p(n,s){s[0]&16&&!hr(e.src,t=n[32].logo)&&h(e,"src",t),s[0]&16&&r!==(r=n[32].name)&&h(e,"alt",r)},d(n){n&&_(e)}}}function Mx(o){let e,t=o[32].environment+"",r;return{c(){e=S("div"),r=V(t),h(e,"class","tenant-env svelte-74c8lg")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s[0]&16&&t!==(t=n[32].environment+"")&&J(r,t)},d(n){n&&_(e)}}}function Fx(o,e){let t,r,n,s,i,a=e[32].name+"",l,c,u,f=e[32].tenantUrl+"",d,p,m,y,g,k,L,I,C=e[32].logo&&Ax(e),A=e[32].environment&&Mx(e);function M(){return e[22](e[32])}function P(){return e[23](e[32])}function O(...T){return e[24](e[32],...T)}return{key:o,first:null,c(){t=S("div"),r=S("div"),C&&C.c(),n=F(),s=S("div"),i=S("div"),l=V(a),c=F(),u=S("div"),d=V(f),p=F(),A&&A.c(),m=F(),y=S("div"),g=S("button"),g.textContent="Remove",k=F(),h(i,"class","tenant-name svelte-74c8lg"),h(u,"class","tenant-url svelte-74c8lg"),h(s,"class","tenant-details svelte-74c8lg"),h(r,"class","tenant-info svelte-74c8lg"),h(g,"class","mod-destructive"),h(g,"title","Remove this tenant"),h(y,"class","tenant-actions svelte-74c8lg"),h(t,"class","tenant-card svelte-74c8lg"),h(t,"role","button"),h(t,"tabindex","0"),h(t,"title","Click to switch to this tenant"),Me(t,"active",e[32].id===e[3]),this.first=t},m(T,U){x(T,t,U),v(t,r),C&&C.m(r,null),v(r,n),v(r,s),v(s,i),v(i,l),v(s,c),v(s,u),v(u,d),v(s,p),A&&A.m(s,null),v(t,m),v(t,y),v(y,g),v(t,k),L||(I=[H(g,"click",Dl(M)),H(t,"click",P),H(t,"keydown",O)],L=!0)},p(T,U){e=T,e[32].logo?C?C.p(e,U):(C=Ax(e),C.c(),C.m(r,n)):C&&(C.d(1),C=null),U[0]&16&&a!==(a=e[32].name+"")&&J(l,a),U[0]&16&&f!==(f=e[32].tenantUrl+"")&&J(d,f),e[32].environment?A?A.p(e,U):(A=Mx(e),A.c(),A.m(s,null)):A&&(A.d(1),A=null),U[0]&24&&Me(t,"active",e[32].id===e[3])},d(T){T&&_(t),C&&C.d(),A&&A.d(),L=!1,Ie(I)}}}function NP(o){var Te,fe,Ee;let e,t,r,n,s,i=o[1]&&o[1].trim(),a,l,c,u,f,d,p,m,y,g,k=(((Te=o[8])==null?void 0:Te.customer)||"Default Tenant")+"",L,I,C,A,M,P=(((fe=o[8])==null?void 0:fe.environment)||o[10].environment)+"",O,T,U,j,Q=[],N=new Map,X,$,B,pe,Z,ae;n=new Oe({props:{name:"Add Enterprise Tenant",description:"Enter your organization's tenant URL",$$slots:{default:[$P]},$$scope:{ctx:o}}});let ue=i&&Lx(o),ee=((Ee=o[8])==null?void 0:Ee.logo)&&Tx(o),q=ke(o[4]),Y=xe=>xe[32].id;for(let xe=0;xe<q.length;xe+=1){let se=Cx(o,q,xe),Ae=Y(se);N.set(Ae,Q[xe]=Fx(Ae,se))}return{c(){e=S("div"),t=S("div"),t.innerHTML="<p>Manage your organization&#39;s enterprise Relay tenants. Add tenants to switch between different enterprise deployments.</p>",r=F(),D(n.$$.fragment),s=F(),ue&&ue.c(),a=F(),l=S("div"),c=S("div"),c.textContent="Available Tenants",u=F(),f=S("div"),d=S("div"),p=S("div"),ee&&ee.c(),m=F(),y=S("div"),g=S("div"),L=V(k),I=F(),C=S("div"),C.textContent=`${o[10].authUrl}`,A=F(),M=S("div"),O=V(P),T=F(),U=S("div"),U.innerHTML="",j=F();for(let xe=0;xe<Q.length;xe+=1)Q[xe].c();X=F(),$=S("div"),B=S("button"),B.textContent="Apply",h(t,"class","setting-item-description"),he(t,"margin-bottom","16px"),h(c,"class","setting-item-name"),h(g,"class","tenant-name svelte-74c8lg"),h(C,"class","tenant-url svelte-74c8lg"),h(M,"class","tenant-env svelte-74c8lg"),h(y,"class","tenant-details svelte-74c8lg"),h(p,"class","tenant-info svelte-74c8lg"),h(U,"class","tenant-actions svelte-74c8lg"),h(d,"class","tenant-card svelte-74c8lg"),h(d,"role","button"),h(d,"tabindex","0"),h(d,"title","Click to use default tenant"),Me(d,"active",!o[3]),h(f,"class","tenant-list"),h(l,"class","tenant-list-section svelte-74c8lg"),h(B,"class","mod-cta apply-btn svelte-74c8lg"),h($,"class","apply-section svelte-74c8lg"),h(e,"class","endpoint-config-modal svelte-74c8lg")},m(xe,se){x(xe,e,se),v(e,t),v(e,r),E(n,e,null),v(e,s),ue&&ue.m(e,null),v(e,a),v(e,l),v(l,c),v(l,u),v(l,f),v(f,d),v(d,p),ee&&ee.m(p,null),v(p,m),v(p,y),v(y,g),v(g,L),v(y,I),v(y,C),v(y,A),v(y,M),v(M,O),v(d,T),v(d,U),v(f,j);for(let Ae=0;Ae<Q.length;Ae+=1)Q[Ae]&&Q[Ae].m(f,null);v(e,X),v(e,$),v($,B),pe=!0,Z||(ae=[H(d,"click",o[15]),H(d,"keydown",o[21]),H(B,"click",o[25])],Z=!0)},p(xe,se){var we,Ve,ut;let Ae={};se[0]&101|se[1]&16&&(Ae.$$scope={dirty:se,ctx:xe}),n.$set(Ae),se[0]&2&&(i=xe[1]&&xe[1].trim()),i?ue?ue.p(xe,se):(ue=Lx(xe),ue.c(),ue.m(e,a)):ue&&(ue.d(1),ue=null),(we=xe[8])!=null&&we.logo?ee?ee.p(xe,se):(ee=Tx(xe),ee.c(),ee.m(p,m)):ee&&(ee.d(1),ee=null),(!pe||se[0]&256)&&k!==(k=(((Ve=xe[8])==null?void 0:Ve.customer)||"Default Tenant")+"")&&J(L,k),(!pe||se[0]&256)&&P!==(P=(((ut=xe[8])==null?void 0:ut.environment)||xe[10].environment)+"")&&J(O,P),(!pe||se[0]&8)&&Me(d,"active",!xe[3]),se[0]&24600&&(q=ke(xe[4]),Q=Qo(Q,se,Y,1,xe,q,N,f,Vl,Fx,null,Cx))},i(xe){pe||(b(n.$$.fragment,xe),pe=!0)},o(xe){w(n.$$.fragment,xe),pe=!1},d(xe){xe&&_(e),R(n),ue&&ue.d(),ee&&ee.d();for(let se=0;se<Q.length;se+=1)Q[se].d();Z=!1,Ie(ae)}}}function BP(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=Ye(),u="",f=!1,d={isValid:!0,error:""},p="",m=!1,y="",g=!1,k=0,L=l.loginManager.getEndpointManager().getDefaultUrls(),I=null;function C(){t(18,k++,k)}function A(){t(1,p=""),t(2,m=!1)}function M(ae){if(!ae.trim())return{isValid:!0,error:""};try{let ue=new URL(ae);if(l.loginManager.getEndpointManager().isStaging()){if(ue.protocol!=="https:"&&ue.protocol!=="http:")return{isValid:!1,error:"Only HTTP and HTTPS URLs are allowed in development"}}else if(ue.protocol!=="https:")return{isValid:!1,error:"Only HTTPS URLs are allowed in production"};return ue.hostname.length<3?{isValid:!1,error:"Invalid hostname"}:{isValid:!0,error:""}}catch(ue){return{isValid:!1,error:"Invalid URL format"}}}function P(){return Pe(this,void 0,void 0,function*(){if(u.trim()&&d.isValid){t(5,f=!0);try{let ae=yield l.loginManager.getEndpointManager().addTenant(u);ae.success?(t(0,u=""),t(1,p=""),t(2,m=!1),C(),t(7,g=!0),ae.tenantId&&(yield O(ae.tenantId))):(console.log("Add tenant failed with error:",ae.error),t(1,p=ae.error||"Failed to add tenant"),t(2,m=!0),C())}catch(ae){let ue=ae instanceof Error?ae.message:"Unknown error occurred";t(1,p=`Error adding tenant: ${ue}`),t(2,m=!0)}finally{t(5,f=!1)}}})}function O(ae){return Pe(this,void 0,void 0,function*(){try{let ue=yield l.loginManager.getEndpointManager().switchToTenant(ae);ue.success?(t(7,g=!0),C()):t(1,p=ue.error||"Failed to switch tenant")}catch(ue){let ee=ue instanceof Error?ue.message:"Unknown error occurred";t(1,p=`Error switching tenant: ${ee}`)}})}function T(ae){return Pe(this,void 0,void 0,function*(){try{(yield l.loginManager.getEndpointManager().removeTenant(ae))?(t(7,g=!0),C()):t(1,p="Failed to remove tenant")}catch(ue){let ee=ue instanceof Error?ue.message:"Unknown error occurred";t(1,p=`Error removing tenant: ${ee}`)}})}function U(){return Pe(this,void 0,void 0,function*(){yield l.endpointSettings.update(ae=>Object.assign(Object.assign({},ae),{activeTenantId:void 0})),l.loginManager.getEndpointManager().clearValidatedEndpoints(),t(7,g=!0),C()})}function j(){return Pe(this,void 0,void 0,function*(){try{return yield l.loginManager.getEndpointManager().getCustomerInfo()}catch(ae){return null}})}function Q(){return Pe(this,void 0,void 0,function*(){try{let ae=l.loginManager.getEndpointManager();t(8,I=yield ae.getDefaultTenantInfo())}catch(ae){console.log("Failed to load default tenant info:",ae),t(8,I=null)}})}dt(()=>{Q()});function N(){u=this.value,t(0,u)}let X=ae=>ae.key==="Enter"||ae.key===" "?U():null,$=ae=>T(ae.id),B=ae=>O(ae.id),pe=(ae,ue)=>ue.key==="Enter"||ue.key===" "?O(ae.id):null,Z=()=>{c(g?"apply":"close")};return o.$$set=ae=>{"plugin"in ae&&t(16,l=ae.plugin)},o.$$.update=()=>{if(o.$$.dirty[0]&327680){e:t(19,r=l.endpointSettings.get())}if(o.$$.dirty[0]&524288){e:t(4,n=r.tenants||[])}if(o.$$.dirty[0]&524288){e:t(3,s=r.activeTenantId)}if(o.$$.dirty[0]&24){e:i=n.find(ae=>ae.id===s)}if(o.$$.dirty[0]&65536){e:a=l.loginManager.getEndpointManager().hasValidatedEndpoints()}if(o.$$.dirty[0]&131079){e:t(6,d=M(u)),u!==y&&y!==""&&(m&&t(2,m=!1),p&&t(1,p="")),t(17,y=u)}},[u,p,m,s,n,f,d,g,I,c,L,A,P,O,T,U,l,y,k,r,N,X,$,B,pe,Z]}var _m=class extends K{constructor(e){super(),G(this,e,BP,NP,W,{plugin:16},OP,[-1,-1])}},Px=_m;var Ic=class extends Ex.Modal{constructor(t,r,n){super(t);this.plugin=r;this.reload=n;this.setTitle("Enterprise Tenant Configuration")}onOpen(){let{contentEl:t}=this;this.component=new Px({target:t,props:{plugin:this.plugin,reload:this.reload}}),this.component.$on("close",()=>{this.close()}),this.component.$on("apply",()=>{this.close(),setTimeout(()=>{this.reload()},100)})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Mt=crypto,qr=o=>o instanceof CryptoKey;var vr=new TextEncoder,Qt=new TextDecoder,Gz=2**32;function Pn(...o){let e=o.reduce((n,{length:s})=>n+s,0),t=new Uint8Array(e),r=0;for(let n of o)t.set(n,r),r+=n.length;return t}var Rx=o=>{let e=o;typeof e=="string"&&(e=vr.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},no=o=>Rx(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Dx=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},Lo=o=>{let e=o;e instanceof Uint8Array&&(e=Qt.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Dx(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var xm={};nu(xm,{JOSEAlgNotAllowed:()=>hi,JOSEError:()=>Bt,JOSENotSupported:()=>pt,JWEDecryptionFailed:()=>xa,JWEInvalid:()=>Tr,JWKInvalid:()=>Cc,JWKSInvalid:()=>Lc,JWKSMultipleMatchingKeys:()=>Tc,JWKSNoMatchingKey:()=>wa,JWKSTimeout:()=>Ac,JWSInvalid:()=>ct,JWSSignatureVerificationFailed:()=>gi,JWTClaimValidationFailed:()=>ir,JWTExpired:()=>mi,JWTInvalid:()=>Wt});var Bt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},ir=class extends Bt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},mi=class extends Bt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},hi=class extends Bt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},pt=class extends Bt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},xa=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Tr=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},ct=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},Wt=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},Cc=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},Lc=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},wa=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},Tc=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},Ac=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},gi=class extends Bt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var Mc=Mt.getRandomValues.bind(Mt);function tn(o,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${o}`)}function Fc(o,e){return o.name===e}function wm(o){return parseInt(o.name.slice(4),10)}function HP(o){switch(o){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function qP(o,e){if(e.length&&!e.some(t=>o.usages.includes(t))){let t="CryptoKey does not support this operation, its usages must include ";if(e.length>2){let r=e.pop();t+=`one of ${e.join(", ")}, or ${r}.`}else e.length===2?t+=`one of ${e[0]} or ${e[1]}.`:t+=`${e[0]}.`;throw new TypeError(t)}}function Ox(o,e,...t){switch(e){case"HS256":case"HS384":case"HS512":{if(!Fc(o.algorithm,"HMAC"))throw tn("HMAC");let r=parseInt(e.slice(2),10);if(wm(o.algorithm.hash)!==r)throw tn(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Fc(o.algorithm,"RSASSA-PKCS1-v1_5"))throw tn("RSASSA-PKCS1-v1_5");let r=parseInt(e.slice(2),10);if(wm(o.algorithm.hash)!==r)throw tn(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Fc(o.algorithm,"RSA-PSS"))throw tn("RSA-PSS");let r=parseInt(e.slice(2),10);if(wm(o.algorithm.hash)!==r)throw tn(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":{if(o.algorithm.name!=="Ed25519"&&o.algorithm.name!=="Ed448")throw tn("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!Fc(o.algorithm,"ECDSA"))throw tn("ECDSA");let r=HP(e);if(o.algorithm.namedCurve!==r)throw tn(r,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}qP(o,t)}function $x(o,e,...t){var r;if(t.length>2){let n=t.pop();o+=`one of type ${t.join(", ")}, or ${n}.`}else t.length===2?o+=`one of type ${t[0]} or ${t[1]}.`:o+=`of type ${t[0]}.`;return e==null?o+=` Received ${e}`:typeof e=="function"&&e.name?o+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(r=e.constructor)!=null&&r.name&&(o+=` Received an instance of ${e.constructor.name}`),o}var so=(o,...e)=>$x("Key must be ",o,...e);function Sm(o,e,...t){return $x(`Key for the ${o} algorithm must be `,e,...t)}var km=o=>qr(o),Ft=["CryptoKey"];var KP=(...o)=>{let e=o.filter(Boolean);if(e.length===0||e.length===1)return!0;let t;for(let r of e){let n=Object.keys(r);if(!t||t.size===0){t=new Set(n);continue}for(let s of n){if(t.has(s))return!1;t.add(s)}}return!0},yi=KP;function GP(o){return typeof o=="object"&&o!==null}function Vt(o){if(!GP(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var Pc=(o,e)=>{if(o.startsWith("RS")||o.startsWith("PS")){let{modulusLength:t}=e.algorithm;if(typeof t!="number"||t<2048)throw new TypeError(`${o} requires key modulusLength to be 2048 bits or larger`)}};var En=(o,e,t=0)=>{t===0&&(e.unshift(e.length),e.unshift(6));let r=o.indexOf(e[0],t);if(r===-1)return!1;let n=o.subarray(r,r+e.length);return n.length!==e.length?!1:n.every((s,i)=>s===e[i])||En(o,e,r+1)},Bx=o=>{switch(!0){case En(o,[42,134,72,206,61,3,1,7]):return"P-256";case En(o,[43,129,4,0,34]):return"P-384";case En(o,[43,129,4,0,35]):return"P-521";case En(o,[43,101,110]):return"X25519";case En(o,[43,101,111]):return"X448";case En(o,[43,101,112]):return"Ed25519";case En(o,[43,101,113]):return"Ed448";default:throw new pt("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},ZP=async(o,e,t,r,n)=>{var c;let s,i,a=new Uint8Array(atob(t.replace(o,"")).split("").map(u=>u.charCodeAt(0))),l=e==="spki";switch(r){case"PS256":case"PS384":case"PS512":s={name:"RSA-PSS",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":s={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${r.slice(-3)}`},i=l?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":s={name:"RSA-OAEP",hash:`SHA-${parseInt(r.slice(-3),10)||1}`},i=l?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":s={name:"ECDSA",namedCurve:"P-256"},i=l?["verify"]:["sign"];break;case"ES384":s={name:"ECDSA",namedCurve:"P-384"},i=l?["verify"]:["sign"];break;case"ES512":s={name:"ECDSA",namedCurve:"P-521"},i=l?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let u=Bx(a);s=u.startsWith("P-")?{name:"ECDH",namedCurve:u}:{name:u},i=l?[]:["deriveBits"];break}case"EdDSA":s={name:Bx(a)},i=l?["verify"]:["sign"];break;default:throw new pt('Invalid or unsupported "alg" (Algorithm) value')}return Mt.subtle.importKey(e,a,s,(c=n==null?void 0:n.extractable)!=null?c:!1,i)};var Vx=(o,e,t)=>ZP(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",o,e,t);async function Im(o,e,t){if(typeof o!="string"||o.indexOf("-----BEGIN PUBLIC KEY-----")!==0)throw new TypeError('"spki" must be SPKI formatted string');return Vx(o,e,t)}var XP=(o,e)=>{if(!(e instanceof Uint8Array)){if(!km(e))throw new TypeError(Sm(o,e,...Ft,"Uint8Array"));if(e.type!=="secret")throw new TypeError(`${Ft.join(" or ")} instances for symmetric algorithms must be of type "secret"`)}},eE=(o,e,t)=>{if(!km(e))throw new TypeError(Sm(o,e,...Ft));if(e.type==="secret")throw new TypeError(`${Ft.join(" or ")} instances for asymmetric algorithms must not be of type "secret"`);if(t==="sign"&&e.type==="public")throw new TypeError(`${Ft.join(" or ")} instances for asymmetric algorithm signing must be of type "private"`);if(t==="decrypt"&&e.type==="public")throw new TypeError(`${Ft.join(" or ")} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&t==="verify"&&e.type==="private")throw new TypeError(`${Ft.join(" or ")} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&t==="encrypt"&&e.type==="private")throw new TypeError(`${Ft.join(" or ")} instances for asymmetric algorithm encryption must be of type "public"`)},tE=(o,e,t)=>{o.startsWith("HS")||o==="dir"||o.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(o)?XP(o,e):eE(o,e,t)},ka=tE;function aE(o,e,t,r,n){if(n.crit!==void 0&&(r==null?void 0:r.crit)===void 0)throw new o('"crit" (Critical) Header Parameter MUST be integrity protected');if(!r||r.crit===void 0)return new Set;if(!Array.isArray(r.crit)||r.crit.length===0||r.crit.some(i=>typeof i!="string"||i.length===0))throw new o('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let s;t!==void 0?s=new Map([...Object.entries(t),...e.entries()]):s=e;for(let i of r.crit){if(!s.has(i))throw new pt(`Extension Header Parameter "${i}" is not recognized`);if(n[i]===void 0)throw new o(`Extension Header Parameter "${i}" is missing`);if(s.get(i)&&r[i]===void 0)throw new o(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(r.crit)}var bi=aE;var lE=(o,e)=>{if(e!==void 0&&(!Array.isArray(e)||e.some(t=>typeof t!="string")))throw new TypeError(`"${o}" option must be an array of strings`);if(e)return new Set(e)},Lm=lE;var fE=Symbol();function Ec(o,e){let t=`SHA-${o.slice(-3)}`;switch(o){case"HS256":case"HS384":case"HS512":return{hash:t,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:t,name:"RSA-PSS",saltLength:o.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:t,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:t,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new pt(`alg ${o} is not supported either by JOSE or your javascript runtime`)}}function Rc(o,e,t){if(qr(e))return Ox(e,o,t),e;if(e instanceof Uint8Array){if(!o.startsWith("HS"))throw new TypeError(so(e,...Ft));return Mt.subtle.importKey("raw",e,{hash:`SHA-${o.slice(-3)}`,name:"HMAC"},!1,[t])}throw new TypeError(so(e,...Ft,"Uint8Array"))}var dE=async(o,e,t,r)=>{let n=await Rc(o,e,"verify");Pc(o,n);let s=Ec(o,n.algorithm);try{return await Mt.subtle.verify(s,n,t,r)}catch(i){return!1}},jx=dE;async function Dc(o,e,t){var y;if(!Vt(o))throw new ct("Flattened JWS must be an object");if(o.protected===void 0&&o.header===void 0)throw new ct('Flattened JWS must have either of the "protected" or "header" members');if(o.protected!==void 0&&typeof o.protected!="string")throw new ct("JWS Protected Header incorrect type");if(o.payload===void 0)throw new ct("JWS Payload missing");if(typeof o.signature!="string")throw new ct("JWS Signature missing or incorrect type");if(o.header!==void 0&&!Vt(o.header))throw new ct("JWS Unprotected Header incorrect type");let r={};if(o.protected)try{let g=Lo(o.protected);r=JSON.parse(Qt.decode(g))}catch(g){throw new ct("JWS Protected Header is invalid")}if(!yi(r,o.header))throw new ct("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...r,...o.header},s=bi(ct,new Map([["b64",!0]]),t==null?void 0:t.crit,r,n),i=!0;if(s.has("b64")&&(i=r.b64,typeof i!="boolean"))throw new ct('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if(typeof a!="string"||!a)throw new ct('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=t&&Lm("algorithms",t.algorithms);if(l&&!l.has(a))throw new hi('"alg" (Algorithm) Header Parameter value not allowed');if(i){if(typeof o.payload!="string")throw new ct("JWS Payload must be a string")}else if(typeof o.payload!="string"&&!(o.payload instanceof Uint8Array))throw new ct("JWS Payload must be a string or an Uint8Array instance");let c=!1;typeof e=="function"&&(e=await e(r,o),c=!0),ka(a,e,"verify");let u=Pn(vr.encode((y=o.protected)!=null?y:""),vr.encode("."),typeof o.payload=="string"?vr.encode(o.payload):o.payload),f;try{f=Lo(o.signature)}catch(g){throw new ct("Failed to base64url decode the signature")}if(!await jx(a,e,f,u))throw new gi;let p;if(i)try{p=Lo(o.payload)}catch(g){throw new ct("Failed to base64url decode the payload")}else typeof o.payload=="string"?p=vr.encode(o.payload):p=o.payload;let m={payload:p};return o.protected!==void 0&&(m.protectedHeader=r),o.header!==void 0&&(m.unprotectedHeader=o.header),c?{...m,key:e}:m}async function Tm(o,e,t){if(o instanceof Uint8Array&&(o=Qt.decode(o)),typeof o!="string")throw new ct("Compact JWS must be a string or Uint8Array");let{0:r,1:n,2:s,length:i}=o.split(".");if(i!==3)throw new ct("Invalid Compact JWS");let a=await Dc({payload:n,protected:r,signature:s},e,t),l={payload:a.payload,protectedHeader:a.protectedHeader};return typeof e=="function"?{...l,key:a.key}:l}var Am=o=>Math.floor(o.getTime()/1e3);var pE=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Uc=o=>{let e=pE.exec(o);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");let t=parseFloat(e[2]),r=e[3].toLowerCase(),n;switch(r){case"sec":case"secs":case"second":case"seconds":case"s":n=Math.round(t);break;case"minute":case"minutes":case"min":case"mins":case"m":n=Math.round(t*60);break;case"hour":case"hours":case"hr":case"hrs":case"h":n=Math.round(t*3600);break;case"day":case"days":case"d":n=Math.round(t*86400);break;case"week":case"weeks":case"w":n=Math.round(t*604800);break;default:n=Math.round(t*31557600);break}return e[1]==="-"||e[4]==="ago"?-n:n};var Wx=o=>o.toLowerCase().replace(/^application\//,""),mE=(o,e)=>typeof o=="string"?e.includes(o):Array.isArray(o)?e.some(Set.prototype.has.bind(new Set(o))):!1,Oc=(o,e,t={})=>{let{typ:r}=t;if(r&&(typeof o.typ!="string"||Wx(o.typ)!==Wx(r)))throw new ir('unexpected "typ" JWT header value',"typ","check_failed");let n;try{n=JSON.parse(Qt.decode(e))}catch(m){}if(!Vt(n))throw new Wt("JWT Claims Set must be a top-level JSON object");let{requiredClaims:s=[],issuer:i,subject:a,audience:l,maxTokenAge:c}=t,u=[...s];c!==void 0&&u.push("iat"),l!==void 0&&u.push("aud"),a!==void 0&&u.push("sub"),i!==void 0&&u.push("iss");for(let m of new Set(u.reverse()))if(!(m in n))throw new ir(`missing required "${m}" claim`,m,"missing");if(i&&!(Array.isArray(i)?i:[i]).includes(n.iss))throw new ir('unexpected "iss" claim value',"iss","check_failed");if(a&&n.sub!==a)throw new ir('unexpected "sub" claim value',"sub","check_failed");if(l&&!mE(n.aud,typeof l=="string"?[l]:l))throw new ir('unexpected "aud" claim value',"aud","check_failed");let f;switch(typeof t.clockTolerance){case"string":f=Uc(t.clockTolerance);break;case"number":f=t.clockTolerance;break;case"undefined":f=0;break;default:throw new TypeError("Invalid clockTolerance option type")}let{currentDate:d}=t,p=Am(d||new Date);if((n.iat!==void 0||c)&&typeof n.iat!="number")throw new ir('"iat" claim must be a number',"iat","invalid");if(n.nbf!==void 0){if(typeof n.nbf!="number")throw new ir('"nbf" claim must be a number',"nbf","invalid");if(n.nbf>p+f)throw new ir('"nbf" claim timestamp check failed',"nbf","check_failed")}if(n.exp!==void 0){if(typeof n.exp!="number")throw new ir('"exp" claim must be a number',"exp","invalid");if(n.exp<=p-f)throw new mi('"exp" claim timestamp check failed',"exp","check_failed")}if(c){let m=p-n.iat,y=typeof c=="number"?c:Uc(c);if(m-f>y)throw new mi('"iat" claim timestamp check failed (too far in the past)',"iat","check_failed");if(m<0-f)throw new ir('"iat" claim timestamp check failed (it should be in the past)',"iat","check_failed")}return n};async function Mm(o,e,t){var i;let r=await Tm(o,e,t);if((i=r.protectedHeader.crit)!=null&&i.includes("b64")&&r.protectedHeader.b64===!1)throw new Wt("JWTs MUST NOT use unencoded payload");let s={payload:Oc(r.protectedHeader,r.payload,t),protectedHeader:r.protectedHeader};return typeof e=="function"?{...s,key:r.key}:s}var vE,$c,Jx;(typeof navigator=="undefined"||!((Jx=($c=navigator.userAgent)==null?void 0:$c.startsWith)!=null&&Jx.call($c,"Mozilla/5.0 ")))&&(vE="jose/v5.3.0");var Fm={};nu(Fm,{decode:()=>Nc,encode:()=>_E});var _E=no,Nc=Lo;function Ia(o){if(typeof o!="string")throw new Wt("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new Wt("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new Wt("Invalid JWT");if(!e)throw new Wt("JWTs must contain a payload");let r;try{r=Nc(e)}catch(s){throw new Wt("Failed to base64url decode the payload")}let n;try{n=JSON.parse(Qt.decode(r))}catch(s){throw new Wt("Failed to parse the decoded payload as JSON")}if(!Vt(n))throw new Wt("Invalid JWT Claims Set");return n}function Qx(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function xE(o){let e=Ia(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var Bc=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=xE,this.maxConnections=t,this.refreshInterval=null,Nt.set(this,"TokenStore")}onRefresh(e){return new Promise((r,n)=>{let s=a=>{r(a)},i=a=>{this.removeFromRefreshQueue(e),n(a)};this.refresh(e,s,i)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){var n;let t=this.tokenMap.get(e),r=((n=t==null?void 0:t.attempts)!=null?n:0)+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){var a;let n=this._activePromises.get(e);if(n)return n;let s=this.tokenMap.get(e);this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:(a=s==null?void 0:s.attempts)!=null?a:0}),this.callbacks.set(e,r);let i=this.onRefresh(e).then(l=>(this.onTokenRefreshed(e,l),this._activePromises.delete(e),l)).catch(l=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),l});return this._activePromises.set(e,i),i}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Error("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,i)=>s[1].expiryTime-i[1].expiryTime);for(let[s,{friendlyName:i,expiryTime:a,attempts:l}]of n){if(!e(s))continue;let c=a-r,u="";c>0?u=`expires in ${Qx(c-this.expiryMargin)}`:u="expired",t.push(`${s} (${i}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${Qx(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function wE(o){return o.expiryTime||0}function SE(o,e){return(...t)=>e(o,...t)}async function kE(o,e,t,r){var c;let n=Fe("[TokenStore][Refresh]","debug"),s=Fe("[TokenStore][Refresh]","error");n(`${e}`);let i=gt.decode(e),a;if(i instanceof Zr)a=JSON.stringify({docId:i.documentId,relay:i.relayId,folder:i.folderId});else if(i instanceof pr)a=JSON.stringify({docId:i.canvasId,relay:i.relayId,folder:i.folderId});else if(i instanceof No)a=JSON.stringify({docId:i.folderId,relay:i.relayId,folder:i.folderId});else if(i instanceof Bo)a=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(c=o.user)==null?void 0:c.token}`,"Relay-Version":"0.6.0","Content-Type":"application/json"};try{let u=o.getEndpointManager().getApiUrl(),f=await ft(`${u}/token`,{method:"POST",headers:l,body:a});if(!f.ok){n(f.status,await f.text()),r(Error(`Received status code ${f.status} from an API.`));return}let d=await f.json();t(d)}catch(u){s(u,a),r(u)}}var Vc=class extends Bc{constructor(t,r,n,s=5){super({log:Fe("[LiveTokenStore]","debug"),refresh:SE(t,kE),getJwtExpiry:wE,getStorage:function(){return new jo("TokenStore/"+n)},getTimeProvider:()=>r},s);this.loginManager=t}async getFileTokenFromNetwork(t,r,n,s){let i=`${t}${r}`,a=this._activePromises.get(i);if(a)return a;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let l=this.fetchFileToken(t,r,n,s).then(c=>{let u=this.getJwtExpiry(c),f=this.tokenMap.get(i);return this.tokenMap.set(r,{...f,token:c,expiryTime:u}),this._activePromises.delete(i),c}).catch(c=>{throw this._activePromises.delete(i),c});return this._activePromises.set(i,l),l}async fetchFileToken(t,r,n,s){var p;let i=Fe("[TokenStore][Fetch]","debug");i(`${t}`);let a=gt.decode(t),l;if(a instanceof Bo)l=JSON.stringify({docId:a.fileId,relay:a.relayId,folder:a.folderId,hash:r,contentType:n,contentLength:s});else throw new Error(`No remote to connect to for ${t}`);if(!this.loginManager.loggedIn)throw new Error("Not logged in");let c={Authorization:`Bearer ${(p=this.loginManager.user)==null?void 0:p.token}`,"Relay-Version":"0.6.0","Content-Type":"application/json"},u=this.loginManager.getEndpointManager().getApiUrl(),f=await ft(`${u}/file-token`,{method:"POST",headers:c,body:l});if(!f.ok){i(f.status,await f.text());let m=await f.json();throw new Error(m.error)}return await f.json()}async getFileToken(t,r,n,s){let i=`${t}${r}`,a=this.tokenMap.get(i);return a&&a.token&&this.isTokenValid(a)?(this.log("token was valid, cache hit!"),this._activePromises.delete(i),Promise.resolve(a.token)):this.getFileTokenFromNetwork(t,r,n,s)}};var Yx=require("obsidian");var Pm=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Fe("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,Yx.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.6.0"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{var t;if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,(t=this.onOffline)==null||t.forEach(r=>r(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Zx=Pm;var Yt=class extends st{constructor(t){super();this.observableName=t;this.derivedMapRefCounts=new WeakMap;this.activeDerivedMaps=new Set;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}subscribe(t){let r=null;for(let s of this.activeDerivedMaps)if(s&&s.parentCallback===t){r=s;break}if(r){let s=this.derivedMapRefCounts.get(r)||0;this.derivedMapRefCounts.set(r,s+1)}let n=super.subscribe(t);return()=>{if(r){let i=(this.derivedMapRefCounts.get(r)||0)-1;i<=0?(this.derivedMapRefCounts.delete(r),this.activeDerivedMaps.delete(r),r.destroy()):this.derivedMapRefCounts.set(r,i)}n()}}unsubscribe(t){for(let r of this.activeDerivedMaps)if(r&&r.parentCallback===t){let s=(this.derivedMapRefCounts.get(r)||0)-1;s<=0?(this.derivedMapRefCounts.delete(r),this.activeDerivedMaps.delete(r),r.destroy()):this.derivedMapRefCounts.set(r,s);break}super.unsubscribe(t)}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new Em(this,t);return this._derivedMaps.set(t,n),this.derivedMapRefCounts.set(n,0),this.activeDerivedMaps.add(n),n}},Em=class extends Yt{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.parentCallback=()=>{let n=new Map;this.parentMap.forEach((s,i)=>{this.predicate(s,i)&&n.set(i,s)}),this._map=n,this.notifyListeners()},this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(this.parentCallback))}subscribe(t){return this.sub(),super.subscribe(t)}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){var t;this.destroyed||(this.destroyed=!0,this.unsub&&(this.unsub(),this.unsub=void 0),(t=this._listeners)==null||t.clear(),this.parentCallback=null)}};var vi=class extends st{constructor(t,r){super();this.evaluate=t;this.unsubscribes=[];this.subscriberCount=0;this.observableName="ObservablePermission";this.currentValue=this.evaluate(),r.forEach(n=>{let s=n.on(()=>{let i=this.evaluate();i!==this.currentValue&&(this.currentValue=i,this.notifyListeners())});this.unsubscribes.push(s)})}subscribe(t){if(this.destroyed)throw new Error("Cannot subscribe to destroyed ObservablePermission");this.subscriberCount++,t(this.currentValue);let r=this.on(()=>{t(this.currentValue)});return()=>{r(),this.subscriberCount--,this.subscriberCount===0&&this.destroy()}}destroy(){var t;this.destroyed||(this.destroyed=!0,this.unsubscribes.forEach(r=>r()),this.unsubscribes.length=0,(t=this._listeners)==null||t.clear())}},Hc=class{constructor(e){this.relayManager=e;this.policies=new Map;this.registerBuiltinPolicies()}isAllowed(e){let t=this.getResourceType(e.resource),r=`${t}:${e.action}`,n=this.policies.get(r);if(!n)return{allowed:!1,policy:r,context:{resourceType:t,action:e.action,principal:e.principal}};try{return{allowed:n.evaluate(e,this.relayManager),policy:r,context:{resourceType:t,action:e.action,principal:e.principal}}}catch(s){return{allowed:!1,policy:r,context:{resourceType:t,action:e.action,principal:e.principal}}}}can(e,t,r,n){let s=this.getResourceType(r),i=t[1];if(t[0]!==r[0])throw new Error(`unexpected permission/resource mismatch ${t[0]} ${r[0]}`);let a=`${s}:${i}`,l=this.policies.get(a),c={principal:e,action:i,resource:r,context:n},u=l?this.getFilteredCollections(l.dependencies,c):[];return new vi(()=>this.isAllowed(c).allowed,u)}getPolicies(){return Array.from(this.policies.keys()).sort()}registerPolicy(e){let[t,r]=e.permission,n=`${t}:${r}`;this.policies.set(n,e)}getResourceType(e){return e[0]}getResourceId(e){return e[1]}getFilteredCollections(e,t){let r=[];for(let n of Object.keys(e)){let s=this.relayManager.getCollectionMapByName(n);s&&r.push(s)}return r}registerBuiltinPolicies(){this.registerPolicy({permission:["folder","delete"],description:"Delete a shared folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderDelete.bind(this)}),this.registerPolicy({permission:["folder","rename"],description:"Rename a shared folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderRename.bind(this)}),this.registerPolicy({permission:["folder","read_content"],description:"Read folder contents and add to vault",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderRead.bind(this)}),this.registerPolicy({permission:["folder","edit_content"],description:"Edit notes in folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderWrite.bind(this)}),this.registerPolicy({permission:["folder","upload"],description:"Upload attachments to folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource),relays:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.id===r.relayId)},storage_quotas:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource)),n=r&&this.relayManager.relays.get(r.relayId);return!!(n&&e.id===n.storageQuotaId)}},evaluate:this.evaluateFolderUpload.bind(this)}),this.registerPolicy({permission:["folder","download"],description:"Download attachments from folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderDownload.bind(this)}),this.registerPolicy({permission:["folder","manage_files"],description:"Add/remove/rename files in folder",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource),relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderManageFiles.bind(this)}),this.registerPolicy({permission:["relay","delete"],description:"Delete a relay server",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayDelete.bind(this)}),this.registerPolicy({permission:["relay","rename"],description:"Rename a relay server",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayRename.bind(this)}),this.registerPolicy({permission:["relay","manage_users"],description:"Manage users in relay server (add/remove/change roles)",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayManageUsers.bind(this)}),this.registerPolicy({permission:["relay","manage_sharing"],description:"Manage relay share keys (enable/disable sharing, rotate keys)",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateRelayManageSharing.bind(this)}),this.registerPolicy({permission:["subscription","manage"],description:"Manage relay subscriptions and plans",dependencies:{relay_roles:(e,t)=>e.relayId===this.getResourceId(t.resource)&&e.userId===t.principal},evaluate:this.evaluateSubscriptionManage.bind(this)}),this.registerPolicy({permission:["folder","manage_users"],description:"Manage users in folder (add/remove/change roles)",dependencies:{folder_roles:(e,t)=>e.sharedFolderId===this.getResourceId(t.resource)&&e.userId===t.principal,relay_roles:(e,t)=>{let r=this.relayManager.remoteFolders.get(this.getResourceId(t.resource));return!!(r&&e.relayId===r.relayId&&e.userId===t.principal)},shared_folders:(e,t)=>e.id===this.getResourceId(t.resource)},evaluate:this.evaluateFolderManageUsers.bind(this)})}isFolderCreator(e,t){let r=this.relayManager.remoteFolders.get(t);return(r==null?void 0:r.creatorId)===e}isRelayOwnerForFolder(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.isRelayOwner(e,r.relayId):!1}isRelayOwner(e,t){return!!this.relayManager.relayRoles.find(n=>n.relayId===t&&n.userId===e&&n.role==="Owner")}hasRelayRole(e,t,r){let n=Array.isArray(r)?r:[r];return!!this.relayManager.relayRoles.find(i=>i.relayId===t&&i.userId===e&&n.includes(i.role))}hasFolderRole(e,t,r){let n=Array.isArray(r)?r:[r];return!!this.relayManager.folderRoles.find(i=>i.sharedFolderId===t&&i.userId===e&&n.includes(i.role))}hasFolderAccess(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.getUserFolderRole(e,t)?!0:r.private?!1:!!this.getUserRelayRole(e,r.relayId):!1}hasFolderWriteAccess(e,t){let r=this.relayManager.remoteFolders.get(t);if(!r)return!1;let n=this.getUserFolderRole(e,t);if(n&&this.roleHasWritePermission(n))return!0;if(!r.private){let s=this.getUserRelayRole(e,r.relayId);if(s&&this.roleHasWritePermission(s))return!0}return!1}hasFolderManagementAccess(e,t){let r=this.relayManager.remoteFolders.get(t);return r?this.isRelayOwnerForFolder(e,t)?!0:r.private?this.hasFolderRole(e,t,["Owner"]):this.isFolderCreator(e,t):!1}getUserFolderRole(e,t){let r=this.relayManager.folderRoles.find(n=>n.sharedFolderId===t&&n.userId===e);return(r==null?void 0:r.role)||null}getUserRelayRole(e,t){let r=this.relayManager.relayRoles.find(n=>n.relayId===t&&n.userId===e);return(r==null?void 0:r.role)||null}roleHasWritePermission(e){return["Owner","Member"].includes(e)}hasStorageQuota(e,t){let r=this.relayManager.remoteFolders.get(e);if(!r)return!1;let n=this.relayManager.relays.get(r.relayId);if(!n)return!1;let s=n.storageQuota;return s?s.usage+t<=s.quota:!0}evaluateFolderDelete(e){let t=this.getResourceId(e.resource);return this.hasFolderManagementAccess(e.principal,t)}evaluateFolderRename(e){let t=this.getResourceId(e.resource);return this.hasFolderManagementAccess(e.principal,t)}evaluateFolderRead(e){let t=this.getResourceId(e.resource);return this.hasFolderAccess(e.principal,t)}evaluateFolderWrite(e){let t=this.getResourceId(e.resource);return this.hasFolderWriteAccess(e.principal,t)}evaluateFolderDownload(e){let t=this.getResourceId(e.resource);return this.hasFolderAccess(e.principal,t)}evaluateFolderManageFiles(e){let t=this.getResourceId(e.resource);return this.hasFolderWriteAccess(e.principal,t)}evaluateFolderUpload(e){var n;let t=this.getResourceId(e.resource),r=((n=e.context)==null?void 0:n.fileSize)||0;return this.hasFolderWriteAccess(e.principal,t)&&this.hasStorageQuota(t,r)}evaluateRelayDelete(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayRename(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayManageUsers(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateRelayManageSharing(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateSubscriptionManage(e){let t=this.getResourceId(e.resource);return this.isRelayOwner(e.principal,t)}evaluateFolderManageUsers(e){let t=this.getResourceId(e.resource);return this.relayManager.remoteFolders.get(t)?this.isRelayOwnerForFolder(e.principal,t)?!0:this.hasFolderRole(e.principal,t,["Owner"]):!1}};function Rm(o){return typeof o.id=="string"}function IE(o){return typeof o.name=="string"}var Um=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function Xx(o){return typeof o.aggregate_root=="object"}function Dm(o){return Array.isArray(o.permissionParents)}var Ca=class{get aggregate_root(){}get permissionParents(){return[]}},Om=class extends st{constructor(t,r){super();this.storageQuota=t;this.relays=r}update(t){return this.storageQuota=t,this}get name(){return this.storageQuota.name}get id(){return this.storageQuota.id}get quota(){return this.storageQuota.quota}get pending(){return this.storageQuota.pending}get usage(){return this.storageQuota.usage}get maxFileSize(){return this.storageQuota.max_file_size}get updated(){return this.storageQuota.updated}get created(){return this.storageQuota.created}get aggregate_root(){var t;return["relays",(t=this.relays.find(r=>r.storageQuotaId===this.storageQuota.id))==null?void 0:t.id]}},$m=class{constructor(e,t,r){this.subscribeRecord=e;this.storageQuota=t;this.relays=r;this.collectionName="storage_quotas"}items(){return this.storageQuota.values()}clear(){this.storageQuota.clear()}get(e){return this.storageQuota.get(e)}ingest(e){let t=this.storageQuota.get(e.id);if(t)return t.update(e),this.storageQuota.notifyListeners(),t;let r=new Om(e,this.relays);return this.subscribeRecord(this.collectionName,e.id,[]).then(n=>{r.offRecordSubscription=n}),this.storageQuota.set(e.id,r),r}delete(e){var r;let t=this.storageQuota.get(e);(r=t==null?void 0:t.offRecordSubscription)==null||r.call(t),this.storageQuota.delete(e)}},qc=class extends Ca{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}get email(){return this.user.email}get picture(){return this.user.picture}update(t){return this.user=t,this}},Nm=class extends st{constructor(t){super();this.provider=t}get id(){return this.provider.id}get name(){return this.provider.name}get url(){return this.provider.url}get selfHosted(){return this.provider.self_hosted}update(t){return this.provider=t,this}},Bm=class{constructor(e){this.providers=e;this.collectionName="providers"}items(){return this.providers.values()}clear(){this.providers.clear()}get(e){return this.providers.get(e)}ingest(e){let t=this.providers.get(e.id);if(t)return t.update(e),this.providers.notifyListeners(),t;let r=new Nm(e);return this.providers.set(e.id,r),r}delete(e){this.providers.delete(e)}},Vm=class extends st{constructor(t,r,n,s,i,a){super();this.remoteFolder=t;this.relays=r;this.relayRoles=n;this.folderRoles=s;this.users=i;this.user=a}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}set name(t){this.remoteFolder.name=t}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get creatorId(){return this.remoteFolder.creator}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get relayId(){return this.remoteFolder.relay}get role(){var s,i;let t=this.remoteFolder.creator===this.user.id,r=(s=this.relayRoles.find(a=>a.relayId===this.relay.id&&a.userId===this.user.id))==null?void 0:s.role,n=(i=this.folderRoles.find(a=>a.sharedFolderId===this.remoteFolder.id&&a.userId===this.user.id))==null?void 0:i.role;if(this.remoteFolder.private){if(n)return n}else return r||this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":r||"Member";return this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member"}get owner(){return this.role==="Owner"}get aggregate_root(){return["relays",this.remoteFolder.relay]}get permissionParents(){var n,s;let t=[],r=(n=this.relayRoles.find(i=>i.relayId===this.relayId&&i.userId===this.user.id))==null?void 0:n.id;if(r&&t.push(["relay_roles",r]),this.remoteFolder.private){let i=(s=this.folderRoles.find(a=>a.sharedFolderId===this.id&&a.userId===this.user.id))==null?void 0:s.id;i&&t.push(["shared_folder_roles",i])}return t}},Hm=class{constructor(e,t,r,n,s,i){this.remoteFolders=e;this.relays=t;this.folderRoles=r;this.relayRoles=n;this.users=s;this.user=i;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new Vm(e,this.relays,this.relayRoles,this.folderRoles,this.users,this.user);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},qm=class{constructor(e,t,r,n,s,i,a,l){this.relays=e;this.relayRoles=t;this.relayInvitations=r;this.remoteFolders=n;this.subscriptions=s;this.storageQuotas=i;this.providers=a;this.user=l;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new eh(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},zm=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new Qm(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},jm=class{constructor(e,t,r,n){this.folderRoles=e;this.remoteFolders=t;this.users=r;this.roles=n;this.collectionName="shared_folder_roles"}items(){return this.folderRoles.values()}clear(){this.folderRoles.clear()}get(e){return this.folderRoles.get(e)}ingest(e){let t=this.folderRoles.get(e.id);if(t)return t.update(e),this.folderRoles.notifyListeners(),t;let r=new Ym(e,this.remoteFolders,this.users,this.roles);return this.folderRoles.set(r.id,r),r}delete(e){this.folderRoles.delete(e)}},Wm=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new Zm(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Km=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new qc(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Gm=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new Xm(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},Jm=class extends Lt{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);Nt.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=Vr.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=Vr.getInstance();r.beginTransaction();let n=this._ingest(t);return r.commitTransaction(),n}_ingest(t){if(!t)return;let r,n=this.collections.get(t.collectionName);if(n?r=n.ingest(t):this.error("No collection found for record",t),Xx(r)){let s=r.aggregate_root;if(s){let i=t.id,a=this.relationships.get(s.join(":"))||new Set;a.add([t.collectionName,i].join(":")),this.relationships.set(s.join(":"),a)}}if(Dm(r)){let s=r.permissionParents;for(let i of s){let a=t.id,l=this.relationships.get(i.join(":"))||new Set;l.add([t.collectionName,a].join(":")),this.relationships.set(i.join(":"),l)}}if(t.expand)for(let[,s]of Object.entries(t.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,n]of this.collections)for(let s of n.items()){if(!Rm(s)){this.warn("record has no id",s);continue}let i=r+"_"+s.id;if(IE(s)&&(i=r+"_"+s.name),t+=`  ${r}_${s.id} [label="${i}"];
`,Rm(s)&&Xx(s)&&s.aggregate_root){let[a,l]=s.aggregate_root;t+=`  ${r}_${s.id} -> ${a}_${l};
`}if(Rm(s)&&Dm(s))for(let a of s.permissionParents){let[l,c]=a;t+=`  ${r}_${s.id} -> ${l}_${c} [style=dotted];
`}}return t+="}",t}cascade(t,r){let n=this.collections.get(t),s=this.relationships.get([t,r].join(":")),i=Vr.getInstance();i.beginTransaction(),n&&(this.warn("cascade delete parent",t,r),n.delete(r)),this.relationships.delete([t,r].join(":"));for(let a of s||[]){let[l,c]=a.split(":"),u=this.getCollection(l),f=u==null?void 0:u.get(c);if(Dm(f)){let d=f.permissionParents.filter(p=>{let[m,y]=p;return!!this.getCollection(m).get(y)});d.length===0?(this.warn("cascade delete child (no valid permission parents)",l,c),this.cascade(l,c)):this.warn("preserving child with valid permission parents",l,c,d)}else this.warn("cascade delete child",l,c),this.cascade(l,c)}i.commitTransaction()}},Qm=class extends Ca{constructor(t,r,n,s){super();this.users=n,this.roles=s,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get permissionParents(){return[["users",this.relayRole.user]]}},Ym=class extends Ca{constructor(t,r,n,s){super();this.folderRole=t;this.remoteFolders=r;this.users=n;this.roles=s}update(t){return this.folderRole=t,this}get id(){return this.folderRole.id}get userId(){return this.folderRole.user}get user(){let t=this.users.get(this.folderRole.user);if(!t)throw new Error(`Unable to find user: ${this.folderRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.folderRole.role))==null?void 0:t.name}get sharedFolderId(){return this.folderRole.shared_folder}get sharedFolder(){let t=this.remoteFolders.get(this.folderRole.shared_folder);if(!t)throw new Error(`invalid role: unable to find folder ${this.folderRole.shared_folder} on role ${this.folderRole.id}`);return t}get aggregate_root(){return["shared_folders",this.folderRole.shared_folder]}get permissionParents(){return[["shared_folders",this.folderRole.shared_folder]]}},Zm=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get enabled(){return this.relayInvitation.enabled}get aggregate_root(){return["relays",this.relayInvitation.relay]}},Xm=class extends st{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get permissionParents(){return[["users",this.subscription.user]]}},eh=class extends st{constructor(t,r,n,s,i,a,l,c){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=i;this.storageQuotas=a;this.providers=l;this.user=c}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get version(){return this.relay.version}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get storageQuota(){return this.storageQuotas.find(t=>t.id===this.relay.storage_quota)}get storageQuotaId(){return this.relay.storage_quota}get folders(){return this.remoteFolders.filter(t=>{let r=t.relayId===this.id,n=t.permissionParents.length>0;return r&&n})}get subscriptions(){return this._subscriptions.filter(t=>t.relayId===this.id)}get permissionParents(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;return t?[["relay_roles",t]]:[]}get provider(){if(this.relay.provider)return this.providers.get(this.relay.provider)}get providerId(){return this.relay.provider}},zc=class extends Lt{constructor(t){super();this.loginManager=t;this.destroyed=!1;this._handleEvent=(t,r)=>{var n,s;this.debug(`[Event]: ${t}`,r.action,r.record),r.action==="delete"?(n=this.store)==null||n.delete(r.record):(s=this.store)==null||s.ingest(r.record)};this.pb=this.loginManager.pb,this.users=new Yt("users"),this.relays=new Yt("relays"),this.providers=new Yt("providers"),this.remoteFolders=new Yt("remote folders"),this.relayInvitations=new Yt("relay invitations"),this.relayRoles=new Yt("relay roles"),this.folderRoles=new Yt("folder roles"),this.roles=new Yt("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new Yt("subscriptions"),this.storageQuotas=new Yt("storage quotas"),this._offLoginManager=this.loginManager.on(()=>{this.loginManager.loggedIn?this.login():this.logout()}),this.setUser(),this.user&&(Nt.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new Um(this.roles),r=new Km(this.users),n=new Bm(this.providers),s=new qm(this.relays,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.storageQuotas,this.providers,this.user),i=new zm(this.relayRoles,this.relays,this.users,this.roles),a=new jm(this.folderRoles,this.remoteFolders,this.users,this.roles),l=new Wm(this.relayInvitations,this.relays,this.roles),c=new Hm(this.remoteFolders,this.relays,this.folderRoles,this.relayRoles,this.users,this.user),u=new Gm(this.subscriptions,this.relays,this.users),f=new $m(this.subscribeRecord.bind(this),this.storageQuotas,this.relays);this.store=new Jm([t,r,s,i,a,l,c,u,f,n]),this.policyManager=new Hc(this)}getCollectionMapByName(t){switch(t){case"folder_roles":return this.folderRoles;case"relay_roles":return this.relayRoles;case"shared_folders":return this.remoteFolders;case"relays":return this.relays;case"storage_quotas":return this.storageQuotas;case"subscriptions":return this.subscriptions;default:console.warn(`Unknown collection name: ${t}`);return}}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new qc(this.authUser),this.users.set(this.user.id,this.user))}login(){var t;this.authUser&&this.authUser==((t=this.pb)==null?void 0:t.authStore.model)||(this.setUser(),this.buildGraph(),this.subscribe(),this.update())}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async rotateKey(t){if(!this.pb)throw new Error("missing pocketbase");return this.pb.send("/api/rotate-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.id})}).then(r=>{var s;let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("unable to rotate key");return n})}async toggleRelayInvitation(t,r){if(!this.pb)throw new Error("missing pocketbase");return this.pb.collection("relay_invitations").update(t.id,{enabled:r}).then(n=>{var i;let s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("unable to toggle invitation enable");return s})}async getRelayInvitation(t){if(!this.pb)return;let r=this.relayInvitations.find(n=>n.relayId===t.id);return r||this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(i=>{var a;(a=this.store)==null||a.ingest(i)});let s=this.relayInvitations.find(i=>i.relayId===t.id);if(s)return s})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var r;if(!this.pb||!this.pb.authStore.isValid||((r=this.pb.authStore.model)==null?void 0:r.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","subscriptions_via_relay.relay.storage_quota","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"providers",expand:[]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"shared_folder_roles",expand:["user","shared_folder"]},{name:"subscriptions",expand:["user","relay"]}];for(let n of t)this.pb.collection(n.name).subscribe("*",s=>this._handleEvent(n.name,s),{expand:n.expand.join(","),fetch:ft})}async subscribeRecord(t,r,n){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0){this.warn("unable to subscribe, pocketbase client is not ready");return}return this.pb.collection(t).subscribe(r,i=>this._handleEvent(t,i),{expand:n.join(","),fetch:ft})}async refreshRemoteFolder(t){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return Promise.resolve([]);let r=await this.pb.collection("shared_folders").getOne(t.id,{expand:"shared_folder_roles_via_shared_folder"});!this.destroyed&&this.store&&this.store.ingest(r)}async refreshRelay(t){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return Promise.resolve([]);let r=await this.pb.collection("relays").getOne(t.id,{expand:"relay_roles_via_relay,shared_folders_via_relay,storage_quota"});!this.destroyed&&this.store&&this.store.ingest(r)}async update(){let t=(n,s={})=>{var i;return!this.pb||!this.pb.authStore.isValid||((i=this.pb.authStore.model)==null?void 0:i.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:["relay_roles_via_user","relay_roles_via_user.relay","relay_roles_via_user.relay.storage_quota","relay_roles_via_user.role"].join(",")})),t("relay_roles",{expand:"user,role"}),t("providers"),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("shared_folder_roles",{expand:"user,role"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let i of s)!this.destroyed&&this.store&&this.store.ingest(i)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})}).catch(i=>{throw i});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var i,a;let r=Js(),n=await((i=this.pb)==null?void 0:i.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay,storage_quota"}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=(a=this.store)==null?void 0:a.ingest(n);if(!s)throw new Error("Failed to create relay");return s}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var r;return await((r=this.pb)==null?void 0:r.collection("shared_folders").delete(t.id)),!0}async createRemoteFolder(t,r,n=!1,s=void 0){var l,c;if(!this.pb)throw new Error("Failed to create folder");let i=await this.pb.collection("shared_folders").create({name:s||t.name,guid:t.guid,relay:r.id,creator:(l=this.user)==null?void 0:l.id,private:n},{expand:"relay"}),a=(c=this.store)==null?void 0:c.ingest(i);if(!a)throw new Error("Failed to create folder");return a}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(i=>{var a;return i.userId===((a=this.user)==null?void 0:a.id)&&i.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}async updateRelayRole(t,r){var a;if(!this.pb)throw new Error("Failed to update relay role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update relay role");let s=await this.pb.collection("relay_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update relay role");return i}async addFolderRole(t,r,n){var l;if(!this.pb)throw new Error("Failed to add folder role");let s=this.roles.find(c=>c.name===n);if(!s)throw new Error("Failed to find role");let i=await this.pb.collection("shared_folder_roles").create({user:r,shared_folder:t.id,role:s.id}),a=(l=this.store)==null?void 0:l.ingest(i);if(!a)throw new Error("Failed to add folder role");return a}async removeFolderRole(t){if(!this.pb)throw new Error("Failed to remove folder role");await this.pb.collection("shared_folder_roles").delete(t.id)}async updateFolderRole(t,r){var a;if(!this.pb)throw new Error("Failed to update folder role");let n=this.roles.find(l=>l.name===r);if(!n)throw new Error("Failed to update folder role");let s=await this.pb.collection("shared_folder_roles").update(t.id,{role:n.id}),i=(a=this.store)==null?void 0:a.ingest(s);if(!i)throw new Error("Failed to update folder role");return i}async updateFolderPrivacy(t,r){var i;if(!this.pb)throw new Error("Failed to update folder privacy");let n=await this.pb.collection("shared_folders").update(t.id,{private:r}),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to update folder privacy");return s}async updateRemoteFolder(t,r){var i;if(!this.pb)throw new Error("Failed to update folder");let n=await this.pb.collection("shared_folders").update(t.id,r),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to update folder");return s}can(t,r,n,s){if(!this.policyManager)return new vi(()=>!1,[]);let[i]=r,a=[i,n.id];return this.policyManager.can(t,r,a,s)}userCan(t,r,n){return this.user?this.can(this.user.id,t,r,n):new vi(()=>!1,[])}destroy(){var t,r,n;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(n=this.store)==null||n.destroy(),this.pb=null,this.authUser=null,this.store=null,this.policyManager=void 0}};var T1=require("obsidian");var th=require("obsidian");function Rn(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let i=t[s].match(/\d+/g),a=r[s].match(/\d+/g);if(i&&a){let l=parseInt(i[0]),c=parseInt(a[0]);if(l!==c)return l-c}}return t[s].localeCompare(r[s])}return t.length-r.length}var jc=class extends Lt{constructor(t,r,n,s=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=n;this.concurrency=s;this.activeSync=new xn;this.activeDownloads=new xn;this.syncGroups=new Yt;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Nt.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,n=0,s=0,i=0,a=0;this.syncGroups.forEach(f=>{t+=f.total,r+=f.completed,n+=f.syncs,s+=f.completedSyncs,i+=f.downloads,a+=f.completedDownloads});let l=t>0?r/t*100:0,c=n>0?s/n*100:0,u=i>0?a/i*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(c),downloadPercent:Math.round(u),totalItems:t,completedItems:r,syncItems:n,completedSyncs:s,downloadItems:i,completedDownloads:a}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let n=r.total>0?r.completed/r.total*100:0,s=r.syncs>0?r.completedSyncs/r.syncs*100:0,i=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(n),syncPercent:Math.round(s),downloadPercent:Math.round(i),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,n)=>{let s=this.getGroupProgress(n);s&&t.push(s)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let n=r.doc;n instanceof In?await this.syncFile(n):await this.syncDocument(n),r.status="completed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.debug(`[Sync Progress] Before: completed=${i.completed}, total=${i.total}, syncs=${i.syncs}, completedSyncs=${i.completedSyncs}`),i.completedSyncs++,i.completed++,this.debug(`[Sync Progress] After: completed=${i.completed}, total=${i.total}, syncs=${i.syncs}, completedSyncs=${i.completedSyncs}`),i.completed===i.total&&(i.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,i))}catch(n){r.status="failed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.syncCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(this.error("[Sync Failed]",n),i.status="failed",this.syncGroups.set(r.sharedFolder,i))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(n=>n.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{r.doc instanceof yt?await this.getCanvas(r.doc):r.doc instanceof In?await this.getSyncFile(r.doc):await this.getDocument(r.doc),r.status="completed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let s=this.syncGroups.get(r.sharedFolder);s&&(s.completedDownloads++,s.completed++,s.completed===s.total&&(s.status="completed"),this.syncGroups.set(r.sharedFolder,s))}catch(n){r.status="failed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.downloadCompletionCallbacks.delete(r.guid));let i=this.syncGroups.get(r.sharedFolder);i&&(i.status="failed",this.syncGroups.set(r.sharedFolder,i)),this.error("[processDownloadQueue]",n)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(n=>n.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?new Promise((l,c)=>{a.resolve=l,a.reject=c}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.total++,s.syncs++,this.syncGroups.set(r,s),this.inProgressSyncs.add(t.guid);let i=new Promise((a,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.syncQueue.push(n),this.syncQueue.sort(Rn),this.processSyncQueue(),i}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let a=this.downloadCompletionCallbacks.get(t.guid);return a?(this.processDownloadQueue(),new Promise((l,c)=>{a.resolve=l,a.reject=c})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.downloads++,n.total++,this.syncGroups.set(r,n);let s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let i=new Promise((a,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:a,reject:l})});return this.downloadQueue.push(s),this.downloadQueue.sort(Rn),this.processDownloadQueue(),i}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(Sr),n=[...t.files.values()].filter(Ir),s=[...t.files.values()].filter(Hr),i=[...r,...n,...s],a={sharedFolder:t,total:i.length,completed:0,status:"pending",downloads:0,syncs:i.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,a);let l=[...r].sort(Rn),c=[...n].sort(Rn),u=[...s].sort(Rn);for(let f of l)this.enqueueDocumentForGroupSync(f);for(let f of c)this.enqueueCanvasForGroupSync(f,t);for(let f of u)this.enqueueSyncFileForGroupSync(f);a.status="running",this.syncGroups.set(t,a)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(Rn),this.processSyncQueue(),s}async enqueueSyncFileForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSyncFileForGroupSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?(this.processSyncQueue(),new Promise((a,l)=>{i.resolve=a,i.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((i,a)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:a})});return this.syncQueue.push(n),this.syncQueue.sort(Rn),this.processSyncQueue(),s}getAuthHeader(t){return{Authorization:`Bearer ${t.token}`}}getBaseUrl(t,r){var a;let n=new URL(t.url);n.protocol="https:";let s=n.pathname.split("/");return s.pop(),s.push(t.docId),n.pathname=s.join("/"),((a=t.baseUrl)==null?void 0:a.replace(/\/$/,""))||n.toString()}async downloadItem(t){let r=u=>u instanceof pr?u.canvasId:u.documentId,n=t.s3rn;if(this.log("[downloadItem]",t.path,`${gt.encode(n)}`),!(n instanceof Zr||n instanceof pr))throw new Error(`Unable to decode S3RN: ${gt.encode(n)}`);let s=await t.getProviderToken(),i=this.getAuthHeader(s),l=`${this.getBaseUrl(s,n)}/as-update`,c=await(0,th.requestUrl)({url:l,method:"GET",headers:i,throw:!1});if(c.status===200)this.debug("[downloadItem]",r(n),c.status);else throw this.error("[downloadItem]",r(n),l,c.status,c.text),new Error(`Unable to download item: ${gt.encode(n)}`);return c}async syncDocumentWebsocket(t){let r="",n="",s=null;Ir(t)?(s=yt.exportCanvasData(t.ydoc),n=JSON.stringify(s)):Sr(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(c){}let i=!1;if(Ir(t)&&s){let c=r?JSON.parse(r):{nodes:[],edges:[]};i=yo(s,c)}else i=n===r;if(!i&&r)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),l=t.intent;return t.connect(),l==="disconnected"&&await a,l==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(gt.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${gt.encode(r)}`),!(r instanceof Zr)&&!(r instanceof pr))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let n=await t.getProviderToken(),s={"Content-Type":"application/octet-stream",...this.getAuthHeader(n)},i=Qn(t.ydoc),l=`${this.getBaseUrl(n,r)}/update`,c=await(0,th.requestUrl)({url:l,method:"POST",headers:s,body:i.buffer,throw:!1});return c.status===200?this.debug("[uploadItem]",r instanceof pr?r.canvasId:r.documentId,c.status,c.text):this.error("[uploadItem]",r instanceof pr?r.canvasId:r.documentId,l,c.status,c.text),c}enqueueCanvasDownload(t){return this.enqueueDownload(t)}async enqueueCanvasForGroupSync(t,r){try{if(!r.syncStore.has(t.path)){this.debug("[enqueueCanvasForGroupSync] Skipping canvas, not in sync list",t.path);return}await this.enqueueDownload(t)}catch(n){this.error("[enqueueCanvasForGroupSync]",n)}}async getCanvas(t,r=3,n=3e3){try{let s=yt.exportCanvasData(t.ydoc),i={edges:[],nodes:[]};try{let d=await t.sharedFolder.read(t);i=JSON.parse(d)}catch(d){}let a=yo(s.edges,i.edges)&&yo(s.nodes,i.nodes),l=i.nodes.length>0,u=(await this.downloadItem(t)).arrayBuffer,f=new Uint8Array(u);if(this.log("[getCanvas] applying content from server"),Ur(t.ydoc,f),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.json),this.log("[getCanvas] flushed"))}catch(s){throw this.error(s),s}}async getDocument(t,r=3,n=3e3){try{let s=t.text,i="";try{i=await t.sharedFolder.read(t)}catch(y){}let a=s===i,l=i!=="",u=(await this.downloadItem(t)).arrayBuffer,f=new Uint8Array(u),d=new wr;Ur(d,f);let p=d.getMap("users");if(d.getText("contents").toString()===""){if(p.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",p.size,r,n),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,n*2)},n);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),Ur(t.ydoc,f),l&&!a){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(s){throw this.error(s),s}}async syncItem(t){let r="",n="",s=null;Ir(t)?(s=yt.exportCanvasData(t.ydoc),n=JSON.stringify(s)):Sr(t)&&(n=t.text);try{r=await t.sharedFolder.read(t)}catch(p){}let i=!1;if(Ir(t)&&s){let p=r?JSON.parse(r):{nodes:[],edges:[]};i=yo(s,p)}else i=n===r;if(!i)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=await this.downloadItem(t);if(a.status!==200)return this.log("server returned an error."),!1;let l=a.arrayBuffer,c=new Uint8Array(l),u=new wr;Ur(u,c);let f=u.getMap("users"),d=!1;if(Ir(t)&&s){let p=yt.exportCanvasData(u);d=f.size>0&&yo(p,s)}else{let p=u.getText("contents").toString();d=f.size>0&&p===n}return d||(Ur(t.ydoc,c),Ir(t)?t.sharedFolder.flush(t,t.json):Sr(t)&&t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncFile(t){t.sync()}async getSyncFile(t){t.pull()}async syncDocument(t){var r;try{je().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),Sr(t)?await this.syncDocumentWebsocket(t):Ir(t)&&await this.syncDocumentWebsocket(t))}catch(n){console.error(n);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},n=this.activeSync.subscribe(()=>r()),s=this.activeDownloads.subscribe(()=>r()),i=this.syncGroups.subscribe(()=>r());return()=>{n(),s(),i()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var nw=require("obsidian");var rw=require("obsidian");function CE(o){Le(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function ew(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function tw(o){let e,t,r,n=o[8]+"",s,i,a,l,c=o[8]+"",u,f,d,p,m,y,g,k,L,I,C,A;function M(){return o[6](o[8])}function P(){return o[7](o[8])}return{c(){e=S("div"),t=S("div"),r=S("div"),s=V(n),i=F(),a=S("div"),l=V("Toggle "),u=V(c),f=V(" on or off"),d=F(),p=S("div"),m=S("div"),y=S("input"),k=F(),L=S("div"),h(r,"class","setting-item-name"),h(a,"class","setting-item-description"),h(t,"class","setting-item-info"),h(y,"type","checkbox"),h(y,"tabindex","-1"),y.checked=g=o[9],h(L,"class","checkbox-toggle"),h(m,"role","checkbox"),h(m,"aria-checked",I=o[9]),h(m,"tabindex","0"),h(m,"class","checkbox-container svelte-4kkvmr"),Me(m,"is-enabled",o[9]),h(p,"class","setting-item-control"),h(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(O,T){x(O,e,T),v(e,t),v(t,r),v(r,s),v(t,i),v(t,a),v(a,l),v(a,u),v(a,f),v(e,d),v(e,p),v(p,m),v(m,y),v(m,k),v(m,L),C||(A=[H(m,"keypress",M),H(m,"click",P)],C=!0)},p(O,T){o=O,T&2&&n!==(n=o[8]+"")&&J(s,n),T&2&&c!==(c=o[8]+"")&&J(u,c),T&2&&g!==(g=o[9])&&(y.checked=g),T&2&&I!==(I=o[9])&&h(m,"aria-checked",I),T&2&&Me(m,"is-enabled",o[9])},d(O){O&&_(e),C=!1,Ie(A)}}}function LE(o){let e,t,r,n,s,i,a,l,c,u=ke(Object.entries(o[1]).filter(o[5]).sort()),f=[];for(let d=0;d<u.length;d+=1)f[d]=tw(ew(o,u,d));return{c(){e=S("div"),t=S("h2"),t.textContent="Feature Flags",r=F();for(let d=0;d<f.length;d+=1)f[d].c();n=F(),s=S("div"),i=S("div"),a=S("button"),a.textContent="Apply",h(a,"aria-label","apply flag settings"),h(a,"tabindex","0"),h(i,"class","setting-item-control"),h(s,"class","setting-item"),h(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(d,p){x(d,e,p),v(e,t),v(e,r);for(let m=0;m<f.length;m+=1)f[m]&&f[m].m(e,null);v(e,n),v(e,s),v(s,i),v(i,a),l||(c=[H(a,"click",function(){Qe(o[0])&&o[0].apply(this,arguments)}),H(a,"keypress",function(){Qe(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(d,[p]){if(o=d,p&10){u=ke(Object.entries(o[1]).filter(o[5]).sort());let m;for(m=0;m<u.length;m+=1){let y=ew(o,u,m);f[m]?f[m].p(y,p):(f[m]=tw(y),f[m].c(),f[m].m(e,n))}for(;m<f.length;m+=1)f[m].d(1);f.length=u.length}},i:z,o:z,d(d){d&&_(e),ze(f,d),l=!1,Ie(c)}}}function TE(o,e,t){let r,n,{reload:s}=e,i=xt.getInstance();ce(o,i,f=>t(4,n=f));function a(f){let d=!r[f];t(1,r[f]=d,r),i.setFlag(f,r[f])}dt(()=>{Object.keys(r).forEach(f=>{let d=document.getElementById(`toggle-${f}`);d&&(0,rw.setIcon)(d,"check")})});let l=([f,d])=>gl(f),c=f=>{if(!gl(f))throw new Error("Unexpected feature flag!");a(f)},u=f=>{if(!gl(f))throw new Error("Unexpected feature flag!");a(f)};return o.$$set=f=>{"reload"in f&&t(0,s=f.reload)},o.$$.update=()=>{if(o.$$.dirty&16){e:t(1,r=Object.assign({},n.flags))}},[s,r,i,a,n,l,c,u]}var rh=class extends K{constructor(e){super(),G(this,e,TE,LE,W,{reload:0},CE)}},ow=rh;var Wc=class extends nw.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new ow({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var mw=require("obsidian");var dw=require("obsidian");function sw(o,e,t){let r=o.slice();return r[13]=e[t],r}function iw(o,e,t){let r=o.slice();return r[16]=e[t],r}function AE(o){let e,t,r;return{c(){e=S("button"),e.textContent="Refresh"},m(n,s){x(n,e,s),t||(r=H(e,"click",(0,dw.debounce)(o[12])),t=!0)},p:z,d(n){n&&_(e),t=!1,r()}}}function ME(o){let e=navigator.userAgent+"",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p:z,d(r){r&&_(t)}}}function FE(o){let e;return{c(){e=V(o[1])},m(t,r){x(t,e,r)},p(t,r){r&2&&J(e,t[1])},d(t){t&&_(e)}}}function PE(o){let e;return{c(){e=V(o[2])},m(t,r){x(t,e,r)},p(t,r){r&4&&J(e,t[2])},d(t){t&&_(e)}}}function EE(o){let e;return{c(){e=V(o[3])},m(t,r){x(t,e,r)},p(t,r){r&8&&J(e,t[3])},d(t){t&&_(e)}}}function RE(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=V(e)},m(r,n){x(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&J(t,e)},d(r){r&&_(t)}}}function aw(o){let e,t=`${o[16]}`,r,n;return{c(){e=S("div"),r=V(t),n=F()},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&16&&t!==(t=`${s[16]}`)&&J(r,t)},d(s){s&&_(e)}}}function DE(o){let e,t=ke(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=aw(iw(o,t,n));return{c(){e=S("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){x(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&16){t=ke(Object.keys(n[4].cancelControllers));let i;for(i=0;i<t.length;i+=1){let a=iw(n,t,i);r[i]?r[i].p(a,s):(r[i]=aw(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),ze(r,n)}}}function lw(o){let e,t=`${o[13]}`,r,n;return{c(){e=S("div"),r=V(t),n=F()},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&32&&t!==(t=`${s[13]}`)&&J(r,t)},d(s){s&&_(e)}}}function UE(o){let e,t=ke(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=lw(sw(o,t,n));return{c(){e=S("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){x(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=ke(n[5]);let i;for(i=0;i<t.length;i+=1){let a=sw(n,t,i);r[i]?r[i].p(a,s):(r[i]=lw(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),ze(r,n)}}}function OE(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,y,g,k,L,I,C,A,M,P;return n=new qe({props:{name:"Environment",$$slots:{default:[AE]},$$scope:{ctx:o}}}),i=new Oe({props:{name:"User Agent",description:"",$$slots:{default:[ME]},$$scope:{ctx:o}}}),l=new Oe({props:{name:"Fetch",description:"",$$slots:{default:[FE]},$$scope:{ctx:o}}}),u=new Oe({props:{name:"Response",description:"",$$slots:{default:[PE]},$$scope:{ctx:o}}}),d=new Oe({props:{name:"Blink Fetch",description:"",$$slots:{default:[EE]},$$scope:{ctx:o}}}),m=new Oe({props:{name:"Startup Time",description:"",$$slots:{default:[RE]},$$scope:{ctx:o}}}),g=new qe({props:{name:"Connections"}}),L=new Oe({props:{name:"",description:"",$$slots:{description:[DE]},$$scope:{ctx:o}}}),C=new qe({props:{name:"Log Files"}}),M=new Oe({props:{name:"",description:"",$$slots:{description:[UE]},$$scope:{ctx:o}}}),{c(){e=S("div"),e.textContent="Debug Info",t=F(),r=S("div"),D(n.$$.fragment),s=F(),D(i.$$.fragment),a=F(),D(l.$$.fragment),c=F(),D(u.$$.fragment),f=F(),D(d.$$.fragment),p=F(),D(m.$$.fragment),y=F(),D(g.$$.fragment),k=F(),D(L.$$.fragment),I=F(),D(C.$$.fragment),A=F(),D(M.$$.fragment),h(e,"class","modal-title"),h(r,"class","modal-content")},m(O,T){x(O,e,T),x(O,t,T),x(O,r,T),E(n,r,null),v(r,s),E(i,r,null),v(r,a),E(l,r,null),v(r,c),E(u,r,null),v(r,f),E(d,r,null),v(r,p),E(m,r,null),v(r,y),E(g,r,null),v(r,k),E(L,r,null),v(r,I),E(C,r,null),v(r,A),E(M,r,null),P=!0},p(O,[T]){let U={};T&524288&&(U.$$scope={dirty:T,ctx:O}),n.$set(U);let j={};T&524288&&(j.$$scope={dirty:T,ctx:O}),i.$set(j);let Q={};T&524290&&(Q.$$scope={dirty:T,ctx:O}),l.$set(Q);let N={};T&524292&&(N.$$scope={dirty:T,ctx:O}),u.$set(N);let X={};T&524296&&(X.$$scope={dirty:T,ctx:O}),d.$set(X);let $={};T&524289&&($.$$scope={dirty:T,ctx:O}),m.$set($);let B={};T&524304&&(B.$$scope={dirty:T,ctx:O}),L.$set(B);let pe={};T&524320&&(pe.$$scope={dirty:T,ctx:O}),M.$set(pe)},i(O){P||(b(n.$$.fragment,O),b(i.$$.fragment,O),b(l.$$.fragment,O),b(u.$$.fragment,O),b(d.$$.fragment,O),b(m.$$.fragment,O),b(g.$$.fragment,O),b(L.$$.fragment,O),b(C.$$.fragment,O),b(M.$$.fragment,O),P=!0)},o(O){w(n.$$.fragment,O),w(i.$$.fragment,O),w(l.$$.fragment,O),w(u.$$.fragment,O),w(d.$$.fragment,O),w(m.$$.fragment,O),w(g.$$.fragment,O),w(L.$$.fragment,O),w(C.$$.fragment,O),w(M.$$.fragment,O),P=!1},d(O){O&&(_(e),_(t),_(r)),R(n),R(i),R(l),R(u),R(d),R(m),R(g),R(L),R(C),R(M)}}}function cw(){try{return Response.toString()}catch(o){return"undefined"}}function uw(){try{return fetch.toString()}catch(o){return"undefined"}}function fw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function $E(o,e,t){let r,n,s,i,a,{plugin:l}=e,c=Ce(cw());ce(o,c,g=>t(2,n=g));let u=Ce(uw());ce(o,u,g=>t(1,r=g));let f=Ce(fw());ce(o,f,g=>t(3,s=g));let d=Ce(l.loginManager.pb);ce(o,d,g=>t(4,i=g));let p=Ce([]);ce(o,p,g=>t(5,a=g)),hl().then(g=>{p.set(g)});function m(){c.set(cw()),u.set(uw()),f.set(fw()),d.set(l.loginManager.pb)}let y=()=>{m()};return o.$$set=g=>{"plugin"in g&&t(0,l=g.plugin)},[l,r,n,s,i,a,c,u,f,d,p,m,y]}var oh=class extends K{constructor(e){super(),G(this,e,$E,OE,W,{plugin:0})}},pw=oh;var Kc=class extends mw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new pw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var hw=require("obsidian"),Gc=class{notify(e){new hw.Notice(e)}},Jc=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var kw=require("obsidian");var ww=require("obsidian");function NE(o){Le(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function gw(o,e,t){let r=o.slice();return r[21]=e[t],r}function BE(o){let e,t,r,n,s,i,a,l,c,u,f,d,p;r=new Oe({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),a=new Oe({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[qE]},$$scope:{ctx:o}}});let m=o[4]&&yw(o);return u=new Oe({props:{name:"",description:"",$$slots:{default:[jE]},$$scope:{ctx:o}}}),{c(){e=S("div"),t=S("div"),D(r.$$.fragment),n=F(),s=S("textarea"),i=F(),D(a.$$.fragment),l=F(),m&&m.c(),c=F(),D(u.$$.fragment),h(s,"placeholder","Describe the issue here..."),h(s,"class","svelte-jmqfac"),h(t,"class","form-content svelte-jmqfac"),h(e,"class","report-container svelte-jmqfac")},m(y,g){x(y,e,g),v(e,t),E(r,t,null),v(t,n),v(t,s),rt(s,o[3]),v(t,i),E(a,t,null),v(t,l),m&&m.m(t,null),v(e,c),E(u,e,null),f=!0,d||(p=H(s,"input",o[13]),d=!0)},p(y,g){g&8&&rt(s,y[3]);let k={};g&16777232&&(k.$$scope={dirty:g,ctx:y}),a.$set(k),y[4]?m?(m.p(y,g),g&16&&b(m,1)):(m=yw(y),m.c(),b(m,1),m.m(t,null)):m&&(oe(),w(m,1,1,()=>{m=null}),ne());let L={};g&16777293&&(L.$$scope={dirty:g,ctx:y}),u.$set(L)},i(y){f||(b(r.$$.fragment,y),b(a.$$.fragment,y),b(m),b(u.$$.fragment,y),f=!0)},o(y){w(r.$$.fragment,y),w(a.$$.fragment,y),w(m),w(u.$$.fragment,y),f=!1},d(y){y&&_(e),R(r),R(a),m&&m.d(),R(u),d=!1,p()}}}function VE(o){let e;return{c(){e=S("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',h(e,"class","centered-message svelte-jmqfac")},m(t,r){x(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function HE(o){let e,t,r;return t=new Oe({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=S("div"),D(t.$$.fragment),h(e,"class","centered-message svelte-jmqfac")},m(n,s){x(n,e,s),E(t,e,null),r=!0},p:z,i(n){r||(b(t.$$.fragment,n),r=!0)},o(n){w(t.$$.fragment,n),r=!1},d(n){n&&_(e),R(t)}}}function qE(o){let e,t,r,n,s,i;return{c(){e=S("div"),t=S("input"),r=F(),n=S("div"),h(t,"type","checkbox"),h(t,"tabindex","-1"),t.checked=o[4],h(n,"class","checkbox-toggle"),h(e,"role","checkbox"),h(e,"aria-checked",o[4]),h(e,"tabindex","0"),h(e,"class","checkbox-container"),Me(e,"is-enabled",o[4])},m(a,l){x(a,e,l),v(e,t),v(e,r),v(e,n),s||(i=[H(e,"keypress",KE),H(e,"click",o[14])],s=!0)},p(a,l){l&16&&(t.checked=a[4]),l&16&&h(e,"aria-checked",a[4]),l&16&&Me(e,"is-enabled",a[4])},d(a){a&&_(e),s=!1,Ie(i)}}}function yw(o){let e,t;return e=new Oe({props:{name:"Logs",description:"",$$slots:{description:[zE]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function bw(o){let e,t=`${o[21]}
`,r,n;return{c(){e=S("div"),r=V(t),n=F()},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&32&&t!==(t=`${s[21]}
`)&&J(r,t)},d(s){s&&_(e)}}}function zE(o){let e,t=ke(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=bw(gw(o,t,n));return{c(){e=S("div");for(let n=0;n<r.length;n+=1)r[n].c();h(e,"slot","description")},m(n,s){x(n,e,s);for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(e,null)},p(n,s){if(s&32){t=ke(n[5]);let i;for(i=0;i<t.length;i+=1){let a=gw(n,t,i);r[i]?r[i].p(a,s):(r[i]=bw(a),r[i].c(),r[i].m(e,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),ze(r,n)}}}function jE(o){let e,t,r,n;return{c(){e=S("button"),t=V("Send"),e.disabled=o[2]},m(s,i){x(s,e,i),v(e,t),r||(n=H(e,"click",o[15]),r=!0)},p(s,i){i&4&&(e.disabled=s[2])},d(s){s&&_(e),r=!1,n()}}}function WE(o){let e,t,r,n,s,i,a=[HE,VE,BE],l=[];function c(u,f){return u[1]?0:u[2]&&!u[1]?1:2}return n=c(o,-1),s=l[n]=a[n](o),{c(){e=S("div"),e.textContent="Send Bug Report",t=F(),r=S("div"),s.c(),h(e,"class","modal-title"),h(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,f){x(u,e,f),x(u,t,f),x(u,r,f),l[n].m(r,null),i=!0},p(u,[f]){let d=n;n=c(u,f),n===d?l[n].p(u,f):(oe(),w(l[d],1,1,()=>{l[d]=null}),ne(),s=l[n],s?s.p(u,f):(s=l[n]=a[n](u),s.c()),b(s,1),s.m(r,null))},i(u){i||(b(s),i=!0)},o(u){w(s),i=!1},d(u){u&&(_(e),_(t),_(r)),l[n].d()}}}function vw(){try{return Response.toString()}catch(o){return"undefined"}}function _w(){try{return fetch.toString()}catch(o){return"undefined"}}function xw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var KE=()=>{};function GE(o,e,t){let r,n,s,i,a,l,{plugin:c}=e,u=Ce(vw()),f=Ce(_w()),d=Ce(xw()),p=Ce("");ce(o,p,O=>t(3,s=O));let m=Ce(!1);ce(o,m,O=>t(4,i=O));let y=Ce(!1),g=Ce(!1);ce(o,g,O=>t(2,n=O));let k=Ce(!1);ce(o,k,O=>t(1,r=O));let L=Ce(c.loginManager.pb);ce(o,L,O=>t(6,l=O));let I=Ce([]);ce(o,I,O=>t(5,a=O)),hl().then(O=>{I.set(O)});function C(){u.set(vw()),f.set(_w()),d.set(xw()),L.set(c.loginManager.pb)}function A(){s=this.value,p.set(s)}let M=()=>{let O=!i;m.set(O)},P=async()=>{var T;let O=`Bug Report

`;if(O+=JSON.stringify({userAgent:navigator.userAgent,manifest:c.manifest,user:(T=l==null?void 0:l.authStore.model)==null?void 0:T.id,loadTime:c.loadTime,description:s},null,2),O+=`

`,m){let U=await My();O+=U}(0,ww.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:O,headers:{"Content-Type":"text/plain"}}).then(()=>{k.set(!0)}),g.set(!0)};return o.$$set=O=>{"plugin"in O&&t(0,c=O.plugin)},[c,r,n,s,i,a,l,p,m,g,k,L,I,A,M,P]}var nh=class extends K{constructor(e){super(),G(this,e,GE,WE,W,{plugin:0},NE)}},Sw=nh;var Qc=class extends kw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Sw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Ew=require("obsidian");async function Iw(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,i=[],a=0,l=0,c=0,u=0;for(let f of n)if(f.name){try{let d=await new Promise((p,m)=>{let y=indexedDB.open(f.name);y.onerror=()=>m(y.error),y.onsuccess=g=>p(g.target.result)});try{let p=Array.from(d.objectStoreNames);if(!p.includes("updates")||!p.includes("custom"))continue;let m=d.transaction(["updates","custom"],"readonly"),y=m.objectStore("updates"),g=m.objectStore("custom"),k=await new Promise(I=>{let C=g.get("appId");C.onsuccess=()=>I(C.result||"")});a++;let L=await new Promise((I,C)=>{let A=y.count();A.onsuccess=()=>I(A.result),A.onerror=()=>C(A.error)});if(l+=L,L>0){let I=0;if(await new Promise((C,A)=>{let M=y.openCursor();M.onsuccess=P=>{let O=P.target.result;if(O){let T=O.value instanceof Uint8Array?O.value.byteLength:JSON.stringify(O.value).length;I+=T,O.continue()}else C()},M.onerror=()=>A(M.error)}),c+=I,I>1024*1024&&(!t||k===e)){let C=await new Promise(P=>{let O=g.get("path");O.onsuccess=()=>P(O.result||"")}),A=await new Promise(P=>{let O=g.get("relay");O.onsuccess=()=>P(O.result||"")}),M=!f.name.startsWith(`${e}-relay`);i.push({slug:`${f.name}/${y.name}`,path:C,relay:A,appId:k||"unknown",count:L,estimatedSizeMB:Math.round(I/(1024*1024)*100)/100,isLegacy:M})}}}finally{d.close()}}catch(d){console.error(`Error processing database ${f.name}:`,d);continue}u++,r&&r(u/n.length*100)}return{totalStores:a,totalItems:l,totalSizeMB:Math.round(c/(1024*1024)*100)/100,databaseCount:s,largeStores:i.sort((f,d)=>d.estimatedSizeMB-f.estimatedSizeMB)}}async function Cw(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let i=indexedDB.open(e);i.onerror=()=>s(i.error),i.onsuccess=()=>n(i.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((i,a)=>{let l=s.clear();l.onsuccess=()=>i(),l.onerror=()=>a(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var hX=require("obsidian");function JE(o){Le(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function Lw(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function Tw(o,e,t){let r=o.slice();return r[22]=e[t],r}function QE(o){let e,t,r,n,s,i=o[0].databaseCount.toLocaleString()+"",a,l,c,u,f,d,p,m,y=o[0].totalStores+"",g,k,L,I,C,A,M=o[0].totalItems.toLocaleString()+"",P,O,T,U,j,Q,N=o[0].totalSizeMB.toFixed(2)+"",X,$,B,pe,Z;function ae(Y,Te){if(Y[0].databaseCount>45e3)return eR;if(Y[0].databaseCount>4e4)return XE}let ue=ae(o,-1),ee=ue&&ue(o),q=o[0].largeStores.length>0&&Aw(o);return{c(){e=S("div"),t=S("div"),r=S("div"),r.textContent="Global Database Limit",n=F(),s=S("div"),a=V(i),l=V(" / 50,000"),c=F(),ee&&ee.c(),u=F(),f=S("div"),d=S("div"),d.textContent="Relay Databases",p=F(),m=S("div"),g=V(y),k=F(),L=S("div"),I=S("div"),I.textContent="Document Updates",C=F(),A=S("div"),P=V(M),O=F(),T=S("div"),U=S("div"),U.textContent="Total Size",j=F(),Q=S("div"),X=V(N),$=V(" MB"),B=F(),q&&q.c(),pe=me(),h(r,"class","system3-stat-label svelte-1n3w4sk"),h(s,"class","system3-stat-value svelte-1n3w4sk"),Me(s,"system3-warning",o[0].databaseCount>4e4),Me(s,"system3-critical",o[0].databaseCount>45e3),h(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),h(d,"class","system3-stat-label svelte-1n3w4sk"),h(m,"class","system3-stat-value svelte-1n3w4sk"),h(f,"class","system3-stat-item svelte-1n3w4sk"),h(I,"class","system3-stat-label svelte-1n3w4sk"),h(A,"class","system3-stat-value svelte-1n3w4sk"),h(L,"class","system3-stat-item svelte-1n3w4sk"),h(U,"class","system3-stat-label svelte-1n3w4sk"),h(Q,"class","system3-stat-value svelte-1n3w4sk"),h(T,"class","system3-stat-item svelte-1n3w4sk"),h(e,"class","system3-summary-stats svelte-1n3w4sk")},m(Y,Te){x(Y,e,Te),v(e,t),v(t,r),v(t,n),v(t,s),v(s,a),v(s,l),v(t,c),ee&&ee.m(t,null),v(e,u),v(e,f),v(f,d),v(f,p),v(f,m),v(m,g),v(e,k),v(e,L),v(L,I),v(L,C),v(L,A),v(A,P),v(e,O),v(e,T),v(T,U),v(T,j),v(T,Q),v(Q,X),v(Q,$),x(Y,B,Te),q&&q.m(Y,Te),x(Y,pe,Te),Z=!0},p(Y,Te){(!Z||Te&1)&&i!==(i=Y[0].databaseCount.toLocaleString()+"")&&J(a,i),(!Z||Te&1)&&Me(s,"system3-warning",Y[0].databaseCount>4e4),(!Z||Te&1)&&Me(s,"system3-critical",Y[0].databaseCount>45e3),ue!==(ue=ae(Y,Te))&&(ee&&ee.d(1),ee=ue&&ue(Y),ee&&(ee.c(),ee.m(t,null))),(!Z||Te&1)&&y!==(y=Y[0].totalStores+"")&&J(g,y),(!Z||Te&1)&&M!==(M=Y[0].totalItems.toLocaleString()+"")&&J(P,M),(!Z||Te&1)&&N!==(N=Y[0].totalSizeMB.toFixed(2)+"")&&J(X,N),Y[0].largeStores.length>0?q?(q.p(Y,Te),Te&1&&b(q,1)):(q=Aw(Y),q.c(),b(q,1),q.m(pe.parentNode,pe)):q&&(oe(),w(q,1,1,()=>{q=null}),ne())},i(Y){Z||(b(q),Z=!0)},o(Y){w(q),Z=!1},d(Y){Y&&(_(e),_(B),_(pe)),ee&&ee.d(),q&&q.d(Y)}}}function YE(o){let e,t;return{c(){e=S("div"),t=V(o[5]),h(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){x(r,e,n),v(e,t)},p(r,n){n&32&&J(t,r[5])},i:z,o:z,d(r){r&&_(e)}}}function ZE(o){let e,t,r,n,s,i,a;return{c(){e=S("div"),t=S("div"),r=F(),n=S("div"),n.textContent="Analyzing Databases...",s=F(),i=S("div"),a=S("div"),h(t,"class","system3-loading-spinner svelte-1n3w4sk"),h(n,"class","loading-text"),h(a,"class","system3-progress-fill svelte-1n3w4sk"),he(a,"width",o[4]+"%"),h(i,"class","system3-progress-bar svelte-1n3w4sk"),h(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,c){x(l,e,c),v(e,t),v(e,r),v(e,n),v(e,s),v(e,i),v(i,a)},p(l,c){c&16&&he(a,"width",l[4]+"%")},i:z,o:z,d(l){l&&_(e)}}}function XE(o){let e;return{c(){e=S("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,h(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function eR(o){let e;return{c(){e=S("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,h(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function Aw(o){let e,t,r,n;e=new qe({props:{name:"Large Stores (>1MB)"}});let s=ke(o[2]),i=[];for(let l=0;l<s.length;l+=1)i[l]=Fw(Lw(o,s,l));let a=l=>w(i[l],1,1,()=>{i[l]=null});return{c(){D(e.$$.fragment),t=F();for(let l=0;l<i.length;l+=1)i[l].c();r=me()},m(l,c){E(e,l,c),x(l,t,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(l,c);x(l,r,c),n=!0},p(l,c){if(c&2052){s=ke(l[2]);let u;for(u=0;u<s.length;u+=1){let f=Lw(l,s,u);i[u]?(i[u].p(f,c),b(i[u],1)):(i[u]=Fw(f),i[u].c(),b(i[u],1),i[u].m(r.parentNode,r))}for(oe(),u=s.length;u<i.length;u+=1)a(u);ne()}},i(l){if(!n){b(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)b(i[c]);n=!0}},o(l){w(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)w(i[c]);n=!1},d(l){l&&(_(t),_(r)),R(e,l),ze(i,l)}}}function tR(o){let e,t,r,n,s;function i(){return o[17](o[22])}return{c(){e=S("div"),t=S("button"),t.textContent="Delete",r=F(),h(t,"class","mod-warning"),h(t,"title","Delete all data in this store"),h(e,"class","system3-actions svelte-1n3w4sk")},m(a,l){x(a,e,l),v(e,t),x(a,r,l),n||(s=H(t,"click",i),n=!0)},p(a,l){o=a},d(a){a&&(_(e),_(r)),n=!1,s()}}}function Mw(o){let e,t;return e=new Oe({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[tR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Fw(o){let e,t,r,n;e=new qe({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=ke(o[19]),i=[];for(let l=0;l<s.length;l+=1)i[l]=Mw(Tw(o,s,l));let a=l=>w(i[l],1,1,()=>{i[l]=null});return{c(){D(e.$$.fragment),t=F();for(let l=0;l<i.length;l+=1)i[l].c();r=me()},m(l,c){E(e,l,c),x(l,t,c);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(l,c);x(l,r,c),n=!0},p(l,c){let u={};if(c&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),c&2052){s=ke(l[19]);let f;for(f=0;f<s.length;f+=1){let d=Tw(l,s,f);i[f]?(i[f].p(d,c),b(i[f],1)):(i[f]=Mw(d),i[f].c(),b(i[f],1),i[f].m(r.parentNode,r))}for(oe(),f=s.length;f<i.length;f+=1)a(f);ne()}},i(l){if(!n){b(e.$$.fragment,l);for(let c=0;c<s.length;c+=1)b(i[c]);n=!0}},o(l){w(e.$$.fragment,l),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)w(i[c]);n=!1},d(l){l&&(_(t),_(r)),R(e,l),ze(i,l)}}}function rR(o){let e,t,r,n,s,i,a,l,c,u,f,d,p,m,y,g,k,L=[ZE,YE,QE],I=[];function C(A,M){return A[3]?0:A[5]?1:A[0]?2:-1}return~(p=C(o,-1))&&(m=I[p]=L[p](o)),{c(){e=S("div"),e.textContent="Relay database analysis",t=F(),r=S("div"),n=S("div"),s=S("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,i=F(),a=S("div"),l=S("div"),c=S("input"),u=F(),f=S("div"),d=F(),m&&m.c(),h(e,"class","modal-title"),h(s,"class","setting-item-info"),h(c,"type","checkbox"),h(c,"tabindex","-1"),c.checked=o[1],h(f,"class","checkbox-toggle"),h(l,"role","checkbox"),h(l,"aria-checked",o[1]),h(l,"tabindex","0"),h(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Me(l,"is-enabled",o[1]),h(a,"class","setting-item-control"),h(n,"class","setting-item"),h(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(A,M){x(A,e,M),x(A,t,M),x(A,r,M),v(r,n),v(n,s),v(n,i),v(n,a),v(a,l),v(l,c),v(l,u),v(l,f),v(r,d),~p&&I[p].m(r,null),y=!0,g||(k=[H(l,"keypress",o[15]),H(l,"click",o[16])],g=!0)},p(A,[M]){(!y||M&2)&&(c.checked=A[1]),(!y||M&2)&&h(l,"aria-checked",A[1]),(!y||M&2)&&Me(l,"is-enabled",A[1]);let P=p;p=C(A,M),p===P?~p&&I[p].p(A,M):(m&&(oe(),w(I[P],1,1,()=>{I[P]=null}),ne()),~p?(m=I[p],m?m.p(A,M):(m=I[p]=L[p](A),m.c()),b(m,1),m.m(r,null)):m=null)},i(A){y||(b(m),y=!0)},o(A){w(m),y=!1},d(A){A&&(_(e),_(t),_(r)),~p&&I[p].d(),g=!1,Ie(k)}}}function oR(o,e,t){let r,n,s,i,a,l;var c;let{plugin:u}=e,f=Ce(!0);ce(o,f,A=>t(3,i=A));let d=Ce(0);ce(o,d,A=>t(4,a=A));let p=Ce(null);ce(o,p,A=>t(0,s=A));let m=Ce(null);ce(o,m,A=>t(5,l=A));let y=!1;function g(){return Pe(this,void 0,void 0,function*(){f.set(!0),m.set(null);try{let A=yield Iw({appId:u.appId,filterByAppId:!y,onProgress:M=>d.set(M)});p.set(A)}catch(A){m.set(`Analysis failed: ${A.message}`)}finally{f.set(!1)}})}function k(A){return Pe(this,void 0,void 0,function*(){try{yield Cw(A),s&&Qs(p,s.largeStores=s.largeStores.filter(M=>M.slug!==A),s)}catch(M){m.set(`Failed to delete ${A}: ${M.message}`)}})}dt(()=>{g()});let L=()=>{t(1,y=!y),g()},I=()=>{t(1,y=!y),g()},C=A=>k(A.slug);return o.$$set=A=>{"plugin"in A&&t(12,u=A.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,c=s==null?void 0:s.largeStores.reduce((A,M)=>{let P=M.relay||"local";return A[P]||(A[P]=[]),A[P].push(M),A},{}))!==null&&c!==void 0?c:{})}if(o.$$.dirty&16384){e:t(2,n=Object.entries(r).sort(([A],[M])=>A==="local"?-1:M==="local"?1:A.localeCompare(M)))}},[s,y,n,i,a,l,f,d,p,m,g,k,u,c,r,L,I,C]}var sh=class extends K{constructor(e){super(),G(this,e,oR,rR,W,{plugin:12},JE)}},Pw=sh;var Yc=class extends Ew.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Pw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var a1=require("obsidian");var{Boolean:jw}=os;function nR(o){Le(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function Rw(o,e,t){let r=o.slice();return r[20]=e[t],r}function Dw(o,e,t){let r=o.slice();return r[23]=e[t],r}function sR(o){return{c:z,m:z,p:z,i:z,o:z,d:z}}function iR(o){let e,t,r=ke(zw(o[19].documents)),n=[];for(let i=0;i<r.length;i+=1)n[i]=Vw(Rw(o,r,i));let s=i=>w(n[i],1,1,()=>{n[i]=null});return{c(){for(let i=0;i<n.length;i+=1)n[i].c();e=me()},m(i,a){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(i,a);x(i,e,a),t=!0},p(i,a){if(a&8311){r=ke(zw(i[19].documents));let l;for(l=0;l<r.length;l+=1){let c=Rw(i,r,l);n[l]?(n[l].p(c,a),b(n[l],1)):(n[l]=Vw(c),n[l].c(),b(n[l],1),n[l].m(e.parentNode,e))}for(oe(),l=r.length;l<n.length;l+=1)s(l);ne()}},i(i){if(!t){for(let a=0;a<r.length;a+=1)b(n[a]);t=!0}},o(i){n=n.filter(jw);for(let a=0;a<n.length;a+=1)w(n[a]);t=!1},d(i){i&&_(e),ze(n,i)}}}function Uw(o){let e,t=qw(o[23].queueState.timestamp)+"",r;return{c(){e=V("\u2022 "),r=V(t)},m(n,s){x(n,e,s),x(n,r,s)},p(n,s){s&3&&t!==(t=qw(n[23].queueState.timestamp)+"")&&J(r,t)},d(n){n&&(_(e),_(r))}}}function Ow(o){let e,t=o[23].queueState.error+"",r;return{c(){e=S("div"),r=V(t),h(e,"class","error-message svelte-18bqwhy")},m(n,s){x(n,e,s),v(e,r)},p(n,s){s&3&&t!==(t=n[23].queueState.error+"")&&J(r,t)},d(n){n&&_(e)}}}function $w(o){let e,t,r,n,s,i;t=new $d({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function a(){return o[10](o[23])}return{c(){e=S("button"),D(t.$$.fragment),r=V(`
							Retry`),h(e,"class","mod-warning svelte-18bqwhy")},m(l,c){x(l,e,c),E(t,e,null),v(e,r),n=!0,s||(i=H(e,"click",a),s=!0)},p(l,c){o=l},i(l){n||(b(t.$$.fragment,l),n=!0)},o(l){w(t.$$.fragment,l),n=!1},d(l){l&&_(e),R(t),s=!1,i()}}}function aR(o){var p,m,y;let e,t,r=o[5](o[23]).text+"",n,s,i,a,l,c,u=((p=o[23].queueState)==null?void 0:p.timestamp)&&Uw(o),f=((m=o[23].queueState)==null?void 0:m.error)&&Ow(o),d=((y=o[23].queueState)==null?void 0:y.status)==="failed"&&$w(o);return{c(){e=S("div"),t=S("span"),n=V(r),s=F(),u&&u.c(),i=F(),f&&f.c(),a=F(),d&&d.c(),l=me(),h(t,"class","details svelte-18bqwhy"),h(e,"class","details-container svelte-18bqwhy")},m(g,k){x(g,e,k),v(e,t),v(t,n),v(t,s),u&&u.m(t,null),v(t,i),f&&f.m(t,null),x(g,a,k),d&&d.m(g,k),x(g,l,k),c=!0},p(g,k){var L,I,C;(!c||k&3)&&r!==(r=g[5](g[23]).text+"")&&J(n,r),(L=g[23].queueState)!=null&&L.timestamp?u?u.p(g,k):(u=Uw(g),u.c(),u.m(t,i)):u&&(u.d(1),u=null),(I=g[23].queueState)!=null&&I.error?f?f.p(g,k):(f=Ow(g),f.c(),f.m(t,null)):f&&(f.d(1),f=null),((C=g[23].queueState)==null?void 0:C.status)==="failed"?d?(d.p(g,k),k&3&&b(d,1)):(d=$w(g),d.c(),b(d,1),d.m(l.parentNode,l)):d&&(oe(),w(d,1,1,()=>{d=null}),ne())},i(g){c||(b(d),c=!0)},o(g){w(d),c=!1},d(g){g&&(_(e),_(a),_(l)),u&&u.d(),f&&f.d(),d&&d.d(g)}}}function lR(o){let e,t=o[9].default,r=ye(t,o,o[13],null),n=r||aR(o);return{c(){n&&n.c()},m(s,i){n&&n.m(s,i),e=!0},p(s,i){r?r.p&&(!e||i&8192)&&ve(r,t,s,s[13],e?be(t,s[13],i,null):_e(s[13]),null):n&&n.p&&(!e||i&3)&&n.p(s,e?i:-1)},i(s){e||(b(n,s),e=!0)},o(s){w(n,s),e=!1},d(s){n&&n.d(s)}}}function cR(o){let e,t,r,n,s=o[23].path.split("/").pop()+"",i,a;var l=o[5](o[23]).icon;function c(u,f){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=Ko(l,c(o))),{c(){e=S("span"),t&&D(t.$$.fragment),r=F(),n=S("span"),i=V(s),h(e,"slot","name"),h(e,"class","file-name svelte-18bqwhy")},m(u,f){x(u,e,f),t&&E(t,e,null),v(e,r),v(e,n),v(n,i),a=!0},p(u,f){if(f&3&&l!==(l=u[5](u[23]).icon)){if(t){oe();let d=t;w(d.$$.fragment,1,0,()=>{R(d,1)}),ne()}l?(t=Ko(l,c(u,f)),D(t.$$.fragment),b(t.$$.fragment,1),E(t,e,r)):t=null}else if(l){let d={};f&3&&(d.class="svg-icon "+u[5](u[23]).iconClass),t.$set(d)}(!a||f&3)&&s!==(s=u[23].path.split("/").pop()+"")&&J(i,s)},i(u){a||(t&&b(t.$$.fragment,u),a=!0)},o(u){t&&w(t.$$.fragment,u),a=!1},d(u){u&&_(e),t&&R(t)}}}function Nw(o){let e,t;return e=new At({props:{$$slots:{name:[cR],default:[lR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Bw(o){let e,t;return e=new At({props:{$$slots:{name:[uR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function uR(o){let e,t,r=Hw(o[1](o[20]).remainingCount)+"",n,s,i=o[20].title.toLowerCase()+"",a,l,c,u,f,d,p,m;function y(){return o[11](o[20])}function g(...k){return o[12](o[20],...k)}return{c(){var k;e=S("span"),t=V("...and "),n=V(r),s=V(` more
					`),a=V(i),l=F(),c=S("span"),u=V("(show more)"),d=F(),h(c,"class","show-more-link svelte-18bqwhy"),h(c,"role","button"),h(c,"tabindex","0"),h(c,"aria-label",f=`Show ${((k=o[2][o[20].title])==null?void 0:k.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),h(e,"slot","name"),h(e,"class","more-files svelte-18bqwhy")},m(k,L){x(k,e,L),v(e,t),v(e,n),v(e,s),v(e,a),v(e,l),v(e,c),v(c,u),v(e,d),p||(m=[H(c,"click",y),H(c,"keydown",g)],p=!0)},p(k,L){var I;o=k,L&3&&r!==(r=Hw(o[1](o[20]).remainingCount)+"")&&J(n,r),L&1&&i!==(i=o[20].title.toLowerCase()+"")&&J(a,i),L&1&&f!==(f=`Show ${((I=o[2][o[20].title])==null?void 0:I.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&h(c,"aria-label",f)},d(k){k&&_(e),p=!1,Ie(m)}}}function Vw(o){let e,t,r,n=o[1](o[20]).remainingCount>0,s,i;e=new qe({props:{name:o[20].title}});let a=ke(o[1](o[20]).visibleDocs),l=[];for(let f=0;f<a.length;f+=1)l[f]=Nw(Dw(o,a,f));let c=f=>w(l[f],1,1,()=>{l[f]=null}),u=n&&Bw(o);return{c(){D(e.$$.fragment),t=F();for(let f=0;f<l.length;f+=1)l[f].c();r=F(),u&&u.c(),s=me()},m(f,d){E(e,f,d),x(f,t,d);for(let p=0;p<l.length;p+=1)l[p]&&l[p].m(f,d);x(f,r,d),u&&u.m(f,d),x(f,s,d),i=!0},p(f,d){let p={};if(d&1&&(p.name=f[20].title),e.$set(p),d&8291){a=ke(f[1](f[20]).visibleDocs);let m;for(m=0;m<a.length;m+=1){let y=Dw(f,a,m);l[m]?(l[m].p(y,d),b(l[m],1)):(l[m]=Nw(y),l[m].c(),b(l[m],1),l[m].m(r.parentNode,r))}for(oe(),m=a.length;m<l.length;m+=1)c(m);ne()}d&3&&(n=f[1](f[20]).remainingCount>0),n?u?(u.p(f,d),d&3&&b(u,1)):(u=Bw(f),u.c(),b(u,1),u.m(s.parentNode,s)):u&&(oe(),w(u,1,1,()=>{u=null}),ne())},i(f){if(!i){b(e.$$.fragment,f);for(let d=0;d<a.length;d+=1)b(l[d]);b(u),i=!0}},o(f){w(e.$$.fragment,f),l=l.filter(jw);for(let d=0;d<l.length;d+=1)w(l[d]);w(u),i=!1},d(f){f&&(_(t),_(r),_(s)),R(e,f),ze(l,f),u&&u.d(f)}}}function fR(o){let e;return{c(){e=S("div"),e.textContent="Loading...",h(e,"class","loading")},m(t,r){x(t,e,r)},p:z,i:z,o:z,d(t){t&&_(e)}}}function dR(o){let e,t,r,n={ctx:o,current:null,token:null,hasCatch:!1,pending:fR,then:iR,catch:sR,value:19,blocks:[,,,]};return Jo(t=o[0],n),{c(){e=me(),n.block.c()},m(s,i){x(s,e,i),n.block.m(s,n.anchor=i),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(s,[i]){o=s,n.ctx=o,i&1&&t!==(t=o[0])&&Jo(t,n)||ri(n,o,i)},i(s){r||(b(n.block),r=!0)},o(s){for(let i=0;i<3;i+=1){let a=n.blocks[i];w(a)}r=!1},d(s){s&&_(e),n.block.d(s),n.token=null,n=null}}}function Hw(o){return new Intl.NumberFormat().format(o)}function qw(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),n=Math.floor(r/(1e3*60));if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;let s=Math.floor(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;let i=Math.floor(s/24);return i===1?"yesterday":`${i} days ago`}function zw(o){let e=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="running"}),t=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="failed"}),r=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="pending"}),n=o.filter(s=>{var i;return((i=s.queueState)===null||i===void 0?void 0:i.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},n.length>0&&{title:"Completed Files",documents:n}].filter(Boolean)}function pR(o,e,t){let r,n,s,i,a,{$$slots:l={},$$scope:c}=e,{folder:u}=e,{backgroundSync:f}=e,d={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},p=Ce({}),m=Ze(p,M=>P=>{let O=d[P.title]||d.default,T=M[P.title]||O.initialCount,U=P.documents.slice(0,T),j=P.documents.length-T;return{visibleCount:T,visibleDocs:U,remainingCount:j}});ce(o,m,M=>t(1,a=M));function y(M){let P=d[M]||d.default;p.update(O=>Object.assign(Object.assign({},O),{[M]:(O[M]||P.initialCount)+P.incrementCount}))}function g(M){return Pe(this,void 0,void 0,function*(){var P;let O=[],T=Array.from(M.docs.values());for(let U of T){let j=yield U.getOrigin(),Q=yield U.getServerSynced(),N={guid:U.guid,path:M.getPath(U.path),doc:U,origin:j||"unknown",serverSynced:Q},X=Array.from(r).find(pe=>pe.guid===U.guid),$=Array.from(n).find(pe=>pe.guid===U.guid),B=s.find(pe=>pe.guid===U.guid);if(X||$||B){let pe=X||$||B;N.queueState={status:pe.status,type:"type"in pe?pe.type:"sync",error:"error"in pe?pe.error:void 0,timestamp:"timestamp"in pe?pe.timestamp:Date.now()}}else j==="local"&&!Q?N.queueState={status:"pending",type:"sync",timestamp:Date.now()}:Q?N.queueState={status:"completed",type:"sync",timestamp:Date.now()}:N.queueState={status:"pending",type:"sync",timestamp:Date.now()};O.push(N)}return{folder:M,documents:O,progress:((P=f.getGroupProgress(M))===null||P===void 0?void 0:P.percent)||0}})}function k(M){let{origin:P,serverSynced:O,queueState:T}=M,U=(T==null?void 0:T.status)||"completed",j=(T==null?void 0:T.type)||"sync";return P==="remote"&&!O&&U==="running"&&j==="download"?{text:"Downloading",description:"Initial acquisition",icon:da,iconClass:"mod-primary"}:P==="remote"&&!O&&U==="pending"&&j==="download"?{text:"Queued for Download",description:"Waiting to download",icon:fa,iconClass:""}:P==="remote"&&!O&&U==="failed"&&j==="download"?{text:"Download stuck",description:"Needs retry",icon:ls,iconClass:"mod-warning"}:P==="local"&&!O&&U==="running"&&j==="sync"?{text:"Uploading",description:"First-time upload",icon:jd,iconClass:"mod-primary"}:P==="local"&&!O&&U==="pending"&&j==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:fa,iconClass:""}:P==="local"&&!O&&U==="failed"&&j==="sync"?{text:"Upload stuck",description:"Needs retry",icon:ls,iconClass:"mod-warning"}:O&&U==="running"&&j==="sync"?{text:"Syncing",description:"Collaborative update",icon:cd,iconClass:"mod-primary"}:O&&U==="pending"&&j==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:fa,iconClass:""}:O&&U==="failed"&&j==="sync"?{text:"Sync stuck",description:"Needs retry",icon:ls,iconClass:"mod-warning"}:O&&U==="completed"?{text:"Complete",description:"Fully synchronized",icon:ca,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:pa,iconClass:""}}function L(M){return Pe(this,void 0,void 0,function*(){var P,O;let T={id:M.guid,guid:M.guid,path:M.path,timestamp:((P=M.queueState)===null||P===void 0?void 0:P.timestamp)||Date.now(),type:((O=M.queueState)===null||O===void 0?void 0:O.type)||"sync",status:"failed",sharedFolderGuid:M.doc.sharedFolder.guid};yield f.retryLogItem(T)})}let I=M=>L(M),C=M=>{y(M.title)},A=(M,P)=>P.key==="Enter"&&y(M.title);return o.$$set=M=>{"folder"in M&&t(7,u=M.folder),"backgroundSync"in M&&t(8,f=M.backgroundSync),"$$scope"in M&&t(13,c=M.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(f.activeSync.items())}if(o.$$.dirty&256){e:n=new Set(f.activeDownloads.items())}if(o.$$.dirty&256){e:s=f.getSyncLog()}if(o.$$.dirty&128){e:t(0,i=g(u))}},[i,a,d,m,y,k,L,u,f,l,I,C,A,c]}var ih=class extends K{constructor(e){super(),G(this,e,pR,dR,W,{folder:7,backgroundSync:8},nR)}},ah=ih;var{Map:mR}=os;function hR(o){Le(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function Ww(o,e,t){let r=o.slice();r[25]=e[t];let n=r[4].get(r[25].guid);return r[26]=n,r}function Kw(o){let e,t;return e=new qe({props:{name:"Sync Status"}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Gw(o){let e,t;return e=new Oe({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[bR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&3072&&(s.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),n&396&&(s.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),n&536874496&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function Jw(o){let e,t,r,n,s,i,a=[yR,gR],l=[];function c(u,f){return u[9]?0:1}return t=c(o,-1),r=l[t]=a[t](o),{c(){e=S("button"),r.c(),h(e,"class","mod-cta")},m(u,f){x(u,e,f),l[t].m(e,null),n=!0,s||(i=H(e,"click",o[16]),s=!0)},p(u,f){let d=t;t=c(u,f),t!==d&&(oe(),w(l[d],1,1,()=>{l[d]=null}),ne(),r=l[t],r||(r=l[t]=a[t](u),r.c()),b(r,1),r.m(e,null))},i(u){n||(b(r),n=!0)},o(u){w(r),n=!1},d(u){u&&_(e),l[t].d(),s=!1,i()}}}function gR(o){let e,t,r;return e=new Rd({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){D(e.$$.fragment),t=V(`
						Pause`)},m(n,s){E(e,n,s),x(n,t,s),r=!0},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){n&&_(t),R(e,n)}}}function yR(o){let e,t,r;return e=new Ud({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){D(e.$$.fragment),t=V(`
						Resume`)},m(n,s){E(e,n,s),x(n,t,s),r=!0},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){n&&_(t),R(e,n)}}}function bR(o){let e,t,r=(o[11]||o[10])&&Jw(o);return{c(){r&&r.c(),e=me()},m(n,s){r&&r.m(n,s),x(n,e,s),t=!0},p(n,s){n[11]||n[10]?r?(r.p(n,s),s&3072&&b(r,1)):(r=Jw(n),r.c(),b(r,1),r.m(e.parentNode,e)):r&&(oe(),w(r,1,1,()=>{r=null}),ne())},i(n){t||(b(r),t=!0)},o(n){w(r),t=!1},d(n){n&&_(e),r&&r.d(n)}}}function vR(o){let e=[],t=new mR,r,n,s=ke(o[6]),i=a=>a[25].guid;for(let a=0;a<s.length;a+=1){let l=Ww(o,s,a),c=i(l);t.set(c,e[a]=t1(c,l))}return{c(){for(let a=0;a<e.length;a+=1)e[a].c();r=me()},m(a,l){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(a,l);x(a,r,l),n=!0},p(a,l){l&32851&&(s=ke(a[6]),oe(),e=Qo(e,l,i,1,a,s,t,r.parentNode,oi,t1,r,Ww),ne())},i(a){if(!n){for(let l=0;l<s.length;l+=1)b(e[l]);n=!0}},o(a){for(let l=0;l<e.length;l+=1)w(e[l]);n=!1},d(a){a&&_(r);for(let l=0;l<e.length;l+=1)e[l].d(a)}}}function _R(o){let e,t,r,n;return e=new qe({props:{$$slots:{name:[CR],default:[kR]},$$scope:{ctx:o}}}),r=new ah({props:{folder:o[5],backgroundSync:o[0]}}),{c(){D(e.$$.fragment),t=F(),D(r.$$.fragment)},m(s,i){E(e,s,i),x(s,t,i),E(r,s,i),n=!0},p(s,i){let a={};i&536875040&&(a.$$scope={dirty:i,ctx:s}),e.$set(a);let l={};i&32&&(l.folder=s[5]),i&1&&(l.backgroundSync=s[0]),r.$set(l)},i(s){n||(b(e.$$.fragment,s),b(r.$$.fragment,s),n=!0)},o(s){w(e.$$.fragment,s),w(r.$$.fragment,s),n=!1},d(s){s&&_(t),R(e,s),R(r,s)}}}function Qw(o){let e,t,r,n,s,i=o[26].progress+"",a,l;return{c(){e=S("div"),t=S("div"),r=S("div"),n=F(),s=S("span"),a=V(i),l=V("%"),h(r,"class","progress-value svelte-ztgdsf"),he(r,"width",o[26].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,u){x(c,e,u),v(e,t),v(t,r),v(e,n),v(e,s),v(s,a),v(s,l)},p(c,u){u&80&&he(r,"width",c[26].progress+"%"),u&80&&i!==(i=c[26].progress+"")&&J(a,i)},d(c){c&&_(e)}}}function xR(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&Qw(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,n):(t=Qw(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function Yw(o){let e,t=o[26].running+"",r,n;return{c(){e=S("span"),r=V(t),n=V(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&80&&t!==(t=s[26].running+"")&&J(r,t)},d(s){s&&_(e)}}}function Zw(o){let e,t=o[26].failed+"",r,n;return{c(){e=S("span"),r=V(t),n=V(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&80&&t!==(t=s[26].failed+"")&&J(r,t)},d(s){s&&_(e)}}}function Xw(o){let e,t=o[26].pending+"",r,n;return{c(){e=S("span"),r=V(t),n=V(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&80&&t!==(t=s[26].pending+"")&&J(r,t)},d(s){s&&_(e)}}}function wR(o){var C,A,M;let e,t,r,n,s,i=o[25].name+"",a,l,c,u,f,d,p,m,y=((C=o[26])==null?void 0:C.running)>0&&Yw(o),g=((A=o[26])==null?void 0:A.failed)>0&&Zw(o),k=((M=o[26])==null?void 0:M.pending)>0&&Xw(o);function L(){return o[22](o[25])}function I(...P){return o[23](o[25],...P)}return{c(){e=S("div"),t=S("span"),r=V("\u25B6"),s=F(),a=V(i),l=F(),c=S("span"),y&&y.c(),u=F(),g&&g.c(),f=F(),k&&k.c(),h(t,"class",n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),h(c,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf"),h(e,"role","button"),h(e,"tabindex","0"),h(e,"aria-expanded",d=!!o[1][o[25].guid])},m(P,O){x(P,e,O),v(e,t),v(t,r),v(e,s),v(e,a),v(e,l),v(e,c),y&&y.m(c,null),v(c,u),g&&g.m(c,null),v(c,f),k&&k.m(c,null),p||(m=[H(e,"click",L),H(e,"keydown",I)],p=!0)},p(P,O){var T,U,j;o=P,O&66&&n!==(n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&h(t,"class",n),O&64&&i!==(i=o[25].name+"")&&J(a,i),((T=o[26])==null?void 0:T.running)>0?y?y.p(o,O):(y=Yw(o),y.c(),y.m(c,u)):y&&(y.d(1),y=null),((U=o[26])==null?void 0:U.failed)>0?g?g.p(o,O):(g=Zw(o),g.c(),g.m(c,f)):g&&(g.d(1),g=null),((j=o[26])==null?void 0:j.pending)>0?k?k.p(o,O):(k=Xw(o),k.c(),k.m(c,null)):k&&(k.d(1),k=null),O&66&&d!==(d=!!o[1][o[25].guid])&&h(e,"aria-expanded",d)},d(P){P&&_(e),y&&y.d(),g&&g.d(),k&&k.d(),p=!1,Ie(m)}}}function SR(o){let e,t;return e=new va({props:{folder:o[25],$$slots:{default:[wR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&536870994&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function e1(o){let e,t;return e=new ah({props:{folder:o[25],backgroundSync:o[0]}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&1&&(s.backgroundSync=r[0]),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function t1(o,e){let t,r,n,s,i;r=new qe({props:{$$slots:{name:[SR],default:[xR]},$$scope:{ctx:e}}});let a=e[1][e[25].guid]&&e1(e);return{key:o,first:null,c(){t=me(),D(r.$$.fragment),n=F(),a&&a.c(),s=me(),this.first=t},m(l,c){x(l,t,c),E(r,l,c),x(l,n,c),a&&a.m(l,c),x(l,s,c),i=!0},p(l,c){e=l;let u={};c&536870994&&(u.$$scope={dirty:c,ctx:e}),r.$set(u),e[1][e[25].guid]?a?(a.p(e,c),c&66&&b(a,1)):(a=e1(e),a.c(),b(a,1),a.m(s.parentNode,s)):a&&(oe(),w(a,1,1,()=>{a=null}),ne())},i(l){i||(b(r.$$.fragment,l),b(a),i=!0)},o(l){w(r.$$.fragment,l),w(a),i=!1},d(l){l&&(_(t),_(n),_(s)),R(r,l),a&&a.d(l)}}}function r1(o){let e,t,r,n,s,i=o[12].progress+"",a,l;return{c(){e=S("div"),t=S("div"),r=S("div"),n=F(),s=S("span"),a=V(i),l=V("%"),h(r,"class","progress-value svelte-ztgdsf"),he(r,"width",o[12].progress+"%"),h(t,"class","progress-bar svelte-ztgdsf"),h(s,"class","progress-text svelte-ztgdsf"),h(e,"class","progress-container svelte-ztgdsf")},m(c,u){x(c,e,u),v(e,t),v(t,r),v(e,n),v(e,s),v(s,a),v(s,l)},p(c,u){u&4096&&he(r,"width",c[12].progress+"%"),u&4096&&i!==(i=c[12].progress+"")&&J(a,i)},d(c){c&&_(e)}}}function kR(o){let e,t=(o[12].running>0||o[12].failed>0)&&r1(o);return{c(){t&&t.c(),e=me()},m(r,n){t&&t.m(r,n),x(r,e,n)},p(r,n){r[12].running>0||r[12].failed>0?t?t.p(r,n):(t=r1(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&_(e),t&&t.d(r)}}}function o1(o){let e,t=o[12].running+"",r,n;return{c(){e=S("span"),r=V(t),n=V(" active"),h(e,"class","tag mod-success svelte-ztgdsf")},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&4096&&t!==(t=s[12].running+"")&&J(r,t)},d(s){s&&_(e)}}}function n1(o){let e,t=o[12].failed+"",r,n;return{c(){e=S("span"),r=V(t),n=V(" stuck"),h(e,"class","tag mod-warning svelte-ztgdsf")},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&4096&&t!==(t=s[12].failed+"")&&J(r,t)},d(s){s&&_(e)}}}function s1(o){let e,t=o[12].pending+"",r,n;return{c(){e=S("span"),r=V(t),n=V(" queued"),h(e,"class","tag svelte-ztgdsf")},m(s,i){x(s,e,i),v(e,r),v(e,n)},p(s,i){i&4096&&t!==(t=s[12].pending+"")&&J(r,t)},d(s){s&&_(e)}}}function IR(o){let e,t=o[5].name+"",r,n,s,i,a,l=o[12].running>0&&o1(o),c=o[12].failed>0&&n1(o),u=o[12].pending>0&&s1(o);return{c(){e=S("div"),r=V(t),n=F(),s=S("span"),l&&l.c(),i=F(),c&&c.c(),a=F(),u&&u.c(),h(s,"class","sync-stats svelte-ztgdsf"),h(e,"class","folder-header svelte-ztgdsf")},m(f,d){x(f,e,d),v(e,r),v(e,n),v(e,s),l&&l.m(s,null),v(s,i),c&&c.m(s,null),v(s,a),u&&u.m(s,null)},p(f,d){d&32&&t!==(t=f[5].name+"")&&J(r,t),f[12].running>0?l?l.p(f,d):(l=o1(f),l.c(),l.m(s,i)):l&&(l.d(1),l=null),f[12].failed>0?c?c.p(f,d):(c=n1(f),c.c(),c.m(s,a)):c&&(c.d(1),c=null),f[12].pending>0?u?u.p(f,d):(u=s1(f),u.c(),u.m(s,null)):u&&(u.d(1),u=null)},d(f){f&&_(e),l&&l.d(),c&&c.d(),u&&u.d()}}}function CR(o){let e,t;return e=new va({props:{folder:o[5],$$slots:{default:[IR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.folder=r[5]),n&536875040&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function LR(o){let e,t,r,n,s,i,a=!o[5]&&Kw(o),l=!o[5]&&Gw(o),c=[_R,vR],u=[];function f(d,p){return d[5]&&d[12]?0:1}return n=f(o,-1),s=u[n]=c[n](o),{c(){e=S("div"),a&&a.c(),t=F(),l&&l.c(),r=F(),s.c(),h(e,"class","setting-item-container")},m(d,p){x(d,e,p),a&&a.m(e,null),v(e,t),l&&l.m(e,null),v(e,r),u[n].m(e,null),i=!0},p(d,[p]){d[5]?a&&(oe(),w(a,1,1,()=>{a=null}),ne()):a?p&32&&b(a,1):(a=Kw(d),a.c(),b(a,1),a.m(e,t)),d[5]?l&&(oe(),w(l,1,1,()=>{l=null}),ne()):l?(l.p(d,p),p&32&&b(l,1)):(l=Gw(d),l.c(),b(l,1),l.m(e,r));let m=n;n=f(d,p),n===m?u[n].p(d,p):(oe(),w(u[m],1,1,()=>{u[m]=null}),ne(),s=u[n],s?s.p(d,p):(s=u[n]=c[n](d),s.c()),b(s,1),s.m(e,null))},i(d){i||(b(a),b(l),b(s),i=!0)},o(d){w(a),w(l),w(s),i=!1},d(d){d&&_(e),a&&a.d(),l&&l.d(),u[n].d()}}}function TR(o,e,t){let r,n,s,i,a,l,c,u,f,d,p,{backgroundSync:m}=e,{sharedFolders:y}=e,{focusedFolderGuid:g}=e,k={},L=0,I=0,C=0,A=0,{activeSync:M,activeDownloads:P}=m;ce(o,M,Q=>t(21,p=Q)),ce(o,P,Q=>t(20,d=Q));function O(Q){t(1,k[Q]=!k[Q],k),t(1,k),t(6,r),t(17,y)}function T(){l?m.resume():m.pause()}let U=Q=>O(Q.guid),j=(Q,N)=>N.key==="Enter"&&O(Q.guid);return o.$$set=Q=>{"backgroundSync"in Q&&t(0,m=Q.backgroundSync),"sharedFolders"in Q&&t(17,y=Q.sharedFolders),"focusedFolderGuid"in Q&&t(18,g=Q.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=y.items().sort((Q,N)=>Q.name.localeCompare(N.name)))}if(o.$$.dirty&66){e:r.forEach(Q=>{Q.guid in k||t(1,k[Q.guid]=!0,k)}),t(1,k),t(6,r),t(17,y)}if(o.$$.dirty&393216){e:t(5,n=g?y.items().find(Q=>Q.guid===g):void 0)}if(o.$$.dirty&3145793){e:t(4,s=new Map(r.map(Q=>{var N,X;return[Q.guid,{progress:((N=m.getGroupProgress(Q))===null||N===void 0?void 0:N.percent)||0,running:[...p.items(),...d.items()].filter($=>$.sharedFolder.guid===Q.guid).length,failed:((X=m.syncGroups.get(Q))===null||X===void 0?void 0:X.status)==="failed"?1:0,pending:[...m.pendingSyncs,...m.pendingDownloads].filter($=>$.sharedFolder.guid===Q.guid).length,completed:(()=>{let $=m.syncGroups.get(Q);return(($==null?void 0:$.completedSyncs)||0)+(($==null?void 0:$.completedDownloads)||0)})(),sharedFolder:Q}]})))}if(o.$$.dirty&48){e:t(12,i=n?s.get(n.guid):void 0)}if(o.$$.dirty&1){e:t(19,a=m.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=a.isPaused)}if(o.$$.dirty&524288){e:c=a.syncsActive>0||a.downloadsActive>0}if(o.$$.dirty&16){e:{let Q=0,N=0,X=0,$=0;for(let B of s.values())Q+=B.running,N+=B.failed,X+=B.pending,$+=B.completed;t(2,L=Q),t(7,I=N),t(3,C=X),t(8,A=$)}}if(o.$$.dirty&4){e:t(11,u=L>0)}if(o.$$.dirty&8){e:t(10,f=C>0)}},[m,k,L,C,s,n,r,I,A,l,f,u,i,M,P,O,T,y,g,a,d,p,U,j]}var lh=class extends K{constructor(e){super(),G(this,e,TR,LR,W,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},hR)}},i1=lh;var La=class extends a1.Modal{constructor(t,r,n,s){super(t);this.backgroundSync=r;this.sharedFolders=n;this.focusedFolderGuid=s}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new i1({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function ch(o){return o.startsWith("v")?o.slice(1):o}function AR(o,e){return o.map((t,r)=>[t,e[r]])}function MR(o,e){try{let t=ch(o).split(".").map(parseInt),r=ch(e).split(".").map(parseInt);for(let[n,s]of AR(t,r))if(n>s)return!0}catch(t){}return!1}var Zc=class extends st{constructor(t,r,n){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=n;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.observableName="UpdateManager";this.githubReleases=new jo("system3-relay/releases"),this.releaseChannels=new jo("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await ft("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let n=await r.json();return je().enableNetworkLogging&&this.debug("GitHub releases fetched:",n),n}async fetchLatestRelease(){try{let n="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${n}`);let s=await ft(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],n=r?await this.fetchRepoManifest(r):null;return n?(this.debug("repo manifest",n),n.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t;let r=await this.fetchReleases(),n=new Set([...this.githubReleases.keys()]),s=new Set;r.forEach(a=>{this.githubReleases.set(a.tag_name,a),s.add(a.tag_name)}),n.forEach(a=>{s.has(a)||this.githubReleases.delete(a)});let i=await this.fetchLatestRelease();i&&(i.latest=!0,this.githubReleases.set(i.tag_name,i)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let n=await this.getReleases();if(n.length===0)return this.debug("No releases found"),null;let s=this.releaseSettings.get().channel;if(!s)return null;let i=await this.fetchLatestTagFromChannel(s);if(!i)return null;let a=n.find(l=>ch(l.tag_name)===i);return a?(this.releaseChannels.set(s,a),this.notifyListeners(),a):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let i=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${i}`);let a=await ft(i);if(!a.ok)throw new Error("unable to fetch manifest");return await a.json()}catch(n){return this.error("Failed to fetch:",n),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(i=>i.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let n=await ft(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`Failed to fetch manifest asset: ${n.status}`);let s=await n.json();return je().enableNetworkLogging&&this.debug("manifest fetched:",s),s}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&MR(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let n="system3-relay",s=this.plugin.app.plugins;return await s.disablePlugin(n),await s.enablePlugin(n),!0}catch(n){return this.error("Failed to install update:",n),!1}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var I1=require("obsidian");var S1=require("obsidian");function FR(o){Le(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function l1(o,e,t){let r=o.slice();return r[66]=e[t],r}function c1(o){let e,t;return e=new At({props:{name:"Show all releases",$$slots:{default:[PR]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},m(r,n){E(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[2]&128&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(b(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){R(e,r)}}}function PR(o){let e,t,r,n,s,i;return{c(){e=S("div"),t=S("input"),r=F(),n=S("div"),h(t,"type","checkbox"),t.checked=o[6],h(n,"class","checkbox-toggle"),h(e,"class","checkbox-container svelte-12doke6"),h(e,"role","checkbox"),h(e,"aria-checked",o[6]),h(e,"tabindex","0"),Me(e,"is-enabled",o[6])},m(a,l){x(a,e,l),v(e,t),v(e,r),v(e,n),s||(i=[H(e,"click",o[41]),H(e,"keydown",o[42])],s=!0)},p(a,l){l[0]&64&&(t.checked=a[6]),l[0]&64&&h(e,"aria-checked",a[6]),l[0]&64&&Me(e,"is-enabled",a[6])},d(a){a&&_(e),s=!1,Ie(i)}}}function ER(o){let e,t,r=!o[1]&&u1(o);function n(a,l){if(a[11])return $R;if(a[16])return OR}let s=n(o,[-1,-1,-1]),i=s&&s(o);return{c(){r&&r.c(),e=F(),i&&i.c(),t=me()},m(a,l){r&&r.m(a,l),x(a,e,l),i&&i.m(a,l),x(a,t,l)},p(a,l){a[1]?r&&(r.d(1),r=null):r?r.p(a,l):(r=u1(a),r.c(),r.m(e.parentNode,e)),s===(s=n(a,l))&&i?i.p(a,l):(i&&i.d(1),i=s&&s(a),i&&(i.c(),i.m(t.parentNode,t)))},d(a){a&&(_(e),_(t)),r&&r.d(a),i&&i.d(a)}}}function RR(o){let e;return{c(){e=S("div"),e.textContent="No matching releases found with the current filter",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function DR(o){let e;return{c(){e=S("div"),e.textContent="No GitHub releases found",h(e,"class","no-releases-text svelte-12doke6")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function UR(o){let e;return{c(){e=S("div"),e.textContent="Loading GitHub releases...",h(e,"class","loading-text svelte-12doke6")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function u1(o){let e,t,r,n=!o[8].some(o[40]),s,i=o[5]&&f1(o),a=o[4]&&d1(o),l=n&&p1(o),c=!o[1]&&m1(o);return{c(){e=S("div"),i&&i.c(),t=F(),a&&a.c(),r=F(),l&&l.c(),s=F(),c&&c.c(),h(e,"class","release-tags-container svelte-12doke6")},m(u,f){x(u,e,f),i&&i.m(e,null),v(e,t),a&&a.m(e,null),v(e,r),l&&l.m(e,null),v(e,s),c&&c.m(e,null)},p(u,f){u[5]?i?i.p(u,f):(i=f1(u),i.c(),i.m(e,t)):i&&(i.d(1),i=null),u[4]?a?a.p(u,f):(a=d1(u),a.c(),a.m(e,r)):a&&(a.d(1),a=null),f[0]&256&&(n=!u[8].some(u[40])),n?l?l.p(u,f):(l=p1(u),l.c(),l.m(e,s)):l&&(l.d(1),l=null),u[1]?c&&(c.d(1),c=null):c?c.p(u,f):(c=m1(u),c.c(),c.m(e,null))},d(u){u&&_(e),i&&i.d(),a&&a.d(),l&&l.d(),c&&c.d()}}}function f1(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("div"),t.textContent="Stable",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="stable"),h(e,"tabindex","0")},m(i,a){x(i,e,a),v(e,t),n||(s=[H(e,"click",o[43]),H(e,"keydown",o[44])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="stable")&&h(e,"aria-selected",r)},d(i){i&&_(e),n=!1,Ie(s)}}}function d1(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("div"),t.textContent="Beta",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[9]==="beta"),h(e,"tabindex","0")},m(i,a){x(i,e,a),v(e,t),n||(s=[H(e,"click",o[45]),H(e,"keydown",o[46])],n=!0)},p(i,a){a[0]&512&&r!==(r=i[9]==="beta")&&h(e,"aria-selected",r)},d(i){i&&_(e),n=!1,Ie(s)}}}function p1(o){let e,t,r,n,s;return{c(){e=S("div"),t=S("div"),t.textContent="Dev",h(t,"class","tag-name svelte-12doke6"),h(e,"class","release-tag-item development-version svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",r=o[10]===o[0].version),h(e,"tabindex","0")},m(i,a){x(i,e,a),v(e,t),n||(s=[H(e,"click",o[47]),H(e,"keydown",o[48])],n=!0)},p(i,a){a[0]&1025&&r!==(r=i[10]===i[0].version)&&h(e,"aria-selected",r)},d(i){i&&_(e),n=!1,Ie(s)}}}function m1(o){let e,t=ke(o[8]),r=[];for(let n=0;n<t.length;n+=1)r[n]=h1(l1(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=me()},m(n,s){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,s);x(n,e,s)},p(n,s){if(s[0]&268436736|s[1]&17){t=ke(n[8]);let i;for(i=0;i<t.length;i+=1){let a=l1(n,t,i);r[i]?r[i].p(a,s):(r[i]=h1(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(n){n&&_(e),ze(r,n)}}}function h1(o){let e,t,r=o[66].tag_name+"",n,s,i,a,l,c;function u(){return o[49](o[66])}function f(...d){return o[50](o[66],...d)}return{c(){e=S("div"),t=S("div"),n=V(r),s=F(),h(t,"class","tag-name svelte-12doke6"),h(e,"class",i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(w1(o[66])?"pre-release":"")+" svelte-12doke6"),h(e,"role","tab"),h(e,"aria-selected",a=o[10]===o[66].tag_name),h(e,"tabindex","0")},m(d,p){x(d,e,p),v(e,t),v(t,n),v(e,s),l||(c=[H(e,"click",u),H(e,"keydown",f)],l=!0)},p(d,p){o=d,p[0]&256&&r!==(r=o[66].tag_name+"")&&J(n,r),p[0]&256&&i!==(i="release-tag-item "+(o[28](o[66].tag_name)?"current-version":"")+" "+(w1(o[66])?"pre-release":"")+" svelte-12doke6")&&h(e,"class",i),p[0]&1280&&a!==(a=o[10]===o[66].tag_name)&&h(e,"aria-selected",a)},d(d){d&&_(e),l=!1,Ie(c)}}}function OR(o){let e,t,r,n,s,i,a;return{c(){e=S("div"),t=S("div"),r=V(o[16]),n=F(),s=S("button"),s.textContent="Close",h(t,"class","manifest-error-message svelte-12doke6"),h(s,"class","manifest-close-btn svelte-12doke6"),h(e,"class","manifest-error svelte-12doke6")},m(l,c){x(l,e,c),v(e,t),v(t,r),v(e,n),v(e,s),i||(a=H(s,"click",o[37]),i=!0)},p(l,c){c[0]&65536&&J(r,l[16])},d(l){l&&_(e),i=!1,a()}}}function $R(o){var Q;let e,t,r,n,s,i,a=(Q=o[38](o[10]))==null?void 0:Q.prerelease,l,c,u,f,d,p,m,y,g,k,L=a&&g1(o),I=o[12][o[10]]==="beta-alias"&&y1(o),C=o[12][o[10]]==="stable-alias"&&b1(o);function A(N,X){if(X[0]&9216&&(d=null),X[0]&1024&&(p=null),d==null&&(d=!!((N[38](N[10])||N[13][N[10]]==="stable-alias"||N[13][N[10]]==="beta-alias")&&!N[28](N[10]))),d)return BR;if(p==null&&(p=!!N[28](N[10])),p)return NR}let M=A(o,[-1,-1,-1]),P=M&&M(o);function O(N,X){return N[13][N[10]]==="stable-alias"||N[13][N[10]]==="beta-alias"||N[9]==="development"?jR:N[10]?zR:qR}let T=O(o,[-1,-1,-1]),U=T(o),j=o[15]&&v1(o);return{c(){e=S("div"),t=S("div"),r=S("h3"),n=V("Release Details: "),s=V(o[10]),i=F(),L&&L.c(),l=F(),I&&I.c(),c=F(),C&&C.c(),u=F(),f=S("div"),P&&P.c(),m=F(),y=S("div"),g=S("div"),U.c(),k=F(),j&&j.c(),h(r,"class","svelte-12doke6"),h(f,"class","manifest-header-actions svelte-12doke6"),h(t,"class","manifest-header svelte-12doke6"),h(g,"class","release-changelog-content svelte-12doke6"),h(y,"class","release-changelog svelte-12doke6"),h(e,"class","manifest-container svelte-12doke6")},m(N,X){x(N,e,X),v(e,t),v(t,r),v(r,n),v(r,s),v(r,i),L&&L.m(r,null),v(r,l),I&&I.m(r,null),v(r,c),C&&C.m(r,null),v(t,u),v(t,f),P&&P.m(f,null),v(e,m),v(e,y),v(y,g),U.m(g,null),v(e,k),j&&j.m(e,null)},p(N,X){var $;X[0]&1024&&J(s,N[10]),X[0]&1024&&(a=($=N[38](N[10]))==null?void 0:$.prerelease),a?L||(L=g1(N),L.c(),L.m(r,l)):L&&(L.d(1),L=null),N[12][N[10]]==="beta-alias"?I||(I=y1(N),I.c(),I.m(r,c)):I&&(I.d(1),I=null),N[12][N[10]]==="stable-alias"?C||(C=b1(N),C.c(),C.m(r,null)):C&&(C.d(1),C=null),M===(M=A(N,X))&&P?P.p(N,X):(P&&P.d(1),P=M&&M(N),P&&(P.c(),P.m(f,null))),T===(T=O(N,X))&&U?U.p(N,X):(U.d(1),U=T(N),U&&(U.c(),U.m(g,null))),N[15]?j?j.p(N,X):(j=v1(N),j.c(),j.m(e,null)):j&&(j.d(1),j=null)},d(N){N&&_(e),L&&L.d(),I&&I.d(),C&&C.d(),P&&P.d(),U.d(),j&&j.d()}}}function g1(o){let e;return{c(){e=S("span"),e.textContent="Pre-release",h(e,"class","prerelease-badge svelte-12doke6")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function y1(o){let e;return{c(){e=S("span"),e.textContent="Beta",h(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function b1(o){let e;return{c(){e=S("span"),e.textContent="Stable",h(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function NR(o){let e;return{c(){e=S("span"),e.textContent="Installed",h(e,"class","currently-installed svelte-12doke6")},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function BR(o){let e,t,r,n;function s(l,c){return l[14]===l[10]?HR:VR}let i=s(o,[-1,-1,-1]),a=i(o);return{c(){e=S("button"),a.c(),h(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[14]===o[10]||o[2]},m(l,c){x(l,e,c),a.m(e,null),r||(n=H(e,"click",o[51]),r=!0)},p(l,c){i!==(i=s(l,c))&&(a.d(1),a=i(l),a&&(a.c(),a.m(e,null))),c[0]&17412&&t!==(t=l[14]===l[10]||l[2])&&(e.disabled=t)},d(l){l&&_(e),a.d(),r=!1,n()}}}function VR(o){let e;return{c(){e=V("Install")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function HR(o){let e;return{c(){e=V("Installing...")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function qR(o){let e;return{c(){e=V('"No changelog available"')},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function zR(o){var n;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:GR,then:KR,catch:WR,value:65};return Jo(t=o[34](((n=o[38](o[10]))==null?void 0:n.body)||"No changelog available"),r),{c(){e=me(),r.block.c()},m(s,i){x(s,e,i),r.block.m(s,r.anchor=i),r.mount=()=>e.parentNode,r.anchor=e},p(s,i){var a;o=s,r.ctx=o,i[0]&1024&&t!==(t=o[34](((a=o[38](o[10]))==null?void 0:a.body)||"No changelog available"))&&Jo(t,r)||ri(r,o,i)},d(s){s&&_(e),r.block.d(s),r.token=null,r=null}}}function jR(o){let e;function t(s,i){if(s[13][s[10]]==="stable-alias")return YR;if(s[13][s[10]]==="beta-alias")return QR;if(s[10]===s[0].version)return JR}let r=t(o,[-1,-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=me()},m(s,i){n&&n.m(s,i),x(s,e,i)},p(s,i){r!==(r=t(s,i))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&_(e),n&&n.d(s)}}}function WR(o){return{c:z,m:z,p:z,d:z}}function KR(o){let e,t=o[65]+"",r;return{c(){e=new Cn(!1),r=me(),e.a=r},m(n,s){e.m(t,n,s),x(n,r,s)},p(n,s){s[0]&1024&&t!==(t=n[65]+"")&&e.p(t)},d(n){n&&(_(r),e.d())}}}function GR(o){let e;return{c(){e=V('"loading..."')},m(t,r){x(t,e,r)},p:z,d(t){t&&_(e)}}}function JR(o){let e;return{c(){e=S("p"),e.textContent="Current development version"},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function QR(o){let e;return{c(){e=S("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function YR(o){let e;return{c(){e=S("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function v1(o){let e,t,r,n,s,i=o[11].version+"",a,l,c=o[10]!==o[11].version&&!o[10].startsWith("v"+o[11].version),u,f,d,p,m,y=o[11].name+"",g,k,L,I,C,A,M=o[11].author+"",P,O,T,U,j,Q,N=o[11].description+"",X,$,B,pe,Z,ae,ue=o[11].isDesktopOnly?"Yes":"No",ee,q,Y,Te,fe,Ee,xe=o[11].minAppVersion+"",se,Ae=c&&_1(o);return{c(){e=S("div"),t=S("div"),r=S("span"),r.textContent="Version:",n=F(),s=S("span"),a=V(i),l=F(),Ae&&Ae.c(),u=F(),f=S("div"),d=S("span"),d.textContent="Name:",p=F(),m=S("span"),g=V(y),k=F(),L=S("div"),I=S("span"),I.textContent="Author:",C=F(),A=S("span"),P=V(M),O=F(),T=S("div"),U=S("span"),U.textContent="Description:",j=F(),Q=S("span"),X=V(N),$=F(),B=S("div"),pe=S("span"),pe.textContent="isDesktopOnly:",Z=F(),ae=S("span"),ee=V(ue),q=F(),Y=S("div"),Te=S("span"),Te.textContent="minAppVersion:",fe=F(),Ee=S("span"),se=V(xe),h(r,"class","manifest-label svelte-12doke6"),h(s,"class","manifest-value svelte-12doke6"),h(t,"class","manifest-field svelte-12doke6"),h(d,"class","manifest-label svelte-12doke6"),h(m,"class","manifest-value svelte-12doke6"),h(f,"class","manifest-field svelte-12doke6"),h(I,"class","manifest-label svelte-12doke6"),h(A,"class","manifest-value svelte-12doke6"),h(L,"class","manifest-field svelte-12doke6"),h(U,"class","manifest-label svelte-12doke6"),h(Q,"class","manifest-value svelte-12doke6"),h(T,"class","manifest-field svelte-12doke6"),h(pe,"class","manifest-label svelte-12doke6"),h(ae,"class","manifest-value svelte-12doke6"),h(B,"class","manifest-field svelte-12doke6"),h(Te,"class","manifest-label svelte-12doke6"),h(Ee,"class","manifest-value svelte-12doke6"),h(Y,"class","manifest-field svelte-12doke6"),h(e,"class","manifest-content svelte-12doke6")},m(we,Ve){x(we,e,Ve),v(e,t),v(t,r),v(t,n),v(t,s),v(s,a),v(t,l),Ae&&Ae.m(t,null),v(e,u),v(e,f),v(f,d),v(f,p),v(f,m),v(m,g),v(e,k),v(e,L),v(L,I),v(L,C),v(L,A),v(A,P),v(e,O),v(e,T),v(T,U),v(T,j),v(T,Q),v(Q,X),v(e,$),v(e,B),v(B,pe),v(B,Z),v(B,ae),v(ae,ee),v(e,q),v(e,Y),v(Y,Te),v(Y,fe),v(Y,Ee),v(Ee,se)},p(we,Ve){Ve[0]&2048&&i!==(i=we[11].version+"")&&J(a,i),Ve[0]&3072&&(c=we[10]!==we[11].version&&!we[10].startsWith("v"+we[11].version)),c?Ae||(Ae=_1(we),Ae.c(),Ae.m(t,null)):Ae&&(Ae.d(1),Ae=null),Ve[0]&2048&&y!==(y=we[11].name+"")&&J(g,y),Ve[0]&2048&&M!==(M=we[11].author+"")&&J(P,M),Ve[0]&2048&&N!==(N=we[11].description+"")&&J(X,N),Ve[0]&2048&&ue!==(ue=we[11].isDesktopOnly?"Yes":"No")&&J(ee,ue),Ve[0]&2048&&xe!==(xe=we[11].minAppVersion+"")&&J(se,xe)},d(we){we&&_(e),Ae&&Ae.d()}}}function _1(o){let e;return{c(){e=S("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,h(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){x(t,e,r)},d(t){t&&_(e)}}}function ZR(o){let e,t=o[1]?"Relay installer":"Relay releases",r,n,s,i,a,l,c,u,f=!o[1]&&c1(o);function d(y,g){return y[7]?UR:y[3].length===0?DR:y[8].length===0?RR:ER}let p=d(o,[-1,-1,-1]),m=p(o);return{c(){e=S("div"),r=V(t),n=F(),s=S("div"),i=S("div"),a=F(),l=S("div"),f&&f.c(),c=F(),m.c(),h(e,"class","modal-title"),h(i,"class","settings-spacer svelte-12doke6"),h(l,"class","settings-container svelte-12doke6"),h(s,"class","modal-content svelte-12doke6")},m(y,g){x(y,e,g),v(e,r),x(y,n,g),x(y,s,g),v(s,i),v(s,a),v(s,l),f&&f.m(l,null),v(s,c),m.m(s,null),u=!0},p(y,g){(!u||g[0]&2)&&t!==(t=y[1]?"Relay installer":"Relay releases")&&J(r,t),y[1]?f&&(oe(),w(f,1,1,()=>{f=null}),ne()):f?(f.p(y,g),g[0]&2&&b(f,1)):(f=c1(y),f.c(),b(f,1),f.m(l,null)),p===(p=d(y,g))&&m?m.p(y,g):(m.d(1),m=p(y),m&&(m.c(),m.m(s,null)))},i(y){u||(b(f),u=!0)},o(y){w(f),u=!1},d(y){y&&(_(e),_(n),_(s)),f&&f.d(),m.d()}}}var x1="system3-relay";function ms(o){return o.startsWith("v")?o.substring(1):o}function w1(o){return(o==null?void 0:o.prerelease)===!0}function XR(o,e,t){let r,n,s,i,a,l,c,u,f,d,p,m,y,g,k,L,{plugin:I}=e,{version:C}=e,A=Ce(I.manifest.version),M=Ce(!1),P=Ce(""),O=Ce(""),T=Ce(!1);ce(o,T,ie=>t(7,c=ie));let U=Ce(!1);ce(o,U,ie=>t(6,l=ie));let j=Ce(null);ce(o,j,ie=>t(11,p=ie));let Q=Ce("");ce(o,Q,ie=>t(10,d=ie));let N=Ce(null),X=Ce(null);ce(o,X,ie=>t(16,L=ie));let $=Ce(!1);ce(o,$,ie=>t(15,k=ie));let B=Ce(null);ce(o,B,ie=>t(5,s=ie));let pe=Ce(null);ce(o,pe,ie=>t(4,n=ie));let Z=Ce(null);ce(o,Z,ie=>t(53,a=ie));let ae=Ce(null);ce(o,ae,ie=>t(52,i=ie));let ue=Ce(!1),ee=!1,q=Ce(null);ce(o,q,ie=>t(14,g=ie));let Y=I.app;function Te(ie){let $e=ms(ie),at=ms(I.version);return $e===at}let fe=Ce({});ce(o,fe,ie=>t(13,y=ie));let Ee=Ce({});ce(o,Ee,ie=>t(12,m=ie));let xe=Ce(I.releaseSettings.get().channel);ce(o,xe,ie=>t(9,f=ie)),dt(()=>{Ve(),se(),!C&&!r.some(ie=>{ie.tag_name,I.version})?xe.set(null):xe.set(I.releaseSettings.get().channel),j.set({version:C||I.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),Q.set(C||I.version)});function se(){return Pe(this,void 0,void 0,function*(){ue.set(!0);try{let ie=yield I.updateManager.fetchRepoManifest("manifest.json");ie&&(B.set(ie),Z.set(ie.version));let $e=yield I.updateManager.fetchRepoManifest("manifest-beta.json");$e&&(pe.set($e),ae.set($e.version))}catch(ie){I.error("Error fetching main branch manifests:",ie)}finally{ue.set(!1)}})}let Ae=Ze(I.updateManager,()=>I.updateManager.releases);ce(o,Ae,ie=>t(3,r=ie));let we=Ze([Ae,U],()=>r&&r.length>0?Zt(l).sort():[]);ce(o,we,ie=>t(8,u=ie)),r.forEach(ie=>Pe(void 0,void 0,void 0,function*(){try{let $e=yield I.updateManager.fetchReleaseManifest(ie);$e&&fe.update(at=>Object.assign(Object.assign({},at),{[ie.tag_name]:$e.version}))}catch($e){}}));function Ve(){return Pe(this,void 0,void 0,function*(){T.set(!0);try{yield I.updateManager.getReleases(),Zt(l)}catch(ie){I.error("Error refreshing GitHub releases:",ie)}finally{T.set(!1)}})}function ut(ie){return Pe(this,void 0,void 0,function*(){let $e=document.createElement("div");return yield S1.MarkdownRenderer.render(I.app,ie,$e,"",I),$e.innerHTML})}function Zt(ie){return ie?r:C?r.filter($e=>C===ms($e.tag_name)):r.filter($e=>{let at=$e.tag_name;return Kt($e)})}function Kt(ie){if(ie.prerelease||ie.draft)return!1;if(ie.latest||ms(ie.tag_name)===a||ms(ie.tag_name)===i)return!0;let $e=new Date(ie.created_at),at=new Date;return at.setMonth(at.getMonth()-3),$e>at}function Ar(ie){return Pe(this,void 0,void 0,function*(){X.set(null),N.set(ie);try{let $e=Dt(ie);if(!$e){X.set(`Could not find release for ${ie}`);return}let at=yield I.updateManager.fetchReleaseManifest($e);at?(j.set(at),Q.set(ie),$.set(!1),fe.update(ar=>Object.assign(Object.assign({},ar),{[ie]:at.version}))):X.set(`Could not find manifest for ${ie}`)}catch($e){I.error("Error fetching manifest:",$e),X.set(`Error fetching manifest: ${$e.message||"Unknown error"}`)}finally{N.set(null)}})}function rn(ie){let $e=ie==="stable"?s:n;if($e){let at=$e.version;xe.set(ie);let ar=[...r.values()].find(lr=>ms(lr.tag_name)===ms(at));ar?(ie==="stable"?Ee.update(lr=>Object.assign(Object.assign({},lr),{[ar.tag_name]:"stable-alias"})):Ee.update(lr=>Object.assign(Object.assign({},lr),{[ar.tag_name]:"beta-alias"})),Ar(ar.tag_name)):(j.set($e),Q.set(at),ie==="stable"?Ee.update(lr=>Object.assign(Object.assign({},lr),{[at]:"stable-alias"})):Ee.update(lr=>Object.assign(Object.assign({},lr),{[at]:"beta-alias"})),$.set(!1))}else X.set(`Could not find ${ie} manifest`)}function Gt(){j.set(null),Q.set(""),X.set(null)}function Dt(ie){return[...r.values()].find($e=>$e.tag_name===ie)}function To(ie){return Pe(this,void 0,void 0,function*(){try{q.set(ie);let $e=Dt(ie);if(!$e)throw new Error(`Could not find release for ${ie}`);let at=yield I.updateManager.fetchReleaseManifest($e);if(!at)throw new Error(`Could not find manifest for ${ie}`);t(2,ee=!0),yield Y.plugins.installPlugin(I.repo,ie,at),yield Y.plugins.disablePlugin(x1),yield Y.plugins.enablePlugin(x1)}catch($e){console.error(`Error installing version ${ie}:`,$e),I&&I.error(`Error installing version ${ie}:`,$e)}finally{I&&(t(2,ee=!1),q.set(null))}})}let on=ie=>Te(ie.tag_name),io=()=>{U.update(ie=>!ie)},nn=ie=>{(ie.key==="Enter"||ie.key===" ")&&U.update($e=>!$e)},Dn=()=>{I.releaseSettings.update(ie=>({...ie,channel:"stable"})),xe.set("stable"),rn("stable")},Un=ie=>{(ie.key==="Enter"||ie.key===" ")&&(I.releaseSettings.update($e=>({...$e,channel:"stable"})),xe.set("stable"),rn("stable"))},sn=()=>{I.releaseSettings.update(ie=>({...ie,channel:"beta"})),xe.set("beta"),rn("beta")},On=ie=>{(ie.key==="Enter"||ie.key===" ")&&(I.releaseSettings.update($e=>({...$e,channel:"beta"})),xe.set("beta"),rn("beta"))},ge=()=>{xe.set(null),j.set({version:I.manifest.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),Q.set(I.version),$.set(!1)},Je=ie=>{(ie.key==="Enter"||ie.key===" ")&&(xe.set(null),j.set({version:I.manifest.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),Q.set(I.version),$.set(!1))},Xe=ie=>{xe.set(null),Ar(ie.tag_name)},_r=(ie,$e)=>{($e.key==="Enter"||$e.key===" ")&&(xe.set(null),Ar(ie.tag_name))},Ao=async()=>{To(d)};return o.$$set=ie=>{"plugin"in ie&&t(0,I=ie.plugin),"version"in ie&&t(1,C=ie.version)},[I,C,ee,r,n,s,l,c,u,f,d,p,m,y,g,k,L,T,U,j,Q,X,$,B,pe,Z,ae,q,Te,fe,Ee,xe,Ae,we,ut,Ar,rn,Gt,Dt,To,on,io,nn,Dn,Un,sn,On,ge,Je,Xe,_r,Ao]}var uh=class extends K{constructor(e){super(),G(this,e,XR,ZR,W,{plugin:0,version:1},FR,[-1,-1,-1])}},k1=uh;var Ta=class extends I1.Modal{constructor(t,r,n){super(t);this.plugin=r;this.version=n}onOpen(){let{contentEl:t}=this;this.component=new k1({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var eD=`
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyDIav6xzBzyi6eQu8aJA
O8DufA/MyTMDsD9d6PmjhuPTSlVPharZSjxRkHi6sK50ZmRedQbyiBuNp0g6so30
+zunoqT9XUpvZD0+USlGvi0J48Cop+DQbbpTlAlsmX6BxhHJLUrmgU0AhHjvJLNL
rRuzzQxrn/Oi0byUHu/moitUypX1hSYrKH5meRy8zoyGb8b0qIOEKpcpVKGyD/ne
+u0Bhh6tI8t2vQDQK0RL87dc+EqlQXxtijXBSClqvJi7o3JYTtWtuaWcZ2pQdg5y
+gDMii2hZYLNdgDM+/NcJlp3fkPztVeVRpiV20gZDhqANSjWjx9iN1Jt9A97rCSH
XQIDAQAB
-----END PUBLIC KEY-----
`.trim();var Ht=class extends Error{constructor(t,r,n){super(t);this.type=r;this.details=n;this.name="ValidationError"}};function fh(o){return typeof o=="object"&&o!==null&&"license"in o&&typeof o.license=="string"}function Xc(o){return Array.isArray(o)&&o.every(fh)}var eu=class{constructor(e){this.settings=e;this.log=Fe("[EndpointManager]")}isStaging(){return!1}sanitizeUrlForLog(e){try{let t=new URL(e);return t.search="",t.toString()}catch(t){return e}}validateUrl(e){if(!e||typeof e!="string")throw new Ht("URL must be a non-empty string","URL_INVALID");let t;try{t=new URL(e)}catch(s){throw new Ht("Invalid URL format","URL_INVALID")}let r=this.isStaging();if(r){if(t.protocol!=="https:"&&t.protocol!=="http:")throw new Ht("Only HTTP and HTTPS URLs are allowed in development","URL_INVALID")}else if(t.protocol!=="https:")throw new Ht("Only HTTPS URLs are allowed in production","URL_INVALID");let n=t.hostname.toLowerCase();if((n==="localhost"||n==="127.0.0.1"||n==="::1")&&this.log(`Warning: Using localhost endpoint (development build: ${r})`),!n||n.length<3)throw new Ht("Invalid hostname","URL_INVALID")}async getPublicKey(){if(this._publicKeyCache)return this._publicKeyCache;try{return this._publicKeyCache=await Im(eD,"RS256"),this._publicKeyCache}catch(e){throw new Ht("Failed to import public key","JWT_VERIFICATION_FAILED",e)}}getApiUrl(){return this._validatedApiUrl||"https://api.system3.md"}getAuthUrl(){return this._validatedAuthUrl||"https://auth.system3.md"}getDefaultUrls(){return{apiUrl:"https://api.system3.md",authUrl:"https://auth.system3.md",environment:"production"}}async validateAndSetEndpoints(e=1e4){let t=this.settings.get(),r=this.getActiveTenant(t);if(!r)return this.log("No active enterprise tenant configured, using defaults"),this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,{success:!0};try{let n=this.performTenantValidation(r.tenantUrl),s=new Promise((a,l)=>setTimeout(()=>l(new Error(`Validation timed out after ${e}ms`)),e));return await Promise.race([n,s])}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("Failed to validate tenant:",s),{success:!1,error:s}}}async performTenantValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return!n.apiUrl||!n.authUrl?{success:!1,error:"License missing required apiUrl or authUrl"}:n.authUrl!==e?{success:!1,error:`Tenant URL mismatch: expected ${e}, license has ${n.authUrl}`}:(this._validatedApiUrl=n.apiUrl,this._validatedAuthUrl=n.authUrl,this.log("Successfully validated enterprise tenant",{tenant:e,apiUrl:this._validatedApiUrl,authUrl:this._validatedAuthUrl,customer:n.customer}),{success:!0,licenseInfo:r.licenseInfo})}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchTenantLicense(e){try{let t=new URL(e),r=`${t.protocol}//${t.host}/.well-known/relay.md/license`;this.log("Fetching tenant license from:",r);let n=await ft(r,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`License fetch failed: ${n.status} ${n.statusText}`);let s=await n.json(),i=[];if(Xc(s))i=s;else if(s&&typeof s=="object"&&"licenses"in s&&Xc(s.licenses))i=s.licenses;else if(fh(s))i=[s];else throw new Ht("No valid licenses found in response","LICENSE_NOT_FOUND");if(i.length===0)throw new Error("Empty license list");return{success:!0,license:i[0].license}}catch(t){let r=t instanceof Error?t.message:"Unknown error";return r.includes("Failed to fetch")||r.includes("NetworkError")||r.includes("ERR_")||r.includes("ECONNREFUSED")?r=`Unable to connect to ${e}. Please check the URL and ensure the server is running.`:r.includes("404")?r=`No tenant license found at ${e}. This may not be a valid Enterprise Relay tenant.`:r.includes("License fetch failed"),this.log("Tenant license fetch error:",r),{success:!1,error:r}}}findMatchingEndpointLicense(e,t,r){this.log(`Searching for ${r} license for ${this.sanitizeUrlForLog(t)}`);for(let n of e)try{let s=Ia(n.license);if(s.endpointType===r&&s.url===t)return this.log(`Found matching license for ${r}: ${this.sanitizeUrlForLog(t)}`),n}catch(s){continue}return null}async validateTenantLicense(e,t){this.log(`Tenant license validation starting: ${this.sanitizeUrlForLog(t)}`);try{let r=await this.verifyJWT(e);if(r.iss!=="https://auth.system3.md")throw new Ht(`Invalid token issuer: expected https://auth.system3.md, got ${r.iss}`,"LICENSE_INVALID");if(r.sub!=="endpoint-certificate")throw new Ht(`Invalid token subject: expected "endpoint-certificate", got ${r.sub}`,"LICENSE_INVALID");let n={issuer:r.iss||"Unknown",subject:r.sub||"Unknown",validFrom:r.iat?new Date(r.iat*1e3).toISOString():"Unknown",validTo:r.exp?new Date(r.exp*1e3).toISOString():"Unknown",isValid:!0};return this.log(`Tenant license validation successful: ${this.sanitizeUrlForLog(t)}`),{success:!0,licenseInfo:n}}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log(`Tenant license validation failed: ${this.sanitizeUrlForLog(t)} - ${n}`),{success:!1,error:n}}}validateLicenseClaims(e,t,r){if(e.iss!=="https://auth.system3.md")throw new Ht(`Invalid token issuer: expected https://auth.system3.md, got ${e.iss}`,"LICENSE_INVALID");if(e.sub!=="endpoint-certificate")throw new Ht(`Invalid token subject: expected "endpoint-certificate", got ${e.sub}`,"LICENSE_INVALID");if(e.endpointType!==t)throw new Ht(`License endpoint type mismatch: expected ${t}, got ${e.endpointType}`,"LICENSE_INVALID");if(e.url!==r)throw new Ht(`License URL mismatch: expected ${r}, got ${e.url}`,"LICENSE_INVALID")}async verifyJWT(e){try{let t=await this.getPublicKey(),{payload:r}=await Mm(e,t,{algorithms:["RS256"]});return r}catch(t){throw this.log("JWT verification failed:",t),new Ht(`JWT verification failed: ${t instanceof Error?t.message:"Unknown error"}`,"JWT_VERIFICATION_FAILED",t)}}clearValidatedEndpoints(){this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0,this.log("Cleared validated endpoints, reverted to defaults")}hasValidatedEndpoints(){return!!(this._validatedApiUrl&&this._validatedAuthUrl)}getActiveTenant(e){if(!(!e.activeTenantId||!e.tenants))return e.tenants.find(t=>t.id===e.activeTenantId)}generateTenantId(e){try{let t=new URL(e);return`${t.hostname}:${t.port||(t.protocol==="https:"?"443":"80")}`}catch(t){return e.replace(/[^a-zA-Z0-9]/g,"_")}}async addTenant(e,t=!0){var r;try{this.validateUrl(e);let n=this.generateTenantId(e);if((r=this.settings.get().tenants)!=null&&r.some(l=>l.id===n))return{success:!1,error:"This tenant is already configured"};let i={id:n,name:e,tenantUrl:e,isValidated:!1},a;if(t){let l=await this.fetchTenantLicense(e);if(!l.success)return{success:!1,error:l.error||"Failed to fetch tenant license"};let c=await this.validateTenantLicense(l.license,e);if(!c.success)return{success:!1,error:c.error||"Tenant license validation failed"};a=c;let u=await this.verifyJWT(l.license);i={...i,name:u.customer||e,apiUrl:u.apiUrl,authUrl:u.authUrl,customer:u.customer,logo:u.logo,environment:u.environment,isValidated:!0,lastValidated:Date.now()}}return await this.settings.update(l=>({...l,tenants:[...l.tenants||[],i]})),{success:!0,tenantId:n,licenseInfo:a==null?void 0:a.licenseInfo}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error"}}}async removeTenant(e){let t=this.settings.get(),r=t.tenants||[];if(!r.some(s=>s.id===e))return!1;let n={tenants:r.filter(s=>s.id!==e)};return t.activeTenantId===e&&(n.activeTenantId=void 0,this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),await this.settings.update(s=>({...s,...n})),!0}async switchToTenant(e){var n;let r=(n=this.settings.get().tenants)==null?void 0:n.find(s=>s.id===e);return r?(await this.settings.update(s=>({...s,activeTenantId:e})),r.isValidated&&r.apiUrl&&r.authUrl?(this._validatedApiUrl=r.apiUrl,this._validatedAuthUrl=r.authUrl):(this._validatedApiUrl=void 0,this._validatedAuthUrl=void 0),{success:!0}):{success:!1,error:"Tenant not found"}}async getCustomerInfo(){if(!this.hasValidatedEndpoints())return null;let e=this.settings.get(),t=this.getActiveTenant(e);if(!t)return null;try{if(t.isValidated&&t.customer)return{customer:t.customer,logo:t.logo};let r=await this.fetchTenantLicense(t.tenantUrl);if(r.success&&r.license){let n=await this.verifyJWT(r.license);return{customer:n.customer,logo:n.logo}}}catch(r){this.log("Failed to get customer info:",r)}return null}async getDefaultTenantInfo(){try{let e=await this.fetchTenantLicense("https://auth.system3.md");if(e.success&&e.license){let t=await this.verifyJWT(e.license);return{customer:t.customer,logo:t.logo,environment:"production"}}}catch(e){this.log("Failed to get default tenant info:",e)}return null}async testValidateTenant(e,t=1e4){try{let r=this.performTestValidation(e),n=new Promise((i,a)=>setTimeout(()=>a(new Error(`Validation timed out after ${t}ms`)),t));return await Promise.race([r,n])}catch(r){let n=r instanceof Error?r.message:"Unknown error";return this.log("Failed to test validate endpoints:",n),{success:!1,error:n}}}async performTestValidation(e){try{this.validateUrl(e);let t=await this.fetchTenantLicense(e);if(!t.success)return{success:!1,error:`Failed to fetch tenant license: ${t.error}`};let r=await this.validateTenantLicense(t.license,e);if(!r.success)return{success:!1,error:`Tenant license validation failed: ${r.error}`};let n=await this.verifyJWT(t.license);return this.log("Test validation successful for tenant",{tenantUrl:e,apiUrl:n.apiUrl,authUrl:n.authUrl}),{success:!0,licenseInfo:r.licenseInfo}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown error"}}}async fetchEndpointLicenseForUrl(e,t,r){try{let n=new URL(e),s=`${n.protocol}//${n.host}/.well-known/relay.md/license`;this.log(`Fetching ${t.toUpperCase()} licenses for test validation from:`,s);let i=await ft(s,{method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok)throw new Error(`License fetch failed: ${i.status} ${i.statusText}`);let a=await i.json();this.log("License response received from:",s);let l=[];if(Xc(a))l=a;else if(a&&typeof a=="object"&&"licenses"in a&&Xc(a.licenses))l=a.licenses;else if(fh(a))l=[a];else throw new Ht("No valid licenses found in response","LICENSE_NOT_FOUND");if(this.log(`Parsed ${l.length} licenses`),l.length===0)throw new Error("Empty license list");let c=this.findMatchingEndpointLicense(l,r,t);if(!c)throw new Ht(`No valid ${t.toUpperCase()} license found for: ${r}`,"LICENSE_NOT_FOUND");return{success:!0,license:c.license}}catch(n){let s=n instanceof Error?n.message:"Unknown error";return this.log("License fetch error:",s),{success:!1,error:`License fetch failed: ${s}`}}}};var tD={debugging:!1},rD={release:{channel:"stable"},sharedFolders:[],endpoints:{},...Gi,...tD},tu=class extends T1.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.6.0";this.repo="No-Instructions/Relay"}enableDebugging(t){ml(!0),console.warn("RelayInstances",Nt),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){ml(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return ml(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return this.loginManager.getEndpointManager().getApiUrl()+t}openEndpointConfigurationModal(){new Ic(this.app,this,()=>{this.reload()}).open()}async validateAndApplyEndpoints(){var n;let t=this.endpointSettings.get();if(!t.activeTenantId||!((n=t.tenants)!=null&&n.length)){new ot.Notice("Please configure an enterprise tenant first",4e3);return}let r=new ot.Notice("Validating endpoints...",0);try{let s=await this.loginManager.validateAndApplyEndpoints();r.hide(),s.success?(await this.endpointSettings.update(i=>({...i,_lastValidationError:void 0,_lastValidationAttempt:void 0})),new ot.Notice("\u2713 Endpoints validated and applied successfully!",5e3),s.licenseInfo&&this.log("License validation successful:",s.licenseInfo)):(await this.endpointSettings.update(i=>({...i,_lastValidationError:s.error,_lastValidationAttempt:Date.now()})),new ot.Notice(`\u274C Validation failed: ${s.error}`,8e3))}catch(s){r.hide();let i=s instanceof Error?s.message:"Unknown error";await this.endpointSettings.update(a=>({...a,_lastValidationError:i,_lastValidationAttempt:Date.now()})),new ot.Notice(`\u274C Validation error: ${i}`,8e3)}}resetToDefaultEndpoints(){this.loginManager.getEndpointManager().clearValidatedEndpoints(),this.endpointSettings.update(()=>({})),new ot.Notice("Reset to default endpoints",3e3)}async validateEndpointsOnStartup(t){var s;let r=this.endpointSettings.get();if(!r.activeTenantId||!((s=r.tenants)!=null&&s.length)){this.log("No active enterprise tenant configured, using defaults");return}let n=r.tenants.find(i=>i.id===r.activeTenantId);if(!n){this.log("Active tenant not found, using defaults");return}this.log("Enterprise tenant configured, validating on startup...",{tenantId:n.id,tenantUrl:n.tenantUrl,tenantName:n.name});try{let i=await t.validateAndSetEndpoints(5e3);i.success?(await this.endpointSettings.update(a=>({...a,_lastValidationError:void 0,_lastValidationAttempt:void 0})),this.log("\u2713 Enterprise tenant validated and applied on startup",{licenseInfo:i.licenseInfo})):(this.error("\u274C Enterprise tenant validation failed on startup",i.error),await this.endpointSettings.update(a=>({...a,_lastValidationError:i.error,_lastValidationAttempt:Date.now()})),new ot.Notice(`\u274C Custom endpoints failed validation: ${i.error}`,8e3))}catch(i){let a=i instanceof Error?i.message:"Unknown error";this.error("Startup endpoint validation error:",a),await this.endpointSettings.update(l=>({...l,_lastValidationError:a,_lastValidationAttempt:Date.now()})),new ot.Notice(`\u274C Endpoint validation error: ${a}`,8e3)}}async onload(){this.appId=this.app.appId;let t=ot.moment.now();Nt.set(this,"plugin"),this.timeProvider=new Ws,this.register(()=>{this.timeProvider.destroy()}),Ay(new Jc(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new Gc,this.debug=Fe("[System 3][Relay]","debug"),this.log=Fe("[System 3][Relay]","log"),this.warn=Fe("[System 3][Relay]","warn"),this.error=Fe("[System 3][Relay]","error"),this.settings=new Ll(this,rD),await this.settings.load(),this.featureSettings=new nr(this.settings,"(enable*)"),this.debugSettings=new nr(this.settings,"(debugging)"),this.folderSettings=new nr(this.settings,"sharedFolders"),this.releaseSettings=new nr(this.settings,"release"),this.loginSettings=new nr(this.settings,"login"),this.endpointSettings=new nr(this.settings,"endpoints"),xt.getInstance().setSettings(this.featureSettings),this.settingsTab=new xc(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new Zc(this,this.timeProvider,this.releaseSettings),this.register(this.debugSettings.subscribe(a=>{a.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let l=new Wc(this.app,()=>{this.reload()});this.openModals.push(l),l.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let l=new Qc(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let l=new Kc(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let l=new Ta(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let l=new Yc(this.app,this);this.openModals.push(l),l.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let l=new La(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(l),l.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}));let n=`async function() {
			const app = window.app;
			await app.plugins.disablePlugin("system3-relay");
			await app.plugins.enablePlugin("system3-relay");
		}`;this.app.reloadRelay=new Function("return "+n),this.addCommand({id:"reload",name:"Reload Relay",callback:this.app.reloadRelay()}),this.addCommand({id:"configure-endpoints",name:"Configure enterprise tenant",callback:()=>{this.openEndpointConfigurationModal()}}),this.register(this.updateManager.subscribe(()=>{let a=this.updateManager.getNewRelease();a?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${a.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(a)}}),this.log(`Update available: v${this.version} \u2192 ${a.tag_name}`)):this.removeCommand("update-plugin")})),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new Tl(this.appId);let i=new eu(this.endpointSettings);await this.validateEndpointsOnStartup(i),this.loginManager=new kc(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this),this.loginSettings,i),this.relayManager=new zc(this.loginManager),this.sharedFolders=new Ml(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new Vc(this.loginManager,this.timeProvider,s,3),this.networkStatus=new Zx(this.timeProvider,"https://api.system3.md/health?version=0.6.0"),this.backgroundSync=new jc(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new ot.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new tc(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),C1.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(a=>a.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(si,a=>new Ql(a)),this.registerEvent(this.app.workspace.on("file-menu",(a,l)=>{if(l instanceof ot.TFolder){let c=this.sharedFolders.find(u=>u.path===l.path);if(!c)return;c.relayId?(a.addItem(u=>{u.setTitle("Relay: Relay settings").setIcon("gear").onClick(()=>{this.openSettings(`/relays?id=${c.relayId}`)})}),a.addItem(u=>{u.setTitle("Relay: Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${c.guid}`)})}),a.addItem(u=>{u.setTitle(c.connected?"Relay: Disconnect":"Relay: Connect").setIcon("satellite").onClick(()=>{c.connected?(c.shouldConnect=!1,c.disconnect()):(c.shouldConnect=!0,c.connect()),this._liveViews.refresh("folder connection toggle")})})):a.addItem(u=>{u.setTitle("Relay: Local folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${c.guid}`)})}),c.relayId&&je().enableSyncModal&&a.addItem(u=>{u.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new La(this.app,this.backgroundSync,this.sharedFolders,c.guid);this.openModals.push(f),f.open()})}),je().enableSyncMenu&&c.relayId&&c.connected&&a.addItem(u=>{u.setTitle("Relay: Sync").setIcon("folder-sync").onClick(()=>{c.netSync()})})}else if(l instanceof ot.TFile){let c=this.sharedFolders.lookup(l.path),u=c==null?void 0:c.getFile(l);u&&Hr(u)&&(a.addItem(f=>{f.setTitle("Relay: Download").setIcon("cloud-download").onClick(async()=>{await u.pull(),new ot.Notice(`Download complete: ${u.name}`)})}),this.debugSettings.get().debugging&&a.addItem(f=>{f.setTitle("Relay: Verify upload").setIcon("search-check").onClick(async()=>{let d=await u.verifyUpload();new ot.Notice(`${u.name} ${d?"on server":"missing from server"}`)})}),a.addItem(f=>{f.setTitle("Relay: Upload").setIcon("cloud-upload").onClick(async()=>{await u.push(!0);let d=await u.verifyUpload();new ot.Notice(`${d?"File uploaded:":"File upload failed:"} ${u.name}`)})}))}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=ot.moment.now()-t})}async reload(){this.app.reloadRelay()()}_createSharedFolder(t,r,n,s){let i=new nr(this.settings,`sharedFolders/[guid=${r}]`),a={guid:r,path:t};return n&&(a.relay=n),i.update(c=>({...c,path:t,guid:r,...n?{relay:n}:{},sync:c.sync?c.sync:kn.defaultFlags}),!0),new Al(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.hashStore,this.backgroundSync,i,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let i=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=i==null?void 0:i.instance)!=null&&s.options)||!i.enabled){this.warn("Webviewer plugin not found or not initialized");return}let a=i.instance.options,l=Object.getOwnPropertyDescriptor(a,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(a,"openExternalURLs",{get(){var p;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((p=d==null?void 0:d.detail)!=null&&p.url)){let m=d.detail.url;for(let y of t.interceptedUrls)if(typeof y=="string"&&m.startsWith(y)||y instanceof RegExp&&y.test(m))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(a,"openExternalURLs",l)}),this.loginManager.getWebviewIntercepts().forEach(d=>{this.debug("Intercepting Webviewer for URL pattern",d.source),this.interceptedUrls.push(d)});let u=this.loginManager.getEndpointManager().getApiUrl(),f=new RegExp(u.replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",f.source),this.interceptedUrls.push(f),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(i){this.error("Failed to patch webviewer:",i)}}setup(){this.folderNavDecorations=new nc(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Fe("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",c=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Fe("[System 3][Relay][Vault]","log"),n=c=>{},s=c=>n(c);window.addEventListener("unhandledrejection",s,!0),this.register(()=>window.removeEventListener("unhandledrejection",s,!0)),this.registerEvent(this.app.vault.on("create",c=>{let u=this.sharedFolders.lookup(c.path);u&&(u.placeHold([c]).length>0?u.uploadFile(c):u.whenReady().then(d=>{d.getFile(c)}))})),this.registerEvent(this.app.vault.on("delete",c=>{if(c instanceof ot.TFolder){let f=this.sharedFolders.find(d=>d.path===c.path);if(f){this.sharedFolders.delete(f);return}}let u=this.sharedFolders.lookup(c.path);u&&(r("Delete",c.path),u.whenReady().then(f=>{f.proxy.deleteFile(c.path)}))})),this.registerEvent(this.app.vault.on("rename",(c,u)=>{if(c instanceof ot.TFolder){let m=this.sharedFolders.find(y=>y.path==u);if(m){m.move(c.path),this.sharedFolders.update();return}}let f=this.sharedFolders.lookup(u),d=this.sharedFolders.lookup(c.path),p=f||d;f&&d?(r("Rename",c.path,u),f.renameFile(c,u),d.renameFile(c,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):p&&(r("Rename",c.path,u),p.renameFile(c,u),this._liveViews.refresh("rename"),this.folderNavDecorations.refresh())})),this.registerEvent(this.app.vault.on("modify",c=>{let u=this.sharedFolders.lookup(c.path);if(u){r("Modify",c.path);let f=u.proxy.getFile(c);f&&Hr(f)&&f.sync(),this.timeProvider.setTimeout(()=>{this.app.metadataCache.trigger("resolve",f)},10)}}));let i=this,a=Zo(ot.MarkdownView.prototype,{onUnloadFile(c){return function(u){return i._liveViews.wipe(),c.call(this,u)}}});this.register(a);let l=Zo(this.app.vault,{process(c){return function(u,f,d){try{let p=i.sharedFolders.lookup(u.path);if(p){let m=p.proxy.getFile(u);u instanceof ot.TFile&&m&&Sr(m)&&m.process(f)}}catch(p){i.log(p)}return c.call(this,u,f,d)}}});this.register(l),this.patchWebviewer(),vn(Ho.enableNewLinkFormat,()=>{let c=Zo(ot.MetadataCache.prototype,{fileToLinktext(u){return function(f,d,p){if(i.sharedFolders.lookup(f.path)){p===void 0&&(p=!0);let y=f.extension==="md"&&p?f.basename:f.name,g=(0,ot.normalizePath)(f.name),k=i.app.metadataCache.uniqueFileLookup.get(g.toLowerCase());if(k&&k.length===1&&k[0]===f)return y;{let L=f.extension==="md"&&p?f.path.slice(0,f.path.length-3):f.path,I=(0,L1.relative)(d,L);return I==="../"+y?"./"+y:I}}return u.call(this,f,d,p)}}});this.register(c)}),this.registerObsidianProtocolHandler("relay/settings/relays",async c=>{let u=c,f=new URLSearchParams({...u}).toString(),d=`/${u.action.split("/").slice(-1)}?${f}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async c=>{let u=c,f=new URLSearchParams({...u}).toString(),d=`/${u.action.split("/").slice(-1)}?${f}`;this.openSettings(d)}),this.registerObsidianProtocolHandler("relay/upgrade",async c=>{var d;let f=(d=c.version)==null?void 0:d.trim();this.installVersion(f)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new Ta(this.app,this,t);this.app.setting.close(),this.openModals.push(r),r.open()}removeCommand(t){if((0,ot.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,i,a,l,c,u,f,d,p,m,y;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(si),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(i=this.tokenStore)==null||i.stop(),(a=this.tokenStore)==null||a.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(c=this.networkStatus)==null||c.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(g=>{g.close()}),this.openModals.length=0,(f=this.sharedFolders)==null||f.destroy(),this.sharedFolders=null,(d=this.settingsTab)==null||d.destroy(),this.settingsTab=null,(p=this.loginManager)==null||p.destroy(),this.loginManager=null,(m=this.backgroundSync)==null||m.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(y=this.app)==null||y.workspace.updateOptions(),this.app.reloadRelay=void 0,this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,xt.destroy(),this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.loginSettings.destroy(),this.loginSettings=null,this.endpointSettings.destroy(),this.endpointSettings=null,this.interceptedUrls.length=0,Vr.destroy(),this.notifier=null,Py(),vf()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/check.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder-lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder-open.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/home.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/lock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/square-pen.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/x.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */